<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
	<channel>
		<title>Xenojoshua</title>
		<description>Joshua's Xeno World!</description>
		<link>https://xenojoshua.com</link>
		<atom:link href="https://xenojoshua.com/feed.xml" rel="self" type="application/rss+xml" />
		
			<item>
				<title>Memcached Notes</title>
				<description>&lt;h4&gt;Table of Contents&lt;/h4&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#1-前言&quot; id=&quot;markdown-toc-1-前言&quot;&gt;1. 前言&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2-清单&quot; id=&quot;markdown-toc-2-清单&quot;&gt;2. 清单&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#21-mixi的系列博文&quot; id=&quot;markdown-toc-21-mixi的系列博文&quot;&gt;2.1 Mixi的系列博文&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#22-自撰的系列博文&quot; id=&quot;markdown-toc-22-自撰的系列博文&quot;&gt;2.2 自撰的系列博文&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;1-前言&quot;&gt;1. 前言&lt;/h1&gt;
&lt;p&gt;早年对memcached有过一系列非常深入的研究分析，并形成了大量的文字积累。memcached这个软件在那么多年中也并没有什么很大的变化，毕竟它要服务的功能相对来说还是非常稳定的，就那么一小块，做好就好了。&lt;/p&gt;

&lt;p&gt;因为文章年代都比较久远了，现在要找都需要到tag里去搜，就比较麻烦。因此在这里做一个综合，把所有的内容都罗列进来。&lt;/p&gt;

&lt;h1 id=&quot;2-清单&quot;&gt;2. 清单&lt;/h1&gt;
&lt;h2 id=&quot;21-mixi的系列博文&quot;&gt;2.1 Mixi的系列博文&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/2011/04/memcached-anatomy-001/&quot; target=&quot;_blank&quot;&gt;memcached完全剖析–1. memcached的基础&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/2011/04/memcached-anatomy-002/&quot; target=&quot;_blank&quot;&gt;memcached全面剖析–2.理解memcached的内存存储&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/2011/04/memcached-anatomy-003/&quot; target=&quot;_blank&quot;&gt;memcached全面剖析–3.memcached的删除机制和发展方向&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/2011/04/memcached-anatomy-004/&quot; target=&quot;_blank&quot;&gt;memcached全面剖析–4. memcached的分布式算法&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/2011/04/memcached-anatomy-005/&quot; target=&quot;_blank&quot;&gt;memcached全面剖析–5. memcached的应用和兼容程序&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;22-自撰的系列博文&quot;&gt;2.2 自撰的系列博文&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;/2011/04/deep-in-memcached-how-it-works/&quot; target=&quot;_blank&quot;&gt;Memcached深入理解 - memcached究竟是如何运作的&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/2011/04/deep-in-memcached-learning-official-protocol-stats/&quot; target=&quot;_blank&quot;&gt;Memcached深入理解 – 理解官方protocol中的统计方法&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;/2011/04/deep-in-memcached-how-to-monitor/&quot; target=&quot;_blank&quot;&gt;Memcached深入理解 - memcached的监控&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;EOF&lt;/p&gt;
&lt;/blockquote&gt;
</description>
				<pubDate>Sat, 11 May 2019 10:01:22 +0800</pubDate>
				<link>https://xenojoshua.com/2019/05/memcached-note/</link>
				<guid isPermaLink="true">https://xenojoshua.com/2019/05/memcached-note/</guid>
			</item>
		
			<item>
				<title>Golang Pipeline</title>
				<description>&lt;h4&gt;Table of Contents&lt;/h4&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#1-前言&quot; id=&quot;markdown-toc-1-前言&quot;&gt;1. 前言&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2-channel实验范例&quot; id=&quot;markdown-toc-2-channel实验范例&quot;&gt;2. Channel实验范例&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#3-go-concurrency-patterns-pipelines-and-cancellation&quot; id=&quot;markdown-toc-3-go-concurrency-patterns-pipelines-and-cancellation&quot;&gt;3. Go Concurrency Patterns: Pipelines and cancellation&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#31-什么是pipeline&quot; id=&quot;markdown-toc-31-什么是pipeline&quot;&gt;3.1 什么是Pipeline&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#32-cancel-channel-done&quot; id=&quot;markdown-toc-32-cancel-channel-done&quot;&gt;3.2 Cancel: Channel Done&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#33-cancel-context&quot; id=&quot;markdown-toc-33-cancel-context&quot;&gt;3.3 Cancel: Context&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#资料&quot; id=&quot;markdown-toc-资料&quot;&gt;资料&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#链接&quot; id=&quot;markdown-toc-链接&quot;&gt;链接&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;1-前言&quot;&gt;1. 前言&lt;/h1&gt;
&lt;p&gt;学习一门新语言最简单的就是那些顺序执行的语言，会了PHP，换JAVA、Python、Ruby，无非就是语法更换下，上stackoverflow查下：”python字符串拼接”之类的，看下怎么写就完事了。难的是那些有特殊编程思维的语言，比如说JavaScript，异步原生，写代码要非常小心注意异步的返回如何处理，否则就会明明看着是先A后B，执行的时候却成了先B再A。就这方面来说，Go语言也属于后者，属于那种&lt;code&gt;语法看会简单，实际学精很难&lt;/code&gt;的语言，而Golang难就难在goroutine以及channel带来的功能上。&lt;/p&gt;

&lt;p&gt;之前在查看Go语言的gRPC第三方库的时候，其代码对channel的运用非常灵活：&lt;a href=&quot;https://github.com/processout/grpc-go-pool/blob/master/pool.go&quot; target=&quot;_blank&quot;&gt;grpc-go-pool/pool.go&lt;/a&gt;。深感需要加深这块的理解。&lt;/p&gt;

&lt;p&gt;在学习的时候，找到了一篇官方之前的博客，时间比较早了（2014年），但还算有用：&lt;a href=&quot;https://blog.golang.org/pipelines&quot; target=&quot;_blank&quot;&gt;Go Concurrency Patterns: Pipelines and cancellation&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;不过语言还是一直在发展的，目前在进行批量的routine控制以及退出触发的方面，最佳的解决方案是&lt;code&gt;context&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;接下来，一点点开始。&lt;/p&gt;

&lt;h1 id=&quot;2-channel实验范例&quot;&gt;2. Channel实验范例&lt;/h1&gt;
&lt;p&gt;在阅读官方博文之前，先自己着手做一些范例代码，加深对于&lt;a href=&quot;/2019/03/golang-basic/#ID_CHANNEL&quot;&gt;Golang Basic &amp;gt; 2.4 通道 / 信道 channel&lt;/a&gt;的理解。&lt;/p&gt;

&lt;p&gt;我做了点简单的演示范例：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/tree/master/golang/src/experiment/channel&quot; target=&quot;_blank&quot;&gt;dist-system-practice/golang/src/experiment/channel/&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;只需要结果的话，可以直接读README：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/blob/master/golang/src/experiment/channel/README.md&quot; target=&quot;_blank&quot;&gt;dist-system-practice/golang/src/experiment/channel/README.md&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;当中有几点比较有意思：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;slice值进出channel之后，&lt;code&gt;地址&lt;/code&gt;并&lt;code&gt;没有改变&lt;/code&gt;，和pointer是一样的结果&lt;/li&gt;
  &lt;li&gt;channel在无buffer的情况下，很容易就会阻塞，导致routine睡眠，必须小心处理&lt;/li&gt;
  &lt;li&gt;带buffer的channel，在buffer耗尽之后也是同样的结果，实际上来说也必须小心阻塞&lt;/li&gt;
  &lt;li&gt;虽然向关闭的通道写数据会引起panic，但向关闭的通道&lt;code&gt;读数据&lt;/code&gt;却&lt;code&gt;不会&lt;/code&gt;，只会获得通道类型的&lt;code&gt;默认值&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;有一张图，很好地将一系列状态以及操作结果整理了出来，可以参考：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/05/golang-pipeline/close_chan.png&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;3-go-concurrency-patterns-pipelines-and-cancellation&quot;&gt;3. Go Concurrency Patterns: Pipelines and cancellation&lt;/h1&gt;
&lt;p&gt;这里并不会通篇翻译：&lt;a href=&quot;https://blog.golang.org/pipelines&quot; target=&quot;_blank&quot;&gt;Go Concurrency Patterns: Pipelines and cancellation&lt;/a&gt;，有需要的可以看&lt;a href=&quot;https://imdiot.github.io/2016/01/01/Go%20Concurrency%20Patterns-Pipelines%20and%20cancellation.html&quot; target=&quot;_blank&quot;&gt;这篇&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;此外，本章后半也会涉及到&lt;code&gt;context&lt;/code&gt;，毕竟这家伙才是现在的准标准。&lt;/p&gt;

&lt;h2 id=&quot;31-什么是pipeline&quot;&gt;3.1 什么是Pipeline&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;通过输入channel从&lt;code&gt;上游&lt;/code&gt;接收值&lt;/li&gt;
  &lt;li&gt;对这些数据执行某些函数，通常是生成一些新的值&lt;/li&gt;
  &lt;li&gt;通过输出channel发送值到&lt;code&gt;下游&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;而在这一系列的交棒过程中，&lt;code&gt;错误&lt;/code&gt;的发生和事务的&lt;code&gt;取消&lt;/code&gt;是正常的情况，必须要进行&lt;code&gt;处理&lt;/code&gt;，否则的话作为下游的routine可能会一直等待已经错误退出或取消事务的上游routine，导致&lt;code&gt;资源泄露&lt;/code&gt;。使用的难点就在这里。&lt;/p&gt;

&lt;h2 id=&quot;32-cancel-channel-done&quot;&gt;3.2 Cancel: Channel Done&lt;/h2&gt;
&lt;p&gt;官方博文中的代码范例写的非常散，因为有多处重复修改，这里提供一份完整拼接的版本：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/blob/master/golang/src/experiment/pipeline/pipeline.go&quot; target=&quot;_blank&quot;&gt;experiment/pipeline/pipeline.go&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;官方博文通篇都阅读了的话，撇开行文中的Dummy业务逻辑不谈，可以了解到该文主要还是谈了如何对出问题的routine进行退出通知。官方的博文中使用的方法是申明一个类型为&lt;code&gt;struct{}&lt;/code&gt;的Dummy通道，关闭该通道来进行退出消息的传送。&lt;/p&gt;

&lt;p&gt;通过：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// HL&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;range&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;nums&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
			&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// HL&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;以这样的方式，监听&lt;code&gt;done&lt;/code&gt;通道的关闭，退出routine函数，并设置defer函数，在routine函数退出的时候，清理对应的资源并关闭通道。这种编码解决方法确实能解决问题，但非常难看，也没有层级退出的概念。&lt;/p&gt;

&lt;h2 id=&quot;33-cancel-context&quot;&gt;3.3 Cancel: Context&lt;/h2&gt;
&lt;p&gt;&lt;code&gt;done通道&lt;/code&gt;确实能在功能上达到要求，但尚欠缺了一些要素，因此后续就有&lt;code&gt;context&lt;/code&gt;这个包的出现。相关的学习可以阅读：&lt;a href=&quot;https://deepzz.com/post/golang-context-package-notes.html&quot; target=&quot;_blank&quot;&gt;快速掌握 Golang context 包，简单示例&lt;/a&gt;。此外，还有官方博客：&lt;a href=&quot;https://blog.golang.org/context&quot; target=&quot;_blank&quot;&gt;Go Concurrency Patterns: Context&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;一些概念和规范这里做下引用：&lt;/p&gt;

&lt;p&gt;Context 的调用应该是链式的，通过&lt;code&gt;WithCancel&lt;/code&gt;，&lt;code&gt;WithDeadline&lt;/code&gt;，&lt;code&gt;WithTimeout&lt;/code&gt;或&lt;code&gt;WithValue&lt;/code&gt;派生出新的 Context。当父 Context 被取消时，其派生的所有 Context 都将取消。&lt;/p&gt;

&lt;p&gt;通过&lt;code&gt;context.WithXXX&lt;/code&gt;都将返回新的 Context 和 CancelFunc。调用 CancelFunc 将取消子代，移除父代对子代的引用，并且停止所有定时器。未能调用 CancelFunc 将泄漏子代，直到父代被取消或定时器触发。&lt;code&gt;go vet&lt;/code&gt;工具检查所有流程控制路径上使用 CancelFuncs。&lt;/p&gt;

&lt;p&gt;遵循以下规则，以保持包之间的接口一致，并启用静态分析工具以检查上下文传播。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;不要将 Contexts 放入结构体，相反&lt;code&gt;context&lt;/code&gt;应该作为第一个参数传入，命名为ctx。&lt;code&gt;func DoSomething（ctx context.Context，arg Arg）error { // ... use ctx ... }&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;即使函数允许，也不要传入&lt;code&gt;nil&lt;/code&gt;的 Context。如果不知道用哪种 Context，可以使用&lt;code&gt;context.TODO()&lt;/code&gt;。&lt;/li&gt;
  &lt;li&gt;使用context的Value相关方法只应该用于在程序和接口中传递的和请求相关的元数据，不要用它来传递一些可选的参数&lt;/li&gt;
  &lt;li&gt;相同的 Context 可以传递给在不同的&lt;code&gt;goroutine&lt;/code&gt;；Context 是并发安全的。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;用法：&lt;/p&gt;

&lt;p&gt;Done函数会返回一个channel，用来进行close通知（本质上还是之前的那一套）：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;gen&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ctx&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
			&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// returning not to leak the goroutine&lt;/span&gt;
		&lt;span class=&quot;c1&quot;&gt;//...&lt;/span&gt;
		&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//...&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;//...&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cancel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;WithCancel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;cancel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// cancel when we are finished consuming integers&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;此外，还有一篇老王的：&lt;a href=&quot;https://blog.huoding.com/2019/04/15/730&quot; target=&quot;_blank&quot;&gt;Golang之Context的迷思&lt;/a&gt;，可以好好读下。&lt;/p&gt;

&lt;h1 id=&quot;资料&quot;&gt;资料&lt;/h1&gt;
&lt;h2 id=&quot;链接&quot;&gt;链接&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/processout/grpc-go-pool/blob/master/pool.go&quot; target=&quot;_blank&quot;&gt;grpc-go-pool/pool.go&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.golang.org/pipelines&quot; target=&quot;_blank&quot;&gt;Go Concurrency Patterns: Pipelines and cancellation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://imdiot.github.io/2016/01/01/Go%20Concurrency%20Patterns-Pipelines%20and%20cancellation.html&quot; target=&quot;_blank&quot;&gt;『译』Go Concurrency Patterns: Pipelines and cancellation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://deepzz.com/post/golang-context-package-notes.html&quot; target=&quot;_blank&quot;&gt;快速掌握 Golang context 包，简单示例&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.huoding.com/2019/04/15/730&quot; target=&quot;_blank&quot;&gt;Golang之Context的迷思&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;EOF&lt;/p&gt;
&lt;/blockquote&gt;
</description>
				<pubDate>Fri, 10 May 2019 10:01:22 +0800</pubDate>
				<link>https://xenojoshua.com/2019/05/golang-pipeline/</link>
				<guid isPermaLink="true">https://xenojoshua.com/2019/05/golang-pipeline/</guid>
			</item>
		
			<item>
				<title>Envoy Notes</title>
				<description>&lt;h4&gt;Table of Contents&lt;/h4&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#1-前言&quot; id=&quot;markdown-toc-1-前言&quot;&gt;1. 前言&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2-选型--比较&quot; id=&quot;markdown-toc-2-选型--比较&quot;&gt;2. 选型 &amp;amp; 比较&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#3-benchmark&quot; id=&quot;markdown-toc-3-benchmark&quot;&gt;3. Benchmark&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#4-架构&quot; id=&quot;markdown-toc-4-架构&quot;&gt;4. 架构&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#5-使用&quot; id=&quot;markdown-toc-5-使用&quot;&gt;5. 使用&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#51-镜像&quot; id=&quot;markdown-toc-51-镜像&quot;&gt;5.1 镜像&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#52-配置&quot; id=&quot;markdown-toc-52-配置&quot;&gt;5.2 配置&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#53-负载均衡front-proxy范例&quot; id=&quot;markdown-toc-53-负载均衡front-proxy范例&quot;&gt;5.3 负载均衡Front Proxy范例&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ID_ADMIN&quot; id=&quot;markdown-toc-ID_ADMIN&quot;&gt;6. Admin&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#7-监控&quot; id=&quot;markdown-toc-7-监控&quot;&gt;7. 监控&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#8-todo&quot; id=&quot;markdown-toc-8-todo&quot;&gt;8. TODO&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#资料&quot; id=&quot;markdown-toc-资料&quot;&gt;资料&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#链接&quot; id=&quot;markdown-toc-链接&quot;&gt;链接&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ID_APP_STATS&quot; id=&quot;markdown-toc-ID_APP_STATS&quot;&gt;stats prometheus&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;1-前言&quot;&gt;1. 前言&lt;/h1&gt;
&lt;p&gt;Envoy应该说是云原生这个概念起来之后的代理应用No.1。在当前的发展趋势下，使用Envoy来解决代理需求应该是最佳方案。&lt;/p&gt;

&lt;p&gt;中文手册：&lt;a href=&quot;http://www.servicemesher.com/envoy/&quot; target=&quot;_blank&quot;&gt;Envoy 官方文档中文版&lt;/a&gt;。当前（&lt;strong&gt;2019-05-07&lt;/strong&gt;）Envoy的最新版本是&lt;code&gt;1.10&lt;/code&gt;，和中文的文档之间有几个小版本的跨度，需要注意。&lt;/p&gt;

&lt;h1 id=&quot;2-选型--比较&quot;&gt;2. 选型 &amp;amp; 比较&lt;/h1&gt;
&lt;p&gt;作为新生代的代理应用，在使用之前必然会有一个为什么的疑问，为什么需要使用Envoy，它和Nginx以及HAProxy这类老牌代理应用相比，好在哪里。&lt;/p&gt;

&lt;p&gt;有一篇不错的博文可以阅读下：&lt;a href=&quot;https://blog.getambassador.io/envoy-vs-nginx-vs-haproxy-why-the-open-source-ambassador-api-gateway-chose-envoy-23826aed79ef&quot; target=&quot;_blank&quot;&gt;Envoy vs NGINX vs HAProxy: Why the open source Ambassador API Gateway chose Envoy&lt;/a&gt;。作者最主要的Concern在于两点：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Nginx之类的其他软件，部分有商业版本和社区版本的区分，而社区版本普遍功能较为简陋，不能完全满足需求&lt;/li&gt;
  &lt;li&gt;HAProxy之类的老牌软件，因为各种原因，功能演进都非常缓慢，不能跟上日益高速发展的云原生技术&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;说穿了就是功能不足，无论是商业原因还是研发原因还是资源原因。&lt;/p&gt;

&lt;p&gt;那么Envoy能提供什么功能：&lt;a href=&quot;http://www.servicemesher.com/envoy/intro/what_is_envoy.html&quot; target=&quot;_blank&quot;&gt;Envoy 是什么？&lt;/a&gt;。可以看到Envoy提供的功能实在是太强大了，基本上现在主流的Proxy需求在Envoy身上都能得到满足。&lt;/p&gt;

&lt;p&gt;官方也有一篇横向比较：&lt;a href=&quot;http://www.servicemesher.com/envoy/intro/comparison.html&quot; target=&quot;_blank&quot;&gt;与类似系统比较&lt;/a&gt;。&lt;/p&gt;

&lt;h1 id=&quot;3-benchmark&quot;&gt;3. Benchmark&lt;/h1&gt;
&lt;p&gt;功能之后就是性能，那么和老牌的Nginx以及HAProxy等比较起来，Envoy的性能又如何呢。这里可以看下：&lt;a href=&quot;https://www.loggly.com/blog/benchmarking-5-popular-load-balancers-nginx-haproxy-envoy-traefik-and-alb/&quot; target=&quot;_blank&quot;&gt;Benchmarking 5 Popular Load Balancers: Nginx, HAProxy, Envoy, Traefik, and ALB&lt;/a&gt;。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Envoy came out as the overall winner in this benchmark. It had the highest throughput in terms of requests per second.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;文章发布时间是：&lt;code&gt;10 Dec 2018&lt;/code&gt;，应该说还是非常具有时效性的。&lt;/p&gt;

&lt;p&gt;&lt;img style=&quot;background-color:transparent;&quot; target=&quot;_blank&quot; src=&quot;/resources/2019/05/envoy-note/envoy-benchmark-01.png&quot; /&gt;
&lt;img style=&quot;background-color:transparent;&quot; target=&quot;_blank&quot; src=&quot;/resources/2019/05/envoy-note/envoy-benchmark-02.png&quot; /&gt;
&lt;img style=&quot;background-color:transparent;&quot; target=&quot;_blank&quot; src=&quot;/resources/2019/05/envoy-note/envoy-benchmark-03.png&quot; /&gt;
&lt;img style=&quot;background-color:transparent;&quot; target=&quot;_blank&quot; src=&quot;/resources/2019/05/envoy-note/envoy-benchmark-04.png&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;4-架构&quot;&gt;4. 架构&lt;/h1&gt;
&lt;p&gt;除了在Nginx中比较常见的作为流量入口的代理模式之外，Envoy还介绍了一种作为服务网格总线的架构模式：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/05/envoy-note/arch-service-to-service.png&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这种设计将Envoy作为面向服务架构（SOA）内部的所有流量的通信总线来使用。此设计将服务和服务之间的关系遮蔽了起来，服务集群只需要知道自己的Envoy在哪里即可，后续的流量就全部交给Envoy，而Envoy之间则通过服务发现将整个服务网格链接起来。&lt;/p&gt;

&lt;h1 id=&quot;5-使用&quot;&gt;5. 使用&lt;/h1&gt;
&lt;h2 id=&quot;51-镜像&quot;&gt;5.1 镜像&lt;/h2&gt;
&lt;p&gt;一般使用镜像的方式进行安装：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;docker pull envoyproxy/envoy:v1.10.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;启动：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;docker run --rm -it -d \
    --name envoy-test \
    --network=envoy-test-net \
    -p 9901:9901 \
    -p 9988:9988 \
    -v ${PATH}/conf:/etc/envoy \
    -v ${PATH}/log:/tmp \
    envoyproxy/envoy:v1.10.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;镜像中配置文件的位置为：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;/etc/envoy/envoy.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;可以通过volume进行对应的配置文件覆盖。&lt;/p&gt;

&lt;h2 id=&quot;52-配置&quot;&gt;5.2 配置&lt;/h2&gt;
&lt;p&gt;因功能实在是太强大，Envoy的配置也就比较复杂，官方文档配置方面的总纲在：&lt;a href=&quot;http://www.servicemesher.com/envoy/configuration/configuration.html&quot; target=&quot;_blank&quot;&gt;配置参考&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;此外，因Envoy的消息都是通过Protobuf来进行设计的，因此可以查看源代码来阅读配置项：&lt;a href=&quot;https://github.com/envoyproxy/envoy/tree/v1.10.0/api/envoy/config&quot; target=&quot;_blank&quot;&gt;envoy/api/envoy/config/&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;另外，官方代码库也给了很多配置范例：&lt;a href=&quot;https://github.com/envoyproxy/envoy/tree/master/examples&quot; target=&quot;_blank&quot;&gt;envoy/examples/&lt;/a&gt;。以及：几个sandbox范例：&lt;a href=&quot;http://www.servicemesher.com/envoy/start/sandboxes.html&quot; target=&quot;_blank&quot;&gt;Sandbox&lt;/a&gt;。最适合新手查看的应该是：&lt;a href=&quot;http://www.servicemesher.com/envoy/start/sandboxes/front_proxy.html&quot; target=&quot;_blank&quot;&gt;前端代理&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;有一篇&lt;a href=&quot;https://www.katacoda.com/envoyproxy/scenarios/migrating-from-nginx-to-envoy&quot; target=&quot;_blank&quot;&gt;Migrating from NGINX to Envoy Proxy by envoyproxy&lt;/a&gt;相当不错。以范例的形式讲解了Nginx的配置如何翻译到Envoy。&lt;/p&gt;

&lt;p&gt;几个重要的配置项：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/v1.10.0/operations/admin&quot; target=&quot;_blank&quot;&gt;Administration interface&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/api/v2/lds.proto&quot; target=&quot;_blank&quot;&gt;Listener&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/api/v2/listener/listener.proto#envoy-api-msg-listener-filter&quot; target=&quot;_blank&quot;&gt;listener.Filter&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/config/filter/network/http_connection_manager/v2/http_connection_manager.proto#envoy-api-msg-config-filter-network-http-connection-manager-v2-httpfilter&quot; target=&quot;_blank&quot;&gt;HttpFilter&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/api/v2/cds.proto#cluster&quot; target=&quot;_blank&quot;&gt;Cluster&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/v1.10.0/api-v2/api/v2/route/route.proto#envoy-api-msg-route-virtualhost&quot; target=&quot;_blank&quot;&gt;route.VirtualHost&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;细节这里就不展开了，实在是篇幅太大。简单的范例可以直接看官方给的例子。&lt;/p&gt;

&lt;h2 id=&quot;53-负载均衡front-proxy范例&quot;&gt;5.3 负载均衡Front Proxy范例&lt;/h2&gt;
&lt;p&gt;简单的带负载均衡的Front Proxy范例可以看：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/tree/master/experiment/envoy&quot; target=&quot;_blank&quot;&gt;dist-system-practice/experiment/envoy/&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;踩过的几个坑：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;监听端的地址都必须是&lt;code&gt;0.0.0.0&lt;/code&gt;，不能是127.0.0.1，否则在容器里收不到外部请求&lt;/li&gt;
  &lt;li&gt;将其他的网络服务作为upstream使用时，必须与envoy连接在同一个docker network中&lt;/li&gt;
  &lt;li&gt;clusters配置中的端点地址可以使用其他&lt;code&gt;docker容器的名字&lt;/code&gt;作为address&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;ID_ADMIN&quot;&gt;6. Admin&lt;/h1&gt;
&lt;p&gt;在Envoy的配置中有一个&lt;code&gt;admin&lt;/code&gt;节点可以用来配置admin功能访问：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;admin&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;access_log_path&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;/tmp/admin_access.log&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;profile_path&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;/tmp/envoy.prof&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;socket_address&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;address&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;127.0.0.1&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;port_value&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;9901&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;提供一些admin相关功能，文档可以看：&lt;a href=&quot;https://www.envoyproxy.io/docs/envoy/v1.10.0/operations/admin&quot; target=&quot;_blank&quot;&gt;Administration interface&lt;/a&gt;。功能列表东西还真不少。&lt;/p&gt;

&lt;p&gt;需要注意：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;All mutations must be sent as HTTP POST operations. When a mutation is requested via GET, the request has no effect, and an HTTP 400 (Invalid Request) response is returned.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;7-监控&quot;&gt;7. 监控&lt;/h1&gt;
&lt;p&gt;监控一样可以使用Prometheus进行Metrics采集。Envoy在启动的时候必须配置&lt;a href=&quot;#ID_ADMIN&quot;&gt;6. Admin&lt;/a&gt;，然后就可以在&lt;code&gt;http://127.0.0.1:9901/stats/prometheus&lt;/code&gt;获取到Metrics。&lt;/p&gt;

&lt;p&gt;本文在最后的附录部分留了一份样例：&lt;a href=&quot;#ID_APP_STATS&quot;&gt;stats prometheus&lt;/a&gt;。&lt;/p&gt;

&lt;h1 id=&quot;8-todo&quot;&gt;8. TODO&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;Envoy的内部架构&lt;/li&gt;
  &lt;li&gt;Envoy的高可用设计&lt;/li&gt;
  &lt;li&gt;Envoy热加载的设计原理&lt;/li&gt;
  &lt;li&gt;Envoy的集群使用&lt;/li&gt;
  &lt;li&gt;Envoy的其他高级功能使用范例&lt;/li&gt;
  &lt;li&gt;Envoy的Metrics理解&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;资料&quot;&gt;资料&lt;/h1&gt;
&lt;h2 id=&quot;链接&quot;&gt;链接&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://jvns.ca/blog/2018/10/27/envoy-basics/&quot; target=&quot;_blank&quot;&gt;Some Envoy basics&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.servicemesher.com/envoy/&quot; target=&quot;_blank&quot;&gt;Envoy 官方文档中文版&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.getambassador.io/envoy-vs-nginx-vs-haproxy-why-the-open-source-ambassador-api-gateway-chose-envoy-23826aed79ef&quot; target=&quot;_blank&quot;&gt;Envoy vs NGINX vs HAProxy: Why the open source Ambassador API Gateway chose Envoy&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.loggly.com/blog/benchmarking-5-popular-load-balancers-nginx-haproxy-envoy-traefik-and-alb/&quot; target=&quot;_blank&quot;&gt;Benchmarking 5 Popular Load Balancers: Nginx, HAProxy, Envoy, Traefik, and ALB&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.katacoda.com/envoyproxy/scenarios/migrating-from-nginx-to-envoy&quot; target=&quot;_blank&quot;&gt;Migrating from NGINX to Envoy Proxy by envoyproxy&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ID_APP_STATS&quot;&gt;stats prometheus&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_admin_http_downstream_rq_xx counter&lt;/span&gt;
envoy_listener_admin_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_listener_admin_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;4&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_admin_downstream_cx_destroy counter&lt;/span&gt;
envoy_listener_admin_downstream_cx_destroy&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_admin_downstream_cx_total counter&lt;/span&gt;
envoy_listener_admin_downstream_cx_total&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;
envoy_listener_admin_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_admin_downstream_pre_cx_timeout counter&lt;/span&gt;
envoy_listener_admin_downstream_pre_cx_timeout&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_admin_http_downstream_rq_completed counter&lt;/span&gt;
envoy_listener_admin_http_downstream_rq_completed&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_admin_no_filter_chain_match counter&lt;/span&gt;
envoy_listener_admin_no_filter_chain_match&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_manager_update_out_of_merge_window counter&lt;/span&gt;
envoy_cluster_manager_update_out_of_merge_window&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_flow_control_resumed_reading_total counter&lt;/span&gt;
envoy_http_downstream_flow_control_resumed_reading_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_http2_total counter&lt;/span&gt;
envoy_http_downstream_cx_http2_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_manager_listener_added counter&lt;/span&gt;
envoy_listener_manager_listener_added&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_overload_close counter&lt;/span&gt;
envoy_http_downstream_rq_overload_close&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_manager_listener_create_success counter&lt;/span&gt;
envoy_listener_manager_listener_create_success&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_http1_total counter&lt;/span&gt;
envoy_http_downstream_cx_http1_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_stats_overflow counter&lt;/span&gt;
envoy_stats_overflow&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_manager_listener_create_failure counter&lt;/span&gt;
envoy_listener_manager_listener_create_failure&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_destroy_remote counter&lt;/span&gt;
envoy_http_downstream_cx_destroy_remote&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_non_relative_path counter&lt;/span&gt;
envoy_http_downstream_rq_non_relative_path&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_no_route counter&lt;/span&gt;
envoy_http_no_route&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;async-client&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_manager_cluster_updated counter&lt;/span&gt;
envoy_cluster_manager_cluster_updated&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_rs_too_large counter&lt;/span&gt;
envoy_http_rs_too_large&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_tx_reset counter&lt;/span&gt;
envoy_http_downstream_rq_tx_reset&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_watchdog_mega_miss counter&lt;/span&gt;
envoy_server_watchdog_mega_miss&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_access_log_file_flushed_by_timer counter&lt;/span&gt;
envoy_access_log_file_flushed_by_timer&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;14&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_rx_bytes_total counter&lt;/span&gt;
envoy_http_downstream_cx_rx_bytes_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1029&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_flow_control_paused_reading_total counter&lt;/span&gt;
envoy_http_downstream_flow_control_paused_reading_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_completed counter&lt;/span&gt;
envoy_http_downstream_rq_completed&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_manager_listener_removed counter&lt;/span&gt;
envoy_listener_manager_listener_removed&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_xx counter&lt;/span&gt;
envoy_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;4&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_access_log_file_reopen_failed counter&lt;/span&gt;
envoy_access_log_file_reopen_failed&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_rq_direct_response counter&lt;/span&gt;
envoy_http_rq_direct_response&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;async-client&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_ws_on_non_ws_route counter&lt;/span&gt;
envoy_http_downstream_rq_ws_on_non_ws_route&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_manager_cluster_updated_via_merge counter&lt;/span&gt;
envoy_cluster_manager_cluster_updated_via_merge&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_manager_cluster_added counter&lt;/span&gt;
envoy_cluster_manager_cluster_added&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_runtime_override_dir_exists counter&lt;/span&gt;
envoy_runtime_override_dir_exists&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_http2_total counter&lt;/span&gt;
envoy_http_downstream_rq_http2_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_response_before_rq_complete counter&lt;/span&gt;
envoy_http_downstream_rq_response_before_rq_complete&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_manager_listener_modified counter&lt;/span&gt;
envoy_listener_manager_listener_modified&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_runtime_deprecated_feature_use counter&lt;/span&gt;
envoy_runtime_deprecated_feature_use&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;21&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_idle_timeout counter&lt;/span&gt;
envoy_http_downstream_cx_idle_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_rq_redirect counter&lt;/span&gt;
envoy_http_rq_redirect&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;async-client&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_too_large counter&lt;/span&gt;
envoy_http_downstream_rq_too_large&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_protocol_error counter&lt;/span&gt;
envoy_http_downstream_cx_protocol_error&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_timeout counter&lt;/span&gt;
envoy_http_downstream_rq_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_runtime_override_dir_not_exists counter&lt;/span&gt;
envoy_runtime_override_dir_not_exists&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_runtime_load_error counter&lt;/span&gt;
envoy_runtime_load_error&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_access_log_file_write_completed counter&lt;/span&gt;
envoy_access_log_file_write_completed&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_no_cluster counter&lt;/span&gt;
envoy_http_no_cluster&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;async-client&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_rq_reset_after_downstream_response_started counter&lt;/span&gt;
envoy_http_rq_reset_after_downstream_response_started&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;async-client&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_watchdog_miss counter&lt;/span&gt;
envoy_server_watchdog_miss&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_manager_cluster_removed counter&lt;/span&gt;
envoy_cluster_manager_cluster_removed&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_debug_assertion_failures counter&lt;/span&gt;
envoy_server_debug_assertion_failures&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_manager_update_merge_cancelled counter&lt;/span&gt;
envoy_cluster_manager_update_merge_cancelled&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_overload_disable_keepalive counter&lt;/span&gt;
envoy_http_downstream_cx_overload_disable_keepalive&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_upgrades_total counter&lt;/span&gt;
envoy_http_downstream_cx_upgrades_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_tx_bytes_total counter&lt;/span&gt;
envoy_http_downstream_cx_tx_bytes_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5132&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_destroy counter&lt;/span&gt;
envoy_http_downstream_cx_destroy&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_destroy_local_active_rq counter&lt;/span&gt;
envoy_http_downstream_cx_destroy_local_active_rq&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_drain_close counter&lt;/span&gt;
envoy_http_downstream_cx_drain_close&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_http1_total counter&lt;/span&gt;
envoy_http_downstream_rq_http1_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_destroy_active_rq counter&lt;/span&gt;
envoy_http_downstream_cx_destroy_active_rq&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_access_log_file_write_buffered counter&lt;/span&gt;
envoy_access_log_file_write_buffered&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;6&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_destroy_local counter&lt;/span&gt;
envoy_http_downstream_cx_destroy_local&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_rq_total counter&lt;/span&gt;
envoy_http_rq_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;async-client&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_total counter&lt;/span&gt;
envoy_http_downstream_cx_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_total counter&lt;/span&gt;
envoy_http_downstream_rq_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_runtime_load_success counter&lt;/span&gt;
envoy_runtime_load_success&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_manager_cluster_modified counter&lt;/span&gt;
envoy_cluster_manager_cluster_modified&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_rx_reset counter&lt;/span&gt;
envoy_http_downstream_rq_rx_reset&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_idle_timeout counter&lt;/span&gt;
envoy_http_downstream_rq_idle_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_delayed_close_timeout counter&lt;/span&gt;
envoy_http_downstream_cx_delayed_close_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_destroy_remote_active_rq counter&lt;/span&gt;
envoy_http_downstream_cx_destroy_remote_active_rq&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_ssl_total counter&lt;/span&gt;
envoy_http_downstream_cx_ssl_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_idle_timeout counter&lt;/span&gt;
envoy_cluster_upstream_cx_idle_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_destroy_local counter&lt;/span&gt;
envoy_cluster_upstream_cx_destroy_local&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_close_notify counter&lt;/span&gt;
envoy_cluster_upstream_cx_close_notify&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_flow_control_paused_reading_total counter&lt;/span&gt;
envoy_cluster_upstream_flow_control_paused_reading_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_connect_timeout counter&lt;/span&gt;
envoy_cluster_upstream_cx_connect_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_xx counter&lt;/span&gt;
envoy_cluster_upstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;,envoy_cluster_name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_cancelled counter&lt;/span&gt;
envoy_cluster_upstream_rq_cancelled&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_overflow counter&lt;/span&gt;
envoy_cluster_upstream_cx_overflow&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_destroy_local_with_active_rq counter&lt;/span&gt;
envoy_cluster_upstream_cx_destroy_local_with_active_rq&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_internal_redirect_succeeded_total counter&lt;/span&gt;
envoy_cluster_upstream_internal_redirect_succeeded_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_subsets_fallback counter&lt;/span&gt;
envoy_cluster_lb_subsets_fallback&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_zone_routing_sampled counter&lt;/span&gt;
envoy_cluster_lb_zone_routing_sampled&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_connect_attempts_exceeded counter&lt;/span&gt;
envoy_cluster_upstream_cx_connect_attempts_exceeded&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_per_try_timeout counter&lt;/span&gt;
envoy_cluster_upstream_rq_per_try_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_tx_bytes_total counter&lt;/span&gt;
envoy_cluster_upstream_cx_tx_bytes_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1065&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_flow_control_resumed_reading_total counter&lt;/span&gt;
envoy_cluster_upstream_flow_control_resumed_reading_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_original_dst_host_invalid counter&lt;/span&gt;
envoy_cluster_original_dst_host_invalid&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_subsets_created counter&lt;/span&gt;
envoy_cluster_lb_subsets_created&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_external_upstream_rq_completed counter&lt;/span&gt;
envoy_cluster_external_upstream_rq_completed&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_rx_bytes_total counter&lt;/span&gt;
envoy_cluster_upstream_cx_rx_bytes_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;715&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_flow_control_backed_up_total counter&lt;/span&gt;
envoy_cluster_upstream_flow_control_backed_up_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_update_success counter&lt;/span&gt;
envoy_cluster_update_success&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;58&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_update_no_rebuild counter&lt;/span&gt;
envoy_cluster_update_no_rebuild&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;56&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_destroy_remote_with_active_rq counter&lt;/span&gt;
envoy_cluster_upstream_cx_destroy_remote_with_active_rq&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_zone_cluster_too_small counter&lt;/span&gt;
envoy_cluster_lb_zone_cluster_too_small&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_zone_routing_all_directly counter&lt;/span&gt;
envoy_cluster_lb_zone_routing_all_directly&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_protocol_error counter&lt;/span&gt;
envoy_cluster_upstream_cx_protocol_error&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_external_upstream_rq_xx counter&lt;/span&gt;
envoy_cluster_external_upstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;,envoy_cluster_name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_external_upstream_rq counter&lt;/span&gt;
envoy_cluster_external_upstream_rq&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;200&amp;quot;&lt;/span&gt;,envoy_cluster_name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_completed counter&lt;/span&gt;
envoy_cluster_upstream_rq_completed&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_update_attempt counter&lt;/span&gt;
envoy_cluster_update_attempt&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;58&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_recalculate_zone_structures counter&lt;/span&gt;
envoy_cluster_lb_recalculate_zone_structures&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_pending_overflow counter&lt;/span&gt;
envoy_cluster_upstream_rq_pending_overflow&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_bind_errors counter&lt;/span&gt;
envoy_cluster_bind_errors&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_retry_overflow counter&lt;/span&gt;
envoy_cluster_upstream_rq_retry_overflow&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq counter&lt;/span&gt;
envoy_cluster_upstream_rq&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;200&amp;quot;&lt;/span&gt;,envoy_cluster_name&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_zone_number_differs counter&lt;/span&gt;
envoy_cluster_lb_zone_number_differs&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_none_healthy counter&lt;/span&gt;
envoy_cluster_upstream_cx_none_healthy&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_zone_no_capacity_left counter&lt;/span&gt;
envoy_cluster_lb_zone_no_capacity_left&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_update_failure counter&lt;/span&gt;
envoy_cluster_update_failure&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_timeout counter&lt;/span&gt;
envoy_cluster_upstream_rq_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_destroy_remote counter&lt;/span&gt;
envoy_cluster_upstream_cx_destroy_remote&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_max_requests counter&lt;/span&gt;
envoy_cluster_upstream_cx_max_requests&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_internal_redirect_failed_total counter&lt;/span&gt;
envoy_cluster_upstream_internal_redirect_failed_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_flow_control_drained_total counter&lt;/span&gt;
envoy_cluster_upstream_flow_control_drained_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_local_cluster_not_ok counter&lt;/span&gt;
envoy_cluster_lb_local_cluster_not_ok&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_rx_reset counter&lt;/span&gt;
envoy_cluster_upstream_rq_rx_reset&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_destroy counter&lt;/span&gt;
envoy_cluster_upstream_cx_destroy&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_subsets_selected counter&lt;/span&gt;
envoy_cluster_lb_subsets_selected&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_subsets_removed counter&lt;/span&gt;
envoy_cluster_lb_subsets_removed&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_http1_total counter&lt;/span&gt;
envoy_cluster_upstream_cx_http1_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_connect_fail counter&lt;/span&gt;
envoy_cluster_upstream_cx_connect_fail&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_pending_total counter&lt;/span&gt;
envoy_cluster_upstream_rq_pending_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_zone_routing_cross_zone counter&lt;/span&gt;
envoy_cluster_lb_zone_routing_cross_zone&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_healthy_panic counter&lt;/span&gt;
envoy_cluster_lb_healthy_panic&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_total counter&lt;/span&gt;
envoy_cluster_upstream_cx_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_http2_total counter&lt;/span&gt;
envoy_cluster_upstream_cx_http2_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_destroy_with_active_rq counter&lt;/span&gt;
envoy_cluster_upstream_cx_destroy_with_active_rq&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_total counter&lt;/span&gt;
envoy_cluster_upstream_rq_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_retry_success counter&lt;/span&gt;
envoy_cluster_upstream_rq_retry_success&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_subsets_fallback_panic counter&lt;/span&gt;
envoy_cluster_lb_subsets_fallback_panic&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_pending_failure_eject counter&lt;/span&gt;
envoy_cluster_upstream_rq_pending_failure_eject&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_membership_change counter&lt;/span&gt;
envoy_cluster_membership_change&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_retry counter&lt;/span&gt;
envoy_cluster_upstream_rq_retry&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_retry_or_shadow_abandoned counter&lt;/span&gt;
envoy_cluster_retry_or_shadow_abandoned&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_maintenance_mode counter&lt;/span&gt;
envoy_cluster_upstream_rq_maintenance_mode&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_tx_reset counter&lt;/span&gt;
envoy_cluster_upstream_rq_tx_reset&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_update_empty counter&lt;/span&gt;
envoy_cluster_update_empty&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_http_downstream_rq_xx counter&lt;/span&gt;
envoy_listener_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,envoy_listener_address&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;4&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,envoy_listener_address&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_downstream_cx_destroy counter&lt;/span&gt;
envoy_listener_downstream_cx_destroy&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,envoy_listener_address&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,envoy_listener_address&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_downstream_pre_cx_timeout counter&lt;/span&gt;
envoy_listener_downstream_pre_cx_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,envoy_listener_address&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_http_downstream_rq_completed counter&lt;/span&gt;
envoy_listener_http_downstream_rq_completed&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,envoy_listener_address&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_no_filter_chain_match counter&lt;/span&gt;
envoy_listener_no_filter_chain_match&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_downstream_cx_total counter&lt;/span&gt;
envoy_listener_downstream_cx_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_tx_reset&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_destroy_remote_active_rq&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_http1_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_overload_close&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_tracing_random_sampling counter&lt;/span&gt;
envoy_http_tracing_random_sampling&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_no_route&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_destroy_remote&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_protocol_error&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_response_before_rq_complete&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_rq_direct_response&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_flow_control_resumed_reading_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_destroy_local_active_rq&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_http1_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_rq_reset_after_downstream_response_started&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_tracing_service_forced counter&lt;/span&gt;
envoy_http_tracing_service_forced&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_overload_disable_keepalive&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_ws_on_non_ws_route&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_rx_bytes_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;390&lt;/span&gt;
envoy_http_downstream_cx_idle_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_idle_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_rs_too_large&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_completed&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_no_cluster&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_destroy_local&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_rx_reset&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_rq_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_tracing_not_traceable counter&lt;/span&gt;
envoy_http_tracing_not_traceable&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_tx_bytes_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;840&lt;/span&gt;
envoy_http_downstream_cx_delayed_close_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_drain_close&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_flow_control_paused_reading_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_timeout&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_destroy&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_rq_redirect&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_tracing_health_check counter&lt;/span&gt;
envoy_http_tracing_health_check&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_ssl_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_too_large&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_tracing_client_enabled counter&lt;/span&gt;
envoy_http_tracing_client_enabled&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_xx&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_response_code_class&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;4&amp;quot;&lt;/span&gt;,envoy_http_conn_manager_prefix&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_upgrades_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_http2_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_non_relative_path&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_http2_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_destroy_active_rq&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_admin_downstream_pre_cx_active gauge&lt;/span&gt;
envoy_listener_admin_downstream_pre_cx_active&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_admin_downstream_cx_active gauge&lt;/span&gt;
envoy_listener_admin_downstream_cx_active&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_active gauge&lt;/span&gt;
envoy_http_downstream_cx_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_manager_total_listeners_draining gauge&lt;/span&gt;
envoy_listener_manager_total_listeners_draining&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_parent_connections gauge&lt;/span&gt;
envoy_server_parent_connections&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_runtime_admin_overrides_active gauge&lt;/span&gt;
envoy_runtime_admin_overrides_active&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_manager_active_clusters gauge&lt;/span&gt;
envoy_cluster_manager_active_clusters&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_manager_warming_clusters gauge&lt;/span&gt;
envoy_cluster_manager_warming_clusters&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_manager_total_listeners_active gauge&lt;/span&gt;
envoy_listener_manager_total_listeners_active&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_http1_active gauge&lt;/span&gt;
envoy_http_downstream_cx_http1_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_uptime gauge&lt;/span&gt;
envoy_server_uptime&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;140&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_memory_heap_size gauge&lt;/span&gt;
envoy_server_memory_heap_size&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5242880&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_days_until_first_cert_expiring gauge&lt;/span&gt;
envoy_server_days_until_first_cert_expiring&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2147483647&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_hot_restart_epoch gauge&lt;/span&gt;
envoy_server_hot_restart_epoch&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_total_connections gauge&lt;/span&gt;
envoy_server_total_connections&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_concurrency gauge&lt;/span&gt;
envoy_server_concurrency&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_version gauge&lt;/span&gt;
envoy_server_version&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;15294198&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_memory_allocated gauge&lt;/span&gt;
envoy_server_memory_allocated&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3875056&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_rx_bytes_buffered gauge&lt;/span&gt;
envoy_http_downstream_cx_rx_bytes_buffered&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;513&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_access_log_file_write_total_buffered gauge&lt;/span&gt;
envoy_access_log_file_write_total_buffered&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_manager_total_listeners_warming gauge&lt;/span&gt;
envoy_listener_manager_total_listeners_warming&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_upgrades_active gauge&lt;/span&gt;
envoy_http_downstream_cx_upgrades_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_active gauge&lt;/span&gt;
envoy_http_downstream_rq_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_runtime_num_keys gauge&lt;/span&gt;
envoy_runtime_num_keys&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_tx_bytes_buffered gauge&lt;/span&gt;
envoy_http_downstream_cx_tx_bytes_buffered&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_server_live gauge&lt;/span&gt;
envoy_server_live&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_ssl_active gauge&lt;/span&gt;
envoy_http_downstream_cx_ssl_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_http2_active gauge&lt;/span&gt;
envoy_http_downstream_cx_http2_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_circuit_breakers_high_rq_retry_open gauge&lt;/span&gt;
envoy_cluster_circuit_breakers_high_rq_retry_open&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_max_host_weight gauge&lt;/span&gt;
envoy_cluster_max_host_weight&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_circuit_breakers_default_cx_open gauge&lt;/span&gt;
envoy_cluster_circuit_breakers_default_cx_open&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_circuit_breakers_high_rq_open gauge&lt;/span&gt;
envoy_cluster_circuit_breakers_high_rq_open&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_circuit_breakers_default_rq_open gauge&lt;/span&gt;
envoy_cluster_circuit_breakers_default_rq_open&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_membership_healthy gauge&lt;/span&gt;
envoy_cluster_membership_healthy&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_lb_subsets_active gauge&lt;/span&gt;
envoy_cluster_lb_subsets_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_circuit_breakers_default_rq_pending_open gauge&lt;/span&gt;
envoy_cluster_circuit_breakers_default_rq_pending_open&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_active gauge&lt;/span&gt;
envoy_cluster_upstream_cx_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_pending_active gauge&lt;/span&gt;
envoy_cluster_upstream_rq_pending_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_version gauge&lt;/span&gt;
envoy_cluster_version&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_tx_bytes_buffered gauge&lt;/span&gt;
envoy_cluster_upstream_cx_tx_bytes_buffered&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_membership_total gauge&lt;/span&gt;
envoy_cluster_membership_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_circuit_breakers_default_rq_retry_open gauge&lt;/span&gt;
envoy_cluster_circuit_breakers_default_rq_retry_open&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_circuit_breakers_default_cx_pool_open gauge&lt;/span&gt;
envoy_cluster_circuit_breakers_default_cx_pool_open&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_circuit_breakers_high_rq_pending_open gauge&lt;/span&gt;
envoy_cluster_circuit_breakers_high_rq_pending_open&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_membership_degraded gauge&lt;/span&gt;
envoy_cluster_membership_degraded&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_circuit_breakers_high_cx_open gauge&lt;/span&gt;
envoy_cluster_circuit_breakers_high_cx_open&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_active gauge&lt;/span&gt;
envoy_cluster_upstream_rq_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_circuit_breakers_high_cx_pool_open gauge&lt;/span&gt;
envoy_cluster_circuit_breakers_high_cx_pool_open&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_rx_bytes_buffered gauge&lt;/span&gt;
envoy_cluster_upstream_cx_rx_bytes_buffered&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_downstream_pre_cx_active gauge&lt;/span&gt;
envoy_listener_downstream_pre_cx_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_downstream_cx_active gauge&lt;/span&gt;
envoy_listener_downstream_cx_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_upgrades_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_tx_bytes_buffered&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_http1_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_http2_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_rx_bytes_buffered&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_ssl_active&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_admin_downstream_cx_length_ms histogram&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;50&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;250&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;30000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;60000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;300000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1800000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;le&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_sum&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_admin_downstream_cx_length_ms_count&lt;span class=&quot;o&quot;&gt;{}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_rq_time histogram&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;50&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;250&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;30000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;60000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;300000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1800000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_http_downstream_rq_time_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_time_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_http_downstream_cx_length_ms histogram&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;50&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;250&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;30000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;60000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;300000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1800000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;admin&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_connect_ms histogram&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;50&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;250&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;30000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;60000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;300000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1800000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_connect_ms_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_cx_length_ms histogram&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;50&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;250&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;30000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;60000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;300000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1800000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;25250&lt;/span&gt;
envoy_cluster_upstream_cx_length_ms_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_external_upstream_rq_time histogram&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;50&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;250&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;30000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;60000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;300000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1800000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_external_upstream_rq_time_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;17&lt;/span&gt;.200000000000002842170943040401
envoy_cluster_external_upstream_rq_time_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_cluster_upstream_rq_time histogram&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;50&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;250&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;30000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;60000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;300000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1800000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_cluster_upstream_rq_time_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;17&lt;/span&gt;.200000000000002842170943040401
envoy_cluster_upstream_rq_time_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_cluster_name&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;http_service&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE envoy_listener_downstream_cx_length_ms histogram&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;50&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;250&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;30000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;60000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;300000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1800000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_listener_downstream_cx_length_ms_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;28&lt;/span&gt;.6999999999999992894572642399
envoy_listener_downstream_cx_length_ms_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_listener_address&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.0.0.0_9988&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;50&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;250&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;30000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;60000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;300000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1800000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_rq_time_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;19&lt;/span&gt;.25
envoy_http_downstream_rq_time_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;50&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;100&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;250&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;30000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;60000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;300000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1800000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;3600000&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;
envoy_http_downstream_cx_length_ms_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;28&lt;/span&gt;.6999999999999992894572642399
envoy_http_downstream_cx_length_ms_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;envoy_http_conn_manager_prefix&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ingress_http&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;EOF&lt;/p&gt;
&lt;/blockquote&gt;
</description>
				<pubDate>Wed, 08 May 2019 10:01:22 +0800</pubDate>
				<link>https://xenojoshua.com/2019/05/envoy-note/</link>
				<guid isPermaLink="true">https://xenojoshua.com/2019/05/envoy-note/</guid>
			</item>
		
			<item>
				<title>gRPC Notes</title>
				<description>&lt;h4&gt;Table of Contents&lt;/h4&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#1-前言&quot; id=&quot;markdown-toc-1-前言&quot;&gt;1. 前言&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2-基本资料及网络问题&quot; id=&quot;markdown-toc-2-基本资料及网络问题&quot;&gt;2. 基本资料及网络问题&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#21-go-support-for-protocol-buffers&quot; id=&quot;markdown-toc-21-go-support-for-protocol-buffers&quot;&gt;2.1 Go support for Protocol Buffers&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#22-grpc-basics-go&quot; id=&quot;markdown-toc-22-grpc-basics-go&quot;&gt;2.2 gRPC Basics: Go&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#23-grpc-enhanced-example&quot; id=&quot;markdown-toc-23-grpc-enhanced-example&quot;&gt;2.3 gRPC enhanced example&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#24-网络问题&quot; id=&quot;markdown-toc-24-网络问题&quot;&gt;2.4 网络问题&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#3-并发编程&quot; id=&quot;markdown-toc-3-并发编程&quot;&gt;3. 并发编程&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#31-go语言的grpc并发&quot; id=&quot;markdown-toc-31-go语言的grpc并发&quot;&gt;3.1 Go语言的gRPC并发&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ID_CONCURRENCY_DOC&quot; id=&quot;markdown-toc-ID_CONCURRENCY_DOC&quot;&gt;3.2 并发相关官方文档&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#concurrency&quot; id=&quot;markdown-toc-concurrency&quot;&gt;Concurrency&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#clients&quot; id=&quot;markdown-toc-clients&quot;&gt;Clients&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#streams&quot; id=&quot;markdown-toc-streams&quot;&gt;Streams&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#servers&quot; id=&quot;markdown-toc-servers&quot;&gt;Servers&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#33-并发范例&quot; id=&quot;markdown-toc-33-并发范例&quot;&gt;3.3 并发范例&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#331-代码差异&quot; id=&quot;markdown-toc-331-代码差异&quot;&gt;3.3.1 代码差异&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#332-顺序执行&quot; id=&quot;markdown-toc-332-顺序执行&quot;&gt;3.3.2 顺序执行&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#333-并发执行&quot; id=&quot;markdown-toc-333-并发执行&quot;&gt;3.3.3 并发执行&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#34-连接池&quot; id=&quot;markdown-toc-34-连接池&quot;&gt;3.4 连接池&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#35-benchmark&quot; id=&quot;markdown-toc-35-benchmark&quot;&gt;3.5 Benchmark&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#测试硬件&quot; id=&quot;markdown-toc-测试硬件&quot;&gt;测试硬件&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#客户端及服务器启动命令&quot; id=&quot;markdown-toc-客户端及服务器启动命令&quot;&gt;客户端及服务器启动命令&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#测试结果&quot; id=&quot;markdown-toc-测试结果&quot;&gt;测试结果&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#结论&quot; id=&quot;markdown-toc-结论&quot;&gt;结论&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#4-负载均衡&quot; id=&quot;markdown-toc-4-负载均衡&quot;&gt;4. 负载均衡&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#5-状态检查&quot; id=&quot;markdown-toc-5-状态检查&quot;&gt;5. 状态检查&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#6-interceptor&quot; id=&quot;markdown-toc-6-interceptor&quot;&gt;6. Interceptor&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#7-debug&quot; id=&quot;markdown-toc-7-debug&quot;&gt;7. Debug&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#资料&quot; id=&quot;markdown-toc-资料&quot;&gt;资料&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#链接&quot; id=&quot;markdown-toc-链接&quot;&gt;链接&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;1-前言&quot;&gt;1. 前言&lt;/h1&gt;
&lt;p&gt;首先需要申明本文并不是通泛的对gRPC的讲解，而是以Golang为基础的一篇gRPC偏应用方向的博文。因此后面的所有技术点和使用范例都会以Go语言为基础。此外，本文中对gRPC偏基础方面的内容不会涉猎过多，而是更多讲解gRPC偏设计方向的技术点。&lt;/p&gt;

&lt;h1 id=&quot;2-基本资料及网络问题&quot;&gt;2. 基本资料及网络问题&lt;/h1&gt;
&lt;h2 id=&quot;21-go-support-for-protocol-buffers&quot;&gt;2.1 Go support for Protocol Buffers&lt;/h2&gt;
&lt;p&gt;关于使用Go语言的情况下的一系列protobuf相关技术点，可以参阅：&lt;a href=&quot;https://github.com/golang/protobuf&quot; target=&quot;_blank&quot;&gt;golang/protobuf&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;主要需要关注的点有几个：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;安装：除了标准的protobuf（protoc）之外，还需要安装go的插件：&lt;code&gt;protoc-gen-go&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;插件：protoc如果要使用go的插件，且需要生成service相关代码的话，需要在&lt;code&gt;go_out&lt;/code&gt;中附带上&lt;code&gt;plugins=grpc:&lt;/code&gt;字符串，e.g：&lt;code&gt;--go_out=plugins=grpc:${OUTPUT_PATH}&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;包管理：protobuf的包定义和go语言的习惯用法有不少差异，使用前建议阅读：&lt;a href=&quot;https://github.com/golang/protobuf#packages-and-input-paths&quot; target=&quot;_blank&quot;&gt;Packages and input paths&lt;/a&gt;
    &lt;ul&gt;
      &lt;li&gt;默认的包名不会转换成相对文件夹，e.g：&lt;code&gt;package com.book&lt;/code&gt;会生成&lt;code&gt;com_book&lt;/code&gt;文件夹，而不是&lt;code&gt;com/book&lt;/code&gt;这样的嵌套文件夹&lt;/li&gt;
      &lt;li&gt;go的包路径可以使用：&lt;code&gt;option go_package = ...&lt;/code&gt;来设定&lt;/li&gt;
      &lt;li&gt;在某些全局编译的情况下，可以：&lt;code&gt;--go_out=$GOPATH&lt;/code&gt;，直接输出到GOPATH&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;生成出来的代码相关规范：&lt;a href=&quot;https://github.com/golang/protobuf#generated-code&quot; target=&quot;_blank&quot;&gt;Generated code&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;protoc插件的额外参数：&lt;a href=&quot;https://github.com/golang/protobuf#parameters&quot; target=&quot;_blank&quot;&gt;Parameters&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;22-grpc-basics-go&quot;&gt;2.2 gRPC Basics: Go&lt;/h2&gt;
&lt;p&gt;初次使用Go语言来编写gRPC代码，请阅读文档：&lt;a href=&quot;https://github.com/grpc/grpc-go/blob/master/examples/gotutorial.md&quot; target=&quot;_blank&quot;&gt;grpc-go/examples/gotutorial.md&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;对于gRPC非常熟悉的程序员可以跳过这个文档，基本上这个文档是面向新手的指引，但是范例代码都使用的是Go语言。&lt;/p&gt;

&lt;h2 id=&quot;23-grpc-enhanced-example&quot;&gt;2.3 gRPC enhanced example&lt;/h2&gt;
&lt;p&gt;进阶的Go语言gRPC代码可以阅读范例：&lt;a href=&quot;https://github.com/grpc/grpc-go/tree/master/examples/route_guide&quot; target=&quot;_blank&quot;&gt;grpc-go/examples/route_guide/&lt;/a&gt;。这个范例代码里加入了单向和双向流的范例，算是比较进阶和完整的范例代码了。&lt;/p&gt;

&lt;p&gt;我的实验项目中也有比较完整的应用范例代码，相对官方的范例来说少了点不伦不类的业务逻辑，对于只需要了解技术的读者来说更友好：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/tree/master/golang/src/experiment/grpc/samples/book&quot; target=&quot;_blank&quot;&gt;dist-system-practice/golang/src/experiment/grpc/samples/book/&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;24-网络问题&quot;&gt;2.4 网络问题&lt;/h2&gt;
&lt;p&gt;因国情原因，Go的包安装会遇到一些网络问题：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc/grpc-go/issues/1959&quot; target=&quot;_blank&quot;&gt;go get not working unrecognized import path “google.golang.org/grpc” #1959&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc/grpc-go/issues/1780&quot; target=&quot;_blank&quot;&gt;go get -u google.golang.org/grpc i/o timeout #1780&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这种情况的最佳对应方法是在命令行下设置HTTP和HTTPS代理：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;http_proxy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;http://127.0.0.1:6152
&lt;span class=&quot;nb&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;https_proxy&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;http://127.0.0.1:6152
go get -u ...&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h1 id=&quot;3-并发编程&quot;&gt;3. 并发编程&lt;/h1&gt;
&lt;h2 id=&quot;31-go语言的grpc并发&quot;&gt;3.1 Go语言的gRPC并发&lt;/h2&gt;
&lt;p&gt;关于在Go语言中使用gRPC的并发问题在官方的issues中已经有很多了：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc/grpc-go/issues/682&quot; target=&quot;_blank&quot;&gt;Best practices for reusing connections, concurrency #682&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc/grpc-go/issues/85&quot; target=&quot;_blank&quot;&gt;Concurrency #85&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc/grpc-go/issues/1345&quot; target=&quot;_blank&quot;&gt;Add section on concurrency to documentation #1345&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;上述的三个issues都可以仔细阅读下，提出的问题都非常有代表性。从一系列的问题中可以看出，官方对于gRPC的并发其实是有一些指导意见的，但并没有很好的文档化（至少之前如此）。而目前对这些问题已经有部分解答了，请继续阅读下去。&lt;/p&gt;

&lt;h2 id=&quot;ID_CONCURRENCY_DOC&quot;&gt;3.2 并发相关官方文档&lt;/h2&gt;
&lt;p&gt;在&lt;a href=&quot;https://github.com/grpc/grpc-go/pull/2034/files&quot; target=&quot;_blank&quot;&gt;这个提交&lt;/a&gt;中，官方添加了对于并发相关的官方指引。正式的文档地址是在：&lt;a href=&quot;https://github.com/grpc/grpc-go/blob/master/Documentation/concurrency.md&quot; target=&quot;_blank&quot;&gt;grpc-go/Documentation/concurrency.md&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;这里做下简单翻译：&lt;/p&gt;

&lt;h3 id=&quot;concurrency&quot;&gt;Concurrency&lt;/h3&gt;
&lt;p&gt;一般来说，gRPC-go提供了对并发友好的API。下文是一些指引。&lt;/p&gt;

&lt;h4 id=&quot;clients&quot;&gt;Clients&lt;/h4&gt;
&lt;p&gt;一个&lt;a href=&quot;https://godoc.org/google.golang.org/grpc#ClientConn&quot; target=&quot;_blank&quot;&gt;ClientConn&lt;/a&gt;可以被安全地并发访问。以&lt;a href=&quot;https://github.com/grpc/grpc-go/blob/master/examples/helloworld/greeter_client/main.go#L43&quot; target=&quot;_blank&quot;&gt;helloworld&lt;/a&gt;作为范例，程序员可以在多个goroutine之间共享一个ClientConn来创建多个GreeterClient客户端类型。在这种使用情况下，RPCs会并行传输。&lt;/p&gt;

&lt;h4 id=&quot;streams&quot;&gt;Streams&lt;/h4&gt;
&lt;p&gt;当使用&lt;a href=&quot;https://godoc.org/google.golang.org/grpc#Stream&quot; target=&quot;_blank&quot;&gt;Stream&lt;/a&gt;的时候，程序员必须小心避免从不同的goroutine向同一个stream发送多次&lt;code&gt;SendMsg&lt;/code&gt;或&lt;code&gt;RecvMsg&lt;/code&gt;请求。换句话来说，如果有一个goroutine向stream中发送SendMsg，然后在同一时间有另一个goroutine向stream中发送RecvMsg，这样做是安全的。但在不同的goroutine中同时向同一个stream发送SendMsg，或是RecvMsg则是不安全的。&lt;/p&gt;

&lt;h4 id=&quot;servers&quot;&gt;Servers&lt;/h4&gt;
&lt;p&gt;每个被附到已注册服务器上的RPC处理器都会在其自身的goroutine中运作。举例来说，&lt;a href=&quot;https://github.com/grpc/grpc-go/blob/master/examples/helloworld/greeter_server/main.go#L41&quot; target=&quot;_blank&quot;&gt;SayHello&lt;/a&gt;会在其自身的goroutine中被调用到。同样的，streaming RPC也是一样，route guide例子可以在&lt;a href=&quot;https://github.com/grpc/grpc-go/blob/master/examples/route_guide/server/server.go#L126&quot; target=&quot;_blank&quot;&gt;这里&lt;/a&gt;看得到。&lt;/p&gt;

&lt;h2 id=&quot;33-并发范例&quot;&gt;3.3 并发范例&lt;/h2&gt;
&lt;p&gt;我在实验项目中做了点并发的范例，可以看下：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/tree/master/golang/src/experiment/grpc/samples/concurrency&quot; target=&quot;_blank&quot;&gt;dist-system-practice/golang/src/experiment/grpc/samples/concurrency/&lt;/a&gt;。&lt;/p&gt;

&lt;h3 id=&quot;331-代码差异&quot;&gt;3.3.1 代码差异&lt;/h3&gt;
&lt;p&gt;服务端代码是一致的，根据&lt;a href=&quot;#ID_CONCURRENCY_DOC&quot;&gt;3.2 并发相关官方文档&lt;/a&gt;，服务端的所有请求都是自然并发的，无需代码特殊处理。但客户端则需要自行编码处理。&lt;/p&gt;

&lt;p&gt;顺序执行：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Echo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;EchoRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)});&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;[Client] singleConnSequence: err: %v&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;elapsed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Sub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;[Client] singleConnSequence: response: %v, consumed: %v&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;elapsed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;并发执行：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-go&quot; data-lang=&quot;go&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;waitgroup&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;sync&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;WaitGroup&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;waitgroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;kd&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;client&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Echo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;pb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;EchoRequest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)});&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;kc&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Fatalf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;[Client] singleConnConcurrency: err: %v&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;end&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;elapsed&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Sub&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;nx&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;[Client] singleConnConcurrency: response: %v, consumed: %v&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;elapsed&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;nx&quot;&gt;waitgroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;waitgroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;332-顺序执行&quot;&gt;3.3.2 顺序执行&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;# 启动服务器
DELAY_NO_5=true go run server.go

# 启动客户端，发送请求
MODE=CONN_ONE_SEQUENCE go run client.go
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;# 客户端输出
2019/05/03 13:58:23 [Client] singleConnSequence: response: id:1 , consumed: 4.284231ms
2019/05/03 13:58:23 [Client] singleConnSequence: response: id:2 , consumed: 381.818µs
2019/05/03 13:58:23 [Client] singleConnSequence: response: id:3 , consumed: 361.608µs
2019/05/03 13:58:23 [Client] singleConnSequence: response: id:4 , consumed: 332.662µs
2019/05/03 13:58:24 [Client] singleConnSequence: response: id:5 , consumed: 1.004485058s
2019/05/03 13:58:24 [Client] singleConnSequence: response: id:6 , consumed: 470.532µs
2019/05/03 13:58:24 [Client] singleConnSequence: response: id:7 , consumed: 468.148µs
2019/05/03 13:58:24 [Client] singleConnSequence: response: id:8 , consumed: 389.214µs
2019/05/03 13:58:24 [Client] singleConnSequence: response: id:9 , consumed: 418.01µs
2019/05/03 13:58:25 [Client] singleConnSequence: response: id:10 , consumed: 1.003602442s

# 服务器输出
2019/05/03 13:58:23 [Server] Echo: request: id:1
2019/05/03 13:58:23 [Server] Echo: response: id:1
2019/05/03 13:58:23 [Server] Echo: request: id:2
2019/05/03 13:58:23 [Server] Echo: response: id:2
2019/05/03 13:58:23 [Server] Echo: request: id:3
2019/05/03 13:58:23 [Server] Echo: response: id:3
2019/05/03 13:58:23 [Server] Echo: request: id:4
2019/05/03 13:58:23 [Server] Echo: response: id:4
2019/05/03 13:58:23 [Server] Echo: request: id:5
2019/05/03 13:58:24 [Server] Echo: response: id:5
2019/05/03 13:58:24 [Server] Echo: request: id:6
2019/05/03 13:58:24 [Server] Echo: response: id:6
2019/05/03 13:58:24 [Server] Echo: request: id:7
2019/05/03 13:58:24 [Server] Echo: response: id:7
2019/05/03 13:58:24 [Server] Echo: request: id:8
2019/05/03 13:58:24 [Server] Echo: response: id:8
2019/05/03 13:58:24 [Server] Echo: request: id:9
2019/05/03 13:58:24 [Server] Echo: response: id:9
2019/05/03 13:58:24 [Server] Echo: request: id:10
2019/05/03 13:58:25 [Server] Echo: response: id:10
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;333-并发执行&quot;&gt;3.3.3 并发执行&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;# 启动服务器
DELAY_NO_5=true go run server.go

# 启动客户端，发送请求
MODE=CONN_ONE_CONCURRENCY go run client.go
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code&gt;# 客户端输出
2019/05/03 13:54:41 [Client] singleConnConcurrency: response: id:9 , consumed: 5.651184ms
2019/05/03 13:54:41 [Client] singleConnConcurrency: response: id:6 , consumed: 5.595945ms
2019/05/03 13:54:41 [Client] singleConnConcurrency: response: id:2 , consumed: 5.693124ms
2019/05/03 13:54:41 [Client] singleConnConcurrency: response: id:4 , consumed: 5.637734ms
2019/05/03 13:54:41 [Client] singleConnConcurrency: response: id:1 , consumed: 5.592096ms
2019/05/03 13:54:41 [Client] singleConnConcurrency: response: id:3 , consumed: 5.58596ms
2019/05/03 13:54:41 [Client] singleConnConcurrency: response: id:7 , consumed: 5.652258ms
2019/05/03 13:54:41 [Client] singleConnConcurrency: response: id:8 , consumed: 5.658945ms
2019/05/03 13:54:42 [Client] singleConnConcurrency: response: id:10 , consumed: 1.008472004s
2019/05/03 13:54:42 [Client] singleConnConcurrency: response: id:5 , consumed: 1.008440948s

# 服务器输出
2019/05/03 13:54:41 [Server] Echo: request: id:3
2019/05/03 13:54:41 [Server] Echo: response: id:3
2019/05/03 13:54:41 [Server] Echo: request: id:1
2019/05/03 13:54:41 [Server] Echo: response: id:1
2019/05/03 13:54:41 [Server] Echo: request: id:6
2019/05/03 13:54:41 [Server] Echo: response: id:6
2019/05/03 13:54:41 [Server] Echo: request: id:10
2019/05/03 13:54:41 [Server] Echo: request: id:8
2019/05/03 13:54:41 [Server] Echo: response: id:8
2019/05/03 13:54:41 [Server] Echo: request: id:9
2019/05/03 13:54:41 [Server] Echo: response: id:9
2019/05/03 13:54:41 [Server] Echo: request: id:5
2019/05/03 13:54:41 [Server] Echo: request: id:2
2019/05/03 13:54:41 [Server] Echo: response: id:2
2019/05/03 13:54:41 [Server] Echo: request: id:4
2019/05/03 13:54:41 [Server] Echo: response: id:4
2019/05/03 13:54:41 [Server] Echo: request: id:7
2019/05/03 13:54:41 [Server] Echo: response: id:7
2019/05/03 13:54:42 [Server] Echo: response: id:10
2019/05/03 13:54:42 [Server] Echo: response: id:5
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;服务端对ID逢5的请求sleep 1秒进行反馈，因此并发的客户端请求中，5和10就是最后返回打印出来的，耗时也是1秒多。&lt;/p&gt;

&lt;h2 id=&quot;34-连接池&quot;&gt;3.4 连接池&lt;/h2&gt;
&lt;p&gt;虽然单连接也是可以进行并发编程的，但在某些极端情况下，数据包可能达到网络吞吐的极限。众所周知Go语言天生对并发编程友好，因此CPU的利用必然是非常充分的，如果RPC服务的类型是低CPU消耗而高网络消耗的情况就有可能出现之前提到的问题。这种情况就需要创建多个连接了。&lt;/p&gt;

&lt;p&gt;在多连接管理方面，官方的类库并没有连接池的功能，第三方倒是有：&lt;a href=&quot;https://github.com/processout/grpc-go-pool/blob/master/pool_test.go&quot; target=&quot;_blank&quot;&gt;grpc-go-pool/pool_test.go&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;此外，可以拓展阅读：&lt;a href=&quot;https://mycodesmells.com/post/pooling-grpc-connections&quot; target=&quot;_blank&quot;&gt;Pooling gRPC Connections&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;范例可以看：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/tree/master/golang/src/experiment/grpc/samples/pool&quot; target=&quot;_blank&quot;&gt;dist-system-practice/golang/src/experiment/grpc/samples/pool/&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;35-benchmark&quot;&gt;3.5 Benchmark&lt;/h2&gt;
&lt;p&gt;范例代码在：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/tree/master/golang/src/experiment/grpc/samples/throughput&quot; target=&quot;_blank&quot;&gt;dist-system-practice/golang/src/experiment/grpc/samples/throughput/&lt;/a&gt;。&lt;/p&gt;

&lt;h3 id=&quot;测试硬件&quot;&gt;测试硬件&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;rMBP 2014 mid
CPU：2.5GHz 四核 Intel Core i7 处理器 (Turbo Boost 3.7GHz)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;测试的时候一些在系统使用中的软件我并没有清空，因此可能有稍许干扰，但总体问题不大。&lt;/p&gt;

&lt;h3 id=&quot;客户端及服务器启动命令&quot;&gt;客户端及服务器启动命令&lt;/h3&gt;

&lt;pre&gt;&lt;code&gt;CORE_NUM=3 go run server.go
CORE_NUM=4 ROUTINES_PER_CORE=50 go run client.go
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;使用&lt;code&gt;CORE_NUM&lt;/code&gt;来控制使用到的物理核心数量，客户端使用&lt;code&gt;ROUTINES_PER_CORE&lt;/code&gt;来决定启动的routine总量：&lt;code&gt;CORE_NUM * ROUTINES_PER_CORE&lt;/code&gt;。&lt;/p&gt;

&lt;h3 id=&quot;测试结果&quot;&gt;测试结果&lt;/h3&gt;
&lt;p&gt;请求数量/s：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2019/05/04 14:19:33 [Client] 73065 requests in 1s
2019/05/04 14:19:34 [Client] 68826 requests in 1s
2019/05/04 14:19:35 [Client] 73655 requests in 1s
2019/05/04 14:19:36 [Client] 70973 requests in 1s
2019/05/04 14:19:37 [Client] 73645 requests in 1s
2019/05/04 14:19:38 [Client] 70616 requests in 1s
2019/05/04 14:19:39 [Client] 72252 requests in 1s
2019/05/04 14:19:40 [Client] 69342 requests in 1s
2019/05/04 14:19:41 [Client] 69745 requests in 1s
2019/05/04 14:19:42 [Client] 62251 requests in 1s
2019/05/04 14:19:43 [Client] 58043 requests in 1s
2019/05/04 14:19:44 [Client] 69316 requests in 1s
2019/05/04 14:19:45 [Client] 69796 requests in 1s
2019/05/04 14:19:46 [Client] 57246 requests in 1s
2019/05/04 14:19:47 [Client] 72265 requests in 1s
2019/05/04 14:19:48 [Client] 72940 requests in 1s
2019/05/04 14:19:49 [Client] 70237 requests in 1s
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;CPU：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/05/grpc-note/cpu.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Network：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/05/grpc-note/network-low.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;
&lt;img src=&quot;/resources/2019/05/grpc-note/network-high.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;结论&quot;&gt;结论&lt;/h3&gt;
&lt;p&gt;因硬件环境的限制，没有使用通过网卡的测试方案，而是使用了127.0.0.1的环回请求方案。此外，测试期间MAC上的一些软件进程也并没有进行清理，因此可能有部分干扰。结论就不做了，这样简单且限制资源的benchmark实际意义不大，列几点可以观测到的状态：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;请求数量/s&lt;/code&gt;符合预期&lt;/li&gt;
  &lt;li&gt;CPU占用基本满&lt;/li&gt;
  &lt;li&gt;提升核心使用数量，提升routine数量，能观察到rps提升&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;4-负载均衡&quot;&gt;4. 负载均衡&lt;/h1&gt;
&lt;p&gt;官方有一篇关于负载均衡设计的文档，可以读下：&lt;a href=&quot;https://github.com/grpc/grpc/blob/master/doc/load-balancing.md&quot; target=&quot;_blank&quot;&gt;Load Balancing in gRPC&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;意义不大，可以了解一些简单的负载均衡概念，以及一些设计上的思路。&lt;/p&gt;

&lt;h1 id=&quot;5-状态检查&quot;&gt;5. 状态检查&lt;/h1&gt;
&lt;p&gt;官方对于如何设计及暴露服务端状态检查接口的一份文档：&lt;a href=&quot;https://github.com/grpc/grpc/blob/master/doc/health-checking.md&quot; target=&quot;_blank&quot;&gt;GRPC Health Checking Protocol&lt;/a&gt;。可以说是一份guideline。同样意义不大。&lt;/p&gt;

&lt;h1 id=&quot;6-interceptor&quot;&gt;6. Interceptor&lt;/h1&gt;
&lt;p&gt;所谓的interceptor，写过gin或者koa的可以直接理解为gRPC里的&lt;code&gt;middleware&lt;/code&gt;。官方文档：&lt;a href=&quot;https://github.com/grpc/grpc-go/tree/master/examples/features/interceptor&quot; target=&quot;_blank&quot;&gt;Interceptor&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;虽然gRPC本身的rpc调用分为多种不同的可能：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;请求响应皆为unary&lt;/li&gt;
  &lt;li&gt;请求unary响应stream&lt;/li&gt;
  &lt;li&gt;请求stream响应unary&lt;/li&gt;
  &lt;li&gt;请求响应皆为stream&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;但interceptor的签名则只有&lt;code&gt;unary&lt;/code&gt;和&lt;code&gt;stream&lt;/code&gt;这两种。&lt;/p&gt;

&lt;p&gt;范例代码可以查看官方的：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc/grpc-go/blob/master/examples/features/interceptor/client/main.go&quot; target=&quot;_blank&quot;&gt;client/main.go&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc/grpc-go/blob/master/examples/features/interceptor/server/main.go&quot; target=&quot;_blank&quot;&gt;server/main.go&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;7-debug&quot;&gt;7. Debug&lt;/h1&gt;
&lt;p&gt;官方的指引：&lt;a href=&quot;https://github.com/grpc/grpc-go/tree/master/examples/features/debugging&quot; target=&quot;_blank&quot;&gt;Debugging&lt;/a&gt;，包括了一份范例代码：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc/grpc-go/blob/master/examples/features/debugging/client/main.go&quot; target=&quot;_blank&quot;&gt;client/main.go&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc/grpc-go/blob/master/examples/features/debugging/server/main.go&quot; target=&quot;_blank&quot;&gt;server/main.go&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;也可以使用go的trace包，做简单的观察：&lt;a href=&quot;https://segmentfault.com/a/1190000008087436&quot; target=&quot;_blank&quot;&gt;Golang gRPC实践 连载六 内置Trace&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;几个环境变量可以大量输出程序执行的细节：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;GODEBUG=http2debug=1 \
GODEBUG=http2debug=2 \
GRPC_GO_LOG_VERBOSITY_LEVEL=99 \
GRPC_GO_LOG_SEVERITY_LEVEL=info \
yourapp
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&quot;资料&quot;&gt;资料&lt;/h1&gt;
&lt;h2 id=&quot;链接&quot;&gt;链接&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/processout/grpc-go-pool/blob/master/pool_test.go&quot; target=&quot;_blank&quot;&gt;grpc-go-pool/pool_test.go&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://mycodesmells.com/post/pooling-grpc-connections&quot; target=&quot;_blank&quot;&gt;Pooling gRPC Connections&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;EOF&lt;/p&gt;
&lt;/blockquote&gt;
</description>
				<pubDate>Mon, 06 May 2019 10:01:22 +0800</pubDate>
				<link>https://xenojoshua.com/2019/05/grpc-note/</link>
				<guid isPermaLink="true">https://xenojoshua.com/2019/05/grpc-note/</guid>
			</item>
		
			<item>
				<title>Kafka Notes</title>
				<description>&lt;h4&gt;Table of Contents&lt;/h4&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#1-前言&quot; id=&quot;markdown-toc-1-前言&quot;&gt;1. 前言&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2-消息队列&quot; id=&quot;markdown-toc-2-消息队列&quot;&gt;2. 消息队列&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#3-消息队列选型比较&quot; id=&quot;markdown-toc-3-消息队列选型比较&quot;&gt;3. 消息队列选型比较&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#31-apache-pulsar&quot; id=&quot;markdown-toc-31-apache-pulsar&quot;&gt;3.1 Apache Pulsar&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#4-kafka架构&quot; id=&quot;markdown-toc-4-kafka架构&quot;&gt;4. Kafka架构&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#41-概念&quot; id=&quot;markdown-toc-41-概念&quot;&gt;4.1 概念&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ID_CLUSTER&quot; id=&quot;markdown-toc-ID_CLUSTER&quot;&gt;4.2 集群&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#43-分布式痛点offset&quot; id=&quot;markdown-toc-43-分布式痛点offset&quot;&gt;4.3 分布式痛点（offset）&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#44-临时消费压力应急&quot; id=&quot;markdown-toc-44-临时消费压力应急&quot;&gt;4.4 临时消费压力应急&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#5-kafka监控--高可用&quot; id=&quot;markdown-toc-5-kafka监控--高可用&quot;&gt;5. Kafka监控 &amp;amp; 高可用&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#51-监控&quot; id=&quot;markdown-toc-51-监控&quot;&gt;5.1 监控&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#52-高可用&quot; id=&quot;markdown-toc-52-高可用&quot;&gt;5.2 高可用&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#6-kafka-benchmark&quot; id=&quot;markdown-toc-6-kafka-benchmark&quot;&gt;6. Kafka Benchmark&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#61-测试环境&quot; id=&quot;markdown-toc-61-测试环境&quot;&gt;6.1 测试环境&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#62-不同场景测试&quot; id=&quot;markdown-toc-62-不同场景测试&quot;&gt;6.2 不同场景测试&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#621-场景1&quot; id=&quot;markdown-toc-621-场景1&quot;&gt;6.2.1 场景1&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#622-场景2&quot; id=&quot;markdown-toc-622-场景2&quot;&gt;6.2.2 场景2&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#623-场景3&quot; id=&quot;markdown-toc-623-场景3&quot;&gt;6.2.3 场景3&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#ID_BENCHMARK_SCEN4&quot; id=&quot;markdown-toc-ID_BENCHMARK_SCEN4&quot;&gt;6.2.4 场景4&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#625-场景5&quot; id=&quot;markdown-toc-625-场景5&quot;&gt;6.2.5 场景5&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#626-场景6&quot; id=&quot;markdown-toc-626-场景6&quot;&gt;6.2.6 场景6&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#63-各场景测试总结&quot; id=&quot;markdown-toc-63-各场景测试总结&quot;&gt;6.3 各场景测试总结&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#7-kafka使用范例&quot; id=&quot;markdown-toc-7-kafka使用范例&quot;&gt;7. Kafka使用范例&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#8-在docker内部署集群&quot; id=&quot;markdown-toc-8-在docker内部署集群&quot;&gt;8. 在Docker内部署集群&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#81-重要配置项&quot; id=&quot;markdown-toc-81-重要配置项&quot;&gt;8.1 重要配置项&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#DOCKER_OUT_NET&quot; id=&quot;markdown-toc-DOCKER_OUT_NET&quot;&gt;8.2 对容器外应用提供服务&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#83-docker-compose-scale&quot; id=&quot;markdown-toc-83-docker-compose-scale&quot;&gt;8.3 docker-compose scale&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#84-yaml配置重用&quot; id=&quot;markdown-toc-84-yaml配置重用&quot;&gt;8.4 yaml配置重用&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#84-相关参考&quot; id=&quot;markdown-toc-84-相关参考&quot;&gt;8.4 相关参考&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#9-写性能与安全性&quot; id=&quot;markdown-toc-9-写性能与安全性&quot;&gt;9. 写性能与安全性&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#10-todo&quot; id=&quot;markdown-toc-10-todo&quot;&gt;10. TODO&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#资料&quot; id=&quot;markdown-toc-资料&quot;&gt;资料&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#链接&quot; id=&quot;markdown-toc-链接&quot;&gt;链接&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;1-前言&quot;&gt;1. 前言&lt;/h1&gt;
&lt;p&gt;Kafka是现在业界选择比较多的一种消息队列解决方案。我这里主要也是选Kafka作为消息队列这块需求的解决方案。下面的技术调研会先从消息队列本身开始，然后做一个横向比较，最后再聚焦到Kafka本身上。&lt;/p&gt;

&lt;p&gt;调研用的Kafka版本为：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;2.2.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;官方文档：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;官方介绍：&lt;a href=&quot;https://kafka.apache.org/intro&quot; target=&quot;_blank&quot;&gt;Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;官方新手入门：&lt;a href=&quot;https://kafka.apache.org/quickstart&quot; target=&quot;_blank&quot;&gt;Quickstart&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;官方应用场景介绍：&lt;a href=&quot;https://kafka.apache.org/uses&quot; target=&quot;_blank&quot;&gt;Use cases&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;官方文档：&lt;a href=&quot;https://kafka.apache.org/documentation/&quot; target=&quot;_blank&quot;&gt;Documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Docker Hub：&lt;a href=&quot;https://hub.docker.com/r/wurstmeister/kafka&quot; target=&quot;_blank&quot;&gt;wurstmeister/kafka&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;一本中文手册，版本较老，看看范例代码尚可：&lt;a href=&quot;http://www.kubiji.cn/book/apache_kafka/APACHEKAFKAJiaoCheng/APACHEKAFKAGaiShu.html&quot; target=&quot;_blank&quot;&gt;Apache kafka中文手册&lt;/a&gt;。&lt;/p&gt;

&lt;h1 id=&quot;2-消息队列&quot;&gt;2. 消息队列&lt;/h1&gt;
&lt;p&gt;在聊Kafka之前，其实更需要关注下消息队列本身。什么需求下需要使用消息队列、消息队列的功能点有哪些、消息队列的模式有哪些、消息队列的实现难点有哪些，等等。如果什么都不了解，那技术选型就无从谈起了，也没办法理解为什么消息队列要做好是非常困难的一件事情。展开了说，也就没办法举一反三，理解其他软件系统的设计精髓了。&lt;/p&gt;

&lt;p&gt;下面会简单列举下消息队列的一系列知识点，细节内容这里就不展开了，篇幅太大。&lt;/p&gt;

&lt;p&gt;消息队列的需求：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;解耦&lt;/li&gt;
  &lt;li&gt;最终一致性&lt;/li&gt;
  &lt;li&gt;广播&lt;/li&gt;
  &lt;li&gt;错峰与流控&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;消息队列的模型：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;点对点：单生产、单队列、单消费&lt;/li&gt;
  &lt;li&gt;生产者消费者模型：多生产、单队列、多消费&lt;/li&gt;
  &lt;li&gt;发布订阅模型：根据topic分队列，多生产、多队列、多消费&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;消息队列的投递模式：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Push：消息队列主动推送（e.g RocketMQ可选）&lt;/li&gt;
  &lt;li&gt;Pull：消费者主动抓取（e.g Kafka）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;消息队列的性能指标：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;吞吐量（Throughput）&lt;/li&gt;
  &lt;li&gt;响应时间（Latency）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;消息队列的投递策略：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;最多一次（At most Once）：消息可能会丢，但绝不会重复传输&lt;/li&gt;
  &lt;li&gt;最少一次（At least Once）：消息绝不会丢，但可能会重复传输&lt;/li&gt;
  &lt;li&gt;仅有一次（Exactly Once）：每条消息肯定会被传输一次且仅传输一次&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;消息队列的功能性：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;优先级队列&lt;/li&gt;
  &lt;li&gt;延迟队列&lt;/li&gt;
  &lt;li&gt;死信队列&lt;/li&gt;
  &lt;li&gt;重试队列&lt;/li&gt;
  &lt;li&gt;消息回溯&lt;/li&gt;
  &lt;li&gt;消息堆积 + 持久化&lt;/li&gt;
  &lt;li&gt;消息追踪&lt;/li&gt;
  &lt;li&gt;消息过滤&lt;/li&gt;
  &lt;li&gt;多租户&lt;/li&gt;
  &lt;li&gt;多协议支持&lt;/li&gt;
  &lt;li&gt;跨语言支持&lt;/li&gt;
  &lt;li&gt;流量控制&lt;/li&gt;
  &lt;li&gt;可靠投递&lt;/li&gt;
  &lt;li&gt;消费确认&lt;/li&gt;
  &lt;li&gt;消息顺序性&lt;/li&gt;
  &lt;li&gt;安全机制&lt;/li&gt;
  &lt;li&gt;消息幂等性&lt;/li&gt;
  &lt;li&gt;事务性消息&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;几篇值得一读的博文：&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;/2019/04/message-queue-design/&quot; target=&quot;_blank&quot;&gt;消息队列设计精要 - 美团点评技术团队&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;一篇通论形式的消息队列设计博文，讲解了一些消息队列通用的知识点，值得一读。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/kafka-note/message-queue-01.png&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.infoq.cn/article/distributed-queue-programme-model-actual-combat-optimization&quot; target=&quot;_blank&quot;&gt;分布式队列编程：从模型、实战到优化&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;本质上也是一篇对于消息队列进行设计和讲解的博文，但结合了美团公司内部的实际项目经验，对于大型系统的设计者有更好的贴近应用场景的指导作用。&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651745361&amp;amp;idx=1&amp;amp;sn=5f0f67484a0de4b0dd2796848ef9cc94&quot; target=&quot;_blank&quot;&gt;分布式队列编程优化篇&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;接上一篇的博文，更多讲到了性能和高级功能相关的实现以及性能的优化。&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.jianshu.com/p/7a6deaba34d2&quot; target=&quot;_blank&quot;&gt;如何保证消息队列的高可用和幂等性以及数据丢失，顺序一致性&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;排版比较粗糙，但内容非常不错。以贴近项目经验的内容讲解了RabbitMQ和Kafka的：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;高可用性&lt;/li&gt;
  &lt;li&gt;消息幂等性&lt;/li&gt;
  &lt;li&gt;消息可靠性&lt;/li&gt;
  &lt;li&gt;消息顺序性&lt;/li&gt;
  &lt;li&gt;消息积压场景处理&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;3-消息队列选型比较&quot;&gt;3. 消息队列选型比较&lt;/h1&gt;
&lt;p&gt;消息队列的选型一直都是比较困难的，业界现在比较主流的选择有：ActiveMQ、RabbitMQ、Kafka、RocketMQ、ZeroMQ 这几种。&lt;/p&gt;

&lt;p&gt;有几篇不错的博文可以看下：&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.infoq.cn/article/kafka-vs-rabbitmq&quot; target=&quot;_blank&quot;&gt;消息中间件选型分析：从 Kafka 与 RabbitMQ 的对比看全局&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;这篇时间还算比较接近&lt;code&gt;2018年5月2日&lt;/code&gt;，主要是以Kafka和RabbitMQ为范例进行了消息队列选型的要点讲解。虽然讲解的时候使用了Kafka以及RabbitMQ作为范例，但实际上讲解的是通用的消息队列选型要点。结合本文上一节所讲到的消息队列的一系列知识点，应该能有更深刻的理解。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/kafka-note/message-queue-02.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;
&lt;img src=&quot;/resources/2019/04/kafka-note/message-queue-03.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;
&lt;img src=&quot;/resources/2019/04/kafka-note/message-queue-04.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.infoq.cn/article/dXJ3EYIp*WaHfmVwlMeu&quot; target=&quot;_blank&quot;&gt;滴滴出行基于 RocketMQ 构建企业级消息队列服务的实践&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;这篇时间稍微有点久，文中提到的Kafka版本还是0.8左右的（虽然文章的发布时间倒是不久之前），所以文中提到的性能指标之类的仅可作为参考。这篇文章是对Kafka和RocketMQ做的一个技术选型比较，文章中有相当多的性能指标比较，并结合滴滴公司的实际情况讲解了下消息队列系统进行替换时候所做的Migration工作，非常有借鉴价值。此外，文中还有一小节讲解了下RocketMQ使用的经验。&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/39586635/why-is-kafka-pull-based-instead-of-push-based&quot; target=&quot;_blank&quot;&gt;Why is Kafka pull-based instead of push-based?&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;为什么Kafka消息队列使用的是Pull投递模式。&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://medium.com/@philipfeng/modern-open-source-messaging-apache-kafka-rabbitmq-nats-pulsar-and-nsq-ca3bf7422db5&quot; target=&quot;_blank&quot;&gt;Modern Open Source Messaging: NATS, RabbitMQ, Apache Kafka, hmbdc, Synapse, NSQ and Pulsar&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;老外写的一篇，提到了不少国内较少提到的开源项目，可以作为参考。&lt;/p&gt;

&lt;h2 id=&quot;31-apache-pulsar&quot;&gt;3.1 Apache Pulsar&lt;/h2&gt;
&lt;p&gt;关于Kafka和后起新秀Pulsar的横向比较，可以看：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47388267&quot; target=&quot;_blank&quot;&gt;比拼Kafka，大数据分析新秀Pulsar到底好在哪&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.slideshare.net/merlimat/high-performance-messaging-with-apache-pulsar&quot; target=&quot;_blank&quot;&gt;High performance messaging with Apache Pulsar&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.infoq.cn/article/Us*a8umKXT9LpV9hA6tF&quot; target=&quot;_blank&quot;&gt;选择 Pulsar 而不是 Kafka 的 7 大理由&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;大略的要点：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;功能性上Pulsar要比Kafka更好，且这是在不牺牲性能的前提下的，就更加难能可贵&lt;/li&gt;
  &lt;li&gt;解决了Kafka单partition只能单consumer消费的问题&lt;/li&gt;
  &lt;li&gt;将Broker和存储解耦，做到更好的错误恢复，在Broker宕机之后可以做到无损耗恢复&lt;/li&gt;
  &lt;li&gt;存储方面的功能交付给Bookie，更细粒度的存储，更好的错误恢复和同步性能&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;4-kafka架构&quot;&gt;4. Kafka架构&lt;/h1&gt;
&lt;h2 id=&quot;41-概念&quot;&gt;4.1 概念&lt;/h2&gt;
&lt;p&gt;老样子从基本的概念开始梳理：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;broker&lt;/code&gt;：kafka集群中的任意一台提供服务的物理服务器即被称为broker&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;topic&lt;/code&gt;：消息队列的一个队列，一般做架构的时候按需求将不同的消息分别派送到不同的管道里，而其中的任意一个管道在kafka里就是一个topic&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;partition&lt;/code&gt;：topic下的概念，任意一个topic根据启动时的设定，会分成多个partition，而每个partition会由集群安排在某一台物理机broker上，以此做到集群的横向扩展&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;offset&lt;/code&gt;：partition下的概念，topic被分为很多partition，而每个partition则都会存储消息，每个partition存储的消息都是从0开始进行标号，而这个每条消息一个的标号，即为offset；可以理解为消息在partition里的唯一id；不同的partition都是从0开始标号，因此offset只对其自身的partition生效，不可混用&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;replica&lt;/code&gt;：某个partition的完整备份（在接收写入请求时数据可能会落后于leader），用在集群的高可用服务上，同时也可以提供partition读操作的负载均衡&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;producer&lt;/code&gt;：向topic里输入消息数据的角色&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;consumer&lt;/code&gt;：从topic里消费消息数据的角色&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;consumer group&lt;/code&gt;：可扩展且具有容错性的consumer机制，多个consumer共享一个group id，组内的所有consumer一起来消费topic的所有partition；但一个partition仍旧只能由一个consumer进行消费；主要是为了解决consumer和partition配对balance的问题，将consumer做成组由集群自动进行平衡并分配到partition&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;关于consumer group，更多的可以看：&lt;a href=&quot;https://www.cnblogs.com/huxi2b/p/6223228.html&quot; target=&quot;_blank&quot;&gt;Kafka消费组(consumer group)&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;ID_CLUSTER&quot;&gt;4.2 集群&lt;/h2&gt;
&lt;p&gt;一张图基本上就能说明问题：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/kafka-note/message-queue-05.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;kafka集群由多台broker（物理机）组成&lt;/li&gt;
  &lt;li&gt;图示中有&lt;code&gt;四台&lt;/code&gt;broker&lt;/li&gt;
  &lt;li&gt;每个topic会根据配置，生成固定数量的partition，均匀分配到物理机上&lt;/li&gt;
  &lt;li&gt;图示中的topic被分成了&lt;code&gt;3个&lt;/code&gt;partition：&lt;code&gt;P1_leader&lt;/code&gt;（broker1）、&lt;code&gt;P2_leader&lt;/code&gt;（broker2）、&lt;code&gt;P3_leader&lt;/code&gt;（broker4）&lt;/li&gt;
  &lt;li&gt;每个partition根据配置，会拥有固定数量的follower（replica），分别分配到各个物理机上&lt;/li&gt;
  &lt;li&gt;图示中即：&lt;code&gt;P1_follower&lt;/code&gt;（broker2、broker3）、&lt;code&gt;P2_follower&lt;/code&gt;（broker3、broker4）、&lt;code&gt;P3_follower&lt;/code&gt;（broker1、broker2）&lt;/li&gt;
  &lt;li&gt;当有broker宕机的时候：
    &lt;ul&gt;
      &lt;li&gt;丢失的follower会由集群重新寻找节点进行备份&lt;code&gt;恢复&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;丢失的leader会由集群自现存的follower中&lt;code&gt;选举&lt;/code&gt;产生，成为新的leader&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;43-分布式痛点offset&quot;&gt;4.3 分布式痛点（offset）&lt;/h2&gt;
&lt;p&gt;Kafka在分布式解决方案上也有痛点，主要是每个partition的offset问题。&lt;/p&gt;

&lt;p&gt;为了性能，kafka将一个partition视作一个管道，拥有一个从0开始的offset。这样做的好处就是不再需要在每一个消息体上做metadata存放该消息是否被消费掉等信息，而是通过partition的offset来标记整个管道中的消息被消费到了哪里。消息体更简单，流程上也更简单，不会出现乱序的消费情况。但也正是因为这种设计，导致每个partition无法由多个consumer并发消费，每个partition绑定只能同时允许一个consumer消费。&lt;/p&gt;

&lt;p&gt;因此，从机制上来说，kafka并不适合用来做consumer重消耗（CPU）类型的消息通道。虽然partition可以做很多，极端点来说可以做到和consumer实际需求1：1的配比，但超过适配当前需求的partition数量设置也会造成吞吐量的下降（参见：&lt;a href=&quot;#ID_BENCHMARK_SCEN4&quot;&gt;6.2.4 场景4&lt;/a&gt;）。&lt;/p&gt;

&lt;p&gt;consumer和partition在进行消息是否被消费掉的确认行为上，有两种方式：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;自动提交：
    &lt;ul&gt;
      &lt;li&gt;设置&lt;code&gt;enable.auto.commit=true&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;更新的频率根据参数&lt;code&gt;auto.commit.interval.ms&lt;/code&gt;来定，这种方式被称为&lt;code&gt;at most once&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;consumer fetch到消息后，partition就会更新offset，无论是否消费成功&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;手动提交：
    &lt;ul&gt;
      &lt;li&gt;设置&lt;code&gt;enable.auto.commit=false&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;这种方式被称为&lt;code&gt;at least once&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;consumer fetch到消息后，必须在消费成功后调用方法&lt;code&gt;consumer.commitSync()&lt;/code&gt;，手动通知partition更新offset&lt;/li&gt;
      &lt;li&gt;如果消费失败，则offset不会更新，此条消息会被重复消费一次&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;关于partition和consumer之间的关系，更多可以看下：&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/45175424/how-multiple-consumer-group-consumers-work-across-partition-on-the-same-topic-in&quot; target=&quot;_blank&quot;&gt;How multiple consumer group consumers work across partition on the same topic in Kafka?&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;If you want to have more consumers than partitions and still have performance enhancement and process only each message once, then you should increase the number of partitions in the topics so that there are at least as many partitions as consumers. Often topics are created with 2 times as many partitions needed to start, just so more consumers can be added later if needed without having to repartition the topic.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/pursuer211/article/details/79799478&quot; target=&quot;_blank&quot;&gt;kafka中partition和消费者对应关系&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;1个partition只能被同组的一个consumer消费，同组的consumer则起到均衡效果&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;以及自动提交相关：&lt;a href=&quot;https://medium.com/@danieljameskay/understanding-the-enable-auto-commit-kafka-consumer-property-12fa0ade7b65&quot; target=&quot;_blank&quot;&gt;Understanding the ‘enable.auto.commit’ Kafka Consumer property&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;44-临时消费压力应急&quot;&gt;4.4 临时消费压力应急&lt;/h2&gt;
&lt;p&gt;如果因某些原因，之前设计的partition分片数量不够导致能够上工的consumer数量不够，且consumer的消费速率跟不上的时候，就会发生消息堆积。如果堆积的情况比较严重的话，就需要程序介入处理。&lt;/p&gt;

&lt;p&gt;思路如下：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;老的partition以及老的topic肯定不能动，就算重新进行repartition整个集群重新平衡耗费的时间也是难以忍受的&lt;/li&gt;
  &lt;li&gt;创建新的topic&lt;/li&gt;
  &lt;li&gt;将新的topic的partition设到consumer消费速率能跟上的数量&lt;/li&gt;
  &lt;li&gt;将新的consumer部署上去，消费新设置的topic和partition&lt;/li&gt;
  &lt;li&gt;将老的topic以及partition上挂载的consumer全部停止&lt;/li&gt;
  &lt;li&gt;在老的topic以及partition上挂载临时consumer，这批consumer不做任何逻辑处理，只是将老的topic内的消息全部读取出来，并输入到新的topic里&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;这样老的topic里的消息就全部分发到新的topic里了，且新的topic的partition数量很高，可以挂载很多consumer处理堆积的消息。&lt;/p&gt;

&lt;h1 id=&quot;5-kafka监控--高可用&quot;&gt;5. Kafka监控 &amp;amp; 高可用&lt;/h1&gt;
&lt;h2 id=&quot;51-监控&quot;&gt;5.1 监控&lt;/h2&gt;
&lt;p&gt;监控方面，datadog的几篇文章非常不错，值得一读，不过版本有点老了，文章是2016年的：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.datadoghq.com/blog/monitoring-kafka-performance-metrics/&quot; target=&quot;_blank&quot;&gt;Monitoring Kafka performance metrics - P1&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.datadoghq.com/blog/collecting-kafka-performance-metrics/&quot; target=&quot;_blank&quot;&gt;Monitoring Kafka performance metrics - P2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;当然，Kafka也有Prometheus的exporter：&lt;a href=&quot;https://github.com/danielqsj/kafka_exporter&quot; target=&quot;_blank&quot;&gt;danielqsj/kafka_exporter&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;如果只需要可检索的指标列表，可以直接看这篇：&lt;a href=&quot;https://docs.confluent.io/current/kafka/monitoring.html&quot; target=&quot;_blank&quot;&gt;Monitoring Kafka&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;52-高可用&quot;&gt;5.2 高可用&lt;/h2&gt;
&lt;p&gt;在之前的&lt;a href=&quot;#ID_CLUSTER&quot;&gt;4.2 集群&lt;/a&gt;中，已经介绍过了Kafka的集群模式，可以看到Kafka天然就是分布式的，而且在设计之初就考虑到了集群的高可用。本文之前章节内关于集群的内容偏简单了，只介绍了大致的设计。如有需要更深入了解分布式和高可用的细节，则可以阅读唯品会的：&lt;a href=&quot;https://www.infoq.cn/article/depth-interpretation-of-kafka-data-reliability&quot; target=&quot;_blank&quot;&gt;Kafka 数据可靠性深度解读&lt;/a&gt;，这篇讲解非常透彻，基本上可以当经典来看了。&lt;/p&gt;

&lt;p&gt;Kafka的高可用配置，有几个配置项控制了集群的安全程度。这里需要记住一点，整个集群越安全集群的吞吐量就越低，这是等价交换的，不可能不付出任何代价就获得数据的安全性。唯品会的文章讲解的细节非常多，但我们真正执行操作的时候可以只知其然，懂得哪几个配置项需要操作即可：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;topic：
    &lt;ul&gt;
      &lt;li&gt;&lt;code&gt;replication.factor&lt;/code&gt;：每个partition会拥有多少个replica&lt;/li&gt;
      &lt;li&gt;&lt;code&gt;min.insync.replicas&lt;/code&gt;：partition的leader节点要求当前在线的replica节点的数量，如果实际在线数量少于这个数值，客户端的请求会被拒绝：&lt;code&gt;org.apache.kafka.common.errors.NotEnoughReplicasExceptoin: Messages are rejected since there are fewer in-sync replicas than required&lt;/code&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;broker：
    &lt;ul&gt;
      &lt;li&gt;&lt;code&gt;unclean.leader.election.enable&lt;/code&gt;：是否允许out-of-sync replica成为leader&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;producer：
    &lt;ul&gt;
      &lt;li&gt;producer.type：消息生产者提交消息到kafka服务器的时候的模式，可选：sync或async
        &lt;ul&gt;
          &lt;li&gt;&lt;code&gt;sync&lt;/code&gt;拥有很好的安全性&lt;/li&gt;
          &lt;li&gt;&lt;code&gt;async&lt;/code&gt;拥有更高的吞吐量，可以批量进行消息发送&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;request.required.acks：kafka服务器在收到消息之后何时对生产者进行完成反馈
        &lt;ul&gt;
          &lt;li&gt;&lt;code&gt;1（默认）&lt;/code&gt;：partition的leader节点收取完成即反馈，如果在follower同步数据之前leader宕机则数据丢失&lt;/li&gt;
          &lt;li&gt;&lt;code&gt;0&lt;/code&gt;：producer不等待kafka服务器反馈即直接进行后续发送，拥有最高的吞吐量以及最低的安全性&lt;/li&gt;
          &lt;li&gt;&lt;code&gt;-1&lt;/code&gt;：partition的所有节点包括了leader以及所有的follower全部都确认数据同步完成再反馈，最高的安全性以及最低的吞吐量&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;要保证数据写入到Kafka是安全的，高可靠的，需要如下配置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;topic：
    &lt;ul&gt;
      &lt;li&gt;replication.factor&amp;gt;=3：即副本数至少是3个&lt;/li&gt;
      &lt;li&gt;2&amp;lt;=min.insync.replicas&amp;lt;=replication.factor：要求每个partition leader的在线replica数量最少保持2个&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;broker：
    &lt;ul&gt;
      &lt;li&gt;unclean.leader.election.enable=false：不允许out-of-sync replica成为leader&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;producer：
    &lt;ul&gt;
      &lt;li&gt;request.required.acks=-1(all)：producer发送的消息请求必须让partition所有的replica都同步完毕才会返回成功&lt;/li&gt;
      &lt;li&gt;producer.type=sync：producer发送的消息以同步方式发送，即在写入成功之前，producer必须等待&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;6-kafka-benchmark&quot;&gt;6. Kafka Benchmark&lt;/h1&gt;
&lt;p&gt;这里的内容全部是转载自唯品会的：&lt;a href=&quot;https://www.infoq.cn/article/depth-interpretation-of-kafka-data-reliability&quot; target=&quot;_blank&quot;&gt;Kafka 数据可靠性深度解读&lt;/a&gt;。网上的资料很容易失效，因此在这里做下转载。&lt;/p&gt;

&lt;p&gt;Benchmark的Kafka版本是：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;0.10.1.0
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;61-测试环境&quot;&gt;6.1 测试环境&lt;/h2&gt;
&lt;p&gt;Kafka broker 用到了 4 台机器，分别为 broker[0/1/2/3] 配置如下：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CPU: 24core/2.6GHZ&lt;/li&gt;
  &lt;li&gt;Memory: 62G&lt;/li&gt;
  &lt;li&gt;Network: 4000Mb&lt;/li&gt;
  &lt;li&gt;OS/kernel: CentOs release 6.6 (Final)&lt;/li&gt;
  &lt;li&gt;Disk: 1089G&lt;/li&gt;
  &lt;li&gt;Kafka 版本：0.10.1.0&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;broker 端 JVM 参数设置：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;-Xmx8G -Xms8G -server -XX:+UseParNewGC -XX:+UseConcMarkSweepGC -XX:+CMSClassUnloadingEnabled -XX:+CMSScavengeBeforeRemark -XX:+DisableExplicitGC -Djava.awt.headless=true -Xloggc:/apps/service/kafka/bin/../logs/kafkaServer-gc.log -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintGCTimeStamps -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.port=9999
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;客户端机器配置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CPU: 24core/2.6GHZ&lt;/li&gt;
  &lt;li&gt;Memory: 3G&lt;/li&gt;
  &lt;li&gt;Network: 1000Mb&lt;/li&gt;
  &lt;li&gt;OS/kernel: CentOs release 6.3 (Final)&lt;/li&gt;
  &lt;li&gt;Disk: 240G&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;62-不同场景测试&quot;&gt;6.2 不同场景测试&lt;/h2&gt;
&lt;h3 id=&quot;621-场景1&quot;&gt;6.2.1 场景1&lt;/h3&gt;
&lt;p&gt;测试不同的副本数、min.insync.replicas 策略以及 request.required.acks 策略（以下简称 acks 策略）对于发送速度（TPS）的影响。&lt;/p&gt;

&lt;p&gt;具体配置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;一个 producer&lt;/li&gt;
  &lt;li&gt;发送方式为 sync&lt;/li&gt;
  &lt;li&gt;消息体大小为 1kB&lt;/li&gt;
  &lt;li&gt;partition 数为 12&lt;/li&gt;
  &lt;li&gt;副本数为：1/2/4&lt;/li&gt;
  &lt;li&gt;min.insync.replicas 分别为 1/2/4&lt;/li&gt;
  &lt;li&gt;acks 分别为 -1（all）/1/0&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;具体测试数据如下表（min.insync.replicas 只在 acks=-1 时有效）：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/kafka-note/message-queue-06.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;测试结果分析：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;客户端的 acks 策略对发送的 TPS 有较大的影响，TPS：acks_0 &amp;gt; acks_1 &amp;gt; ack_-1;&lt;/li&gt;
  &lt;li&gt;副本数越高，TPS 越低；副本数一致时，min.insync.replicas 不影响 TPS；&lt;/li&gt;
  &lt;li&gt;acks=0/1 时，TPS 与 min.insync.replicas 参数以及副本数无关，仅受 acks 策略的影响。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;下面将 partition 的个数设置为 1，来进一步确认下不同的 acks 策略、不同的 min.insync.replicas 策略以及不同的副本数对于发送速度的影响，详细请看情景 2 和情景 3。&lt;/p&gt;

&lt;h3 id=&quot;622-场景2&quot;&gt;6.2.2 场景2&lt;/h3&gt;
&lt;p&gt;在 partition 个数固定为 1，测试不同的副本数和 min.insync.replicas 策略对发送速度的影响。&lt;/p&gt;

&lt;p&gt;具体配置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;一个 producer&lt;/li&gt;
  &lt;li&gt;发送方式为 sync&lt;/li&gt;
  &lt;li&gt;消息体大小为 1kB&lt;/li&gt;
  &lt;li&gt;producer 端 acks=-1(all)&lt;/li&gt;
  &lt;li&gt;变换副本数：2/3/4&lt;/li&gt;
  &lt;li&gt;min.insync.replicas 设置为：1/2/4&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;测试结果如下：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/kafka-note/message-queue-07.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;测试结果分析：&lt;/p&gt;

&lt;p&gt;副本数越高，TPS 越低（这点与场景 1 的测试结论吻合），但是当 partition 数为 1 时差距甚微。min.insync.replicas 不影响 TPS。&lt;/p&gt;

&lt;h3 id=&quot;623-场景3&quot;&gt;6.2.3 场景3&lt;/h3&gt;
&lt;p&gt;在 partition 个数固定为 1，测试不同的 acks 策略和副本数对发送速度的影响。&lt;/p&gt;

&lt;p&gt;具体配置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;一个 producer&lt;/li&gt;
  &lt;li&gt;发送方式为 sync&lt;/li&gt;
  &lt;li&gt;消息体大小为 1kB&lt;/li&gt;
  &lt;li&gt;min.insync.replicas=1&lt;/li&gt;
  &lt;li&gt;topic 副本数为：1/2/4&lt;/li&gt;
  &lt;li&gt;acks： 0/1/-1&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;测试结果如下：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/kafka-note/message-queue-08.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;测试结果分析（与情景 1 一致）：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;副本数越多，TPS 越低；&lt;/li&gt;
  &lt;li&gt;客户端的 acks 策略对发送的 TPS 有较大的影响，TPS：acks_0 &amp;gt; acks_1 &amp;gt; ack_-1。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;ID_BENCHMARK_SCEN4&quot;&gt;6.2.4 场景4&lt;/h3&gt;
&lt;p&gt;测试不同 partition 数对发送速率的影响&lt;/p&gt;

&lt;p&gt;具体配置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;一个 producer&lt;/li&gt;
  &lt;li&gt;消息体大小为 1KB&lt;/li&gt;
  &lt;li&gt;发送方式为 sync&lt;/li&gt;
  &lt;li&gt;topic 副本数为 2&lt;/li&gt;
  &lt;li&gt;min.insync.replicas=2&lt;/li&gt;
  &lt;li&gt;acks=-1&lt;/li&gt;
  &lt;li&gt;partition 数量设置为 1/2/4/8/12&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;测试结果：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/kafka-note/message-queue-09.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;测试结果分析：&lt;/p&gt;

&lt;p&gt;partition 的不同会影响 TPS，随着 partition 的个数的增长 TPS 会有所增长，但并不是一直成正比关系，到达一定临界值时，partition 数量的增加反而会使 TPS 略微降低。&lt;/p&gt;

&lt;h3 id=&quot;625-场景5&quot;&gt;6.2.5 场景5&lt;/h3&gt;
&lt;p&gt;通过将集群中部分 broker 设置成不可服务状态，测试对客户端以及消息落盘的影响。&lt;/p&gt;

&lt;p&gt;具体配置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;一个 producer&lt;/li&gt;
  &lt;li&gt;消息体大小 1KB&lt;/li&gt;
  &lt;li&gt;发送方式为 sync&lt;/li&gt;
  &lt;li&gt;topic 副本数为 4&lt;/li&gt;
  &lt;li&gt;min.insync.replicas 设置为 2&lt;/li&gt;
  &lt;li&gt;acks=-1&lt;/li&gt;
  &lt;li&gt;retries=0/100000000&lt;/li&gt;
  &lt;li&gt;partition 数为 12&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;具体测试数据如下表：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/kafka-note/message-queue-10.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;出错信息：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;错误 1：客户端返回异常，部分数据可落盘，部分失败：org.apache.kafka.common.errors.NetworkException: The server disconnected before a response was received.&lt;/li&gt;
  &lt;li&gt;错误 2：[WARN]internals.Sender - Got error produce response with correlation id 19369 on topic-partition default_channel_replicas_4_1-3, retrying (999999999 attempts left). Error: NETWORK_EXCEPTION&lt;/li&gt;
  &lt;li&gt;错误 3： [WARN]internals.Sender - Got error produce response with correlation id 77890 on topic-partition default_channel_replicas_4_1-8, retrying (999999859 attempts left). Error: NOT_ENOUGH_REPLICAS&lt;/li&gt;
  &lt;li&gt;错误 4： [WARN]internals.Sender - Got error produce response with correlation id 77705 on topic-partition default_channel_replicas_4_1-3, retrying (999999999 attempts left). Error: NOT_ENOUGH_REPLICAS_AFTER_APPEND&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;测试结果分析：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;kill 两台 broker 后，客户端可以继续发送。broker 减少后，partition 的 leader 分布在剩余的两台 broker 上，造成了 TPS 的减小；&lt;/li&gt;
  &lt;li&gt;kill 三台 broker 后，客户端无法继续发送。Kafka 的自动重试功能开始起作用，当大于等于 min.insync.replicas 数量的 broker 恢复后，可以继续发送；&lt;/li&gt;
  &lt;li&gt;当 retries 不为 0 时，消息有重复落盘；客户端成功返回的消息都成功落盘，异常时部分消息可以落盘。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;626-场景6&quot;&gt;6.2.6 场景6&lt;/h3&gt;
&lt;p&gt;测试单个 producer 的发送延迟，以及端到端的延迟。&lt;/p&gt;

&lt;p&gt;具体配置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;一个 producer&lt;/li&gt;
  &lt;li&gt;消息体大小 1KB&lt;/li&gt;
  &lt;li&gt;发送方式为 sync&lt;/li&gt;
  &lt;li&gt;topic 副本数为 4&lt;/li&gt;
  &lt;li&gt;min.insync.replicas 设置为 2&lt;/li&gt;
  &lt;li&gt;acks=-1&lt;/li&gt;
  &lt;li&gt;partition 数为 12&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;测试数据及结果（单位为 ms）：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/kafka-note/message-queue-11.jpg&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;63-各场景测试总结&quot;&gt;6.3 各场景测试总结&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;当 acks=-1 时，Kafka 发送端的 TPS 受限于 topic 的副本数量（ISR 中），副本越多 TPS 越低；&lt;/li&gt;
  &lt;li&gt;acks=0 时，TPS 最高，其次为 1，最差为 -1，即 TPS：acks_0 &amp;gt; acks_1 &amp;gt; ack_-1；&lt;/li&gt;
  &lt;li&gt;min.insync.replicas 参数不影响 TPS；&lt;/li&gt;
  &lt;li&gt;partition 的不同会影响 TPS，随着 partition 的个数的增长 TPS 会有所增长，但并不是一直成正比关系，到达一定临界值时，partition 数量的增加反而会使 TPS 略微降低；&lt;/li&gt;
  &lt;li&gt;Kafka 在 acks=-1,min.insync.replicas&amp;gt;=1 时，具有高可靠性，所有成功返回的消息都可以落盘。&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;7-kafka使用范例&quot;&gt;7. Kafka使用范例&lt;/h1&gt;
&lt;p&gt;实验使用的还是下载下来的Kafka，版本如头部申明的是&lt;code&gt;2.2.0&lt;/code&gt;。范例代码可以在Github查看：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/tree/master/experiment/kafka&quot; target=&quot;_blank&quot;&gt;dist-system-practice/experiment/kafka/&lt;/a&gt;。&lt;/p&gt;

&lt;h1 id=&quot;8-在docker内部署集群&quot;&gt;8. 在Docker内部署集群&lt;/h1&gt;
&lt;p&gt;一般来说部署一个以上的docker容器组成集群，可以使用bash脚本的方法，自己编写命令一个个启动，但更好的方法是使用&lt;code&gt;docker-compose&lt;/code&gt;命令，读取配置文件，将整个集群按设定的模式启动起来。可运行范例可以查看：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/blob/master/golang/src/dist-system-practice/conf/kafka-cluster.yaml&quot; target=&quot;_blank&quot;&gt;dist-system-practice/conf/kafka-cluster.yaml&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;启动脚本：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/blob/master/golang/src/dist-system-practice/bash/dev/docker_kafka.sh&quot; target=&quot;_blank&quot;&gt;dist-system-practice/bash/dev/docker_kafka.sh&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;主要有几个点需要注意下。&lt;/p&gt;

&lt;h2 id=&quot;81-重要配置项&quot;&gt;8.1 重要配置项&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;kafka_1&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;wurstmeister/kafka:2.12-2.2.0&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 一定需要&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;kafka_1&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;kafka_1&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 使用这个名字来让同network的其他服务进行访问&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;zookeeper&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 保证启动先后顺序&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;kafka-net&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;19092:19092&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 保证非同一network的其他服务也能访问，但这么做要求每个kafka service都监听不同的端口，相互不能冲突&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;expose&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;19093&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# kafka集群内部流量走的端口号&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;always&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 保证container存活&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;logging&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;driver&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;json-file&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 日志输出以json格式，容易让聚合工具使用&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;max-size&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;512m&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 保证日志最大尺寸不会过大占用过多系统磁盘&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KAFKA_LISTENERS&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;INSIDE://0.0.0.0:19093,OUTSIDE://0.0.0.0:19092&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# kafka的实际监听地址，一般不是0.0.0.0就是容器名&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KAFKA_ADVERTISED_LISTENERS&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;INSIDE://kafka_1:19093,OUTSIDE://127.0.0.1:19092&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# kafka发布到zookeeper，让客户端获取并凭之连接kafka的地址，一定需要是客户端能访问到的地址，INSIDE部分供集群内部流量使用，OUTSIDE供客户端使用&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KAFKA_LISTENER_SECURITY_PROTOCOL_MAP&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 明确内部外部的通讯协议&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KAFKA_INTER_BROKER_LISTENER_NAME&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;INSIDE&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 告诉kafka集群上面的INSIDE和OUTSIDE配置哪个才是供集群内部流量使用的，按语义一般是INSIDE&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KAFKA_BROKER_ID&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 必须每个kafka service单独一个，不可重复&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KAFKA_ZOOKEEPER_CONNECT&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;zookeeper:2181&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 告知kafka zookeeper的访问地址&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KAFKA_LOG_DIRS&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;/tmp/kafka-logs&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# kafka实际的数据存放位置，推荐使用volume进行该地址的local映射&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;关于&lt;code&gt;LISTENER&lt;/code&gt;相关的几个配置（用于集群访问）更多的可以看下：&lt;a href=&quot;#DOCKER_OUT_NET&quot;&gt;8.2 对容器外应用提供服务&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;参见：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.confluent.io/current/kafka/deployment.html&quot; target=&quot;_blank&quot;&gt;Running Kafka in Production&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;DOCKER_OUT_NET&quot;&gt;8.2 对容器外应用提供服务&lt;/h2&gt;
&lt;p&gt;在docker中部署集群有一个比较大的问题就是容器内部和外部的网络访问地址是隔离的，而kafka集群部分节点的相互发现是根据配置：&lt;code&gt;KAFKA_ADVERTISED_LISTENERS&lt;/code&gt;来进行通知的。&lt;/p&gt;

&lt;p&gt;如果该配置内的地址填写的是&lt;code&gt;127.0.0.1&lt;/code&gt;这样的回环地址或容器外的IP，那么容器内各kafka节点之间的通讯就会有问题（因为容器内各节点拿到的配置地址都是容器外的IP）。而如果将该配置内的地址都配置成docker容器的名字，那么在容器内部的流量是没问题了，但外部访问kafka服务的应用程序拿到的地址则是容器的名字，就没法访问了。&lt;/p&gt;

&lt;p&gt;所以对于需要向容器外部环境的应用提供服务的情况来说，需要做好几项配置的调整（这里说的配置都是kafka的配置，不涉及到zookeeper的配置，事实上集群部署的配置中zookeeper相关的内容非常简单）：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KAFKA_LISTENERS&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;INSIDE://0.0.0.0:19093,OUTSIDE://0.0.0.0:19092&amp;quot;&lt;/span&gt;
&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KAFKA_ADVERTISED_LISTENERS&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;INSIDE://kafka_1:19093,OUTSIDE://127.0.0.1:19092&amp;quot;&lt;/span&gt;
&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KAFKA_LISTENER_SECURITY_PROTOCOL_MAP&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;INSIDE:PLAINTEXT,OUTSIDE:PLAINTEXT&amp;quot;&lt;/span&gt;
&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KAFKA_INTER_BROKER_LISTENER_NAME&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;INSIDE&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;kafka的配置中，现在可以将内部流量和外部流量的监听地址分离开来，在配置&lt;code&gt;LISTENERS&lt;/code&gt;相关的配置时，使用&lt;code&gt;,&lt;/code&gt;将&lt;code&gt;INSIDE&lt;/code&gt;和&lt;code&gt;OUTSIDE&lt;/code&gt;隔离开来即可。一般来说，&lt;code&gt;INSIDE&lt;/code&gt;的地址会配置成当前节点的容器名，或者就直接设置成&lt;code&gt;0.0.0.0&lt;/code&gt;。而&lt;code&gt;OUTSIDE&lt;/code&gt;则根据自身需求设置即可，这里的范例是给本机开发测试用，因此设置的是&lt;code&gt;127.0.0.1&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;KAFKA_INTER_BROKER_LISTENER_NAME&lt;/code&gt;配置项则是告诉kafka，集群各broker节点之间是使用INSIDE还是OUTSIDE配置作为集群内部流量的通讯地址。此外需要注意的是，该配置的&lt;code&gt;INSIDE&lt;/code&gt;和&lt;code&gt;OUTSIDE&lt;/code&gt;监听的端口是&lt;code&gt;不可以重复&lt;/code&gt;的，因为实际上kafka就是开了两个端口都在监听。&lt;/p&gt;

&lt;p&gt;一般第一次在本地设置集群进行开发和调试的时候，这里是个大坑，非常麻烦。配置不正确就会发现kafka完全无法通讯。&lt;/p&gt;

&lt;h2 id=&quot;83-docker-compose-scale&quot;&gt;8.3 docker-compose scale&lt;/h2&gt;
&lt;p&gt;一般来说，kafka service的配置不适合在配置文件中只设置一份，然后使用docker-compose scale的方法进行横向扩展。&lt;/p&gt;

&lt;p&gt;适用scale的场景只有完全无状态，且各个节点之间的配置完全相同的情况，而kafka各节点一般最好设置自身的&lt;code&gt;container_name&lt;/code&gt;，然后在监听地址中使用正确的容器名作为地址，来进行相互通讯。&lt;/p&gt;

&lt;h2 id=&quot;84-yaml配置重用&quot;&gt;8.4 yaml配置重用&lt;/h2&gt;
&lt;p&gt;因为无法使用scale的缘故，必须手写大量的kafka service节点yaml配置，这倒也不算是大问题。关键的问题在于有大量重复的配置项，如果后面要修改，就很麻烦，怕漏改或者改错。&lt;/p&gt;

&lt;p&gt;因此最好的方法是使用yaml的配置重用，来设置共通的配置，然后像变量一样重用。这可以参见我之前提到的范例配置文件：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;x-kafka-environment-defaults&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;&amp;amp;KAFKA_ENV_DEFAULTS&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;...&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;# 在这里放默认的配置&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;...&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;kafka_1&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;...&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;*KAFKA_ENV_DEFAULTS&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 这样就把作为变量的配置全部导入到这个点上了&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;84-相关参考&quot;&gt;8.4 相关参考&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://better-coding.com/building-apache-kafka-cluster-using-docker-compose-and-virtualbox/&quot; target=&quot;_blank&quot;&gt;Building Apache Kafka cluster using docker-compose and VirtualBox&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.kaaproject.org/kafka-docker&quot; target=&quot;_blank&quot;&gt;Deploying a Kafka broker in a Docker container&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;9-写性能与安全性&quot;&gt;9. 写性能与安全性&lt;/h1&gt;
&lt;p&gt;在进行测试的过程中，发现写入的速度比较慢，基本上每次写入在kafka集群这边会耗时1秒多，完全不能接受了。之前的博文中也提到了，集群安全性和写入性能是反比的，主要有几项因素：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;producer的写入模式：同步、异步
    &lt;ul&gt;
      &lt;li&gt;异步拥有最佳的性能，但安全性极差&lt;/li&gt;
      &lt;li&gt;同步性能很差，但安全性有保证&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;acks写入的集群同步模式：-1完全同步、0完全不等待同步、1Leader节点同步
    &lt;ul&gt;
      &lt;li&gt;0拥有最佳性能，最低的安全性&lt;/li&gt;
      &lt;li&gt;-1拥有最佳性能，但性能最低&lt;/li&gt;
      &lt;li&gt;1则比较均衡&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;partition数量：acks如果为-1，则需要同步所有节点，partition数量越多则性能越低&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;后续进行了一些研究和测试。&lt;/p&gt;

&lt;p&gt;集群共3个broker，topic分片如下：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Topic:work-topic	PartitionCount:3	ReplicationFactor:3	Configs:
	Topic: work-topic	Partition: 0	Leader: 2	Replicas: 2,0,1	Isr: 2,0,1
	Topic: work-topic	Partition: 1	Leader: 1	Replicas: 1,2,0	Isr: 1,2,0
	Topic: work-topic	Partition: 2	Leader: 0	Replicas: 0,1,2	Isr: 0,1,2
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;查了下官方配置，&lt;code&gt;producer.acks&lt;/code&gt;这个现在放在&lt;code&gt;3.3 Producer Configs&lt;/code&gt;里，命名为&lt;code&gt;acks&lt;/code&gt;（&lt;a href=&quot;https://kafka.apache.org/22/documentation.html#producerconfigs&quot; target=&quot;_blank&quot;&gt;链接&lt;/a&gt;）。需要注意的是，这一项配置并不是服务端的配置项，而是连接上来的客户端producer所进行的设置，是否acks根据客户端producer的要求而变动。这很反直觉，我一开始一直都以为这是服务端的配置项，没想到居然是客户端的。&lt;/p&gt;

&lt;p&gt;acks在kafka-go的使用，可以查看注释：&lt;a href=&quot;https://github.com/segmentio/kafka-go/blob/v0.2.4/writer.go#L101&quot; target=&quot;_blank&quot;&gt;kafka-go/writer.go&lt;/a&gt;，默认是-1，也就是最安全但最慢的那种。&lt;/p&gt;

&lt;p&gt;此外，写入模式是同步还是异步也是客户端设置，见：&lt;a href=&quot;https://github.com/segmentio/kafka-go/blob/v0.2.4/writer.go#L105&quot; target=&quot;_blank&quot;&gt;kafka-go/writer.go&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;在上面提到的几项要素中，集群规模和partition数量之类都是业务要求，一般不会轻易变动，所以测试主要是实验在不同写入模式和acks情况下的性能变动。&lt;/p&gt;

&lt;p&gt;测试：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;同步 -1 1秒+
同步 1  1秒+
同步 0  1秒+
异步 -1 0.2ms 几乎瞬间完成
异步 1  0.2ms 几乎瞬间完成
异步 0  0.2ms 几乎瞬间完成
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;结论：性能只在于是否将客户端设置成异步写入，acks对性能的影响微乎其微。&lt;/p&gt;

&lt;p&gt;但上述的测试是在MAC本地环境进行的，有几项因素不够稳定：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;kafka集群的内存很小&lt;/li&gt;
  &lt;li&gt;磁盘IO和实际情况差别较大&lt;/li&gt;
  &lt;li&gt;集群规模过小&lt;/li&gt;
  &lt;li&gt;partition数量很少（集群和partition数量很小能够部分解释为什么acks的改动基本上不影响性能）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;因此上述测试的结论主要是参考价值，不能作为最终结论。如果后续需要严谨结论的话，需要在真实机器上测试，并需要开启go的profiling，观察下kafka类库中的写入到底是怎么完成的，以及kafka集群的响应情况。此外，即便是模拟集群1秒左右的同步写入速度也实在是太慢了，后续还需要深入profiling，到底这1秒做了什么（无论是kafka还是go客户端）。&lt;/p&gt;

&lt;h1 id=&quot;10-todo&quot;&gt;10. TODO&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;深入研究Kafka的监控Metrics&lt;/li&gt;
  &lt;li&gt;Kafka集群同步写入性能较低的原因解析&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;资料&quot;&gt;资料&lt;/h1&gt;
&lt;h2 id=&quot;链接&quot;&gt;链接&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://www.kubiji.cn/book/apache_kafka/APACHEKAFKAJiaoCheng/APACHEKAFKAGaiShu.html&quot; target=&quot;_blank&quot;&gt;Apache kafka中文手册&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.infoq.cn/article/distributed-queue-programme-model-actual-combat-optimization&quot; target=&quot;_blank&quot;&gt;分布式队列编程：从模型、实战到优化&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=MjM5NjQ5MTI5OA==&amp;amp;mid=2651745361&amp;amp;idx=1&amp;amp;sn=5f0f67484a0de4b0dd2796848ef9cc94&quot; target=&quot;_blank&quot;&gt;分布式队列编程优化篇&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/7a6deaba34d2&quot; target=&quot;_blank&quot;&gt;如何保证消息队列的高可用和幂等性以及数据丢失，顺序一致性&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.infoq.cn/article/kafka-vs-rabbitmq&quot; target=&quot;_blank&quot;&gt;消息中间件选型分析：从 Kafka 与 RabbitMQ 的对比看全局&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.infoq.cn/article/dXJ3EYIp*WaHfmVwlMeu&quot; target=&quot;_blank&quot;&gt;滴滴出行基于 RocketMQ 构建企业级消息队列服务的实践&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/39586635/why-is-kafka-pull-based-instead-of-push-based&quot; target=&quot;_blank&quot;&gt;Why is Kafka pull-based instead of push-based?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://medium.com/@philipfeng/modern-open-source-messaging-apache-kafka-rabbitmq-nats-pulsar-and-nsq-ca3bf7422db5&quot; target=&quot;_blank&quot;&gt;Modern Open Source Messaging: NATS, RabbitMQ, Apache Kafka, hmbdc, Synapse, NSQ and Pulsar&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/huxi2b/p/6223228.html&quot; target=&quot;_blank&quot;&gt;Kafka消费组(consumer group)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/45175424/how-multiple-consumer-group-consumers-work-across-partition-on-the-same-topic-in&quot; target=&quot;_blank&quot;&gt;How multiple consumer group consumers work across partition on the same topic in Kafka?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://blog.csdn.net/pursuer211/article/details/79799478&quot; target=&quot;_blank&quot;&gt;kafka中partition和消费者对应关系&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://medium.com/@danieljameskay/understanding-the-enable-auto-commit-kafka-consumer-property-12fa0ade7b65&quot; target=&quot;_blank&quot;&gt;Understanding the ‘enable.auto.commit’ Kafka Consumer property&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.datadoghq.com/blog/monitoring-kafka-performance-metrics/&quot; target=&quot;_blank&quot;&gt;Monitoring Kafka performance metrics - P1&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.datadoghq.com/blog/collecting-kafka-performance-metrics/&quot; target=&quot;_blank&quot;&gt;Monitoring Kafka performance metrics - P2&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/danielqsj/kafka_exporter&quot; target=&quot;_blank&quot;&gt;danielqsj/kafka_exporter&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.confluent.io/current/kafka/monitoring.html&quot; target=&quot;_blank&quot;&gt;Monitoring Kafka&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.infoq.cn/article/depth-interpretation-of-kafka-data-reliability&quot; target=&quot;_blank&quot;&gt;Kafka 数据可靠性深度解读&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://better-coding.com/building-apache-kafka-cluster-using-docker-compose-and-virtualbox/&quot; target=&quot;_blank&quot;&gt;Building Apache Kafka cluster using docker-compose and VirtualBox&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.kaaproject.org/kafka-docker&quot; target=&quot;_blank&quot;&gt;Deploying a Kafka broker in a Docker container&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.confluent.io/current/kafka/deployment.html&quot; target=&quot;_blank&quot;&gt;Running Kafka in Production&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/47388267&quot; target=&quot;_blank&quot;&gt;比拼Kafka，大数据分析新秀Pulsar到底好在哪&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.slideshare.net/merlimat/high-performance-messaging-with-apache-pulsar&quot; target=&quot;_blank&quot;&gt;High performance messaging with Apache Pulsar&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.infoq.cn/article/Us*a8umKXT9LpV9hA6tF&quot; target=&quot;_blank&quot;&gt;选择 Pulsar 而不是 Kafka 的 7 大理由&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;EOF&lt;/p&gt;
&lt;/blockquote&gt;
</description>
				<pubDate>Mon, 29 Apr 2019 10:01:22 +0800</pubDate>
				<link>https://xenojoshua.com/2019/04/kafka-note/</link>
				<guid isPermaLink="true">https://xenojoshua.com/2019/04/kafka-note/</guid>
			</item>
		
			<item>
				<title>消息队列设计精要 - 美团点评技术团队</title>
				<description>&lt;h4&gt;Table of Contents&lt;/h4&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#前言&quot; id=&quot;markdown-toc-前言&quot;&gt;前言&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#正文&quot; id=&quot;markdown-toc-正文&quot;&gt;正文&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#1-何时需要消息队列&quot; id=&quot;markdown-toc-1-何时需要消息队列&quot;&gt;1. 何时需要消息队列&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#11-解耦&quot; id=&quot;markdown-toc-11-解耦&quot;&gt;1.1 解耦&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#12-最终一致性&quot; id=&quot;markdown-toc-12-最终一致性&quot;&gt;1.2 最终一致性&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#13-广播&quot; id=&quot;markdown-toc-13-广播&quot;&gt;1.3 广播&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#14-错峰与流控&quot; id=&quot;markdown-toc-14-错峰与流控&quot;&gt;1.4 错峰与流控&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2-如何设计一个消息队列&quot; id=&quot;markdown-toc-2-如何设计一个消息队列&quot;&gt;2. 如何设计一个消息队列&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#21-综述&quot; id=&quot;markdown-toc-21-综述&quot;&gt;2.1 综述&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#22-实现队列基本功能&quot; id=&quot;markdown-toc-22-实现队列基本功能&quot;&gt;2.2 实现队列基本功能&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#221-rpc通信协议&quot; id=&quot;markdown-toc-221-rpc通信协议&quot;&gt;2.2.1 RPC通信协议&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#222-高可用&quot; id=&quot;markdown-toc-222-高可用&quot;&gt;2.2.2 高可用&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#223-服务端承载消息堆积的能力&quot; id=&quot;markdown-toc-223-服务端承载消息堆积的能力&quot;&gt;2.2.3 服务端承载消息堆积的能力&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#224-存储子系统的选择&quot; id=&quot;markdown-toc-224-存储子系统的选择&quot;&gt;2.2.4 存储子系统的选择&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#225-消费关系解析&quot; id=&quot;markdown-toc-225-消费关系解析&quot;&gt;2.2.5 消费关系解析&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#23-队列高级特性设计&quot; id=&quot;markdown-toc-23-队列高级特性设计&quot;&gt;2.3 队列高级特性设计&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#231-可靠投递最终一致性&quot; id=&quot;markdown-toc-231-可靠投递最终一致性&quot;&gt;2.3.1 可靠投递（最终一致性）&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#2311-消费确认&quot; id=&quot;markdown-toc-2311-消费确认&quot;&gt;2.3.1.1 消费确认&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#2312-重复消息和顺序消息&quot; id=&quot;markdown-toc-2312-重复消息和顺序消息&quot;&gt;2.3.1.2 重复消息和顺序消息&lt;/a&gt;                &lt;ul&gt;
                  &lt;li&gt;&lt;a href=&quot;#版本号&quot; id=&quot;markdown-toc-版本号&quot;&gt;版本号&lt;/a&gt;&lt;/li&gt;
                  &lt;li&gt;&lt;a href=&quot;#状态机&quot; id=&quot;markdown-toc-状态机&quot;&gt;状态机&lt;/a&gt;&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#2313-中间件对于重复消息的处理&quot; id=&quot;markdown-toc-2313-中间件对于重复消息的处理&quot;&gt;2.3.1.3 中间件对于重复消息的处理&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#232-事务&quot; id=&quot;markdown-toc-232-事务&quot;&gt;2.3.2 事务&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#233-性能相关&quot; id=&quot;markdown-toc-233-性能相关&quot;&gt;2.3.3 性能相关&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#2331-异步同步&quot; id=&quot;markdown-toc-2331-异步同步&quot;&gt;2.3.3.1 异步/同步&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#2332-批量&quot; id=&quot;markdown-toc-2332-批量&quot;&gt;2.3.3.2 批量&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#24-push还是pull&quot; id=&quot;markdown-toc-24-push还是pull&quot;&gt;2.4 push还是pull&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#241-慢消费&quot; id=&quot;markdown-toc-241-慢消费&quot;&gt;2.4.1 慢消费&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#242-消息延迟与忙等&quot; id=&quot;markdown-toc-242-消息延迟与忙等&quot;&gt;2.4.2 消息延迟与忙等&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#243-顺序消息&quot; id=&quot;markdown-toc-243-顺序消息&quot;&gt;2.4.3 顺序消息&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#3-总结&quot; id=&quot;markdown-toc-3-总结&quot;&gt;3. 总结&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#作者简介&quot; id=&quot;markdown-toc-作者简介&quot;&gt;作者简介&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;前言&quot;&gt;前言&lt;/h1&gt;

&lt;p&gt;本文源自美团点评技术团队博客，但似乎是因为博客改版的原因，之前本文的链接失效了。我因为有剪藏文章的习惯，因此有幸没有丢失原文内容。而最近在写的消息队列文章中，我希望引用部分内容，而网上已经不好找原文了，因此无奈之下在这里做一份备份转载。&lt;/p&gt;

&lt;h1 id=&quot;正文&quot;&gt;正文&lt;/h1&gt;

&lt;p&gt;消息队列已经逐渐成为企业IT系统内部通信的核心手段。它具有低耦合、可靠投递、广播、流量控制、最终一致性等一系列功能，成为异步RPC的主要手段之一。&lt;/p&gt;

&lt;p&gt;当今市面上有很多主流的消息中间件，如老牌的ActiveMQ、RabbitMQ，炙手可热的Kafka，阿里巴巴自主开发的Notify、MetaQ、RocketMQ等。&lt;/p&gt;

&lt;p&gt;本文不会一一介绍这些消息队列的所有特性，而是探讨一下自主开发设计一个消息队列时，你需要思考和设计的重要方面。过程中我们会参考这些成熟消息队列的很多重要思想。&lt;/p&gt;

&lt;p&gt;本文首先会阐述什么时候你需要一个消息队列，然后以Push模型为主，从零开始分析设计一个消息队列时需要考虑到的问题，如RPC、高可用、顺序和重复消息、可靠投递、消费关系解析等。&lt;/p&gt;

&lt;p&gt;也会分析以Kafka为代表的pull模型所具备的优点。最后是一些高级主题，如用批量/异步提高性能、pull模型的系统设计理念、存储子系统的设计、流量控制的设计、公平调度的实现等。其中最后四个方面会放在下篇讲解。&lt;/p&gt;

&lt;h1 id=&quot;1-何时需要消息队列&quot;&gt;1. 何时需要消息队列&lt;/h1&gt;

&lt;p&gt;当你需要使用消息队列时，首先需要考虑它的必要性。可以使用mq的场景有很多，最常用的几种，是做业务解耦/最终一致性/广播/错峰流控等。反之，如果需要强一致性，关注业务逻辑的处理结果，则RPC显得更为合适。&lt;/p&gt;

&lt;h2 id=&quot;11-解耦&quot;&gt;1.1 解耦&lt;/h2&gt;

&lt;p&gt;解耦是消息队列要解决的最本质问题。所谓解耦，简单点讲就是一个事务，只关心核心的流程。而需要依赖其他系统但不那么重要的事情，有通知即可，无需等待结果。换句话说，基于消息的模型，关心的是“通知”，而非“处理”。&lt;/p&gt;

&lt;p&gt;比如在美团旅游，我们有一个产品中心，产品中心上游对接的是主站、移动后台、旅游供应链等各个数据源；下游对接的是筛选系统、API系统等展示系统。当上游的数据发生变更的时候，如果不使用消息系统，势必要调用我们的接口来更新数据，就特别依赖产品中心接口的稳定性和处理能力。但其实，作为旅游的产品中心，也许只有对于旅游自建供应链，产品中心更新成功才是他们关心的事情。而对于团购等外部系统，产品中心更新成功也好、失败也罢，并不是他们的职责所在。他们只需要保证在信息变更的时候通知到我们就好了。&lt;/p&gt;

&lt;p&gt;而我们的下游，可能有更新索引、刷新缓存等一系列需求。对于产品中心来说，这也不是我们的职责所在。说白了，如果他们定时来拉取数据，也能保证数据的更新，只是实时性没有那么强。但使用接口方式去更新他们的数据，显然对于产品中心来说太过于“重量级”了，只需要发布一个产品ID变更的通知，由下游系统来处理，可能更为合理。&lt;/p&gt;

&lt;p&gt;再举一个例子，对于我们的订单系统，订单最终支付成功之后可能需要给用户发送短信积分什么的，但其实这已经不是我们系统的核心流程了。如果外部系统速度偏慢（比如短信网关速度不好），那么主流程的时间会加长很多，用户肯定不希望点击支付过好几分钟才看到结果。那么我们只需要通知短信系统“我们支付成功了”，不一定非要等待它处理完成。&lt;/p&gt;

&lt;h2 id=&quot;12-最终一致性&quot;&gt;1.2 最终一致性&lt;/h2&gt;

&lt;p&gt;最终一致性指的是两个系统的状态保持一致，要么都成功，要么都失败。当然有个时间限制，理论上越快越好，但实际上在各种异常的情况下，可能会有一定延迟达到最终一致状态，但最后两个系统的状态是一样的。&lt;/p&gt;

&lt;p&gt;业界有一些为“最终一致性”而生的消息队列，如Notify（阿里）、QMQ（去哪儿）等，其设计初衷，就是为了交易系统中的高可靠通知。&lt;/p&gt;

&lt;p&gt;以一个银行的转账过程来理解最终一致性，转账的需求很简单，如果A系统扣钱成功，则B系统加钱一定成功。反之则一起回滚，像什么都没发生一样。&lt;/p&gt;

&lt;p&gt;然而，这个过程中存在很多可能的意外：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;A扣钱成功，调用B加钱接口失败。&lt;/li&gt;
  &lt;li&gt;A扣钱成功，调用B加钱接口虽然成功，但获取最终结果时网络异常引起超时。&lt;/li&gt;
  &lt;li&gt;A扣钱成功，B加钱失败，A想回滚扣的钱，但A机器down机。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;可见，想把这件看似简单的事真正做成，真的不那么容易。所有跨VM的一致性问题，从技术的角度讲通用的解决方案是：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;强一致性，分布式事务，但落地太难且成本太高，后文会具体提到。&lt;/li&gt;
  &lt;li&gt;最终一致性，主要是用“记录”和“补偿”的方式。在做所有的不确定的事情之前，先把事情记录下来，然后去做不确定的事情，结果可能是：成功、失败或是不确定，“不确定”（例如超时等）可以等价为失败。成功就可以把记录的东西清理掉了，对于失败和不确定，可以依靠定时任务等方式把所有失败的事情重新搞一遍，直到成功为止。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;回到刚才的例子，系统在A扣钱成功的情况下，把要给B“通知”这件事记录在库里（为了保证最高的可靠性可以把通知B系统加钱和扣钱成功这两件事维护在一个本地事务里），通知成功则删除这条记录，通知失败或不确定则依靠定时任务补偿性地通知我们，直到我们把状态更新成正确的为止。&lt;/p&gt;

&lt;p&gt;整个这个模型依然可以基于RPC来做，但可以抽象成一个统一的模型，基于消息队列来做一个“企业总线”。&lt;/p&gt;

&lt;p&gt;具体来说，本地事务维护业务变化和通知消息，一起落地（失败则一起回滚），然后RPC到达broker，在broker成功落地后，RPC返回成功，本地消息可以删除。否则本地消息一直靠定时任务轮询不断重发，这样就保证了消息可靠落地broker。&lt;/p&gt;

&lt;p&gt;Broker往consumer发送消息的过程类似，一直发送消息，直到consumer发送消费成功确认。&lt;/p&gt;

&lt;p&gt;我们先不理会重复消息的问题，通过两次消息落地加补偿，下游是一定可以收到消息的。然后依赖状态机版本号等方式做判重，更新自己的业务，就实现了最终一致性。&lt;/p&gt;

&lt;p&gt;最终一致性不是消息队列的必备特性，但确实可以依靠消息队列来做最终一致性的事情。另外，所有不保证100%不丢消息的消息队列，理论上无法实现最终一致性。好吧，应该说理论上的100%，排除系统严重故障和bug。&lt;/p&gt;

&lt;p&gt;像Kafka一类的设计，在设计层面上就有丢消息的可能（比如定时刷盘，如果掉电就会丢消息）。哪怕只丢千分之一的消息，业务也必须用其他的手段来保证结果正确。&lt;/p&gt;

&lt;h2 id=&quot;13-广播&quot;&gt;1.3 广播&lt;/h2&gt;

&lt;p&gt;消息队列的基本功能之一是进行广播。如果没有消息队列，每当一个新的业务方接入，我们都要联调一次新接口。有了消息队列，我们只需要关心消息是否送达了队列，至于谁希望订阅，是下游的事情，无疑极大地减少了开发和联调的工作量。&lt;/p&gt;

&lt;p&gt;比如本文开始提到的产品中心发布产品变更的消息，以及景点库很多去重更新的消息，可能“关心”方有很多个，但产品中心和景点库只需要发布变更消息即可，谁关心谁接入。&lt;/p&gt;

&lt;h2 id=&quot;14-错峰与流控&quot;&gt;1.4 错峰与流控&lt;/h2&gt;

&lt;p&gt;试想上下游对于事情的处理能力是不同的。比如，Web前端每秒承受上千万的请求，并不是什么神奇的事情，只需要加多一点机器，再搭建一些LVS负载均衡设备和Nginx等即可。但数据库的处理能力却十分有限，即使使用SSD加分库分表，单机的处理能力仍然在万级。由于成本的考虑，我们不能奢求数据库的机器数量追上前端。&lt;/p&gt;

&lt;p&gt;这种问题同样存在于系统和系统之间，如短信系统可能由于短板效应，速度卡在网关上（每秒几百次请求），跟前端的并发量不是一个数量级。但用户晚上个半分钟左右收到短信，一般是不会有太大问题的。如果没有消息队列，两个系统之间通过协商、滑动窗口等复杂的方案也不是说不能实现。但系统复杂性指数级增长，势必在上游或者下游做存储，并且要处理定时、拥塞等一系列问题。而且每当有处理能力有差距的时候，都需要单独开发一套逻辑来维护这套逻辑。所以，利用中间系统转储两个系统的通信内容，并在下游系统有能力处理这些消息的时候，再处理这些消息，是一套相对较通用的方式。&lt;/p&gt;

&lt;p&gt;总而言之，消息队列不是万能的。对于需要强事务保证而且延迟敏感的，RPC是优于消息队列的。&lt;/p&gt;

&lt;p&gt;对于一些无关痛痒，或者对于别人非常重要但是对于自己不是那么关心的事情，可以利用消息队列去做。&lt;/p&gt;

&lt;p&gt;支持最终一致性的消息队列，能够用来处理延迟不那么敏感的“分布式事务”场景，而且相对于笨重的分布式事务，可能是更优的处理方式。&lt;/p&gt;

&lt;p&gt;当上下游系统处理能力存在差距的时候，利用消息队列做一个通用的“漏斗”。在下游有能力处理的时候，再进行分发。如果下游有很多系统关心你的系统发出的通知的时候，果断地使用消息队列吧。&lt;/p&gt;

&lt;h1 id=&quot;2-如何设计一个消息队列&quot;&gt;2. 如何设计一个消息队列&lt;/h1&gt;

&lt;h2 id=&quot;21-综述&quot;&gt;2.1 综述&lt;/h2&gt;

&lt;p&gt;我们现在明确了消息队列的使用场景，下一步就是如何设计实现一个消息队列了。&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/message-queue-design/message-queue-01.png&quot; alt=&quot;01&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;基于消息的系统模型，不一定需要broker(消息队列服务端)。市面上的的Akka（actor模型）、ZeroMQ等，其实都是基于消息的系统设计范式，但是没有broker。&lt;/p&gt;

&lt;p&gt;我们之所以要设计一个消息队列，并且配备broker，无外乎要做两件事情：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;消息的转储，在更合适的时间点投递，或者通过一系列手段辅助消息最终能送达消费机。&lt;/li&gt;
  &lt;li&gt;规范一种范式和通用的模式，以满足解耦、最终一致性、错峰等需求。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;掰开了揉碎了看，最简单的消息队列可以做成一个消息转发器，把一次RPC做成两次RPC。发送者把消息投递到服务端（以下简称broker），服务端再将消息转发一手到接收端，就是这么简单。&lt;/p&gt;

&lt;p&gt;一般来讲，设计消息队列的整体思路是先build一个整体的数据流,例如producer发送给broker,broker发送给consumer,consumer回复消费确认，broker删除/备份消息等。&lt;/p&gt;

&lt;p&gt;利用RPC将数据流串起来。然后考虑RPC的高可用性，尽量做到无状态，方便水平扩展。&lt;/p&gt;

&lt;p&gt;之后考虑如何承载消息堆积，然后在合适的时机投递消息，而处理堆积的最佳方式，就是存储，存储的选型需要综合考虑性能/可靠性和开发维护成本等诸多因素。&lt;/p&gt;

&lt;p&gt;为了实现广播功能，我们必须要维护消费关系，可以利用zk/config server等保存消费关系。&lt;/p&gt;

&lt;p&gt;在完成了上述几个功能后，消息队列基本就实现了。然后我们可以考虑一些高级特性，如可靠投递，事务特性，性能优化等。&lt;/p&gt;

&lt;p&gt;下面我们会以设计消息队列时重点考虑的模块为主线，穿插灌输一些消息队列的特性实现方法，来具体分析设计实现一个消息队列时的方方面面。&lt;/p&gt;

&lt;h2 id=&quot;22-实现队列基本功能&quot;&gt;2.2 实现队列基本功能&lt;/h2&gt;

&lt;h3 id=&quot;221-rpc通信协议&quot;&gt;2.2.1 RPC通信协议&lt;/h3&gt;

&lt;p&gt;刚才讲到，所谓消息队列，无外乎两次RPC加一次转储，当然需要消费端最终做消费确认的情况是三次RPC。既然是RPC，就必然牵扯出一系列话题，什么负载均衡啊、服务发现啊、通信协议啊、序列化协议啊，等等。在这一块，我的强烈建议是不要重复造轮子。利用公司现有的RPC框架：Thrift也好，Dubbo也好，或者是其他自定义的框架也好。因为消息队列的RPC，和普通的RPC没有本质区别。当然了，自主利用Memchached或者Redis协议重新写一套RPC框架并非不可（如MetaQ使用了自己封装的Gecko NIO框架，卡夫卡也用了类似的协议）。但实现成本和难度无疑倍增。排除对效率的极端要求，都可以使用现成的RPC框架。&lt;/p&gt;

&lt;p&gt;简单来讲，服务端提供两个RPC服务，一个用来接收消息，一个用来确认消息收到。并且做到不管哪个server收到消息和确认消息，结果一致即可。当然这中间可能还涉及跨IDC的服务的问题。这里和RPC的原则是一致的，尽量优先选择本机房投递。你可能会问，如果producer和consumer本身就在两个机房了，怎么办？首先，broker必须保证感知的到所有consumer的存在。其次，producer尽量选择就近的机房就好了。&lt;/p&gt;

&lt;h3 id=&quot;222-高可用&quot;&gt;2.2.2 高可用&lt;/h3&gt;

&lt;p&gt;其实所有的高可用，是依赖于RPC和存储的高可用来做的。先来看RPC的高可用，美团的基于MTThrift的RPC框架，阿里的Dubbo等，其本身就具有服务自动发现，负载均衡等功能。而消息队列的高可用，只要保证broker接受消息和确认消息的接口是幂等的，并且consumer的几台机器处理消息是幂等的，这样就把消息队列的可用性，转交给RPC框架来处理了。&lt;/p&gt;

&lt;p&gt;那么怎么保证幂等呢？最简单的方式莫过于共享存储。broker多机器共享一个DB或者一个分布式文件/kv系统，则处理消息自然是幂等的。就算有单点故障，其他节点可以立刻顶上。另外failover可以依赖定时任务的补偿，这是消息队列本身天然就可以支持的功能。存储系统本身的可用性我们不需要操太多心，放心大胆的交给DBA们吧！&lt;/p&gt;

&lt;p&gt;对于不共享存储的队列，如Kafka使用分区加主备模式，就略微麻烦一些。需要保证每一个分区内的高可用性，也就是每一个分区至少要有一个主备且需要做数据的同步，关于这块HA的细节，可以参考下篇pull模型消息系统设计。&lt;/p&gt;

&lt;h3 id=&quot;223-服务端承载消息堆积的能力&quot;&gt;2.2.3 服务端承载消息堆积的能力&lt;/h3&gt;

&lt;p&gt;消息到达服务端如果不经过任何处理就到接收者了，broker就失去了它的意义。为了满足我们错峰/流控/最终可达等一系列需求，把消息存储下来，然后选择时机投递就显得是顺理成章的了。&lt;/p&gt;

&lt;p&gt;只是这个存储可以做成很多方式。比如存储在内存里，存储在分布式KV里，存储在磁盘里，存储在数据库里等等。但归结起来，主要有持久化和非持久化两种。&lt;/p&gt;

&lt;p&gt;持久化的形式能更大程度地保证消息的可靠性（如断电等不可抗外力），并且理论上能承载更大限度的消息堆积（外存的空间远大于内存）。&lt;/p&gt;

&lt;p&gt;但并不是每种消息都需要持久化存储。很多消息对于投递性能的要求大于可靠性的要求，且数量极大（如日志）。这时候，消息不落地直接暂存内存，尝试几次failover，最终投递出去也未尝不可。&lt;/p&gt;

&lt;p&gt;市面上的消息队列普遍两种形式都支持。当然具体的场景还要具体结合公司的业务来看。&lt;/p&gt;

&lt;h3 id=&quot;224-存储子系统的选择&quot;&gt;2.2.4 存储子系统的选择&lt;/h3&gt;

&lt;p&gt;我们来看看如果需要数据落地的情况下各种存储子系统的选择。理论上，从速度来看，文件系统&amp;gt;分布式KV（持久化）&amp;gt;分布式文件系统&amp;gt;数据库，而可靠性却截然相反。还是要从支持的业务场景出发作出最合理的选择，如果你们的消息队列是用来支持支付/交易等对可靠性要求非常高，但对性能和量的要求没有这么高，而且没有时间精力专门做文件存储系统的研究，DB是最好的选择。&lt;/p&gt;

&lt;p&gt;但是DB受制于IOPS，如果要求单broker 5位数以上的QPS性能，基于文件的存储是比较好的解决方案。整体上可以采用数据文件+索引文件的方式处理，具体这块的设计比较复杂，可以参考下篇的存储子系统设计。&lt;/p&gt;

&lt;p&gt;分布式KV（如MongoDB，HBase）等，或者持久化的Redis，由于其编程接口较友好，性能也比较可观，如果在可靠性要求不是那么高的场景，也不失为一个不错的选择。&lt;/p&gt;

&lt;h3 id=&quot;225-消费关系解析&quot;&gt;2.2.5 消费关系解析&lt;/h3&gt;

&lt;p&gt;现在我们的消息队列初步具备了转储消息的能力。下面一个重要的事情就是解析发送接收关系，进行正确的消息投递了。&lt;/p&gt;

&lt;p&gt;市面上的消息队列定义了一堆让人晕头转向的名词，如JMS 规范中的Topic/Queue，Kafka里面的Topic/Partition/ConsumerGroup，RabbitMQ里面的Exchange等等。抛开现象看本质，无外乎是单播与广播的区别。所谓单播，就是点到点；而广播，是一点对多点。当然，对于互联网的大部分应用来说，组间广播、组内单播是最常见的情形。&lt;/p&gt;

&lt;p&gt;消息需要通知到多个业务集群，而一个业务集群内有很多台机器，只要一台机器消费这个消息就可以了。&lt;/p&gt;

&lt;p&gt;当然这不是绝对的，很多时候组内的广播也是有适用场景的，如本地缓存的更新等等。另外，消费关系除了组内组间，可能会有多级树状关系。这种情况太过于复杂，一般不列入考虑范围。所以，一般比较通用的设计是支持组间广播，不同的组注册不同的订阅。组内的不同机器，如果注册一个相同的ID，则单播；如果注册不同的ID(如IP地址+端口)，则广播。&lt;/p&gt;

&lt;p&gt;至于广播关系的维护，一般由于消息队列本身都是集群，所以都维护在公共存储上，如config server、zookeeper等。维护广播关系所要做的事情基本是一致的:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;发送关系的维护。&lt;/li&gt;
  &lt;li&gt;发送关系变更时的通知。&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;23-队列高级特性设计&quot;&gt;2.3 队列高级特性设计&lt;/h2&gt;

&lt;p&gt;上面都是些消息队列基本功能的实现，下面来看一些关于消息队列特性相关的内容，不管可靠投递/消息丢失与重复以及事务乃至于性能，不是每个消息队列都会照顾到，所以要依照业务的需求，来仔细衡量各种特性实现的成本，利弊，最终做出最为合理的设计。&lt;/p&gt;

&lt;h3 id=&quot;231-可靠投递最终一致性&quot;&gt;2.3.1 可靠投递（最终一致性）&lt;/h3&gt;

&lt;p&gt;这是个激动人心的话题，完全不丢消息，究竟可不可能？答案是，完全可能，前提是消息可能会重复，并且，在异常情况下，要接受消息的延迟。&lt;/p&gt;

&lt;p&gt;方案说简单也简单，就是每当要发生不可靠的事情（RPC等）之前，先将消息落地，然后发送。当失败或者不知道成功失败（比如超时）时，消息状态是待发送，定时任务不停轮询所有待发送消息，最终一定可以送达。&lt;/p&gt;

&lt;p&gt;具体来说：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;producer往broker发送消息之前，需要做一次落地。&lt;/li&gt;
  &lt;li&gt;请求到server后，server确保数据落地后再告诉客户端发送成功。&lt;/li&gt;
  &lt;li&gt;支持广播的消息队列需要对每个待发送的endpoint，持久化一个发送状态，直到所有endpoint状态都OK才可删除消息。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;对于各种不确定（超时、down机、消息没有送达、送达后数据没落地、数据落地了回复没收到），其实对于发送方来说，都是一件事情，就是消息没有送达。&lt;/p&gt;

&lt;p&gt;重推消息所面临的问题就是消息重复。重复和丢失就像两个噩梦，你必须要面对一个。好在消息重复还有处理的机会，消息丢失再想找回就难了。&lt;/p&gt;

&lt;p&gt;Anyway，作为一个成熟的消息队列，应该尽量在各个环节减少重复投递的可能性，不能因为重复有解决方案就放纵的乱投递。&lt;/p&gt;

&lt;p&gt;最后说一句，不是所有的系统都要求最终一致性或者可靠投递，比如一个论坛系统、一个招聘系统。一个重复的简历或话题被发布，可能比丢失了一个发布显得更让用户无法接受。不断重复一句话，任何基础组件要服务于业务场景。&lt;/p&gt;

&lt;h4 id=&quot;2311-消费确认&quot;&gt;2.3.1.1 消费确认&lt;/h4&gt;

&lt;p&gt;当broker把消息投递给消费者后，消费者可以立即响应我收到了这个消息。但收到了这个消息只是第一步，我能不能处理这个消息却不一定。或许因为消费能力的问题，系统的负荷已经不能处理这个消息；或者是刚才状态机里面提到的消息不是我想要接收的消息，主动要求重发。&lt;/p&gt;

&lt;p&gt;把消息的送达和消息的处理分开，这样才真正的实现了消息队列的本质-解耦。所以，允许消费者主动进行消费确认是必要的。当然，对于没有特殊逻辑的消息，默认Auto Ack也是可以的，但一定要允许消费方主动ack。&lt;/p&gt;

&lt;p&gt;对于正确消费ack的，没什么特殊的。但是对于reject和error，需要特别说明。reject这件事情，往往业务方是无法感知到的，系统的流量和健康状况的评估，以及处理能力的评估是一件非常复杂的事情。举个极端的例子，收到一个消息开始build索引，可能这个消息要处理半个小时，但消息量却是非常的小。所以reject这块建议做成滑动窗口/线程池类似的模型来控制，消费能力不匹配的时候，直接拒绝，过一段时间重发，减少业务的负担。&lt;/p&gt;

&lt;p&gt;但业务出错这件事情是只有业务方自己知道的，就像上文提到的状态机等等。这时应该允许业务方主动ack error，并可以与broker约定下次投递的时间。&lt;/p&gt;

&lt;h4 id=&quot;2312-重复消息和顺序消息&quot;&gt;2.3.1.2 重复消息和顺序消息&lt;/h4&gt;

&lt;p&gt;上文谈到重复消息是不可能100%避免的，除非可以允许丢失，那么，顺序消息能否100%满足呢? 答案是可以，但条件更为苛刻：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;允许消息丢失。&lt;/li&gt;
  &lt;li&gt;从发送方到服务方到接受者都是单点单线程。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;所以绝对的顺序消息基本上是不能实现的，当然在METAQ/Kafka等pull模型的消息队列中，单线程生产/消费，排除消息丢失，也是一种顺序消息的解决方案。&lt;/p&gt;

&lt;p&gt;一般来讲，一个主流消息队列的设计范式里，应该是不丢消息的前提下，尽量减少重复消息，不保证消息的投递顺序。&lt;/p&gt;

&lt;p&gt;谈到重复消息，主要是两个话题：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;如何鉴别消息重复，并幂等的处理重复消息。&lt;/li&gt;
  &lt;li&gt;一个消息队列如何尽量减少重复消息的投递。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;先来看看第一个话题，每一个消息应该有它的唯一身份。不管是业务方自定义的，还是根据IP/PID/时间戳生成的MessageId，如果有地方记录这个MessageId，消息到来是能够进行比对就能完成重复的鉴定。数据库的唯一键/bloom filter/分布式KV中的key，都是不错的选择。由于消息不能被永久存储，所以理论上都存在消息从持久化存储移除的瞬间上游还在投递的可能（上游因种种原因投递失败，不停重试，都到了下游清理消息的时间）。这种事情都是异常情况下才会发生的，毕竟是小众情况。两分钟消息都还没送达，多送一次又能怎样呢？幂等的处理消息是一门艺术，因为种种原因重复消息或者错乱的消息还是来到了，说两种通用的解决方案：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;版本号。&lt;/li&gt;
  &lt;li&gt;状态机。&lt;/li&gt;
&lt;/ol&gt;

&lt;h5 id=&quot;版本号&quot;&gt;版本号&lt;/h5&gt;

&lt;p&gt;举个简单的例子，一个产品的状态有上线/下线状态。如果消息1是下线，消息2是上线。不巧消息1判重失败，被投递了两次，且第二次发生在2之后，如果不做重复性判断，显然最终状态是错误的。&lt;/p&gt;

&lt;p&gt;但是，如果每个消息自带一个版本号。上游发送的时候，标记消息1版本号是1，消息2版本号是2。如果再发送下线消息，则版本号标记为3。下游对于每次消息的处理，同时维护一个版本号。&lt;/p&gt;

&lt;p&gt;每次只接受比当前版本号大的消息。初始版本为0，当消息1到达时，将版本号更新为1。消息2到来时，因为版本号&amp;gt;1.可以接收，同时更新版本号为2.当另一条下线消息到来时，如果版本号是3.则是真实的下线消息。如果是1，则是重复投递的消息。&lt;/p&gt;

&lt;p&gt;如果业务方只关心消息重复不重复，那么问题就已经解决了。但很多时候另一个头疼的问题来了，就是消息顺序如果和想象的顺序不一致。比如应该的顺序是12，到来的顺序是21。则最后会发生状态错误。&lt;/p&gt;

&lt;p&gt;参考TCP/IP协议，如果想让乱序的消息最后能够正确的被组织，那么就应该只接收比当前版本号大一的消息。并且在一个session周期内要一直保存各个消息的版本号。&lt;/p&gt;

&lt;p&gt;如果到来的顺序是21，则先把2存起来，待2到来后，再处理1，这样重复性和顺序性要求就都达到了。&lt;/p&gt;

&lt;h5 id=&quot;状态机&quot;&gt;状态机&lt;/h5&gt;

&lt;p&gt;基于版本号来处理重复和顺序消息听起来是个不错的主意，但凡事总有瑕疵。使用版本号的最大问题是：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;对发送方必须要求消息带业务版本号。&lt;/li&gt;
  &lt;li&gt;下游必须存储消息的版本号，对于要严格保证顺序的。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;还不能只存储最新的版本号的消息，要把乱序到来的消息都存储起来。而且必须要对此做出处理。试想一个永不过期的”session”，比如一个物品的状态，会不停流转于上下线。那么中间环节的所有存储就必须保留，直到在某个版本号之前的版本一个不丢的到来，成本太高。&lt;/p&gt;

&lt;p&gt;就刚才的场景看，如果消息没有版本号，该怎么解决呢？业务方只需要自己维护一个状态机，定义各种状态的流转关系。例如，”下线”状态只允许接收”上线”消息，“上线”状态只能接收“下线消息”，如果上线收到上线消息，或者下线收到下线消息，在消息不丢失和上游业务正确的前提下。要么是消息发重了，要么是顺序到达反了。这时消费者只需要把“我不能处理这个消息”告诉投递者，要求投递者过一段时间重发即可。而且重发一定要有次数限制，比如5次，避免死循环，就解决了。&lt;/p&gt;

&lt;p&gt;举例子说明，假设产品本身状态是下线，1是上线消息，2是下线消息，3是上线消息，正常情况下，消息应该的到来顺序是123，但实际情况下收到的消息状态变成了3123。&lt;/p&gt;

&lt;p&gt;那么下游收到3消息的时候，判断状态机流转是下线-&amp;gt;上线，可以接收消息。然后收到消息1，发现是上线-&amp;gt;上线，拒绝接收，要求重发。然后收到消息2，状态是上线-&amp;gt;下线，于是接收这个消息。&lt;/p&gt;

&lt;p&gt;此时无论重发的消息1或者3到来，还是可以接收。另外的重发，在一定次数拒绝后停止重发，业务正确。&lt;/p&gt;

&lt;h4 id=&quot;2313-中间件对于重复消息的处理&quot;&gt;2.3.1.3 中间件对于重复消息的处理&lt;/h4&gt;

&lt;p&gt;回归到消息队列的话题来讲。上述通用的版本号/状态机/ID判重解决方案里，哪些是消息队列该做的、哪些是消息队列不该做业务方处理的呢？其实这里没有一个完全严格的定义，但回到我们的出发点，我们保证不丢失消息的情况下尽量少重复消息，消费顺序不保证。那么重复消息下和乱序消息下业务的正确，应该是由消费方保证的，我们要做的是减少消息发送的重复。&lt;/p&gt;

&lt;p&gt;我们无法定义业务方的业务版本号/状态机，如果API里强制需要指定版本号，则显得过于绑架客户了。况且，在消费方维护这么多状态，就涉及到一个消费方的消息落地/多机间的同步消费状态问题，复杂度指数级上升，而且只能解决部分问题。&lt;/p&gt;

&lt;p&gt;减少重复消息的关键步骤：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;broker记录MessageId，直到投递成功后清除，重复的ID到来不做处理，这样只要发送者在清除周期内能够感知到消息投递成功，就基本不会在server端产生重复消息。&lt;/li&gt;
  &lt;li&gt;对于server投递到consumer的消息，由于不确定对端是在处理过程中还是消息发送丢失的情况下，有必要记录下投递的IP地址。决定重发之前询问这个IP，消息处理成功了吗？如果询问无果，再重发。&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;232-事务&quot;&gt;2.3.2 事务&lt;/h3&gt;

&lt;p&gt;持久性是事务的一个特性，然而只满足持久性却不一定能满足事务的特性。还是拿扣钱/加钱的例子讲。满足事务的一致性特征，则必须要么都不进行，要么都能成功。&lt;/p&gt;

&lt;p&gt;解决方案从大方向上有两种：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;两阶段提交，分布式事务。&lt;/li&gt;
  &lt;li&gt;本地事务，本地落地，补偿发送。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;分布式事务存在的最大问题是成本太高，两阶段提交协议，对于仲裁down机或者单点故障，几乎是一个无解的黑洞。对于交易密集型或者I/O密集型的应用，没有办法承受这么高的网络延迟，系统复杂性。&lt;/p&gt;

&lt;p&gt;并且成熟的分布式事务一定构建与比较靠谱的商用DB和商用中间件上，成本也太高。&lt;/p&gt;

&lt;p&gt;那如何使用本地事务解决分布式事务的问题呢？以本地和业务在一个数据库实例中建表为例子，与扣钱的业务操作同一个事务里，将消息插入本地数据库。如果消息入库失败，则业务回滚；如果消息入库成功，事务提交。&lt;/p&gt;

&lt;p&gt;然后发送消息（注意这里可以实时发送，不需要等定时任务检出，以提高消息实时性）。以后的问题就是前文的最终一致性问题所提到的了，只要消息没有发送成功，就一直靠定时任务重试。&lt;/p&gt;

&lt;p&gt;这里有一个关键的点，本地事务做的，是业务落地和消息落地的事务，而不是业务落地和RPC成功的事务。这里很多人容易混淆，如果是后者，无疑是事务嵌套RPC，是大忌，会有长事务死锁等各种风险。&lt;/p&gt;

&lt;p&gt;而消息只要成功落地，很大程度上就没有丢失的风险（磁盘物理损坏除外）。而消息只要投递到服务端确认后本地才做删除，就完成了producer-&amp;gt;broker的可靠投递，并且当消息存储异常时，业务也是可以回滚的。&lt;/p&gt;

&lt;p&gt;本地事务存在两个最大的使用障碍：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;配置较为复杂，“绑架”业务方，必须本地数据库实例提供一个库表。&lt;/li&gt;
  &lt;li&gt;对于消息延迟高敏感的业务不适用。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;话说回来，不是每个业务都需要强事务的。扣钱和加钱需要事务保证，但下单和生成短信却不需要事务，不能因为要求发短信的消息存储投递失败而要求下单业务回滚。所以，一个完整的消息队列应该定义清楚自己可以投递的消息类型，如事务型消息，本地非持久型消息，以及服务端不落地的非可靠消息等。对不同的业务场景做不同的选择。另外事务的使用应该尽量低成本、透明化，可以依托于现有的成熟框架，如Spring的声明式事务做扩展。业务方只需要使用@Transactional标签即可。&lt;/p&gt;

&lt;h3 id=&quot;233-性能相关&quot;&gt;2.3.3 性能相关&lt;/h3&gt;

&lt;h4 id=&quot;2331-异步同步&quot;&gt;2.3.3.1 异步/同步&lt;/h4&gt;

&lt;p&gt;首先澄清一个概念，异步，同步和oneway是三件事。异步，归根结底你还是需要关心结果的，但可能不是当时的时间点关心，可以用轮询或者回调等方式处理结果；同步是需要当时关心的结果的；而oneway是发出去就不管死活的方式，这种对于某些完全对可靠性没有要求的场景还是适用的，但不是我们重点讨论的范畴。&lt;/p&gt;

&lt;p&gt;回归来看，任何的RPC都是存在客户端异步与服务端异步的，而且是可以任意组合的：客户端同步对服务端异步，客户端异步对服务端异步，客户端同步对服务端同步，客户端异步对服务端同步。&lt;/p&gt;

&lt;p&gt;对于客户端来说，同步与异步主要是拿到一个Result，还是Future(Listenable)的区别。实现方式可以是线程池，NIO或者其他事件机制，这里先不展开讲。&lt;/p&gt;

&lt;p&gt;服务端异步可能稍微难理解一点，这个是需要RPC协议支持的。参考servlet 3.0规范，服务端可以吐一个future给客户端，并且在future done的时候通知客户端。&lt;/p&gt;

&lt;p&gt;整个过程可以参考下面的代码：&lt;/p&gt;

&lt;p&gt;客户端同步服务端异步。&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;future&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// server立刻返回future&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;synchronized&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(!&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;isDone&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;())&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;n&quot;&gt;future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;wait&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// server处理结束后会notify这个future，并修改isdone标志&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;客户端同步服务端同步。&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;客户端异步服务端同步(这里用线程池的方式)。&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;future&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;executor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Callable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;call&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;});&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;客户端异步服务端异步。&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;future&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// server立刻返回future&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;future&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;上面说了这么多，其实是想让大家脱离两个误区：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;RPC只有客户端能做异步，服务端不能。&lt;/li&gt;
  &lt;li&gt;异步只能通过线程池。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;那么，服务端使用异步最大的好处是什么呢？说到底，是解放了线程和I/O。试想服务端有一堆I/O等待处理，如果每个请求都需要同步响应，每条消息都需要结果立刻返回，那么就几乎没法做I/O合并（当然接口可以设计成batch的，但可能batch发过来的仍然数量较少）。而如果用异步的方式返回给客户端future，就可以有机会进行I/O的合并，把几个批次发过来的消息一起落地（这种合并对于MySQL等允许batch insert的数据库效果尤其明显），并且彻底释放了线程。不至于说来多少请求开多少线程，能够支持的并发量直线提高。&lt;/p&gt;

&lt;p&gt;来看第二个误区，返回future的方式不一定只有线程池。换句话说，可以在线程池里面进行同步操作，也可以进行异步操作，也可以不使用线程池使用异步操作（NIO、事件）。&lt;/p&gt;

&lt;p&gt;回到消息队列的议题上，我们当然不希望消息的发送阻塞主流程（前面提到了，server端如果使用异步模型，则可能因消息合并带来一定程度上的消息延迟），所以可以先使用线程池提交一个发送请求，主流程继续往下走。&lt;/p&gt;

&lt;p&gt;但是线程池中的请求关心结果吗？Of course，必须等待服务端消息成功落地，才算是消息发送成功。所以这里的模型，准确地说事客户端半同步半异步（使用线程池不阻塞主流程，但线程池中的任务需要等待server端的返回），server端是纯异步。客户端的线程池wait在server端吐回的future上，直到server端处理完毕，才解除阻塞继续进行。&lt;/p&gt;

&lt;p&gt;总结一句，同步能够保证结果，异步能够保证效率，要合理的结合才能做到最好的效率。&lt;/p&gt;

&lt;h4 id=&quot;2332-批量&quot;&gt;2.3.3.2 批量&lt;/h4&gt;

&lt;p&gt;谈到批量就不得不提生产者消费者模型。但生产者消费者模型中最大的痛点是：消费者到底应该何时进行消费。大处着眼来看，消费动作都是事件驱动的。主要事件包括：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;攒够了一定数量。&lt;/li&gt;
  &lt;li&gt;到达了一定时间。&lt;/li&gt;
  &lt;li&gt;队列里有新的数据到来。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;对于及时性要求高的数据，可用采用方式3来完成，比如客户端向服务端投递数据。只要队列有数据，就把队列中的所有数据刷出，否则将自己挂起，等待新数据的到来。&lt;/p&gt;

&lt;p&gt;在第一次把队列数据往外刷的过程中，又积攒了一部分数据，第二次又可以形成一个批量。伪代码如下:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Executor&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;executor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Executors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;newFixedThreadPool&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BlockingQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ArrayBlockingQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;();&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Runnable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 这里由于共享队列，Runnable可以复用，故做成全局的&lt;/span&gt;
   &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;messages&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ArrayList&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;drainTo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;messages&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;，&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;doSend&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;messages&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 阻塞，在这个过程中会有新的消息到来，如果4个线程都占满，队列就有机会囤新的消息&lt;/span&gt;
   &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;offer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;executor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;这种方式是消息延迟和批量的一个比较好的平衡，但优先响应低延迟。延迟的最高程度由上一次发送的等待时间决定。但可能造成的问题是发送过快的话批量的大小不够满足性能的极致。&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-java&quot; data-lang=&quot;java&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Executor&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;executor&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Executors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;newFixedThreadPool&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;BlockingQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ArrayBlockingQueue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;();&lt;/span&gt;
&lt;span class=&quot;kd&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;last&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;currentMills&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;Executors&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;newSingleThreadScheduledExecutor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Runnable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;n&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;，&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;，&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;，&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeUnits&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;MILLS&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;task&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Runnable&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;({&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 这里由于共享队列，Runnable可以复用，顾做成全局的。&lt;/span&gt;
   &lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;messages&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ArrayList&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;drainTo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;messages&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;，&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
      &lt;span class=&quot;n&quot;&gt;doSend&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;messages&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// 阻塞，在这个过程中会有新的消息到来，如果4个线程都占满，队列就有机会屯新的消息。&lt;/span&gt;
   &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;});&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Message&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;last&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;currentMills&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;offer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;();&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kd&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;queue&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;currentMills&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;last&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;
       &lt;span class=&quot;n&quot;&gt;executor&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;submit&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;task&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;相反对于可以用适量的延迟来换取高性能的场景来说，用定时/定量二选一的方式可能会更为理想，既到达一定数量才发送，但如果数量一直达不到，也不能干等，有一个时间上限。&lt;/p&gt;

&lt;p&gt;具体说来，在上文的submit之前，多判断一个时间和数量，并且Runnable内部维护一个定时器，避免没有新任务到来时旧的任务永远没有机会触发发送条件。对于server端的数据落地，使用这种方式就非常方便。&lt;/p&gt;

&lt;p&gt;最后啰嗦几句，曾经有人问我，为什么网络请求小包合并成大包会提高性能？主要原因有两个：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;减少无谓的请求头，如果你每个请求只有几字节，而头却有几十字节，无疑效率非常低下。&lt;/li&gt;
  &lt;li&gt;减少回复的ack包个数。把请求合并后，ack包数量必然减少，确认和重发的成本就会降低。&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;24-push还是pull&quot;&gt;2.4 push还是pull&lt;/h2&gt;

&lt;p&gt;上文提到的消息队列，大多是针对push模型的设计。现在市面上有很多经典的也比较成熟的pull模型的消息队列，如Kafka、MetaQ等。这跟JMS中传统的push方式有很大的区别，可谓另辟蹊径。&lt;/p&gt;

&lt;p&gt;我们简要分析下push和pull模型各自存在的利弊。&lt;/p&gt;

&lt;h3 id=&quot;241-慢消费&quot;&gt;2.4.1 慢消费&lt;/h3&gt;

&lt;p&gt;慢消费无疑是push模型最大的致命伤，穿成流水线来看，如果消费者的速度比发送者的速度慢很多，势必造成消息在broker的堆积。假设这些消息都是有用的无法丢弃的，消息就要一直在broker端保存。当然这还不是最致命的，最致命的是broker给consumer推送一堆consumer无法处理的消息，consumer不是reject就是error，然后来回踢皮球。&lt;/p&gt;

&lt;p&gt;反观pull模式，consumer可以按需消费，不用担心自己处理不了的消息来骚扰自己，而broker堆积消息也会相对简单，无需记录每一个要发送消息的状态，只需要维护所有消息的队列和偏移量就可以了。所以对于建立索引等慢消费，消息量有限且到来的速度不均匀的情况，pull模式比较合适。&lt;/p&gt;

&lt;h3 id=&quot;242-消息延迟与忙等&quot;&gt;2.4.2 消息延迟与忙等&lt;/h3&gt;

&lt;p&gt;这是pull模式最大的短板。由于主动权在消费方，消费方无法准确地决定何时去拉取最新的消息。如果一次pull取到消息了还可以继续去pull，如果没有pull取到则需要等待一段时间重新pull。&lt;/p&gt;

&lt;p&gt;但等待多久就很难判定了。你可能会说，我可以有xx动态pull取时间调整算法，但问题的本质在于，有没有消息到来这件事情决定权不在消费方。也许1分钟内连续来了1000条消息，然后半个小时没有新消息产生，可能你的算法算出下次最有可能到来的时间点是31分钟之后，或者60分钟之后，结果下条消息10分钟后到了，是不是很让人沮丧？当然也不是说延迟就没有解决方案了，业界较成熟的做法是从短时间开始（不会对broker有太大负担），然后指数级增长等待。比如开始等5ms，然后10ms，然后20ms，然后40ms……直到有消息到来，然后再回到5ms。&lt;/p&gt;

&lt;p&gt;即使这样，依然存在延迟问题：假设40ms到80ms之间的50ms消息到来，消息就延迟了30ms，而且对于半个小时来一次的消息，这些开销就是白白浪费的。&lt;/p&gt;

&lt;p&gt;在阿里的RocketMq里，有一种优化的做法-长轮询，来平衡推拉模型各自的缺点。基本思路是:消费者如果尝试拉取失败，不是直接return,而是把连接挂在那里wait,服务端如果有新的消息到来，把连接notify起来，这也是不错的思路。但海量的长连接block对系统的开销还是不容小觑的，还是要合理的评估时间间隔，给wait加一个时间上限比较好~&lt;/p&gt;

&lt;h3 id=&quot;243-顺序消息&quot;&gt;2.4.3 顺序消息&lt;/h3&gt;

&lt;p&gt;如果push模式的消息队列，支持分区，单分区只支持一个消费者消费，并且消费者只有确认一个消息消费后才能push送另外一个消息，还要发送者保证全局顺序唯一，听起来也能做顺序消息，但成本太高了，尤其是必须每个消息消费确认后才能发下一条消息，这对于本身堆积能力和慢消费就是瓶颈的push模式的消息队列，简直是一场灾难。&lt;/p&gt;

&lt;p&gt;反观pull模式，如果想做到全局顺序消息，就相对容易很多：&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;producer对应partition，并且单线程。&lt;/li&gt;
  &lt;li&gt;consumer对应partition，消费确认（或批量确认），继续消费即可。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;所以对于日志push送这种最好全局有序，但允许出现小误差的场景，pull模式非常合适。如果你不想看到通篇乱套的日志~~Anyway，需要顺序消息的场景还是比较有限的而且成本太高，请慎重考虑。&lt;/p&gt;

&lt;h1 id=&quot;3-总结&quot;&gt;3. 总结&lt;/h1&gt;

&lt;p&gt;本文从为何使用消息队列开始讲起，然后主要介绍了如何从零开始设计一个消息队列，包括RPC、事务、最终一致性、广播、消息确认等关键问题。并对消息队列的push、pull模型做了简要分析，最后从批量和异步角度，分析了消息队列性能优化的思路。下篇会着重介绍一些高级话题，如存储系统的设计、流控和错峰的设计、公平调度等。希望通过这些，让大家对消息队列有个提纲挈领的整体认识，并给自主开发消息队列提供思路。另外，本文主要是源自自己在开发消息队列中的思考和读源码时的体会，比较不”官方”，也难免会存在一些漏洞，欢迎大家多多交流。&lt;/p&gt;

&lt;p&gt;后续我们还会推出消息队列设计高级篇，内容会涵盖以下方面：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;pull模型消息系统设计理念&lt;/li&gt;
  &lt;li&gt;存储子系统设计&lt;/li&gt;
  &lt;li&gt;流量控制&lt;/li&gt;
  &lt;li&gt;公平调度&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;敬请期待哦~&lt;/p&gt;

&lt;h2 id=&quot;作者简介&quot;&gt;作者简介&lt;/h2&gt;

&lt;p&gt;王烨，现在是美团旅游后台研发组的程序猿，之前曾经在百度、去哪和优酷工作过，专注Java后台开发。对于网络编程和并发编程具有浓厚的兴趣，曾经做过一些基础组件，也翻过一些源码，属于比较典型的宅男技术控。期待能够与更多知己，在coding的路上并肩前行~&lt;/p&gt;
</description>
				<pubDate>Fri, 26 Apr 2019 10:01:22 +0800</pubDate>
				<link>https://xenojoshua.com/2019/04/message-queue-design/</link>
				<guid isPermaLink="true">https://xenojoshua.com/2019/04/message-queue-design/</guid>
			</item>
		
			<item>
				<title>Elasticsearch Notes</title>
				<description>&lt;h4&gt;Table of Contents&lt;/h4&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#1-前言&quot; id=&quot;markdown-toc-1-前言&quot;&gt;1. 前言&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2-log-shipper&quot; id=&quot;markdown-toc-2-log-shipper&quot;&gt;2. Log Shipper&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#21-横向比较--选择&quot; id=&quot;markdown-toc-21-横向比较--选择&quot;&gt;2.1 横向比较 &amp;amp; 选择&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#22-架构设计&quot; id=&quot;markdown-toc-22-架构设计&quot;&gt;2.2 架构设计&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#3-filebeat&quot; id=&quot;markdown-toc-3-filebeat&quot;&gt;3. Filebeat&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#31-设计--基础概念&quot; id=&quot;markdown-toc-31-设计--基础概念&quot;&gt;3.1 设计 &amp;amp; 基础概念&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#32-使用&quot; id=&quot;markdown-toc-32-使用&quot;&gt;3.2 使用&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#33-模块&quot; id=&quot;markdown-toc-33-模块&quot;&gt;3.3 模块&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#34-过滤和丰富&quot; id=&quot;markdown-toc-34-过滤和丰富&quot;&gt;3.4 过滤和丰富&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#35-文件状态记录--投递保证&quot; id=&quot;markdown-toc-35-文件状态记录--投递保证&quot;&gt;3.5 文件状态记录 &amp;amp; 投递保证&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#4-elasticsearch&quot; id=&quot;markdown-toc-4-elasticsearch&quot;&gt;4. Elasticsearch&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#41-知识点&quot; id=&quot;markdown-toc-41-知识点&quot;&gt;4.1 知识点&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#411-基础概念&quot; id=&quot;markdown-toc-411-基础概念&quot;&gt;4.1.1 基础概念&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#412-安装--配置&quot; id=&quot;markdown-toc-412-安装--配置&quot;&gt;4.1.2 安装 &amp;amp; 配置&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#413-api&quot; id=&quot;markdown-toc-413-api&quot;&gt;4.1.3 API&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#414-query-dsl&quot; id=&quot;markdown-toc-414-query-dsl&quot;&gt;4.1.4 Query DSL&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#415-sql&quot; id=&quot;markdown-toc-415-sql&quot;&gt;4.1.5 SQL&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#416-ingest节点&quot; id=&quot;markdown-toc-416-ingest节点&quot;&gt;4.1.6 Ingest节点&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ID_INDEX&quot; id=&quot;markdown-toc-ID_INDEX&quot;&gt;4.2 文档数据库 &amp;amp; 索引&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#421-index-template&quot; id=&quot;markdown-toc-421-index-template&quot;&gt;4.2.1 Index Template&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#422-设置index生命周期&quot; id=&quot;markdown-toc-422-设置index生命周期&quot;&gt;4.2.2 设置index生命周期&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#423-index的自动创建设置&quot; id=&quot;markdown-toc-423-index的自动创建设置&quot;&gt;4.2.3 Index的自动创建设置&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ID_STORAGE&quot; id=&quot;markdown-toc-ID_STORAGE&quot;&gt;4.3 存储&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ID_ARC_CLUSTER&quot; id=&quot;markdown-toc-ID_ARC_CLUSTER&quot;&gt;4.4 集群&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#45-监控--高可用&quot; id=&quot;markdown-toc-45-监控--高可用&quot;&gt;4.5 监控 &amp;amp; 高可用&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#451-监控&quot; id=&quot;markdown-toc-451-监控&quot;&gt;4.5.1 监控&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#452-高可用&quot; id=&quot;markdown-toc-452-高可用&quot;&gt;4.5.2 高可用&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#46-性能调优&quot; id=&quot;markdown-toc-46-性能调优&quot;&gt;4.6 性能调优&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#5-kibana&quot; id=&quot;markdown-toc-5-kibana&quot;&gt;5. Kibana&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#ID_INDEX_PATTERN&quot; id=&quot;markdown-toc-ID_INDEX_PATTERN&quot;&gt;5.1 Index Pattern&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#52-使用简介&quot; id=&quot;markdown-toc-52-使用简介&quot;&gt;5.2 使用简介&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#53-qa&quot; id=&quot;markdown-toc-53-qa&quot;&gt;5.3 Q&amp;amp;A&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#6-filebeat直连elasticsearch实践&quot; id=&quot;markdown-toc-6-filebeat直连elasticsearch实践&quot;&gt;6. Filebeat直连Elasticsearch实践&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#61-直连流程&quot; id=&quot;markdown-toc-61-直连流程&quot;&gt;6.1 直连流程&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#62-应用场景&quot; id=&quot;markdown-toc-62-应用场景&quot;&gt;6.2 应用场景&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ID_INDEX_TEMPLATE&quot; id=&quot;markdown-toc-ID_INDEX_TEMPLATE&quot;&gt;6.3 Index Template&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#64-issues&quot; id=&quot;markdown-toc-64-issues&quot;&gt;6.4 Issues&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#641-filebeat字段层级&quot; id=&quot;markdown-toc-641-filebeat字段层级&quot;&gt;6.4.1 Filebeat字段层级&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#642-kibana-message字段&quot; id=&quot;markdown-toc-642-kibana-message字段&quot;&gt;6.4.2 Kibana message字段&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#643-input--processors-fields&quot; id=&quot;markdown-toc-643-input--processors-fields&quot;&gt;6.4.3 input | processors fields&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#ID_FILEBEAT_INDEX_TEMPLATE&quot; id=&quot;markdown-toc-ID_FILEBEAT_INDEX_TEMPLATE&quot;&gt;6.4.4 Index Template设置&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#645-切片数量&quot; id=&quot;markdown-toc-645-切片数量&quot;&gt;6.4.5 切片数量&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#646-kibana-timestamp&quot; id=&quot;markdown-toc-646-kibana-timestamp&quot;&gt;6.4.6 Kibana @timestamp&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#647-elasticsearch-预创建数据&quot; id=&quot;markdown-toc-647-elasticsearch-预创建数据&quot;&gt;6.4.7 Elasticsearch 预创建数据&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#7-实践范例&quot; id=&quot;markdown-toc-7-实践范例&quot;&gt;7. 实践范例&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#8-docker集群部署&quot; id=&quot;markdown-toc-8-docker集群部署&quot;&gt;8. Docker集群部署&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#ID_ES_CONFIG&quot; id=&quot;markdown-toc-ID_ES_CONFIG&quot;&gt;8.1 Elasticsearch配置&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#811-环境变量配置&quot; id=&quot;markdown-toc-811-环境变量配置&quot;&gt;8.1.1 环境变量配置&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#812-多节点配置的共享&quot; id=&quot;markdown-toc-812-多节点配置的共享&quot;&gt;8.1.2 多节点配置的共享&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#813-集群发现相关配置&quot; id=&quot;markdown-toc-813-集群发现相关配置&quot;&gt;8.1.3 集群发现相关配置&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#82-kibana配置&quot; id=&quot;markdown-toc-82-kibana配置&quot;&gt;8.2 Kibana配置&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#83-filebeat配置&quot; id=&quot;markdown-toc-83-filebeat配置&quot;&gt;8.3 Filebeat配置&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#9-todo&quot; id=&quot;markdown-toc-9-todo&quot;&gt;9. TODO&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#资料&quot; id=&quot;markdown-toc-资料&quot;&gt;资料&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#链接&quot; id=&quot;markdown-toc-链接&quot;&gt;链接&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;1-前言&quot;&gt;1. 前言&lt;/h1&gt;
&lt;p&gt;之前做了Prometheus和Jaeger相关的调研工作，这两者虽然也涉及到日志聚合相关的技术或是类似的技术，但毕竟不是通用的日志聚合系统。通用的日志聚合系统需要能接受任何类型的日志，并将其索引入库以备后续的查询。市面上这方面的产品现在基本上是Elasticsearch为主要选择，已经可以说是很成熟了。所以这块需求我这里也是以ELK为第一备选进行相关的调研。&lt;/p&gt;

&lt;p&gt;后续的调研内容版本如下：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;elasticsearch 7.0.0
elastic/filebeat 7.0.0
kibana 7.0.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;在提到Elasticsearch的时候我们一般不会只说Elasticsearch本身，而是会提到&lt;code&gt;ELK&lt;/code&gt;这个词，这里说的其实就是从日志采集、清洗、转换、分发、到最后入库的整个流程，以及查询用的面板包含在内的一整套生态。因此下面行文会从：日志采集、日志存储、日志查询三方面着手。&lt;/p&gt;

&lt;p&gt;官方文档：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/index.html&quot; target=&quot;_blank&quot;&gt;Elastic Stack and Product Documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/index.html&quot; target=&quot;_blank&quot;&gt;Elasticsearch Reference&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/index.html&quot; target=&quot;_blank&quot;&gt;Filebeat Reference&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/index.html&quot; target=&quot;_blank&quot;&gt;Kibana User Guide&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;2-log-shipper&quot;&gt;2. Log Shipper&lt;/h1&gt;
&lt;p&gt;日志是在各个应用程序中生产的，此外也包括了操作系统级别的日志生产。因此日志的产生这个行为是分散在各个节点上的，日志的收集就是从分散的节点采集数据汇集到中心存储的一个过程，这也是所谓的&lt;code&gt;聚合&lt;/code&gt;。而从分散的节点上采集数据，我们需要Agent（Log Shipper）来执行这个操作。&lt;/p&gt;

&lt;p&gt;经典的&lt;code&gt;ELK&lt;/code&gt;中，&lt;code&gt;L&lt;/code&gt;代表的就是日志采集Agent：Logstash。当然，市面上也有非常多的其他选择，可以做到和Logstash类似的功能。从系统设计上来说，ELK三者本身是完全解耦分离的，所以所谓的ELK堆栈，只是一种经过验证的实践方案，其实中间除了E之外，L和K都是可以自由更换的。&lt;/p&gt;

&lt;h2 id=&quot;21-横向比较--选择&quot;&gt;2.1 横向比较 &amp;amp; 选择&lt;/h2&gt;
&lt;p&gt;关于日志采集组件的备选有大量横向比较，推荐阅读：&lt;a href=&quot;https://sematext.com/blog/logstash-alternatives/&quot; target=&quot;_blank&quot;&gt;5 Logstash Alternatives&lt;/a&gt;。这篇的时间还算比较新&lt;code&gt;2018-10-09&lt;/code&gt;，讲解也非常到位，基本上看这篇就OK了。&lt;/p&gt;

&lt;p&gt;此外，&lt;a href=&quot;https://gist.github.com/StevenACoffman/4e267f0f60c8e7fcb3f77b9e504f3bd7&quot; target=&quot;_blank&quot;&gt;StevenACoffman/fluent-filebeat-comparison.md&lt;/a&gt;也可以看下。&lt;/p&gt;

&lt;p&gt;排除比较年轻的项目，以及资历不太雄厚的项目，剩下的主要选项有三个：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Logstash
    &lt;ul&gt;
      &lt;li&gt;优势：功能强大；经过实践检验&lt;/li&gt;
      &lt;li&gt;劣势：资源占用过大；JVM&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Filebeat
    &lt;ul&gt;
      &lt;li&gt;优势：Go语言；部署简单；资源占用极小&lt;/li&gt;
      &lt;li&gt;劣势：功能相对简单&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Fluentd
    &lt;ul&gt;
      &lt;li&gt;优势：CNCF孵化项目&lt;/li&gt;
      &lt;li&gt;劣势：Ruby语言实现&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Log Shipper作为每个应用程序都需要附加的边车组件其中之一，Logstash的内存和CPU消耗在某些情况下是完全不能接受的（1GB内存，开玩笑）。JVM众所周知是比较难搞的虚拟机，如果要用好，调优需要有非常专门的知识，所以算是一个减分项。但放在Elasticsearch堆栈上来说，倒也不是那么严重，因为你无论如何都需要JVM知识来调优Elasticsearch本身。功能强大是Logstash的最大优势，能满足基本上所有的应用场景，在某些架构上，即便使用了Filebeat等高效轻量级的Log Shipper，在进入Elasticsearch入库之前仍旧需要一个Logstash来进行转换等工作。&lt;/p&gt;

&lt;p&gt;Filebeat基本上没有缺点，如果它的功能能满足你的需求的话。如果不能满足，那么最新的Kafka输出能解决你的问题。使用Filebeat作为边车的Log Shipper，输出到Kafka，然后使用Logstash或者自己编写的组件来消费Kafka里的日志，最终入库到Elasticsearch。&lt;/p&gt;

&lt;p&gt;Fluentd的最大优势在于CNCF的加持（背书）。但基于我多年的编程经验，ruby的性能一般来说是不可靠的，甚至使用JVM的Logstash都已经为性能付出了过大的代价，我又有什么理由要去相信口碑一直不怎么样的ruby呢。Logstash至少使用的JVM还和Elasticsearch本身是一个技术栈的，Fluentd会引入一个完全新的ruby虚拟机，就更加增加系统复杂度了。甚至，我在调研的初期就随手找到了：&lt;a href=&quot;https://github.com/fluent/fluentd/issues/1657&quot; target=&quot;_blank&quot;&gt;Fluentd retains excessive amounts of memory after handling traffic peaks #1657&lt;/a&gt;，&lt;code&gt;2017年&lt;/code&gt;的BUG，到现在还是&lt;code&gt;Open状态&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;综上所述，任何情况下都应该使用Filebeat作为边车的Log Shipper。Filebeat能满足需求的直接入库到Elasticsearch，不能满足需求的日志进Kafka，然后使用Logstash或其他Consumer来进行转换，最终入库到Elasticsearch。&lt;/p&gt;

&lt;h2 id=&quot;22-架构设计&quot;&gt;2.2 架构设计&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;/resources/2019/04/elasticsearch-note/log_shipper_arc.jpg&quot; alt=&quot;Architecture&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;图中的Logstash部分可以替换成自编写的轻量级Consumer。&lt;/p&gt;

&lt;h1 id=&quot;3-filebeat&quot;&gt;3. Filebeat&lt;/h1&gt;
&lt;p&gt;非常细节的使用及配置，可以查看这篇中文的博客：&lt;a href=&quot;https://www.cnblogs.com/cjsblog/p/9495024.html&quot; target=&quot;_blank&quot;&gt;Filebeat 模块与配置&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;31-设计--基础概念&quot;&gt;3.1 设计 &amp;amp; 基础概念&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;/resources/2019/04/elasticsearch-note/filebeat.png&quot; alt=&quot;Architecture&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;这张图看看就好，意义不大。&lt;/p&gt;

&lt;p&gt;Filebeat是一种&lt;a href=&quot;https://www.elastic.co/cn/products/beats&quot; target=&quot;_blank&quot;&gt;Elastic Beat&lt;/a&gt;，其实现基于&lt;code&gt;libbeat&lt;/code&gt;框架，更多的可以查看：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/libbeat/7.0/index.html&quot; target=&quot;_blank&quot;&gt;Beats Platform Reference&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;工作流：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;输入：从指定的文件进行监控日志增加行为，并触发读取发送&lt;/li&gt;
  &lt;li&gt;输出：可直接向Elasticsearch集群发送日志，也可以将日志输出到外部的消息队列（Kafka）里&lt;/li&gt;
  &lt;li&gt;模块：对某些日志进行的采集行为及Elasticsearch集群对这些日志进行分析的配置化和固化&lt;/li&gt;
  &lt;li&gt;消费：Elasticsearch集群解析日志入库，或从Kafka读取日志然后解析入库&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;32-使用&quot;&gt;3.2 使用&lt;/h2&gt;
&lt;p&gt;部分说明文档：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;安装请参照：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/filebeat-installation.html#filebeat-installation&quot; target=&quot;_blank&quot;&gt;Step 1: Install Filebeat&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;配置请参照：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/filebeat-configuration.html#filebeat-configuration&quot; target=&quot;_blank&quot;&gt;Step 2: Configure Filebeat&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;容器内运行：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/running-on-docker.html#running-on-docker&quot; target=&quot;_blank&quot;&gt;Running Filebeat on Docker&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;33-模块&quot;&gt;3.3 模块&lt;/h2&gt;
&lt;p&gt;官方文档：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/filebeat-modules-overview.html&quot; target=&quot;_blank&quot;&gt;Modules overview&lt;/a&gt;。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Elasticsearch Ingest Node pipeline definition, which is used to parse the log lines.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;首先明确一点，Filebeat的模块并不是一般意义上的&lt;code&gt;功能模块&lt;/code&gt;。按软件设计思维来说，模块意味着功能的拓展，意味着根据模块设计的要求（框架）可以将软件本身能做的事情大幅拓展。而Filebeat的模块则不是，在Filebeat里，模块意味着一系列既有行为的组合：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Nginx有两个日志：access和error&lt;/li&gt;
  &lt;li&gt;Nginx在Elasticsearch上处理的Ingest Pipeline是XXX&lt;/li&gt;
  &lt;li&gt;Nginx的日志格式是XXX，Elasticsearch里对应的字段是XXX&lt;/li&gt;
  &lt;li&gt;Nginx日志对应的Kibana面板有XXX，可以看到XXX数据&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;从上面的例子可见：Filebeat本身并没有做什么，它做的仍旧只是采集日志，发送出去，没了。只不过指定了Elasticsearch集群中处理这个日志的Ingest Pipeline是谁，日志应该怎么入库（事情是在Elasticsearch集群上完成的）。因此在功能性上Filebeat是&lt;code&gt;不可能替代&lt;/code&gt;Logstash的，它的定位只是轻量级的应用端Log Shipper，如果要在功能上覆盖Logstash的功能点，就需要使用Elasticsearch自身的Ingest Pipeline，仍旧需要Filebeat以外的系统支持。&lt;/p&gt;

&lt;p&gt;部分文档：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;如何创建一个新的模块：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/devguide/7.0/filebeat-modules-devguide.html#filebeat-modules-devguide&quot; target=&quot;_blank&quot;&gt;Creating a New Filebeat Module&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;模块清单：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/filebeat-modules.html#filebeat-modules&quot; target=&quot;_blank&quot;&gt;Modules&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;命令行列出模块：&lt;/li&gt;
&lt;/ul&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ docker run --rm &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --name filebeat &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    elastic/filebeat:7.0.0 modules list&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;34-过滤和丰富&quot;&gt;3.4 过滤和丰富&lt;/h2&gt;
&lt;p&gt;Filebeat可以在配置中指定一些受限的过滤和清洗功能：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/filtering-and-enhancing-data.html&quot; target=&quot;_blank&quot;&gt;Filter and enhance the exported data&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;可选的processor清单有：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/defining-processors.html#processors&quot; target=&quot;_blank&quot;&gt;Define processors&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;触发的条件：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/defining-processors.html#conditions&quot; target=&quot;_blank&quot;&gt;Conditions&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;35-文件状态记录--投递保证&quot;&gt;3.5 文件状态记录 &amp;amp; 投递保证&lt;/h2&gt;
&lt;p&gt;Filebeat对于输入的日志文件，会制作一个本地的注册文件，将状态都保存下来，因此在重启或者挂掉重新拉起来之后，Filebeat总是能知道之前发送到哪里。&lt;/p&gt;

&lt;p&gt;Filebeat会保证本地的日志文件至少被输出一次，如果在输出的结果返回之前Filebeat就挂掉的话，在下次Filebeat启动之后，它还会将之前最后的日志再投递一次（对于Filebeat来说，它并不知道自己死前已经投递过一次，并被输出方接收到了）。因此，收取数据的服务端&lt;code&gt;可能&lt;/code&gt;在某些情况下收到&lt;code&gt;重复的数据&lt;/code&gt;。&lt;/p&gt;

&lt;h1 id=&quot;4-elasticsearch&quot;&gt;4. Elasticsearch&lt;/h1&gt;
&lt;p&gt;2套电子书非常不错：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://fdv.github.io/running-elasticsearch-fun-profit/&quot; target=&quot;_blank&quot;&gt;Operating Elasticsearch for Fun and Profit&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://es.xiaoleilu.com/index.html&quot; target=&quot;_blank&quot;&gt;Elasticsearch 权威指南（中文版）&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;对于作为Elasticsearch底层的Lucene有兴趣的，可以查看这篇：&lt;a href=&quot;https://www.infoq.cn/article/ejEG02VRoeGVaLw4j_LL&quot; target=&quot;_blank&quot;&gt;Lucene 查询原理及解析&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;41-知识点&quot;&gt;4.1 知识点&lt;/h2&gt;
&lt;p&gt;这一节基本上都是简单的知识点和概念罗列，主要阐明：”这是什么”。详细的内容会在后续的章节里分析。&lt;/p&gt;

&lt;h3 id=&quot;411-基础概念&quot;&gt;4.1.1 基础概念&lt;/h3&gt;
&lt;p&gt;官方文档：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/getting-started-concepts.html#getting-started-concepts&quot; target=&quot;_blank&quot;&gt;Basic Concepts&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;提到了几点：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Near Realtime (NRT)&lt;/li&gt;
  &lt;li&gt;Cluster&lt;/li&gt;
  &lt;li&gt;Node&lt;/li&gt;
  &lt;li&gt;Index&lt;/li&gt;
  &lt;li&gt;Document&lt;/li&gt;
  &lt;li&gt;Shards &amp;amp; Replicas&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;412-安装--配置&quot;&gt;4.1.2 安装 &amp;amp; 配置&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/docker.html#docker&quot; target=&quot;_blank&quot;&gt;Install Elasticsearch with Docker&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/settings.html#settings&quot; target=&quot;_blank&quot;&gt;Configuring Elasticsearch&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/jvm-options.html#jvm-options&quot; target=&quot;_blank&quot;&gt;Setting JVM options&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/important-settings.html#important-settings&quot; target=&quot;_blank&quot;&gt;Important Elasticsearch configuration&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/system-config.html#system-config&quot; target=&quot;_blank&quot;&gt;Important System Configuration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;后面三条对生产环境影响比较大，需要仔细阅读。更贴近实践的范例可以参见：&lt;a href=&quot;#ID_ES_CONFIG&quot;&gt;8.1 Elasticsearch配置&lt;/a&gt;。&lt;/p&gt;

&lt;h3 id=&quot;413-api&quot;&gt;4.1.3 API&lt;/h3&gt;
&lt;p&gt;Elasticsearch的API文档相当散，主要是以下几项：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/docs.html&quot; target=&quot;_blank&quot;&gt;Document APIs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/search.html&quot; target=&quot;_blank&quot;&gt;Search APIs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/search-aggregations.html&quot; target=&quot;_blank&quot;&gt;Aggregations&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/indices.html&quot; target=&quot;_blank&quot;&gt;Indices APIs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/cat.html&quot; target=&quot;_blank&quot;&gt;cat APIs&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/cluster.html&quot; target=&quot;_blank&quot;&gt;Cluster APIs&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;API最常见的用途是对Elasticsearch集群进行观察，并进行一些例如Index Template设置之类的，超乎于日常日志输入相关业务之外的管理和控制。&lt;/p&gt;

&lt;h3 id=&quot;414-query-dsl&quot;&gt;4.1.4 Query DSL&lt;/h3&gt;
&lt;p&gt;官方文档：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/query-dsl.html&quot; target=&quot;_blank&quot;&gt;Query DSL&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;了解Elasticsearch的人肯定会问：Query DSL和Elasticsearch的基础Lucene之间是什么关系。关于这个知识点可以查看：&lt;a href=&quot;https://stackoverflow.com/questions/27793721/what-is-the-difference-between-lucene-and-elasticsearch&quot; target=&quot;_blank&quot;&gt;What is the difference between Lucene and Elasticsearch&lt;/a&gt;。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Elasticsearch is a JSON Based, Distributed, web server build over Lucene. Though it’s Lucene who is doing the actual work beneath, Elasticsearch provides us a convenient layer over Lucene. Each shard that gets created in Elasticsearch is a separate Lucene instance.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Lucene是底层，Elasticsearch是基于Lucene之上的超集开发，而QueryDSL则是用户和Elasticsearch之间交互的桥梁。&lt;/p&gt;

&lt;h3 id=&quot;415-sql&quot;&gt;4.1.5 SQL&lt;/h3&gt;
&lt;p&gt;Elasticsearch还可以使用SQL进行查询：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/xpack-sql.html&quot; target=&quot;_blank&quot;&gt;SQL access&lt;/a&gt;。&lt;/p&gt;

&lt;h3 id=&quot;416-ingest节点&quot;&gt;4.1.6 Ingest节点&lt;/h3&gt;
&lt;p&gt;在整个&lt;a href=&quot;#ID_ARC_CLUSTER&quot;&gt;Elasticsearch集群&lt;/a&gt;中，有一部分节点是用来进行日志过滤、清洗、丰富化的，这些工作在这个设计出现之前是只能在Agent上实现的，一般来说就是Logstash，而现在在服务器节点上也可以处理相对应的工作了。&lt;/p&gt;

&lt;p&gt;官方文档：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/ingest.html#ingest&quot; target=&quot;_blank&quot;&gt;Ingest Node&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;通过定义Processors来进行日志的解析和处理：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/ingest-processors.html#ingest-processors&quot; target=&quot;_blank&quot;&gt;Processors&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;初步了解下来功能应该还算强大，可以使用脚本化代码进行功能拓展：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/script-processor.html#script-processor&quot; target=&quot;_blank&quot;&gt;Script Processor&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/modules-scripting-using.html#modules-scripting-using&quot; target=&quot;_blank&quot;&gt;How to use scripts&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;此外还有插件机制：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/plugins/7.0/ingest.html#ingest&quot; target=&quot;_blank&quot;&gt;Ingest Plugins&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;ID_INDEX&quot;&gt;4.2 文档数据库 &amp;amp; 索引&lt;/h2&gt;
&lt;p&gt;Elasticsearch是一个文档数据库，从本质上来看，它和Mongo其实相当类似。和传统RDBMS比较起来：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Relational DB -&amp;gt; Databases -&amp;gt; Tables  -&amp;gt; Rows      -&amp;gt; Columns
Elasticsearch -&amp;gt; Cluster   -&amp;gt; Indices -&amp;gt; Documents -&amp;gt; Fields
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;简单理解：所谓的索引就是&lt;code&gt;表名&lt;/code&gt;，用来定位查询以及根据该名字进行分片sharding。&lt;/p&gt;

&lt;p&gt;举个例子：
PUT /employee/1&lt;/p&gt;

&lt;p&gt;Index：&lt;code&gt;employee&lt;/code&gt;  &lt;br /&gt;
Document：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;first_name&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;John&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;last_name&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;  &lt;span class=&quot;s2&quot;&gt;&amp;quot;Smith&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;age&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;        &lt;span class=&quot;mi&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;about&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;      &lt;span class=&quot;s2&quot;&gt;&amp;quot;I love to go rock climbing&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;interests&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;sports&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;music&amp;quot;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Fields：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;first_name&lt;/li&gt;
  &lt;li&gt;last_name&lt;/li&gt;
  &lt;li&gt;age&lt;/li&gt;
  &lt;li&gt;about&lt;/li&gt;
  &lt;li&gt;interests&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;索引非常重要，在集群模式（cluster）中，索引是用来进行分区的唯一指标。Elasticsearch会根据Index来决定当前数据落到哪台实际的存储服务器上。&lt;/p&gt;

&lt;p&gt;此外，需要注意，Index可以被Reindex，但不可以Reshard。换句话说，在Index被创建出来的时候，其shards数量就已经被固定下来了，以后不可更改。如果有这样的需求的话，必须使用Reindex来重新分配并平衡Index，已经创建出来的就没办法了。而Replicas则可以随时更改数量。&lt;/p&gt;

&lt;p&gt;关于索引的细节，以及一些集群相关的索引知识，可以查看：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/docs-index_.html&quot; target=&quot;_blank&quot;&gt;Index API&lt;/a&gt;。&lt;/p&gt;

&lt;h3 id=&quot;421-index-template&quot;&gt;4.2.1 Index Template&lt;/h3&gt;
&lt;p&gt;和索引（&lt;code&gt;Index&lt;/code&gt;）息息相关的有一个概念叫：&lt;code&gt;Index Template&lt;/code&gt;。这部分比较重要也稍微有点复杂，后面会结合实际实践一并解释，会更容易理解：&lt;a href=&quot;#ID_INDEX_TEMPLATE&quot;&gt;6.3 Index Template&lt;/a&gt;。&lt;/p&gt;

&lt;h3 id=&quot;422-设置index生命周期&quot;&gt;4.2.2 设置index生命周期&lt;/h3&gt;
&lt;p&gt;一般实践的时候，建议不要向单个Index内放入过多的文档，这会对写入和查询都造成比较大的压力。比较常见的做法是对输出端进行设置，将日志的输出索引设置成按日划分：&lt;code&gt;index: &quot;dist-%{[fields.app]}-%{[fields.module]}-%{[agent.version]}-%{+yyyy.MM.dd}&quot;&lt;/code&gt;，这样就有一个最基本的保障。但这样做的缺陷一样非常明显，当单日的业务量上涨之后，单日的日志量可能就比较夸张。&lt;/p&gt;

&lt;p&gt;在Elasticsearch中，Index的生命周期有另外的管理方法：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/getting-started-index-lifecycle-management.html#getting-started-index-lifecycle-management&quot; target=&quot;_blank&quot;&gt;Getting started with index lifecycle management&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;同时需要在Filebeat端进行配合：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/ilm.html&quot; target=&quot;_blank&quot;&gt;Configure index lifecycle management&lt;/a&gt;。&lt;/p&gt;

&lt;h3 id=&quot;423-index的自动创建设置&quot;&gt;4.2.3 Index的自动创建设置&lt;/h3&gt;
&lt;p&gt;在大部分情况下Elasticsearch都是允许自动创建Index的。在某些情况下可能需要关闭自动创建的允许权限，可以参见文档：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/docs-index_.html#index-creation&quot; target=&quot;_blank&quot;&gt;Automatic Index Creation&lt;/a&gt;，来查看如何操作。&lt;/p&gt;

&lt;h2 id=&quot;ID_STORAGE&quot;&gt;4.3 存储&lt;/h2&gt;
&lt;p&gt;在官方手册文档中，并没有关于存储相关的设计及实现的详细内容。在Blog中找到一篇：&lt;a href=&quot;https://www.elastic.co/blog/found-dive-into-elasticsearch-storage&quot; target=&quot;_blank&quot;&gt;A Dive into the Elasticsearch Storage&lt;/a&gt;，不过时间也稍微有点久，但还算可以用来一窥存储相关的技术点。&lt;/p&gt;

&lt;p&gt;此外，&lt;strong&gt;shards：Lucene segments&lt;/strong&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Each Elasticsearch index is divided into shards. Shards are both logical and physical division of an index. Each Elasticsearch shard is a Lucene index. The maximum number of documents you can have in a Lucene index is 2,147,483,519. The Lucene index is divided into smaller files called segments. A segment is a small Lucene index. Lucene searches in all segments sequentially.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/elasticsearch-note/elk_shards.png&quot; alt=&quot;elk_shards&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;ID_ARC_CLUSTER&quot;&gt;4.4 集群&lt;/h2&gt;
&lt;p&gt;关于架构和集群的基础概念可以阅读官方的一份PPT：&lt;a href=&quot;https://www.elastic.co/pdf/architecture-best-practices.pdf&quot; target=&quot;_blank&quot;&gt;Elasticsearch Best Practice Architecture&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;主要是了解下Elasticsearch集群的节点分类：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/elasticsearch-note/elk_node_types.png&quot; alt=&quot;elk_node_types&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;然后看下之前提到过的ELK整体集群拓扑：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/elasticsearch-note/elk_arch.png&quot; alt=&quot;elk_arch&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;此外推荐一篇：&lt;a href=&quot;https://thoughts.t37.net/designing-the-perfect-elasticsearch-cluster-the-almost-definitive-guide-e614eabc1a87&quot; target=&quot;_blank&quot;&gt;Designing the Perfect Elasticsearch Cluster: the (almost) Definitive Guide&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;在官方的文档库中我并没有找到比较新版本的文档有讲解到分布式和高可用之类的架构设计内容，大部分的文档都是各种API和各种细节。在老的版本中倒是找到一点信息：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/guide/current/_how_primary_and_replica_shards_interact.html&quot; target=&quot;_blank&quot;&gt;How Primary and Replica Shards Interact&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/guide/current/distrib-write.html&quot; target=&quot;_blank&quot;&gt;Creating, Indexing, and Deleting a Document&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;此外，中文书里的内容也可以阅读：&lt;a href=&quot;https://es.xiaoleilu.com/020_Distributed_Cluster/00_Intro.html&quot; target=&quot;_blank&quot;&gt;集群内部工作方式&lt;/a&gt;，注意这本中文书的版本已经相当老了，里面的内容有部分和现在的版本明显不同。&lt;/p&gt;

&lt;p&gt;几点整理：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;replica与数据主节点并不一定是1：1的关系（并不一定一个master拖一个slave这样的设计），这个replica节点数量是可设置的，一个主节点可能有多份完全一致的replica&lt;/li&gt;
  &lt;li&gt;当你的replica设置越多，写入速度就越慢（参与的节点多），主节点写入完毕之后还要让所有的replica写入，全部都完成才会返回客户端完成&lt;/li&gt;
  &lt;li&gt;当你的replica设置越多，查询（读取）速度就越快（参与的节点多）&lt;/li&gt;
  &lt;li&gt;当发生查询请求时，查询请求是会落到所有的shard上的，所以集群shards做的越多，整个集群的查询性能开销就越大，这里就有一个平衡的问题&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;45-监控--高可用&quot;&gt;4.5 监控 &amp;amp; 高可用&lt;/h2&gt;
&lt;h3 id=&quot;451-监控&quot;&gt;4.5.1 监控&lt;/h3&gt;
&lt;p&gt;对于Elasticsearch的监控，官方有一套解决方案（Elasticsearch算是一个生态了，在上游和下游都有完整的处理）。可以查阅下官方文档：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/es-monitoring.html&quot; target=&quot;_blank&quot;&gt;Monitoring Elasticsearch&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/setup-xpack.html#setup-xpack&quot; target=&quot;_blank&quot;&gt;Set up X-Pack&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/getting-started-cluster-health.html#getting-started-cluster-health&quot; target=&quot;_blank&quot;&gt;Cluster Health&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;当然也可以选用Prometheus作为监控：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/vvanholl/elasticsearch-prometheus-exporter&quot; target=&quot;_blank&quot;&gt;Prometheus Exporter Plugin for Elasticsearch&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;452-高可用&quot;&gt;4.5.2 高可用&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;数据节点数量选择&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://thoughts.t37.net/resizing-your-elasticsearch-indexes-in-production-d7a0402d137e&quot; target=&quot;_blank&quot;&gt;Resizing your Elasticsearch Indexes in Production&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.signalfx.com/blog/scaling-elasticsearch-sharding-availability-hundreds-millions-documents/&quot; target=&quot;_blank&quot;&gt;Scaling Elasticsearch: Sharding and Availability for Hundreds Of Millions of Documents&lt;/a&gt;：这篇当中有一段讲解了&lt;code&gt;Resharding With Zero Downtime&lt;/code&gt;，这是非常有价值的一个topic&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;可恢复的集群最低配置&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;3 locations to host your nodes. 2 locations to run half of your cluster, and one for the backup master node.&lt;/li&gt;
  &lt;li&gt;3 master nodes. You need an odd number of eligible master nodes to avoid split brains when you lose a whole data center. Put one master node in each location so you hopefully never lose the quorum.&lt;/li&gt;
  &lt;li&gt;2 http nodes, one in each primary data center.&lt;/li&gt;
  &lt;li&gt;As many data nodes as you need, split evenly between both main locations.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;故障恢复&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Elasticsearch在集群中分主节点shard和复制节点replica，当集群的设置足够多（数据冗余充分）的情况下，当某个物理节点不可用时，Elasticsearch会自动进行选举，将丢失的主节点shard的replica节点设置成主节点，并重新对集群进行平衡。举个例子：&lt;/p&gt;

&lt;p&gt;事故发生前：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;一共有3个物理节点&lt;/li&gt;
  &lt;li&gt;一共有3个主节点shard&lt;/li&gt;
  &lt;li&gt;每个主节点shard有2个复制节点replica&lt;/li&gt;
  &lt;li&gt;当前物理节点1是作为整个集群的master节点进行服务的&lt;/li&gt;
  &lt;li&gt;后续事故会发生在物理节点1，这个节点会下线&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/elasticsearch-note/elk_ha_01.png&quot; alt=&quot;Before&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;事故发生后：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;master节点下线了，因此集群重新开始选取master节点，设定为物理节点2&lt;/li&gt;
  &lt;li&gt;0号主节点shard（P0）本来就在物理节点3上，因此不受影响&lt;/li&gt;
  &lt;li&gt;1号和2号主节点shard之前在物理节点1上，全部丢失，集群将物理节点2上的2号shard的replica（R2）提升为主节点shard（P2），并将物理节点3上的1号shard的replica（R1）提升为主节点shard（P1）&lt;/li&gt;
  &lt;li&gt;此时所有的主节点shard都已恢复，且各主节点shard都存在一份replica&lt;/li&gt;
  &lt;li&gt;后续集群会继续为各主节点shard复制缺失的一份replica&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/elasticsearch-note/elk_ha_02.png&quot; alt=&quot;After&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;46-性能调优&quot;&gt;4.6 性能调优&lt;/h2&gt;
&lt;p&gt;Ebay有一篇非常细节非常棒的设计及性能优化分析博文：&lt;a href=&quot;https://www.ebayinc.com/stories/blogs/tech/elasticsearch-performance-tuning-practice-at-ebay/&quot; target=&quot;_blank&quot;&gt;Elasticsearch Performance Tuning Practice at eBay&lt;/a&gt;。从时间上来看，这篇文章也还算近：&lt;code&gt;2018-01-08&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;这篇博文分析了大规模Elasticsearch集群会面临的挑战，以及解决方案，还按实际的应用Scenario进行了问题分析以及给出了解决范例，很棒。&lt;/p&gt;

&lt;h1 id=&quot;5-kibana&quot;&gt;5. Kibana&lt;/h1&gt;
&lt;p&gt;Kibana这块相对来说比较简单。一些关键文档位置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/docker.html#docker&quot; target=&quot;_blank&quot;&gt;Running Kibana on Docker&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/settings.html#settings&quot; target=&quot;_blank&quot;&gt;Configuring Kibana&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/kuery-query.html&quot; target=&quot;_blank&quot;&gt;Kibana Query Language&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/lucene-query.html#lucene-query&quot; target=&quot;_blank&quot;&gt;Lucene Query Syntax&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ID_INDEX_PATTERN&quot;&gt;5.1 Index Pattern&lt;/h2&gt;
&lt;p&gt;在打开Kibana页面进行任何查询和设置之前，必须进行&lt;code&gt;Index Pattern&lt;/code&gt;的设置。这是使用的前提。该设置是用来告知Kibana，Elasticsearch集群中的哪些Index是需要进行解析和观察的，作为后续所有查询的数据来源。&lt;/p&gt;

&lt;p&gt;官方文档：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/index-patterns.html#index-patterns&quot; target=&quot;_blank&quot;&gt;Index Patterns&lt;/a&gt; &lt;a href=&quot;https://www.elastic.co/guide/cn/kibana/current/index-patterns.html&quot; target=&quot;_blank&quot;&gt;中文&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/tutorial-define-index.html#tutorial-define-index&quot; target=&quot;_blank&quot;&gt;Defining your index patterns&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;官方对于自动化的支持做的不太好，如果需要在Elasticsearch集群启动之后自动化对Kibana内设置Index Pattern的话，该需求是没有官方的解决方案的。找了一圈有一些hack方案，但都不稳定，非常容易因版本更新的原因后续就无法使用了。这方面后面只能说有需要再临时找对应版本的hack。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/elastic/kibana/issues/3709&quot; target=&quot;_blank&quot;&gt;Index pattern creation API #3709&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;52-使用简介&quot;&gt;5.2 使用简介&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;如果只是要简单过滤下数据进行简单的统计或者进行临时的debug日志搜索，那么在&lt;code&gt;Discover&lt;/code&gt;页面直接使用条件搜索过滤即可：&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/tutorial-discovering.html#tutorial-discovering&quot; target=&quot;_blank&quot;&gt;Discovering your data&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;如果需要对一个常用的搜索或数值结果进行定义，方便后续直接查看，那么可以使用&lt;code&gt;Visualize&lt;/code&gt;页面制作图表，这里的Visualize是和Grafana里的&lt;code&gt;Panel&lt;/code&gt;同样的概念：&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/tutorial-visualizing.html#tutorial-visualizing&quot; target=&quot;_blank&quot;&gt;Visualizing your data&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;如果需要定义一系列常用的图表进行观察，则可以使用&lt;code&gt;Dashboard&lt;/code&gt;页面进行设置，这里的Dashboard是和Grafana里的&lt;code&gt;Dashboard&lt;/code&gt;同样的概念：&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/tutorial-dashboard.html#tutorial-dashboard&quot; target=&quot;_blank&quot;&gt;Displaying your visualizations in a dashboard&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;一般如果将Elasticsearch作为日志聚合debug工具的话，不需要很复杂的设置，直接使用Discover即可。偶尔会有些例如同时在线或最近请求数量之类的观测需求，那么简单设置下Visualize即可。&lt;/p&gt;

&lt;h2 id=&quot;53-qa&quot;&gt;5.3 Q&amp;amp;A&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/47370280/whats-the-difference-between-the-field-and-field-keyword-fields-in-kibana&quot; target=&quot;_blank&quot;&gt;What’s the difference between the ‘field’ and ‘field.keyword’ fields in Kibana?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;6-filebeat直连elasticsearch实践&quot;&gt;6. Filebeat直连Elasticsearch实践&lt;/h1&gt;
&lt;h2 id=&quot;61-直连流程&quot;&gt;6.1 直连流程&lt;/h2&gt;
&lt;p&gt;在实际应用的场景中，大部分情况下我们需要的这是将本地日志的内容分类传送到Elasticsearch集群中，按条件定位到不同的索引内。最多也就是对日志里的字段进行一些简单的丰富化或转换。而完成这样的需求其实是不需要Logstash这样的工具，仅使用Filebeat就可以独立完成。这样做的好处是节约了大量系统资源（Golang vs Java），同时还兼具了高可用和性能。&lt;/p&gt;

&lt;p&gt;流程也非常简单：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Filebeat监听本地日志变化&lt;/li&gt;
  &lt;li&gt;Filebeat将新产生的日志内容按JSON进行解析&lt;/li&gt;
  &lt;li&gt;Filebeat根据日志内的字段内容，进行&lt;code&gt;processors&lt;/code&gt;处理，进行丰富化或进行格式转换&lt;/li&gt;
  &lt;li&gt;Filebeat根据根据&lt;code&gt;Elasticsearch template setting&lt;/code&gt;，启用在Elasticsearch集群上设置好的Index Template（只有这步是依赖Elasticsearch集群的，需要预先在Elasticsearch集群中设置好Template）&lt;/li&gt;
  &lt;li&gt;Filebeat根据设置，将日志传输到Elasticsearch集群中不同的Index里&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;基本上全部的处理都是在Filebeat里完成了，不需要Ingest Pipeline做什么，更不需要Logstash出马。&lt;/p&gt;

&lt;p&gt;实际操作下来，还是有很多细节问题，后面一一细说。&lt;/p&gt;

&lt;h2 id=&quot;62-应用场景&quot;&gt;6.2 应用场景&lt;/h2&gt;
&lt;p&gt;先描述下应用场景，否则后面的一些配置和细节都不好说明。&lt;/p&gt;

&lt;p&gt;系统有三个应用程序：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;web&lt;/li&gt;
  &lt;li&gt;service&lt;/li&gt;
  &lt;li&gt;consumer&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;每个应用程序都会输出一份日志：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;web：/tmp/logs/app/app.web.stdout.log&lt;/li&gt;
  &lt;li&gt;service：/tmp/logs/app/app.service.stdout.log&lt;/li&gt;
  &lt;li&gt;consumer：/tmp/logs/app/app.consumer.stdout.log&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;每个应用除了自身的业务日志之外，也会有一些使用中的组件会在对应的日志内输出内容：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;web：
    &lt;ul&gt;
      &lt;li&gt;web：自身业务日志&lt;/li&gt;
      &lt;li&gt;gin：web框架gin的日志&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;service：
    &lt;ul&gt;
      &lt;li&gt;service：自身业务日志&lt;/li&gt;
      &lt;li&gt;gorm：数据库orm框架的日志&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;consumer：
    &lt;ul&gt;
      &lt;li&gt;consumer：自身业务日志&lt;/li&gt;
      &lt;li&gt;gorm：数据库orm框架的日志&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;需求是跟踪、解析这三份日志文件，将输出的日志根据应用以及组件分发到Elasticsearch不同的Index中：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;web：
    &lt;ul&gt;
      &lt;li&gt;web：分发到 dist-web-web-*&lt;/li&gt;
      &lt;li&gt;gin：分发到 dist-web-gin-*&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;service：
    &lt;ul&gt;
      &lt;li&gt;service：分发到 dist-service-service-*&lt;/li&gt;
      &lt;li&gt;gorm：分发到 dist-service-gorm-*&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;consumer：
    &lt;ul&gt;
      &lt;li&gt;consumer：分发到 dist-consumer-consumer-*&lt;/li&gt;
      &lt;li&gt;gorm：分发到 dist-consumer-gorm-*&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;解决方案：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;使用input配置下的fields配置，根据输入的文件，添加自定义字段：&lt;code&gt;fields.app: web|service|consumer&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;使用processors，解析JSON日志内容、字段，添加自定义字段：&lt;code&gt;fields.module: web|gin|service|consumer|gorm&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;根据字段&lt;code&gt;fields.app&lt;/code&gt;&lt;code&gt;fields.module&lt;/code&gt;输出日志到不同的Index：&lt;code&gt;dist-%{[fields.app]}-%{[fields.module]}-%{[agent.version]}-%{+yyyy.MM.dd}&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ID_INDEX_TEMPLATE&quot;&gt;6.3 Index Template&lt;/h2&gt;
&lt;p&gt;中间还需要补一个Elasticsearch的概念：&lt;code&gt;Index Template&lt;/code&gt;。官方文档在：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/indices-templates.html&quot; target=&quot;_blank&quot;&gt;Index Templates&lt;/a&gt;，也有一份&lt;a href=&quot;https://www.elastic.co/guide/cn/elasticsearch/guide/current/index-templates.html&quot; target=&quot;_blank&quot;&gt;中文&lt;/a&gt;的。&lt;/p&gt;

&lt;p&gt;之前在&lt;a href=&quot;#ID_INDEX&quot;&gt;4.2 文档数据库 &amp;amp; 索引&lt;/a&gt;已经讲到了，Index即相当于RDBMS里的&lt;code&gt;表名&lt;/code&gt;，且在Elasticsearch中是用来进行sharding的重要字段。而同时我们之前也提到过了，在大部分的情况下，Index是自动创建的，按某些格式：&lt;code&gt;dist-%{[fields.app]}-%{[fields.module]}-%{[agent.version]}-%{+yyyy.MM.dd}&lt;/code&gt;。所以如果要针对每一个Index进行单独的配置，这基本上是不可能的。在Elasticsearch中，为了应对这样的需求，就有了&lt;code&gt;Index Template&lt;/code&gt;这个设置。新创建的Index都会根据名字套用上某个Template（如果有匹配到的话），达到对Index进行设置的目的。&lt;/p&gt;

&lt;p&gt;此外，Index Template里还设置了很多细节（这些设置都会在名字匹配的Index上生效）：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Index的shards数量&lt;/li&gt;
  &lt;li&gt;Index的replicas数量&lt;/li&gt;
  &lt;li&gt;Index如何分词、如何过滤&lt;/li&gt;
  &lt;li&gt;Index对应日志中的字段应该怎么解析，分别都是什么类型的字段（如果不设置的话，Elasticsearch会根据第一次出现的值进行猜测，以后将不再更改，除非使用API手动重设）&lt;/li&gt;
  &lt;li&gt;等等&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如果某个新创建的Index不符合任何Elasticsearch集群上已知的所有Template，则该Index内的所有设置都会按默认值来。一般来说这种情况下最严重的问题是：该Index将只会存在一个shard，且只会有一份replica。&lt;/p&gt;

&lt;p&gt;所以，一般来说都需要在正式使用之前将需要的Index Template创建好，才可能开始向Elasticsearch输入日志，否则创建出来的Index会有问题，至少分片就不对。&lt;/p&gt;

&lt;p&gt;额外的资料：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;有一份中文的博文，讲解的很好，后续可以看下：&lt;a href=&quot;https://www.jianshu.com/p/1f67e4436c37&quot; target=&quot;_blank&quot;&gt;初探 Elasticsearch Index Template（索引模板)&lt;/a&gt;。&lt;/li&gt;
  &lt;li&gt;官方社区有一个讨论帖，里面有comment对如何操作自定义Index Template有比较详细的步骤讲解：&lt;a href=&quot;https://discuss.elastic.co/t/custom-filebeat-template-for-json-log-lines/114761/5&quot; target=&quot;_blank&quot;&gt;Custom filebeat template for JSON log lines&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;64-issues&quot;&gt;6.4 Issues&lt;/h2&gt;
&lt;h3 id=&quot;641-filebeat字段层级&quot;&gt;6.4.1 Filebeat字段层级&lt;/h3&gt;
&lt;p&gt;Filebeat默认将日志JSON解析出来的内容放到&lt;code&gt;message&lt;/code&gt;字段下，见下图的message字段内容：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/elasticsearch-note/filebeat_json_no_root.png&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;如果不知道这点的话，在使用&lt;code&gt;processors&lt;/code&gt;时候会发现设定的条件因字段没有找到而没有被触发。调试的时候会非常痛苦。&lt;/p&gt;

&lt;p&gt;这里需要了解filebeat的设置：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/filebeat-input-log.html#filebeat-input-log-config-json&quot; target=&quot;_blank&quot;&gt;Log input &amp;gt; json&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;有几项配置需要了解下：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;filebeat.inputs&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;log&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;/...&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;json.keys_under_root&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;json.overwrite_keys&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;json.message_key&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;message&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;json.keys_under_root: true&lt;/code&gt;：将之前存放在message字段里的JSON释放到根节点，效果见下图，可以和上面的图做下比对；一般来说这也是用户希望的效果&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;json.overwrite_keys: true&lt;/code&gt;：是否在冲突的时候使用释放出来的字段的值覆盖根目录下同Key的值，一般也需要配置&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;json.message_key: message&lt;/code&gt;：这项一般不要改，留默认的&lt;code&gt;message&lt;/code&gt;即可，后面会解释原因&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/elasticsearch-note/filebeat_json_root.png&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;如果不配置&lt;code&gt;json.keys_under_root: true&lt;/code&gt;也不是不可以，但在查找日志JSON内容的时候就需要到message字段下去查找，而不是根节点。&lt;/p&gt;

&lt;h3 id=&quot;642-kibana-message字段&quot;&gt;6.4.2 Kibana message字段&lt;/h3&gt;
&lt;p&gt;Kibana页面上的原始日志页面，显示的是filebeat传输到Elasticsearch日志内容中的&lt;code&gt;message&lt;/code&gt;字段内容，且显示的仅只有message字段的内容。并且，当Kibana发现Elasticsearch中存放的日志不存在message字段的时候，还会显示错误：&lt;code&gt;failed to find message&lt;/code&gt;。因此之前提到，不要随意更改：&lt;code&gt;json.message_key: message&lt;/code&gt;。要更改Kibana的行为也不是不可以，参见：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://discuss.elastic.co/t/log-ui-failed-to-format-message-from/163196&quot; target=&quot;_blank&quot;&gt;Log UI failed to format message from&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/elastic/kibana/pull/26579/files#diff-3d8e25bfa60ef76c1ce7b5e7a68232f2R9&quot; target=&quot;_blank&quot;&gt;[InfraOps] Update docs with data source configuration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;实际效果可以参见下面两张图的比对，第一张是没有使用&lt;code&gt;json.keys_under_root: true&lt;/code&gt;的情况，第二张则是释放之后的情况：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/elasticsearch-note/filebeat_logs_msg_no_root.png&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;
&lt;img src=&quot;/resources/2019/04/elasticsearch-note/filebeat_logs_msg_root.png&quot; alt=&quot;&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;643-input--processors-fields&quot;&gt;6.4.3 input | processors fields&lt;/h3&gt;
&lt;p&gt;在filebeat的input配置中，可以根据日志输入向日志内容中添加自定义的字段：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;filebeat.inputs&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;log&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;true&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;/tmp/app/logs/app.web.stdout.log&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;web&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;在processors配置中，也可以根据条件向日志内容中添加自定义的字段：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;processors&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;add_fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;WEB.Handler&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt;
&lt;span class=&quot;nn&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;但有一点需要明确，这些添加的字段，都会存放在根节点下的&lt;code&gt;fields&lt;/code&gt;字段里。上面例子里的两个设置，会产生：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;fields.app: web&lt;/li&gt;
  &lt;li&gt;fields.module: web&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;可以看下之前6.4.1图中的字段列表。&lt;/p&gt;

&lt;h3 id=&quot;ID_FILEBEAT_INDEX_TEMPLATE&quot;&gt;6.4.4 Index Template设置&lt;/h3&gt;
&lt;p&gt;Index Template虽然是在Elasticsearch上创建的（见：&lt;a href=&quot;#ID_INDEX_TEMPLATE&quot;&gt;6.3 Index Template&lt;/a&gt;），但在filebeat端还是需要做设置的。主要是需要在filebeat端加载Elasticsearch上存在的Index Template，然后后续在filebeat向Elasticsearch传输日志的时候，就会应用这些Template。如果配置不正确的话，诸如shards数量之类的配置就会出错、不生效。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;filebeat中关于Index Template的配置项：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/configuration-template.html&quot; target=&quot;_blank&quot;&gt;Load the Elasticsearch index template&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;filebeat中如何加载Index Template：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/filebeat-template.html&quot; target=&quot;_blank&quot;&gt;Step 4: Load the index template in Elasticsearch&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;此外，该功能一般和输出相关配置有关：&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/elasticsearch-output.html#indices-option-es&quot; target=&quot;_blank&quot;&gt;Configure the Elasticsearch output &amp;gt; indices&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如果不想在Elasticsearch端创建自定义的Index Template，那么可以使用的Template只有一个，就是filebeat默认的：&lt;code&gt;filebeat-%{[agent.version]}-%{+yyyy.MM.dd}&lt;/code&gt;，在当前的版本下就是：&lt;code&gt;filebeat-7.0.0-2019-05-29&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;该默认的Template在Elastcsearch上的配置可以通过API &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/indices-templates.html#getting&quot; target=&quot;_blank&quot;&gt;Getting templates&lt;/a&gt; 进行观察：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;filebeat-7.0.0&amp;quot;&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;quot;order&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;quot;index_patterns&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;filebeat-7.0.0-*&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;quot;settings&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;index&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;lifecycle&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;quot;name&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;filebeat-7.0.0&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;quot;rollover_alias&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;filebeat-7.0.0&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;mapping&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;nt&quot;&gt;&amp;quot;total_fields&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;quot;limit&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;10000&amp;quot;&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;refresh_interval&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;5s&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;number_of_shards&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;3&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;err&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;可以看到，该Template的名字匹配pattern是：&lt;code&gt;filebeat-7.0.0-*&lt;/code&gt;，所以如果要利用这个默认的Template的话，名字一定不能搞错。我之前做实验的时候使用过：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;filebeat-web-web-7.0.0-*&lt;/li&gt;
  &lt;li&gt;filebeat-web-gin-7.0.0-*&lt;/li&gt;
  &lt;li&gt;…&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;之类的，就因为名字不匹配导致没有套用上这个Template，最后shards数量之类的就全错了。&lt;/p&gt;

&lt;h3 id=&quot;645-切片数量&quot;&gt;6.4.5 切片数量&lt;/h3&gt;
&lt;p&gt;查看集群Index切片状态，可以通过API &lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/cat-shards.html#cat-shards&quot; target=&quot;_blank&quot;&gt;cat shards&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;范例集群的切片设置为：&lt;code&gt;主节点&lt;/code&gt;数量3，&lt;code&gt;replica&lt;/code&gt;数量1。也就是说一个Index的切片总数为：&lt;code&gt;primary * (1 + replica)&lt;/code&gt; = 6。公式括号中的1就是primary，每一份切片只会有一个primary。&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ curl -X GET &lt;span class=&quot;s2&quot;&gt;&amp;quot;http://127.0.0.1:9201/_cat/shards&amp;quot;&lt;/span&gt;
dist-consumer-gorm-7.0.0-2019.05.29     &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-consumer-gorm-7.0.0-2019.05.29     &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-consumer-gorm-7.0.0-2019.05.29     &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-consumer-gorm-7.0.0-2019.05.29     &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
dist-consumer-gorm-7.0.0-2019.05.29     &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;17&lt;/span&gt;.2kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-consumer-gorm-7.0.0-2019.05.29     &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;17&lt;/span&gt;.2kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
dist-web-gin-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-web-gin-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-web-gin-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;32&lt;/span&gt;.3kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-web-gin-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;32&lt;/span&gt;.3kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
dist-web-gin-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;32&lt;/span&gt;.3kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-web-gin-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;32&lt;/span&gt;.3kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
dist-service-gorm-7.0.0-2019.05.29      &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;33&lt;/span&gt;.4kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-service-gorm-7.0.0-2019.05.29      &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;33&lt;/span&gt;.4kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
dist-service-gorm-7.0.0-2019.05.29      &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;16&lt;/span&gt;.6kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-service-gorm-7.0.0-2019.05.29      &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;16&lt;/span&gt;.6kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
dist-service-gorm-7.0.0-2019.05.29      &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-service-gorm-7.0.0-2019.05.29      &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-consumer-consumer-7.0.0-2019.05.29 &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;14&lt;/span&gt;.6kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-consumer-consumer-7.0.0-2019.05.29 &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;14&lt;/span&gt;.6kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-consumer-consumer-7.0.0-2019.05.29 &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-consumer-consumer-7.0.0-2019.05.29 &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
dist-consumer-consumer-7.0.0-2019.05.29 &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;14&lt;/span&gt;.6kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-consumer-consumer-7.0.0-2019.05.29 &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;14&lt;/span&gt;.6kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
.kibana_1                               &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;50&lt;/span&gt;.2kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
.kibana_1                               &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;50&lt;/span&gt;.2kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
dist-service-service-7.0.0-2019.05.29   &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-service-service-7.0.0-2019.05.29   &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-service-service-7.0.0-2019.05.29   &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;28&lt;/span&gt;.2kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-service-service-7.0.0-2019.05.29   &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;14&lt;/span&gt;.9kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
dist-service-service-7.0.0-2019.05.29   &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;13&lt;/span&gt;.9kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-service-service-7.0.0-2019.05.29   &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;13&lt;/span&gt;.9kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
.kibana_task_manager                    &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;45&lt;/span&gt;.4kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
.kibana_task_manager                    &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;45&lt;/span&gt;.4kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-web-web-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;27&lt;/span&gt;.9kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
dist-web-web-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;27&lt;/span&gt;.9kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
dist-web-web-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;   14kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-web-web-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;   14kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
dist-web-web-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;   14kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
dist-web-web-7.0.0-2019.05.29           &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;   14kb &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
filebeat-7.0.0-2019.05.29-000001        &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
filebeat-7.0.0-2019.05.29-000001        &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
filebeat-7.0.0-2019.05.29-000001        &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.2 es_3
filebeat-7.0.0-2019.05.29-000001        &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1
filebeat-7.0.0-2019.05.29-000001        &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; p STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.4 es_2
filebeat-7.0.0-2019.05.29-000001        &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt; r STARTED &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;   230b &lt;span class=&quot;m&quot;&gt;172&lt;/span&gt;.20.0.3 es_1&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;输出的内容有几列，这里解释下含义：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;Index名&lt;/code&gt;：dist-consumer-gorm-7.0.0-2019.05.29&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;节点编号&lt;/code&gt;：切片在当前Index的切片组中的编号，从0开始，一个primary占用一个编号，所有该primary的从属replicas和primary共享同一个编号&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;节点类型&lt;/code&gt;：只有&lt;code&gt;p&lt;/code&gt;和&lt;code&gt;r&lt;/code&gt;，表示是primary还是replica&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;节点状态&lt;/code&gt;：正常状态为&lt;code&gt;STARTED&lt;/code&gt;，启动中为&lt;code&gt;INITIALIZING&lt;/code&gt;，错误状态为&lt;code&gt;UNASSIGNED&lt;/code&gt;；unassigned相关参见：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/cat-shards.html#reason-unassigned&quot; target=&quot;_blank&quot;&gt;Reasons for unassigned shard&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;文档数量&lt;/code&gt;：存储在该节点内的文档数量&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;节点容量&lt;/code&gt;：节点占用的磁盘容量&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;节点IP&lt;/code&gt;：节点的IP地址&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;节点名&lt;/code&gt;：节点在Elasticsearch集群中的名字&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;646-kibana-timestamp&quot;&gt;6.4.6 Kibana @timestamp&lt;/h3&gt;
&lt;p&gt;Filebeat向Elasticsearch传输的日志内容会添加一个字段：&lt;code&gt;@timestamp&lt;/code&gt;。而Kibana在设置Index Pattern（&lt;a href=&quot;#ID_INDEX_PATTERN&quot;&gt;5.1 Index Pattern&lt;/a&gt;）的时候，强制需要选择一项日志内的时间字段作为后续时间相关过滤的指标。如果用户没有自己的时间字段的话，一般都会选择&lt;code&gt;@timestamp&lt;/code&gt;字段，因为该段总是存在的。&lt;/p&gt;

&lt;p&gt;不过这里有一项需要注意：&lt;/p&gt;

&lt;p&gt;@timestamp 是日志被filebeat处理的时间点，而不是日志发生的时间点。一般来说这两者可以混用，但在日志有堆积，处理比较慢的情况下，就不合适了。千万需要小心，一般来说尽量选择业务日志自带的时间字段，就不会有问题了。&lt;/p&gt;

&lt;h3 id=&quot;647-elasticsearch-预创建数据&quot;&gt;6.4.7 Elasticsearch 预创建数据&lt;/h3&gt;
&lt;p&gt;一般来说，在Elasticsearch启动的时候都会有创建一些预设配置的需求，特别是在docker中运行的时候，因为docker本来就具有高度自动化的特征，也就格外需要这样的预设数据。这方面只能说官方仍旧没有提供非常完备的支持，只能自行处理：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://discuss.elastic.co/t/best-practice-for-creating-an-index-when-an-es-docker-container-starts/126651&quot; target=&quot;_blank&quot;&gt;Best practice for creating an index when an ES docker container starts&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/35526532/how-to-add-an-elasticsearch-index-during-docker-build&quot; target=&quot;_blank&quot;&gt;How to add an elasticsearch index during docker build&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;7-实践范例&quot;&gt;7. 实践范例&lt;/h1&gt;
&lt;p&gt;和之前做Prometheus实验的时候一样，因为需要把握一些细节，所以实验使用的还是下载下来的Elasticsearch、Kibana以及Filebeat。作为配角的Nginx使用的则是镜像版本。&lt;/p&gt;

&lt;p&gt;范例代码可以在Github查看：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/tree/master/experiment/elasticsearch&quot; target=&quot;_blank&quot;&gt;dist-system-practice/experiment/elasticsearch/&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;这则例子非常简单，基本上没有涉及任何比较核心的使用，粗略看下启动还是可以的。&lt;/p&gt;

&lt;h1 id=&quot;8-docker集群部署&quot;&gt;8. Docker集群部署&lt;/h1&gt;
&lt;p&gt;仍旧是使用docker-compose进行群组的编辑和启动，可运行范例可以查看：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/blob/master/golang/src/dist-system-practice/conf/elk-cluster.yaml&quot; target=&quot;_blank&quot;&gt;dist-system-practice/conf/elk-cluster.yaml&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;启动脚本：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/blob/master/golang/src/dist-system-practice/bash/dev/docker_elasticsearch.sh&quot; target=&quot;_blank&quot;&gt;dist-system-practice/bash/dev/docker_elasticsearch.sh&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;下面会根据职责一一解析配置文件。&lt;/p&gt;

&lt;h2 id=&quot;ID_ES_CONFIG&quot;&gt;8.1 Elasticsearch配置&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;elk-cluster.yaml&lt;/strong&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;x-es-environment-defaults&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;C1&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;&amp;amp;DISCOVERY_SEED_HOSTS&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;discovery.seed_hosts=es_1:9300,es_2:9300,es_3:9300&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 集群中的所有可用节点，这个配置中需要完整给出节点的HOST和PORT&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;C2&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;&amp;amp;CLUSTER_INITIAL_MASTER_NODES&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;cluster.initial_master_nodes=es_1,es_2,es_3&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 集群初始化的master节点，这个配置中只需要给节点名，即 node.name=es_1 里面设置的名字&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;C4&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;&amp;amp;ES_JAVA_OPTS&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;ES_JAVA_OPTS=\&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;-Xms256m&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&lt;/span&gt;
      &lt;span class=&quot;s&quot;&gt;-Xmx256m&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;&amp;quot;&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;x-es-ulimit-defaults&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;&amp;amp;ES_ULIMIT_DEFAULTS&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;nproc&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;65535&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;nofile&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;soft&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;65535&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;hard&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;65535&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;memlock&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;soft&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;-1&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;hard&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;-1&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;x-es-logging-defaults&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nl&quot;&gt;&amp;amp;ES_LOGGING_DEFAULTS&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;driver&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;json-file&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;max-size&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;512m&amp;quot;&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;net&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;driver&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;bridge&amp;quot;&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;es_vol_1_logs&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;driver&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;local&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;es_vol_1_data&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;driver&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;local&amp;quot;&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;es_1&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;elasticsearch:7.0.0&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;es_1&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;es_1&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;es_vol_1_data:/usr/share/elasticsearch/data&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;es_vol_1_logs:/usr/share/elasticsearch/logs&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;/private/tmp/elasticsearch.yaml:/usr/share/elasticsearch/config/elasticsearch.yml&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;net&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;9201:9201&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 该PORT是给外部访问使用的，比如Kibana、Filebeat，以及客户端查询API&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;expose&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;9300&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 该PORT是给集群内部流量使用的，所以只要expose即可&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;always&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;logging&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;*ES_LOGGING_DEFAULTS&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;node.name=es_1&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 节点名必须设置且不可重复&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;http.port=9201&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 这个PORT同上&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;node.master=true&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 如果需要该节点作为master角色提供服务，则这里设置成true&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;node.data=true&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 如果需要该节点作为数据节点提供服务（数据存储），则这里设置成true&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;*DISCOVERY_SEED_HOSTS&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;*CLUSTER_INITIAL_MASTER_NODES&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;*ES_JAVA_OPTS&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ulimits&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;*ES_ULIMIT_DEFAULTS&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;elasticsearch.yaml&lt;/strong&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;cluster.name&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;es_cluster&lt;/span&gt;
&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;path.data&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;/usr/share/elasticsearch/data&lt;/span&gt;
&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;path.logs&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;/usr/share/elasticsearch/logs&lt;/span&gt;
&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;bootstrap.memory_lock&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;network.host&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;0.0.0.0&lt;/span&gt;
&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;transport.tcp.port&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;9300&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;相关文档：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;官方文档及范例配置文件：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/docker.html#docker-cli-run-prod-mode&quot; target=&quot;_blank&quot;&gt;Install Elasticsearch with Docker&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;理解Elasticsearch的集群发现：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/modules-discovery-hosts-providers.html#modules-discovery-hosts-providers&quot; target=&quot;_blank&quot;&gt;Discovery&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;全局变量配置的使用：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/settings.html#_environment_variable_substitution&quot; target=&quot;_blank&quot;&gt;Environment variable substitution&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;同上，不同的做法：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/docker.html#docker-configuration-methods&quot; target=&quot;_blank&quot;&gt;Configuring Elasticsearch with Docker&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;一些比较常见的问题：&lt;a href=&quot;https://www.jianshu.com/p/fa31f38d241e&quot; target=&quot;_blank&quot;&gt;使用ElasticSearch踩过的坑&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;一个非常完整的搭建例子：&lt;a href=&quot;https://www.infvie.com/ops-notes/elkstack-beats&quot; target=&quot;_blank&quot;&gt;ELK Stack+Beats 搭建分布式日志平台&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;大杂烩：&lt;a href=&quot;https://www.jianshu.com/p/6a700cc61913&quot; target=&quot;_blank&quot;&gt;Elasticsearch安装配置&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;带说明的非docker安装：&lt;a href=&quot;https://logz.io/blog/elasticsearch-cluster-tutorial/&quot; target=&quot;_blank&quot;&gt;Creating an Elasticsearch Cluster: Getting Started&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;811-环境变量配置&quot;&gt;8.1.1 环境变量配置&lt;/h3&gt;
&lt;p&gt;Elasticsearch的环境变量配置要求使用配置文件中的配置项字符串，完全不用改动，全部都是小写，然后使用&lt;code&gt;=&lt;/code&gt;连接配置项的值。此外需要注意，数组的配置和配置文件中有所不同，直接使用以&lt;code&gt;,&lt;/code&gt;分隔的字符串即可：&lt;code&gt;discovery.seed_hosts=es_1:9300,es_2:9300,es_3:9300&lt;/code&gt;。&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;node.name=es_1&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;http.port=9201&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;node.master=true&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;node.data=true&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;812-多节点配置的共享&quot;&gt;8.1.2 多节点配置的共享&lt;/h3&gt;
&lt;p&gt;Elasticsearch docker compose的配置中，需要把environment配置成数组，而YAML则恰恰不支持数组的Anchor Merge。这是YAML的一个功能性问题，不支持Array的平铺Merge：&lt;a href=&quot;https://github.com/yaml/yaml/issues/35&quot; target=&quot;_blank&quot;&gt;Merge arrays #35&lt;/a&gt;。社区的方案一般都需要在原生的YAML之外，再使用工具把嵌套的Array整平：&lt;a href=&quot;https://stackoverflow.com/questions/4948933/is-there-a-way-to-alias-anchor-an-array-in-yaml&quot; target=&quot;_blank&quot;&gt;Is there a way to alias/anchor an array in YAML?&lt;/a&gt;，这就在我的接受范围之外了，我不希望使用任何第三方工具来修改yaml文件。&lt;/p&gt;

&lt;p&gt;最后方案为：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;把不怎么需要在运行时修改的共通变量写入配置文件&lt;/li&gt;
  &lt;li&gt;使用bind mount的方法加载配置文件到容器里&lt;/li&gt;
  &lt;li&gt;在yaml中设置变量&lt;/li&gt;
  &lt;li&gt;在多节点中使用变量，至少里面的值只需要改一个地方就可以生效了&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;813-集群发现相关配置&quot;&gt;8.1.3 集群发现相关配置&lt;/h3&gt;
&lt;p&gt;官方文档：&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/discovery-settings.html#discovery-settings&quot; target=&quot;_blank&quot;&gt;Important discovery and cluster formation settings&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;集群发现主要依赖两项配置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;discovery.seed_hosts=es_1:9300,es_2:9300,es_3:9300&lt;/li&gt;
  &lt;li&gt;cluster.initial_master_nodes=es_1,es_2,es_3&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;code&gt;discovery.seed_hosts&lt;/code&gt;用来告知Elasticsearch组成集群的所有节点都是谁，分别HOST和PORT是什么。无论是否是master节点，或者是否仅仅只是data节点，都需要列在这个选项中，告知给Elasticsearch。这个选项里的配置是常规的&lt;code&gt;host:port&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;cluster.initial_master_nodes&lt;/code&gt;用来告知Elasticsearch，集群启动的时候初期可用的master节点是哪几个，之后Elasticsearch会从这些节点中选出master节点。列在这个配置中的节点，其&lt;code&gt;node.master=true&lt;/code&gt;必须为true。&lt;/p&gt;

&lt;p&gt;然后，这个配置有个坑，非常非常坑，这个配置中的所有字符串，列的都是节点的名字，即必须和&lt;code&gt;node.name=es_1&lt;/code&gt;里的名字一致，不需要配置成&lt;code&gt;host:port&lt;/code&gt;，只需要&lt;code&gt;node_name&lt;/code&gt;。官方文档中的&lt;a href=&quot;https://www.elastic.co/guide/en/elasticsearch/reference/7.0/docker.html#docker-cli-run-prod-mode&quot; target=&quot;_blank&quot;&gt;例子&lt;/a&gt;因为是docker，所以节点的名字和docker network中的container名字是一致的，而且官方的例子用的都是默认port，所有的port都没写，所以我一开始误认为这个选项里的配置也是&lt;code&gt;host:port&lt;/code&gt;，然后各种无法组成集群。而且Elasticsearch针对这种错误给的错误信息非常暧昧，完全找不到有用的信息。最后找了半天才在官方论坛的一个帖子里找到线索。我填了这个坑之后貌似官方文档就更新了。&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://discuss.elastic.co/t/elastic-search-7-unable-to-bootstrap-the-cluster-due-to-master-not-discovered-yet/182073/2&quot; target=&quot;_blank&quot;&gt;Elastic Search 7 unable to bootstrap the cluster due to master not discovered yet&lt;/a&gt;（这个comment离我找到它只隔了3天，超级新的问题）：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Remove the port from the cluster.initial_master_nodes setting, and it will work. We have updated the docs recently to make it clearer that either node name, or ip/port is to be used. Node name/port is not a valid combination.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://discuss.elastic.co/t/elastic-search-7-unable-to-bootstrap-the-cluster-due-to-master-not-discovered-yet/182073/4&quot; target=&quot;_blank&quot;&gt;另一个comment&lt;/a&gt;：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;It is intentional. This setting does not denote a hostname, but the node name or the advertised publish address. In particular, it is not an address that is resolved or actively connected to. The discovery.seed_hosts setting is used for that. The cluster.initial_master_nodes setting is used to determine the identities of the subset of master-eligible nodes that participate in the bootstrapping process after discovery.seed_hosts has established a connection to the nodes.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;82-kibana配置&quot;&gt;8.2 Kibana配置&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;kibana&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;kibana:7.0.0&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;kibana&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;kibana&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;es_1&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;es_2&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;es_3&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;net&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;5601:5601&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;always&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;logging&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;*ES_LOGGING_DEFAULTS&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;SERVER_PORT=5601&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;SERVER_HOST=0.0.0.0&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;SERVER_NAME=es_cluster&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ELASTICSEARCH_HOSTS=[&amp;quot;http://es_1:9201&amp;quot;]&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;KIBANA_INDEX=.kibana&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;DIBANA_DEFAULTAPPID=home&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ELASTICSEARCH_PINGTIMEOUT=1500&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ELASTICSEARCH_REQUESTTIMEOUT=10000&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ELASTICSEARCH_LOGQUERIES=false&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;相关文档：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/docker.html&quot; target=&quot;_blank&quot;&gt;Running Kibana on Docker&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/kibana/7.0/docker.html#environment-variable-config&quot; target=&quot;_blank&quot;&gt;Environment variable configuration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Kibana环境变量的配置和Elasticsearch不一致：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Elasticsearch使用的是数组，常量的键使用的直接是配置文件中的键，不需要转大写和下划线&lt;/li&gt;
  &lt;li&gt;Kibana使用的是数组，常量的键使用的是配置文件中的键转大写，且将点转换成下划线&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;当前版本有一个配置项相关非常严重的BUG：&lt;a href=&quot;https://github.com/elastic/kibana/issues/32303&quot; target=&quot;_blank&quot;&gt;Kibana fails to validate config if elasticsearch.hosts is not a string #32303&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;简单来说就是&lt;code&gt;ELASTICSEARCH_HOSTS&lt;/code&gt;这项配置，如果写成下面的任何一种，都不正确，Kibana会报错告知找不到Elasticsearch集群：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ELASTICSEARCH_HOSTS&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;http://es_1:9201&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;http://es_2:9202&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;http://es_3:9203&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ELASTICSEARCH_HOSTS=[&amp;quot;http://es_1:9201&amp;quot;,&amp;quot;http://es_2:9202&amp;quot;,&amp;quot;http://es_3:9203&amp;quot;]&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ELASTICSEARCH_HOSTS=es_1:9201,es_2:9202,es_3:9203&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;虽然上面的写法其实理论上来说都是合法的，但现在就是会出错。现在唯一的写法是：&lt;code&gt;ELASTICSEARCH_HOSTS=[&quot;http://es_1:9201&quot;]&lt;/code&gt;。写成数组格式，但里面只能放一个节点，这样就不会出错。&lt;/p&gt;

&lt;h2 id=&quot;83-filebeat配置&quot;&gt;8.3 Filebeat配置&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;elk-cluster.yaml&lt;/strong&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;services&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;filebeat&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;elastic/filebeat:7.0.0&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;container_name&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;filebeat&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;filebeat&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;depends_on&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;es_1&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;es_2&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;es_3&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;networks&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;net&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;/private/tmp/filebeat.yaml:/usr/share/filebeat/filebeat.yml&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;/private/tmp/logs/app:/tmp/app/logs&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;restart&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;always&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;logging&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;*ES_LOGGING_DEFAULTS&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;ES_HOSTS=es_1:9201,es_2:9202,es_3:9203&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;LOGGING_LEVEL=debug&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# error, warning, info, debug&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;NUM_OF_OUTPUT_WORKERS=9&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# workers会均匀分配到node：如果有3个ES的node，那么每个node会分到3个workers&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;NUM_OF_SHARDS=3&lt;/span&gt;
      &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;NUM_OF_REPLICAS=1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;filebeat.yaml&lt;/strong&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-yaml&quot; data-lang=&quot;yaml&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;filebeat.inputs&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;log&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;/tmp/app/logs/app.web.stdout.log&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;json.keys_under_root&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 释放日志JSON到根节点&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;web&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 根据日志文件，添加不同的app字段值，后续会使用该值进行不同的Index分发&lt;/span&gt;

&lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;log&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;/tmp/app/logs/app.service.stdout.log&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;json.keys_under_root&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;service&lt;/span&gt;

&lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;log&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;enabled&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;/tmp/app/logs/app.consumer.stdout.log&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;json.keys_under_root&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;consumer&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;logging.level&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;#39;${LOGGING_LEVEL}&amp;#39;&lt;/span&gt;
&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;logging.selectors&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p p-Indicator&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;*&amp;quot;&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;processors&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;add_fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;WEB.Handler&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 根据日志内容，进行条件匹配&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;web&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 根据不同的匹配，添加不同的module字段值，后续会使用该值进行不同的Index分发&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;add_fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;logger&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;7c4b822813e7&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# &amp;quot;logger&amp;quot;:&amp;quot;zap@v0.0.0-20190405225521-7c4b822813e7/zap.go:46&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;gin&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;add_fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;gorm&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;gorm&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;add_fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Service.Rpc&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;service&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;add_fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;when&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;contains&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;Consumer&amp;quot;&lt;/span&gt;
      &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;fields&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;module&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;consumer&amp;quot;&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;setup.template.name&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;dist&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 启用的Elasticsearch Index Template，注意这个Template必须在Elasticsearch中存在&lt;/span&gt;
&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;setup.template.pattern&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;dist-*&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# Index名字匹配模式&lt;/span&gt;
&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;setup.template.settings&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;index.number_of_shards&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;#39;${NUM_OF_SHARDS}&amp;#39;&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;index.number_of_replicas&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;#39;${NUM_OF_REPLICAS}&amp;#39;&lt;/span&gt;

&lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;output.elasticsearch&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;#39;${ES_HOSTS}&amp;#39;&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;worker&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;#39;${NUM_OF_OUTPUT_WORKERS}&amp;#39;&lt;/span&gt;
  &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;indices&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 根据之前添加的字段，决定应该发送日志到什么Index&lt;/span&gt;
    &lt;span class=&quot;p p-Indicator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;l l-Scalar l-Scalar-Plain&quot;&gt;index&lt;/span&gt;&lt;span class=&quot;p p-Indicator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;dist-%{[fields.app]}-%{[fields.module]}-%{[agent.version]}-%{+yyyy.MM.dd}&amp;quot;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;# 注意这里使用到的Index名字需要匹配Index Template&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;strong&gt;elk-index-template.json&lt;/strong&gt;&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;quot;order&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;quot;index_patterns&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&amp;quot;dist-*&amp;quot;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;quot;settings&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;index&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;number_of_shards&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;number_of_replicas&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;refresh_interval&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;5s&amp;quot;&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;相关文档：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/running-on-docker.html#_configure_filebeat_on_docker&quot; target=&quot;_blank&quot;&gt;Configure Filebeat on Docker&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.elastic.co/guide/en/beats/filebeat/7.0/using-environ-vars.html#using-environ-vars&quot; target=&quot;_blank&quot;&gt;Use environment variables in the configuration&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Filebeat的环境变量配置和Kibana还有Elasticsearch都不一致，明明是一家公司的三个组件，居然相互之间的做法各不相同，也是服了。Filebeat的做法是在启动时设置环境变量，但这个环境变量不会自动转换并覆盖配置文件中的值，而是需要在配置文件中使用&lt;code&gt;${ENV_KEY}&lt;/code&gt;这样的方法来使用环境变量的值。&lt;/p&gt;

&lt;p&gt;此外，关于非常重要的Index Template设置，参见：&lt;a href=&quot;#ID_FILEBEAT_INDEX_TEMPLATE&quot;&gt;6.4.4 Index Template设置&lt;/a&gt;。&lt;/p&gt;

&lt;h1 id=&quot;9-todo&quot;&gt;9. TODO&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;Elasticsearch集群及一些基本观察用的API熟悉&lt;/li&gt;
  &lt;li&gt;Elasticsearch JVM相关参数和实践研究&lt;/li&gt;
  &lt;li&gt;Elasticsearch reshard的策略，最佳实践&lt;/li&gt;
  &lt;li&gt;Elasticsearch reshard时候的CPU、磁盘、内存，还有特别是网络的影响&lt;/li&gt;
  &lt;li&gt;Elasticsearch reshard在各种集群规模下的耗时&lt;/li&gt;
  &lt;li&gt;Elasticsearch的性能指标研究&lt;/li&gt;
  &lt;li&gt;Elasticsearch性能测试&lt;/li&gt;
  &lt;li&gt;Kibana使用深入&lt;/li&gt;
  &lt;li&gt;添加Logstash部分内容，这块由于时间问题暂时不准备展开&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;资料&quot;&gt;资料&lt;/h1&gt;
&lt;h2 id=&quot;链接&quot;&gt;链接&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://sematext.com/blog/logstash-alternatives/&quot; target=&quot;_blank&quot;&gt;5 Logstash Alternatives&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://gist.github.com/StevenACoffman/4e267f0f60c8e7fcb3f77b9e504f3bd7&quot; target=&quot;_blank&quot;&gt;StevenACoffman/fluent-filebeat-comparison.md&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/fluent/fluentd/issues/1657&quot; target=&quot;_blank&quot;&gt;Fluentd retains excessive amounts of memory after handling traffic peaks #1657&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.cnblogs.com/cjsblog/p/9495024.html&quot; target=&quot;_blank&quot;&gt;Filebeat 模块与配置&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://fdv.github.io/running-elasticsearch-fun-profit/&quot; target=&quot;_blank&quot;&gt;Operating Elasticsearch for Fun and Profit&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://es.xiaoleilu.com/index.html&quot; target=&quot;_blank&quot;&gt;Elasticsearch 权威指南（中文版）&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.infoq.cn/article/ejEG02VRoeGVaLw4j_LL&quot; target=&quot;_blank&quot;&gt;Lucene 查询原理及解析&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/27793721/what-is-the-difference-between-lucene-and-elasticsearch&quot; target=&quot;_blank&quot;&gt;What is the difference between Lucene and Elasticsearch&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://thoughts.t37.net/designing-the-perfect-elasticsearch-cluster-the-almost-definitive-guide-e614eabc1a87&quot; target=&quot;_blank&quot;&gt;Designing the Perfect Elasticsearch Cluster: the (almost) Definitive Guide&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://es.xiaoleilu.com/020_Distributed_Cluster/00_Intro.html&quot; target=&quot;_blank&quot;&gt;集群内部工作方式&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/vvanholl/elasticsearch-prometheus-exporter&quot; target=&quot;_blank&quot;&gt;Prometheus Exporter Plugin for Elasticsearch&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://thoughts.t37.net/resizing-your-elasticsearch-indexes-in-production-d7a0402d137e&quot; target=&quot;_blank&quot;&gt;Resizing your Elasticsearch Indexes in Production&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.signalfx.com/blog/scaling-elasticsearch-sharding-availability-hundreds-millions-documents/&quot; target=&quot;_blank&quot;&gt;Scaling Elasticsearch: Sharding and Availability for Hundreds Of Millions of Documents&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.ebayinc.com/stories/blogs/tech/elasticsearch-performance-tuning-practice-at-ebay/&quot; target=&quot;_blank&quot;&gt;Elasticsearch Performance Tuning Practice at eBay&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/elastic/kibana/issues/3709&quot; target=&quot;_blank&quot;&gt;Index pattern creation API #3709&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/47370280/whats-the-difference-between-the-field-and-field-keyword-fields-in-kibana&quot; target=&quot;_blank&quot;&gt;What’s the difference between the ‘field’ and ‘field.keyword’ fields in Kibana?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/1f67e4436c37&quot; target=&quot;_blank&quot;&gt;初探 Elasticsearch Index Template（索引模板)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://discuss.elastic.co/t/custom-filebeat-template-for-json-log-lines/114761/5&quot; target=&quot;_blank&quot;&gt;Custom filebeat template for JSON log lines&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://discuss.elastic.co/t/log-ui-failed-to-format-message-from/163196&quot; target=&quot;_blank&quot;&gt;Log UI failed to format message from&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/elastic/kibana/pull/26579/files#diff-3d8e25bfa60ef76c1ce7b5e7a68232f2R9&quot; target=&quot;_blank&quot;&gt;[InfraOps] Update docs with data source configuration&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://discuss.elastic.co/t/best-practice-for-creating-an-index-when-an-es-docker-container-starts/126651&quot; target=&quot;_blank&quot;&gt;Best practice for creating an index when an ES docker container starts&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/35526532/how-to-add-an-elasticsearch-index-during-docker-build&quot; target=&quot;_blank&quot;&gt;How to add an elasticsearch index during docker build&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/fa31f38d241e&quot; target=&quot;_blank&quot;&gt;使用ElasticSearch踩过的坑&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.infvie.com/ops-notes/elkstack-beats&quot; target=&quot;_blank&quot;&gt;ELK Stack+Beats 搭建分布式日志平台&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/6a700cc61913&quot; target=&quot;_blank&quot;&gt;Elasticsearch安装配置&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://logz.io/blog/elasticsearch-cluster-tutorial/&quot; target=&quot;_blank&quot;&gt;Creating an Elasticsearch Cluster: Getting Started&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/yaml/yaml/issues/35&quot; target=&quot;_blank&quot;&gt;Merge arrays #35&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/4948933/is-there-a-way-to-alias-anchor-an-array-in-yaml&quot; target=&quot;_blank&quot;&gt;Is there a way to alias/anchor an array in YAML?&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://discuss.elastic.co/t/elastic-search-7-unable-to-bootstrap-the-cluster-due-to-master-not-discovered-yet/182073/2&quot; target=&quot;_blank&quot;&gt;Elastic Search 7 unable to bootstrap the cluster due to master not discovered yet&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/elastic/kibana/issues/32303&quot; target=&quot;_blank&quot;&gt;Kibana fails to validate config if elasticsearch.hosts is not a string #32303&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://qbox.io/blog/optimizing-elasticsearch-how-many-shards-per-index&quot; target=&quot;_blank&quot;&gt;Optimizing Elasticsearch: How Many Shards per Index?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;EOF&lt;/p&gt;
&lt;/blockquote&gt;
</description>
				<pubDate>Thu, 25 Apr 2019 10:01:22 +0800</pubDate>
				<link>https://xenojoshua.com/2019/04/elasticsearch-note/</link>
				<guid isPermaLink="true">https://xenojoshua.com/2019/04/elasticsearch-note/</guid>
			</item>
		
			<item>
				<title>Jaeger Notes</title>
				<description>&lt;h4&gt;Table of Contents&lt;/h4&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#1-前言&quot; id=&quot;markdown-toc-1-前言&quot;&gt;1. 前言&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2-opentracing&quot; id=&quot;markdown-toc-2-opentracing&quot;&gt;2. OpenTracing&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#21-trace&quot; id=&quot;markdown-toc-21-trace&quot;&gt;2.1 Trace&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#22-span&quot; id=&quot;markdown-toc-22-span&quot;&gt;2.2 Span&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#221-trace与span关系&quot; id=&quot;markdown-toc-221-trace与span关系&quot;&gt;2.2.1 Trace与Span关系&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#222-span属性&quot; id=&quot;markdown-toc-222-span属性&quot;&gt;2.2.2 Span属性&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#223-span-context属性&quot; id=&quot;markdown-toc-223-span-context属性&quot;&gt;2.2.3 Span Context属性&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#224-span间关系&quot; id=&quot;markdown-toc-224-span间关系&quot;&gt;2.2.4 Span间关系&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#3-jaeger架构&quot; id=&quot;markdown-toc-3-jaeger架构&quot;&gt;3. Jaeger架构&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#31-jaeger-client&quot; id=&quot;markdown-toc-31-jaeger-client&quot;&gt;3.1 Jaeger Client&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#32-jaeger-agent&quot; id=&quot;markdown-toc-32-jaeger-agent&quot;&gt;3.2 Jaeger Agent&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#33-jaeger-collector&quot; id=&quot;markdown-toc-33-jaeger-collector&quot;&gt;3.3 Jaeger Collector&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#34-data-store&quot; id=&quot;markdown-toc-34-data-store&quot;&gt;3.4 Data Store&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#341-elasticsearch支持&quot; id=&quot;markdown-toc-341-elasticsearch支持&quot;&gt;3.4.1 ElasticSearch支持&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#35-jaeger-query&quot; id=&quot;markdown-toc-35-jaeger-query&quot;&gt;3.5 Jaeger Query&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#36-jaeger-ingester&quot; id=&quot;markdown-toc-36-jaeger-ingester&quot;&gt;3.6 Jaeger Ingester&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#37-日志模式&quot; id=&quot;markdown-toc-37-日志模式&quot;&gt;3.7 日志模式&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#4-jaeger使用&quot; id=&quot;markdown-toc-4-jaeger使用&quot;&gt;4. Jaeger使用&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#41-jaeger-collector单独启动&quot; id=&quot;markdown-toc-41-jaeger-collector单独启动&quot;&gt;4.1 Jaeger Collector单独启动&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#42-jaeger-agent单独启动&quot; id=&quot;markdown-toc-42-jaeger-agent单独启动&quot;&gt;4.2 Jaeger Agent单独启动&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#43-jaeger-query单独启动&quot; id=&quot;markdown-toc-43-jaeger-query单独启动&quot;&gt;4.3 Jaeger Query单独启动&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#5-jaeger高可用&quot; id=&quot;markdown-toc-5-jaeger高可用&quot;&gt;5. Jaeger高可用&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#51-metrics&quot; id=&quot;markdown-toc-51-metrics&quot;&gt;5.1 Metrics&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#52-components&quot; id=&quot;markdown-toc-52-components&quot;&gt;5.2 Components&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#521-client&quot; id=&quot;markdown-toc-521-client&quot;&gt;5.2.1 Client&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#522-agent&quot; id=&quot;markdown-toc-522-agent&quot;&gt;5.2.2 Agent&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#523-collector&quot; id=&quot;markdown-toc-523-collector&quot;&gt;5.2.3 Collector&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#524-data-store&quot; id=&quot;markdown-toc-524-data-store&quot;&gt;5.2.4 Data Store&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#6-jaeger采样&quot; id=&quot;markdown-toc-6-jaeger采样&quot;&gt;6. Jaeger采样&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#61-client配置&quot; id=&quot;markdown-toc-61-client配置&quot;&gt;6.1 Client配置&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#611-constant&quot; id=&quot;markdown-toc-611-constant&quot;&gt;6.1.1 Constant&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#612-probabilistic&quot; id=&quot;markdown-toc-612-probabilistic&quot;&gt;6.1.2 Probabilistic&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#613-rate-limiting&quot; id=&quot;markdown-toc-613-rate-limiting&quot;&gt;6.1.3 Rate Limiting&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#614-remote&quot; id=&quot;markdown-toc-614-remote&quot;&gt;6.1.4 Remote&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#62-collector配置&quot; id=&quot;markdown-toc-62-collector配置&quot;&gt;6.2 Collector配置&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#7-jaeger监控&quot; id=&quot;markdown-toc-7-jaeger监控&quot;&gt;7. Jaeger监控&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#71-exporter&quot; id=&quot;markdown-toc-71-exporter&quot;&gt;7.1 Exporter&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#72-grafana-dashboard&quot; id=&quot;markdown-toc-72-grafana-dashboard&quot;&gt;7.2 Grafana Dashboard&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#8-docker集群实践&quot; id=&quot;markdown-toc-8-docker集群实践&quot;&gt;8. Docker集群实践&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#81-docker集群配置&quot; id=&quot;markdown-toc-81-docker集群配置&quot;&gt;8.1 Docker集群配置&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#82-storage-schema&quot; id=&quot;markdown-toc-82-storage-schema&quot;&gt;8.2 Storage Schema&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#821-使用cqlsh导入&quot; id=&quot;markdown-toc-821-使用cqlsh导入&quot;&gt;8.2.1 使用cqlsh导入&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#822-工具镜像导入&quot; id=&quot;markdown-toc-822-工具镜像导入&quot;&gt;8.2.2 工具镜像导入&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#83-opentracing-coding-tutorial&quot; id=&quot;markdown-toc-83-opentracing-coding-tutorial&quot;&gt;8.3 Opentracing Coding Tutorial&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#84-client-coding&quot; id=&quot;markdown-toc-84-client-coding&quot;&gt;8.4 Client Coding&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#9-todo&quot; id=&quot;markdown-toc-9-todo&quot;&gt;9. TODO&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#资料&quot; id=&quot;markdown-toc-资料&quot;&gt;资料&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#链接&quot; id=&quot;markdown-toc-链接&quot;&gt;链接&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#help&quot; id=&quot;markdown-toc-help&quot;&gt;Help&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#ID_APP_AGENT_HELP&quot; id=&quot;markdown-toc-ID_APP_AGENT_HELP&quot;&gt;jaeger-agent –help&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#ID_APP_COLLECTOR_HELP&quot; id=&quot;markdown-toc-ID_APP_COLLECTOR_HELP&quot;&gt;jaeger-collector memory –help&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#ID_APP_QUERY_HELP&quot; id=&quot;markdown-toc-ID_APP_QUERY_HELP&quot;&gt;jaeger-query –help&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#metrics&quot; id=&quot;markdown-toc-metrics&quot;&gt;Metrics&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#ID_APP_AGENT_METRICS&quot; id=&quot;markdown-toc-ID_APP_AGENT_METRICS&quot;&gt;jaeger-agent metrics&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#ID_APP_COLLECTOR_METRICS&quot; id=&quot;markdown-toc-ID_APP_COLLECTOR_METRICS&quot;&gt;jaeger-collector metrics&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#ID_APP_QUERY_METRICS&quot; id=&quot;markdown-toc-ID_APP_QUERY_METRICS&quot;&gt;jaeger-query metrics&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;1-前言&quot;&gt;1. 前言&lt;/h1&gt;
&lt;p&gt;Tracing是最近才慢慢开始普及起来的一个概念。现在越来越多的系统转向微服务，或者类似于微服务设计的分布式系统，系统内部的复杂度越来越高，导致观察某一个请求的整个生命周期非常困难，查错也很困难。为了解决这样的问题，Tracing这个需求就被慢慢提出来了。最早的解决方案是一个开源项目被称为：&lt;a href=&quot;https://zipkin.io/&quot; target=&quot;_blank&quot;&gt;Zipkin&lt;/a&gt;。后来CNCF对Tracing做了一个规范：&lt;a href=&quot;https://opentracing.io/&quot; target=&quot;_blank&quot;&gt;OpenTracing&lt;/a&gt;，在CNCF里也孵化了一个项目：&lt;a href=&quot;https://www.jaegertracing.io/&quot; target=&quot;_blank&quot;&gt;Jaeger&lt;/a&gt;。现在基本上有这方面需求的，都会使用Jaeger，前浪死在沙滩上啊。&lt;/p&gt;

&lt;p&gt;关于监控、追踪、日志三者的区别，可以查看：&lt;a href=&quot;/2019/04/monitoring-tracing-logging/&quot; target=&quot;_blank&quot;&gt;Compare: Monitoring | Tracing | Logging&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;以下所有针对Jaeger的讨论都基于版本：&lt;code&gt;1.11.0&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;外部链接：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;阿里云的一篇博文很不错，可以看下：&lt;a href=&quot;https://yq.aliyun.com/articles/514488&quot; target=&quot;_blank&quot;&gt;开放分布式追踪（OpenTracing）入门与 Jaeger 实现&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/a963ad0bbe3e&quot; target=&quot;_blank&quot;&gt;OpenTracing语义标准规范及实现&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;2-opentracing&quot;&gt;2. OpenTracing&lt;/h1&gt;
&lt;p&gt;OpenTracing在CNCF里有其站点：&lt;a href=&quot;https://opentracing.io&quot; target=&quot;_blank&quot;&gt;opentracing.io&lt;/a&gt;，这个站点主要是进行一些大概念的介绍，基本上没什么可用的实现，而实现可以看上面提到过的Jaeger，当然本文后面也会介绍。&lt;/p&gt;

&lt;p&gt;该站点的文档中，有意义的部分从：&lt;a href=&quot;https://opentracing.io/docs/overview/&quot; target=&quot;_blank&quot;&gt;OpenTracing Overview&lt;/a&gt;开始。文档概念性的部分过完之后，其他部分基本上就可以忽略了。&lt;/p&gt;

&lt;p&gt;OpenTracing有官方的Specification：&lt;a href=&quot;https://github.com/opentracing-contrib/opentracing-specification-zh/blob/master/specification.md&quot; target=&quot;_blank&quot;&gt;CN汉化版&lt;/a&gt;，以及&lt;a href=&quot;https://opentracing.io/specification/&quot; target=&quot;_blank&quot;&gt;EN原版&lt;/a&gt;。既然是SPEC，里面也就包含了所有需要了解的信息，有时间的可以通读一遍。&lt;/p&gt;

&lt;p&gt;这里需要注意，SPEC是有明确版本的，当前的版本为：&lt;code&gt;1.1&lt;/code&gt; - &lt;code&gt;19 Sep 2018&lt;/code&gt;。  &lt;br /&gt;
前一版本为：1.0 - 23 Dec 2016，可以看到版本基本上很稳定。&lt;/p&gt;

&lt;p&gt;此外，对于SPEC，有一些&lt;a href=&quot;https://github.com/opentracing-contrib/opentracing-specification-zh/blob/master/semantic_conventions.md&quot; target=&quot;_blank&quot;&gt;语义惯例&lt;/a&gt;可以看下。&lt;/p&gt;

&lt;p&gt;主要需要遵循的有：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/opentracing-contrib/opentracing-specification-zh/blob/master/semantic_conventions.md#span-tag-%E6%B8%85%E5%8D%95&quot; target=&quot;_blank&quot;&gt;Span tag 清单&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/opentracing-contrib/opentracing-specification-zh/blob/master/semantic_conventions.md#log-field-%E6%B8%85%E5%8D%95&quot; target=&quot;_blank&quot;&gt;Log field 清单&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/opentracing-contrib/opentracing-specification-zh/blob/master/semantic_conventions.md#%E5%85%B8%E5%9E%8B%E5%9C%BA%E6%99%AF%E5%BB%BA%E6%A8%A1&quot; target=&quot;_blank&quot;&gt;典型场景建模&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如果应用场景符合上述范例中定义的情况，则务必需要遵循这些规范。这有点类似于写代码的时候的Coding Style，虽然代码编译执行可能没有任何问题，但为了统一编码的可读性还是需要遵循规范。&lt;/p&gt;

&lt;p&gt;下文会从组成Tracing的一些概念着手开始逐步介绍。&lt;/p&gt;

&lt;h2 id=&quot;21-trace&quot;&gt;2.1 Trace&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;p&gt;Trace: The description of a transaction as it moves through a distributed system.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Trace：一个在分布式系统内运作的事务。&lt;/p&gt;

&lt;p&gt;Trace代表着一个完整的事务，举个例子来说，如果有一个复杂的API系统，内部的API后台由大量的微服务实现，而一个可能需要十来个甚至更多的微服务协同处理的&lt;code&gt;API请求&lt;/code&gt;，就是一个&lt;code&gt;Trace&lt;/code&gt;。而这个例子中每一个微服务，其所作的工作就可以被认为是一个&lt;code&gt;Span&lt;/code&gt;。&lt;/p&gt;

&lt;h2 id=&quot;22-span&quot;&gt;2.2 Span&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;p&gt;Span: A named, timed operation representing a piece of the workflow. Spans accept key:value tags as well as fine-grained, timestamped, structured logs attached to the particular span instance.
Span context: Trace information that accompanies the distributed transaction, including when it passes the service to service over the network or through a message bus. The span context contains the trace identifier, span identifier, and any other data that the tracing system needs to propagate to the downstream service.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Span：一个被命名、被计时，代表着一段工作流的操作。Spans实例接受键值对的tags，以及含有细节的、计时的、结构化的日志内容。&lt;/p&gt;

&lt;p&gt;Span context：伴随着分布式事务产生的Trace相关的信息，包含了该事务通过网络或消息总线在服务之间传递的时间。此外还包含了：trace标识符、span标识符，以及其他任何tracing系统需要用来衍生下游服务所需要的数据。&lt;/p&gt;

&lt;h3 id=&quot;221-trace与span关系&quot;&gt;2.2.1 Trace与Span关系&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;/resources/2019/04/jaeger-note/spans-traces.png&quot; alt=&quot;Relationship&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;上图是一个Trace和Span的关系范例图。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;从时间轴上可以看到，A覆盖了所有下面子条目的时间，这很容易理解：所有的Span组成一个Trace，而每个Span实际上都消耗了时间，这些时间的总合就是Trace的时间消耗&lt;/li&gt;
  &lt;li&gt;Span有父子级别概念：B和C以及D的关系就是父子，而C和D则不是父子关系，父子的时间是&lt;code&gt;重合&lt;/code&gt;的，就类似所有子Span和Trace之间的时间关系，B消耗的时间是C和D的时间总合，而A消耗的时间则是B和E的总合&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;图中：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;在Trace &lt;code&gt;A&lt;/code&gt;中，&lt;code&gt;B&lt;/code&gt;和&lt;code&gt;E&lt;/code&gt;是&lt;code&gt;A&lt;/code&gt;的子Span&lt;/li&gt;
  &lt;li&gt;在Trace &lt;code&gt;A&lt;/code&gt;中，&lt;code&gt;B&lt;/code&gt;和&lt;code&gt;E&lt;/code&gt;顺序执行，&lt;code&gt;E&lt;/code&gt;的执行需要等待&lt;code&gt;B&lt;/code&gt;的完成&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;A&lt;/code&gt;的消耗时长为&lt;code&gt;B&lt;/code&gt;和&lt;code&gt;E&lt;/code&gt;的总合（这里都是理想情况）&lt;/li&gt;
  &lt;li&gt;在Span &lt;code&gt;B&lt;/code&gt;中，&lt;code&gt;C&lt;/code&gt;和&lt;code&gt;D&lt;/code&gt;是&lt;code&gt;B&lt;/code&gt;的子Span&lt;/li&gt;
  &lt;li&gt;在Span &lt;code&gt;B&lt;/code&gt;中，&lt;code&gt;C&lt;/code&gt;和&lt;code&gt;D&lt;/code&gt;顺序执行，&lt;code&gt;D&lt;/code&gt;的执行需要等待&lt;code&gt;C&lt;/code&gt;的完成&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;B&lt;/code&gt;的消耗时长为&lt;code&gt;C&lt;/code&gt;和&lt;code&gt;D&lt;/code&gt;的总合（这里都是理想情况）&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;222-span属性&quot;&gt;2.2.2 Span属性&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;An operation name&lt;/code&gt;，操作名称&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;A start timestamp&lt;/code&gt;，起始时间&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;A finish timestamp&lt;/code&gt;，结束时间&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;Span Tag&lt;/code&gt;，一组键值对构成的Span标签集合。键值对中，键必须为string，值可以是字符串，布尔，或者数字类型&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;Span Log&lt;/code&gt;，一组span的日志集合
    &lt;ul&gt;
      &lt;li&gt;每次log操作包含一个键值对，以及一个时间戳&lt;/li&gt;
      &lt;li&gt;键值对中，键必须为string，值可以是任意类型&lt;/li&gt;
      &lt;li&gt;但是需要注意，不是所有的支持OpenTracing的Tracer，都需要支持所有的值类型&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code&gt;SpanContext&lt;/code&gt;，Span上下文对象&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;References&lt;/code&gt;，Span间关系，相关的零个或者多个Span（Span间通过SpanContext建立这种关系）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Span Tag 范例：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;db.instance:”jdbc:mysql://127.0.0.1:3306/customers”&lt;/li&gt;
  &lt;li&gt;db.statement:”SELECT * FROM mytable WHERE foo=’bar’;”&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Span Logs 范例：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;message:”Can’t connect to mysql server on ‘127.0.0.1’(10061)”&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;223-span-context属性&quot;&gt;2.2.3 Span Context属性&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;任何一个OpenTracing的实现，都需要将当前调用链的状态（例如：trace和span的id），依赖一个独特的Span去跨进程边界传输&lt;/li&gt;
  &lt;li&gt;Baggage Items，Trace的随行数据，是一个键值对集合，它存在于trace中，也需要跨进程边界传输&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;SpanContext 范例：&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;trace_id:”abc123”&lt;/li&gt;
  &lt;li&gt;span_id:”xyz789”&lt;/li&gt;
  &lt;li&gt;Baggage Items:
    &lt;ul&gt;
      &lt;li&gt;special_id:”vsid1738”&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;224-span间关系&quot;&gt;2.2.4 Span间关系&lt;/h3&gt;
&lt;p&gt;一个Span可以与一个或者多个SpanContexts存在因果关系。OpenTracing目前定义了两种关系：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ChildOf（父子）&lt;/li&gt;
  &lt;li&gt;FollowsFrom（跟随）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ChildOf引用：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;一个RPC调用的服务端的span，和RPC服务客户端的span构成ChildOf关系&lt;/li&gt;
  &lt;li&gt;一个sql insert操作的span，和ORM的save方法的span构成ChildOf关系&lt;/li&gt;
  &lt;li&gt;很多span可以并行工作（或者分布式工作）都可能是一个父级的span的子项，他会合并所有子span的执行结果，并在指定期限内返回&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;3-jaeger架构&quot;&gt;3. Jaeger架构&lt;/h1&gt;
&lt;p&gt;官网上（&lt;a href=&quot;https://www.jaegertracing.io/docs/1.11/architecture/&quot; target=&quot;_blank&quot;&gt;Architecture&lt;/a&gt;）有一张架构图，可以先看下：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/jaeger-note/architecture.png&quot; alt=&quot;Architecture&quot; target=&quot;_blank&quot; /&gt;&lt;/p&gt;

&lt;p&gt;图上的内容主要分几个部分，下面一个个说。&lt;/p&gt;

&lt;h2 id=&quot;31-jaeger-client&quot;&gt;3.1 Jaeger Client&lt;/h2&gt;
&lt;p&gt;Jaeger client是之前提到的OpenTracing API的多语言实现。这部分是嵌在你的应用程序里的一个&lt;code&gt;类库&lt;/code&gt;，它就是你的应用程序的一部分，使用它你就可以在收到Request的时候创建对应的Span，并向下游Request输出对应的Trace上下文。&lt;/p&gt;

&lt;p&gt;Jaeger Client可以直接向Collector发送Trace信息，也可以结合本地的Agent协同工作，降低性能开销。实际上这部分的性能开销不会很大。&lt;/p&gt;

&lt;h2 id=&quot;32-jaeger-agent&quot;&gt;3.2 Jaeger Agent&lt;/h2&gt;
&lt;p&gt;Jaeger Agent是和目标应用程序并行部署的一个组件，可以理解为边车设计中的&lt;code&gt;边车&lt;/code&gt;的组成部分之一。它是一个长期启动的守护进程，通过监听UDP网络接收Client发送过来的Trace信息，并批量向Collector发送。在设计上，Agent可以将路由和服务发现相关的业务从Client里解耦出来。&lt;/p&gt;

&lt;h2 id=&quot;33-jaeger-collector&quot;&gt;3.3 Jaeger Collector&lt;/h2&gt;
&lt;p&gt;Jaeger Collector可以说是Jaeger的&lt;code&gt;服务器&lt;/code&gt;，接收从Agent发送过来的Trace信息，并对其进行验证、索引、转换，并最终将其存储起来。&lt;/p&gt;

&lt;h2 id=&quot;34-data-store&quot;&gt;3.4 Data Store&lt;/h2&gt;
&lt;p&gt;Jaeger的数据存储是可插拔式组件设计，有多种数据后端可选：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Cassandra&lt;/li&gt;
  &lt;li&gt;Elasticsearch&lt;/li&gt;
  &lt;li&gt;Kafka (only as a buffer)，即并不能把Kafka当做最终存储设施&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;存储选择是个问题，我简单搜索了下，没有找到非常权威的帖子对这三者进行横向比较，也可能是因为这块的技术比较新发展比较快。就我来看，个人建议是熟悉什么用什么，以不增加系统复杂度为第一要务。猜想：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Cassandra大概是稳定性最好的，大数据量的选择应该是这个&lt;/li&gt;
  &lt;li&gt;功能上大概是ELK最好，本来它就是以全文搜索为功能设计出来的系统&lt;/li&gt;
  &lt;li&gt;性能上应该是Kafka最高，毕竟Kafka的吞吐量是有口皆碑的（中间通道）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;从官方的文档口径上来看，最推荐的应该是使用Kafka和Ingester组成通道，然后使用Cassandra作为存储设备。&lt;/p&gt;

&lt;h3 id=&quot;341-elasticsearch支持&quot;&gt;3.4.1 ElasticSearch支持&lt;/h3&gt;
&lt;p&gt;Jaeger最佳支持的后端存储是Cassandra，Elasticsearch是第二个官方支持的存储设施。文档在：&lt;a href=&quot;https://github.com/jaegertracing/jaeger/blob/master/plugin/storage/es/README.md&quot; target=&quot;_blank&quot;&gt;ElasticSearch Support&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;需要注意的是，当前版本&lt;code&gt;1.11.x&lt;/code&gt;是不支持Elasticsearch最新版本&lt;code&gt;7.x&lt;/code&gt;的：&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/1474&quot;&gt;Support Elasticsearch 7.x #1474&lt;/a&gt;，而且看情况短期内应该也不会支持。后面我做practice的时候就直接选择cassandra作为存储了，毕竟存储还是安全第一。&lt;/p&gt;

&lt;h2 id=&quot;35-jaeger-query&quot;&gt;3.5 Jaeger Query&lt;/h2&gt;
&lt;p&gt;Jaeger的查询引擎，UI发送查询请求到该组件，然后查询引擎会查询后台数据仓库，返回结果。该组件启动的时候已经附带启动了HTTP的UI界面。&lt;/p&gt;

&lt;h2 id=&quot;36-jaeger-ingester&quot;&gt;3.6 Jaeger Ingester&lt;/h2&gt;
&lt;p&gt;组件上还有个Ingester，但基本上没找到什么相关信息。官方介绍：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Ingester is a service that reads from Kafka topic and writes to another storage backend (Cassandra, Elasticsearch).&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;感觉应该是一个解决吞吐量的中间件。&lt;/p&gt;

&lt;h2 id=&quot;37-日志模式&quot;&gt;3.7 日志模式&lt;/h2&gt;
&lt;p&gt;按照Jaeger当前的设计，Client和Agent之间是使用UDP进行通讯，必须是实时连接的，这就对Agent的健壮性提出了要求，如果当前Agent已挂，Client就基本上不可用了。而日志文件化的好处就是将Client和Agent彻底解耦，使用操作系统的磁盘IO来解决Tracing生成的问题，而这方面，官方&lt;code&gt;并没有计划&lt;/code&gt;要这么做，没有任何关于这方面的设计讨论（至少我没找到）。&lt;/p&gt;

&lt;p&gt;而官方倒是有讨论：如果有一个外部存储已经存放了Tracing相关数据，能不能直接使用Query连接上去进行Tracing数据的展示和分析。见：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/649&quot; target=&quot;_blank&quot;&gt;Integration with external logs storage when displaying traces #649&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如果这个实现的话，实际上就完全绕过了Jaeger的整个生命周期：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;不再需要在应用程序中嵌入Jaeger的Client（直接使用日志组件将Tracing打成日志）&lt;/li&gt;
  &lt;li&gt;不再需要在边车中放置Jaeger的Agent（只要有日志聚合的Agent即可：Logstash、Filebeat）&lt;/li&gt;
  &lt;li&gt;不再需要启动Collector集群（直接由日志聚合Agent发送到Elaticsearch）&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;只需要直接沿用（如果在用的话）ELK系列日志聚合系统，然后用Jaeger的Query直接连接到Elasticsearch上进行Tracing对应的日志分析就可以了。这样即减少了系统的整体复杂度（不需要Jaeger的一整套东西了），又降低了系统整体负载（磁盘IO永远是最便宜的东西）。&lt;/p&gt;

&lt;p&gt;就看今后发展了。不过如果这真的实现了，Jaeger项目还有必要存在么。。。&lt;/p&gt;

&lt;h1 id=&quot;4-jaeger使用&quot;&gt;4. Jaeger使用&lt;/h1&gt;
&lt;p&gt;初步入门可以查看官方文档：&lt;a href=&quot;https://www.jaegertracing.io/docs/1.11/getting-started/&quot; target=&quot;_blank&quot;&gt;Getting started&lt;/a&gt;。实际生产环境的安装和部署，需要仔细阅读官方文档：&lt;a href=&quot;https://www.jaegertracing.io/docs/1.11/deployment/&quot; target=&quot;_blank&quot;&gt;Deployment&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;如果使用&lt;code&gt;all-in-one&lt;/code&gt;范例镜像的话，可以：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ docker run -d --name jaeger \
  -e COLLECTOR_ZIPKIN_HTTP_PORT=9411 \
  -p 5775:5775/udp \
  -p 6831:6831/udp \
  -p 6832:6832/udp \
  -p 5778:5778 \
  -p 16686:16686 \
  -p 14268:14268 \
  -p 9411:9411 \
  jaegertracing/all-in-one:1.11.0
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;这里主要要了解下一堆端口：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Port&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Protocol&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Component&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Function&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5775&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;UDP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;agent&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;accept zipkin.thrift over compact thrift protocol (deprecated, used by legacy clients only)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;6831&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;UDP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;agent&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;accept jaeger.thrift over compact thrift protocol&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;6832&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;UDP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;agent&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;accept jaeger.thrift over binary thrift protocol&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5778&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;HTTP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;agent&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;serve configs&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;16686&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;HTTP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;query&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;serve frontend&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;16687&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;HTTP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;query&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;The http port for the health check service&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;14267&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;TChannel&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;collector&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;The TChannel port for the collector service&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;14268&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;HTTP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;collector&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;accept jaeger.thrift directly from clients&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;14269&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;HTTP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;collector&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;The http port for the health check service&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;14250&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;gRPC&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;collector&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;accept model.proto&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;9411&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;HTTP&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;collector&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;Zipkin compatible endpoint (optional)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;部分补充：&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.jaegertracing.io/docs/1.11/getting-started/&quot; target=&quot;_blank&quot;&gt;Getting started&lt;/a&gt;范例的官方文档里缺一个端口&lt;code&gt;14267&lt;/code&gt;。这个端口的Protocol被描述成&lt;code&gt;TChannel&lt;/code&gt;，可搜索文档&lt;a href=&quot;https://www.jaegertracing.io/docs/1.11/deployment/&quot; target=&quot;_blank&quot;&gt;Deployment&lt;/a&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ docker run \
  -e SPAN_STORAGE_TYPE=memory \
  jaegertracing/jaeger-collector:1.11.0 \
  --help

...
--collector.port int    The TChannel port for the collector service (default 14267)
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;此外，端口&lt;code&gt;14250&lt;/code&gt;的说明也不够清楚，实际上它的Protocol是gRPC，也就是HTTP2：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;...
--collector.grpc-port int    The gRPC port for the collector service (default 14250)
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;以及，&lt;code&gt;14268&lt;/code&gt;：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;...
--collector.http-port int    The HTTP port for the collector service (default 14268)
...
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;41-jaeger-collector单独启动&quot;&gt;4.1 Jaeger Collector单独启动&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;#ID_APP_COLLECTOR_HELP&quot;&gt;jaeger-collector memory –help&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ docker run -d --name jaeger-collector \
  -e SPAN_STORAGE_TYPE=memory \
  -p 14267:14267 \
  -p 14268:14268 \
  -p 14250:14250 \
  jaegertracing/jaeger-collector:1.11.0
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;42-jaeger-agent单独启动&quot;&gt;4.2 Jaeger Agent单独启动&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;#ID_APP_AGENT_HELP&quot;&gt;jaeger-agent –help&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ docker run -d --name jaeger-agent \
  --link jaeger-collector \
  -p 5775:5775/udp \
  -p 6831:6831/udp \
  -p 6832:6832/udp \
  -p 5778:5778 \
  jaegertracing/jaeger-agent:1.11.0 \
  --reporter.type=grpc \
  --reporter.grpc.host-port=jaeger-collector:14250
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;43-jaeger-query单独启动&quot;&gt;4.3 Jaeger Query单独启动&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;#ID_APP_QUERY_HELP&quot;&gt;jaeger-query –help&lt;/a&gt;&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ docker run -d --name jaeger-query \
  --link jaeger-collector \
  -e SPAN_STORAGE_TYPE=memory \
  -p 16686:16686 \
  jaegertracing/jaeger-query:1.11.0
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&quot;5-jaeger高可用&quot;&gt;5. Jaeger高可用&lt;/h1&gt;
&lt;h2 id=&quot;51-metrics&quot;&gt;5.1 Metrics&lt;/h2&gt;
&lt;p&gt;Jaeger也兼容Prometheus格式的指标输出，有两个命令行参数：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;--metrics-backend&lt;/code&gt;：metrics暴露的格式，默认为&lt;code&gt;prometheus&lt;/code&gt;，&lt;code&gt;expvar&lt;/code&gt;可选&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;--metrics-http-route&lt;/code&gt;：metrics暴露的endpoint，默认为&lt;code&gt;/metrics&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;此外，几个端口需要了解下：&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Component&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;Port&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;jaeger-agent&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;5778&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;jaeger-collector&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;14268&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;jaeger-query&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;16686&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;jaeger-ingester&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;14271&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;&lt;br /&gt;&lt;/p&gt;

&lt;p&gt;范例都在本文下面的资料部分：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;#ID_APP_AGENT_METRICS&quot;&gt;jaeger-agent&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ID_APP_COLLECTOR_METRICS&quot;&gt;jaeger-collector&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#ID_APP_QUERY_METRICS&quot;&gt;jaeger-query&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;jaeger-ingester（这块启动需要的依赖太重，暂时没做尝试）&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;52-components&quot;&gt;5.2 Components&lt;/h2&gt;
&lt;p&gt;先说结论，Jaeger在高可用这块的设计和实现基本上是空白，很可能在某些极端情况下丢失Tracing的数据。&lt;/p&gt;

&lt;h3 id=&quot;521-client&quot;&gt;5.2.1 Client&lt;/h3&gt;
&lt;p&gt;Client因为只是应用程序的Lib部分，因此不涉及到任何高可用的概念。&lt;/p&gt;

&lt;h3 id=&quot;522-agent&quot;&gt;5.2.2 Agent&lt;/h3&gt;
&lt;p&gt;Agent部分就只是一个转发机关，我查了下对应的文档和网络没找到高可用的设计，此外错误处理基本上也是没有的。也就是说，如果Agent出问题，所有当前未发送缓存中的数据都会丢失，且从Client传输到Agent的数据也会丢失。&lt;/p&gt;

&lt;p&gt;见：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/1255&quot; target=&quot;_blank&quot;&gt;What happens when the jaeger-agent is down on a machine? #1255&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/1430&quot; target=&quot;_blank&quot;&gt;Jaeger Agent does not buffer spans when the Collector is unavailable #1430&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;523-collector&quot;&gt;5.2.3 Collector&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;p&gt;The collectors are stateless and thus many instances of jaeger-collector can be run in parallel.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;这和我一开始的理解有点不同。我之前认为对同个Trace的多个子Span的识别和清洗过滤等行为是在Collector这个环节处理的，但既然官方文档都说明Collector是无状态的了，那就不是了。Collector应该只负责简单的Validation然后就直接存储到后台的Data Store里了。&lt;/p&gt;

&lt;p&gt;如果对Agent配置了以&lt;code&gt;,&lt;/code&gt;分隔的多台无状态Collectors，而其中某台Down了会发生什么，后面需要做测试，按现在Jaeger对错误处理和可用性的支持来看，估计就是直接丢数据了。&lt;/p&gt;

&lt;p&gt;同个Trace的多个组成部分Span是否都到达，是否缺失了一部分，看来是没有任何处理和保证的。这也就是说：可能会有部分Trace在UI中可以查到，但其中组成部分的Spans是不完整的，部分缺失的。说实在的，这还蛮致命的。&lt;/p&gt;

&lt;h3 id=&quot;524-data-store&quot;&gt;5.2.4 Data Store&lt;/h3&gt;
&lt;p&gt;这块就完全由选择的后台数据存储设施自己负责了，Cassandra是出了名的好用，Kafka在扩展上也不错，但Kafka仅只能作为中间通道使用，官方文档描述为：&lt;code&gt;kafka (only as a buffer)&lt;/code&gt;。&lt;/p&gt;

&lt;h1 id=&quot;6-jaeger采样&quot;&gt;6. Jaeger采样&lt;/h1&gt;
&lt;p&gt;在&lt;a href=&quot;/2019/04/monitoring-tracing-logging/&quot; target=&quot;_blank&quot;&gt;Compare: Monitoring | Tracing | Logging&lt;/a&gt;里我已经提到过，tracing是一件频度相当高，且数据量很庞大的工作，因此其性能很可能有问题。Jaeger给了一个新的思路，就是按规则采样，而不是将所有发生的事件全部都发送并存储。&lt;/p&gt;

&lt;p&gt;这里需要说明的是采样的决策。如果一个链路很长的Trace，其中每一个Span都有权决定当前信息是否需要被采样，那么你就永远看不到一个完整的Trace了。组成Trace的A、B、C，Span A决定采样，B决定不采样，C决定采样，结果Trace就丢失了B部分数据。&lt;/p&gt;

&lt;p&gt;Jaeger采样的决策是在链路的第一节点就决定好了的，当前的Trace是否需要被采样，该决策做出之后，后续整个链路中所有的Span都需要按整个决策执行。这样就不会丢失数据了。&lt;/p&gt;

&lt;p&gt;见：&lt;a href=&quot;https://www.jaegertracing.io/docs/1.11/sampling/&quot; target=&quot;_blank&quot;&gt;Sampling&lt;/a&gt;。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;The sampling decision will be propagated with the requests to B and to C, so those services will not be making the sampling decision again but instead will respect the decision made by the top service A. This approach guarantees that if a trace is sampled, all its spans will be recorded in the backend. If each service was making its own sampling decision we would rarely get complete traces in the backend.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;关于采样的策略，官方也看到了不少问题，后续有一个正在制作中的功能&lt;code&gt;Adaptive Sampling&lt;/code&gt;，具体的问题和设计可以看：&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/365&quot; target=&quot;_blank&quot;&gt;Adaptive Sampling #365&lt;/a&gt;。简单来说就是可以按更复杂的策略进行采样的决策。&lt;/p&gt;

&lt;h2 id=&quot;61-client配置&quot;&gt;6.1 Client配置&lt;/h2&gt;
&lt;p&gt;最基础的策略，采样是按&lt;code&gt;Client&lt;/code&gt;的配置进行执行的，记住，这种情况下采样是在客户端做的，而不是服务器，而且每个客户端都可以做不同的策略。&lt;/p&gt;

&lt;p&gt;此外，光阅读文档可能会理解不全，可以查看issue来加深理解：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/832&quot; target=&quot;_blank&quot;&gt;How sampler.type=remote works #832&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;611-constant&quot;&gt;6.1.1 Constant&lt;/h3&gt;
&lt;p&gt;常量决策。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;类型：&lt;code&gt;sampler.type=const&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;值：
    &lt;ul&gt;
      &lt;li&gt;&lt;code&gt;sampler.param=1&lt;/code&gt;：全部采样&lt;/li&gt;
      &lt;li&gt;&lt;code&gt;sampler.param=0&lt;/code&gt;：全部丢弃&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;612-probabilistic&quot;&gt;6.1.2 Probabilistic&lt;/h3&gt;
&lt;p&gt;概率决策。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;类型：&lt;code&gt;sampler.type=probabilistic&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;值：&lt;code&gt;sampler.param=0.1&lt;/code&gt;表示 采样 1/10&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;613-rate-limiting&quot;&gt;6.1.3 Rate Limiting&lt;/h3&gt;
&lt;p&gt;频次策略。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;类型：&lt;code&gt;sampler.type=ratelimiting&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;值：&lt;code&gt;sampler.param=2.0&lt;/code&gt;表示 每秒 采样2次&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;614-remote&quot;&gt;6.1.4 Remote&lt;/h3&gt;
&lt;p&gt;远端决策。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;类型：&lt;code&gt;sampler.type=remote&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这种情况下，Client会把请求发到Agent，而Agent则会进行判断是否进行采样。实际的配置则是放在Collector上，参见下面的&lt;code&gt;6.2&lt;/code&gt;。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;sampler consults Jaeger agent for the appropriate sampling strategy to use in the current service.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;62-collector配置&quot;&gt;6.2 Collector配置&lt;/h2&gt;
&lt;p&gt;官方文档在：&lt;a href=&quot;https://www.jaegertracing.io/docs/1.11/sampling/#collector-sampling-configuration&quot; target=&quot;_blank&quot;&gt;Collector Sampling Configuration&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;在&lt;code&gt;Client&lt;/code&gt;采样策略配置为：&lt;code&gt;sampler.type=remote&lt;/code&gt;的情况下，Agent会向Collector进行采样策略询问，这部分配置是放在&lt;code&gt;Collector&lt;/code&gt;上的。需要在Collector启动的时候指定配置文件：&lt;code&gt;--sampling.strategies-file&lt;/code&gt;。见：&lt;a href=&quot;#ID_APP_COLLECTOR_HELP&quot;&gt;jaeger-collector memory –help&lt;/a&gt;。&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;This option requires a path to a json file which have the sampling strategies defined.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-json&quot; data-lang=&quot;json&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;quot;service_strategies&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;service&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;foo&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;probabilistic&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;param&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;operation_strategies&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;quot;operation&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;op1&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;probabilistic&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;quot;param&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.2&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;quot;operation&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;op2&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;probabilistic&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;nt&quot;&gt;&amp;quot;param&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.4&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;},&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;service&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;bar&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;ratelimiting&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;quot;param&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;],&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;quot;default_strategy&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;type&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&amp;quot;probabilistic&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;quot;param&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;0.5&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;service_strategies&lt;/code&gt;定义了服务级别的采样策略，&lt;code&gt;operation_strategies&lt;/code&gt;则定义了操作级别的采样策略。而实施的采样策略有两种可能：&lt;code&gt;概率策略&lt;/code&gt;和&lt;code&gt;频次策略&lt;/code&gt;（注意：操作级别的采样策略 不支持 频次策略）。&lt;code&gt;default_strategy&lt;/code&gt;定义了上述定义之外的情况下的采样策略。&lt;/p&gt;

&lt;p&gt;在上面的例子中：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;所有的&lt;code&gt;foo&lt;/code&gt;服务，都按0.8的概率策略进行采样&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;op1&lt;/code&gt;和&lt;code&gt;op2&lt;/code&gt;虽然属于&lt;code&gt;foo&lt;/code&gt;服务，但因为它们各自有自己的配置，因此按自己的配置实施，分别是0.2和0.4的概率策略&lt;/li&gt;
  &lt;li&gt;所有的&lt;code&gt;bar&lt;/code&gt;服务，都按每分钟5次的频次策略进行采样&lt;/li&gt;
  &lt;li&gt;除此之外的所有都按0.5的概率频次进行采样&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;7-jaeger监控&quot;&gt;7. Jaeger监控&lt;/h1&gt;
&lt;p&gt;也许是因为项目太年轻了，在监控实践的过程中实在是很难找到资料，无论是metrics指标的说明文档，还是实际操作起来的Grafana Dashboard，基本上都是空白。大量工作只能自己手动实践解决。&lt;/p&gt;

&lt;h2 id=&quot;71-exporter&quot;&gt;7.1 Exporter&lt;/h2&gt;
&lt;p&gt;Jaeger应用官方直接带了metrics输出，这方面就不需要找第三方的Exporter了。&lt;/p&gt;

&lt;p&gt;端口需要简单说明下。metrics输出端口都是各服务的HTTP端口，也就是说，默认：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;jaeger-agent：5778&lt;/li&gt;
  &lt;li&gt;jaeger-collector：14268&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;关于输出的metrics的说明没有找到对应的文档，官方有一个open的issue表示该工作在进行中：&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/1224&quot; target=&quot;_blank&quot;&gt;Is there a document to explain the specific meaning of various metrics? #1224&lt;/a&gt;，至少近期是没指望了。&lt;/p&gt;

&lt;p&gt;查找代码可以找到部分指标的简单说明：&lt;a href=&quot;https://github.com/jaegertracing/jaeger/blob/v1.11.0/cmd/collector/app/metrics.go#L30&quot; target=&quot;_blank&quot;&gt;jaeger/cmd/collector/app/metrics.go&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;72-grafana-dashboard&quot;&gt;7.2 Grafana Dashboard&lt;/h2&gt;
&lt;p&gt;在Grafana Labs简单查找了下，没有找到可以直接使用的Dashboard。确实能搜到几个Dashboard，但时间都比较久远，Jaeger的部分metrics已经改名了，导致这些Dashboard都无法正常使用，因此一般需要手动自制Dashboard。&lt;/p&gt;

&lt;p&gt;官方有意向提供开箱即用的Dashboard，阅读下这个issue：&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/789&quot; target=&quot;_blank&quot;&gt;Could we provide pre-made Grafana dashboards for Jaeger backend components? #789&lt;/a&gt;，但一样短期内不用指望了。&lt;/p&gt;

&lt;p&gt;Issue中提到的&lt;a href=&quot;https://github.com/grafana/jsonnet-libs/tree/master/jaeger-mixin&quot; target=&quot;_blank&quot;&gt;jsonnet-libs/jaeger-mixin/&lt;/a&gt;倒是可以花点时间简单过一下。虽然不能直接使用，但对自制Dashboard有点指导帮助。&lt;/p&gt;

&lt;h1 id=&quot;8-docker集群实践&quot;&gt;8. Docker集群实践&lt;/h1&gt;
&lt;h2 id=&quot;81-docker集群配置&quot;&gt;8.1 Docker集群配置&lt;/h2&gt;
&lt;p&gt;配置相对来说比较简单，范例地址：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/blob/master/golang/src/dist-system-practice/conf/dev/jaeger-cluster.yaml&quot; target=&quot;_blank&quot;&gt;dist-system-practice/conf/dev/jaeger-cluster.yaml&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;主要搞清楚端口号就行了，jaeger这块开的端口实在是太多了，容易搞混。不过实际上用得多的也就那几个。&lt;/p&gt;

&lt;h2 id=&quot;82-storage-schema&quot;&gt;8.2 Storage Schema&lt;/h2&gt;
&lt;p&gt;Jaeger支持的后端主要是Cassandra，对Elasticsearch的支持有，但只是二等的（版本更新、支持、响应都比Cassandra慢），所以如果可能，尽量使用Cassandra。&lt;/p&gt;

&lt;p&gt;实验项目中使用的后端存储为Cassandra，版本为：&lt;code&gt;3.11.4&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;Jaeger在使用之前，必须对后端存储设施进行Schema的初始化，也就是说要在数据库当中创建表才能使用，下文主要讲述Cassandra作为后端的使用经验，Elasticsearch相关请查阅官方文档：&lt;a href=&quot;https://github.com/jaegertracing/jaeger/blob/master/plugin/storage/es/README.md&quot; target=&quot;_blank&quot;&gt;ElasticSearch Support&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;使用Cassandra作为后端，其Schema相关的导入代码存放在：&lt;a href=&quot;https://github.com/jaegertracing/jaeger/tree/v1.11.0/plugin/storage/cassandra/schema&quot; target=&quot;_blank&quot;&gt;jaeger/plugin/storage/cassandra/schema/&lt;/a&gt;，虽然路径是plugin，但实际上是可以单独使用的。&lt;/p&gt;

&lt;p&gt;路径中存在两份&lt;code&gt;*.cql.tmpl&lt;/code&gt;，这实际上就是真正导入的SQL，如果不希望使用bash脚本工具，直接使用也是可以的，当然也需要像bash中的内容一样做一些准备和调整。关于cql相关，可以查看文档：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://cassandra.apache.org/doc/latest/cql/&quot; target=&quot;_blank&quot;&gt;The Cassandra Query Language (CQL)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.datastax.com/en/archived/cql/3.3/cql/cql_reference/cqlsh.html&quot; target=&quot;_blank&quot;&gt;Starting cqlsh&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;821-使用cqlsh导入&quot;&gt;8.2.1 使用cqlsh导入&lt;/h3&gt;
&lt;p&gt;&lt;code&gt;不推荐&lt;/code&gt;直接使用cqlsh这种方法，下面的7.2.2有更好的方法。&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ docker run -it --rm &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    --network dist_net &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    cassandra:3.11.4 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    cqlsh &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;si&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;si&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -u cassandra -p cassandra &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    -f &lt;span class=&quot;si&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;file_path&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;关于Cassandra的端口号，可以查看：&lt;a href=&quot;https://docs.datastax.com/en/archived/cassandra/3.0/cassandra/configuration/secureFireWall.html&quot; target=&quot;_blank&quot;&gt;Configuring firewall port access&lt;/a&gt;。cqlsh连接用的端口号为client用端口号，即：&lt;code&gt;9042&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;默认的用户名和密码：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;The default user is cassandra. The default password is cassandra. 
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;822-工具镜像导入&quot;&gt;8.2.2 工具镜像导入&lt;/h3&gt;
&lt;p&gt;实际上官方有一个docker镜像帮忙协助进行schema的创建，但你直接去看这个镜像你根本就不会知道这个镜像是干嘛的，因为什么文档都没有。官方的文档中也没提到过这个镜像，我是在google的时候搜到jaeger的维护者中某一个人的博客的时候才找到的，哎。。。只能说，怎么说呢，这文档工作。。。jaeger已经算是好的了，实际上。&lt;/p&gt;

&lt;p&gt;镜像：&lt;a href=&quot;https://hub.docker.com/r/jaegertracing/jaeger-cassandra-schema&quot; target=&quot;_blank&quot;&gt;jaegertracing/jaeger-cassandra-schema&lt;/a&gt;。使用方法可以查看博客里的范例：&lt;a href=&quot;https://medium.com/jaegertracing/jaeger-and-multitenancy-99dfa1d49dc0&quot; target=&quot;_blank&quot;&gt;Jaeger and multitenancy&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;例子已经比较老了，修改如下：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;$ docker run --rm &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --name jaeger-cassandra-schema &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  --network dist_net &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  -e &lt;span class=&quot;nv&quot;&gt;MODE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  -e &lt;span class=&quot;nv&quot;&gt;CQLSH_HOST&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;cas_1 &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  -e &lt;span class=&quot;nv&quot;&gt;KEYSPACE&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;jaeger_keyspace &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
  jaegertracing/jaeger-cassandra-schema:1.11.0&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;&lt;code&gt;KEYSPACE=jaeger_keyspace&lt;/code&gt;这个名字一定要记住，后面在架设集群的时候是需要提供给collector的。&lt;/p&gt;

&lt;p&gt;具体镜像做了什么，以及这个镜像可用的环境变量设置，可以查看：&lt;a href=&quot;https://github.com/jaegertracing/jaeger/blob/v1.11.0/plugin/storage/cassandra/schema/docker.sh&quot; target=&quot;_blank&quot;&gt;jaeger/plugin/storage/cassandra/schema/docker.sh&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;其实这些环境变量最后还是落实到执行的脚本create.sh里，所以需要查看环境变量的作用以及脚本做了什么，可以查看：&lt;a href=&quot;https://github.com/jaegertracing/jaeger/blob/v1.11.0/plugin/storage/cassandra/schema/create.sh&quot; target=&quot;_blank&quot;&gt;jaeger/plugin/storage/cassandra/schema/create.sh&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&quot;83-opentracing-coding-tutorial&quot;&gt;8.3 Opentracing Coding Tutorial&lt;/h2&gt;
&lt;p&gt;Opentracing Go官方是有Tutorial的：&lt;a href=&quot;https://github.com/yurishkuro/opentracing-tutorial/tree/master/go&quot; target=&quot;_blank&quot;&gt;OpenTracing Tutorial - Go&lt;/a&gt;。一样在官方文档里只字未提。&lt;/p&gt;

&lt;p&gt;这个tutorial对新了解opentracing的人，以及对需要学习opentracing client编码的人都很有帮助。范例举得相当不错。&lt;/p&gt;

&lt;h2 id=&quot;84-client-coding&quot;&gt;8.4 Client Coding&lt;/h2&gt;
&lt;p&gt;Jaeger集群架设完毕还不算结束，后面还需要编写客户端的集成代码。Opentracing的整体流程，以及trace、span等概念，首先需要阅读官方文档，以及7.3中提到的tutorial。&lt;/p&gt;

&lt;p&gt;这里要提一点，jaeger免不了会遇到rpc调用之间的上下文跨实体的情况，遇到这种情况，需要上游将trace相关信息&lt;code&gt;inject&lt;/code&gt;到请求中，然后在下游将trace信息&lt;code&gt;extract&lt;/code&gt;出来，根据extract的信息继续走之前的trace，这样才能保证跨实体的请求是在同一个trace中。相关细节可以查看7.3的tutorial中的第三节课。&lt;/p&gt;

&lt;p&gt;客户端代码怎么写，看下下面的文档基本上就了解了。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Opentracing官方文档：&lt;a href=&quot;https://opentracing.io/guides/golang/quick-start/&quot; target=&quot;_blank&quot;&gt;Quick Start&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;gRPC Interceptor插件，官方：&lt;a href=&quot;https://github.com/grpc-ecosystem/go-grpc-middleware/tree/master/tracing/opentracing&quot; target=&quot;_blank&quot;&gt;go-grpc-middleware/tracing/opentracing/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;gRPC非官方插件：&lt;a href=&quot;https://github.com/grpc-ecosystem/grpc-opentracing/tree/master/go/otgrpc&quot; target=&quot;_blank&quot;&gt;grpc-opentracing/go/otgrpc/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;对于一般的客户端使用看下官方文档就没什么问题了，gRPC稍微有点不同，官方提供了interceptor插件。至于这些插件怎么使用，可以查看范例：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc/grpc-go/blob/master/examples/features/interceptor/client/main.go&quot; target=&quot;_blank&quot;&gt;client/main.go&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc/grpc-go/blob/master/examples/features/interceptor/server/main.go&quot; target=&quot;_blank&quot;&gt;server/main.go&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;9-todo&quot;&gt;9. TODO&lt;/h1&gt;
&lt;p&gt;囿于当前使用的深度及项目调研的时间限制，有部分内容做的还不够深入，后续可以考虑补全：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Jaeger自身的几项Metrics深入研究：Agent、Collector、Query&lt;/li&gt;
  &lt;li&gt;Jaeger的Benchmark&lt;/li&gt;
  &lt;li&gt;特别需要关注Jaeger在高负载情况下的数据丢失情况&lt;/li&gt;
  &lt;li&gt;后端Data Store的选择问题&lt;/li&gt;
  &lt;li&gt;和gin混用的情况下，gRPC客户端的interceptor不会生效（服务端正常），很奇怪，需要后续debug&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;资料&quot;&gt;资料&lt;/h1&gt;
&lt;h2 id=&quot;链接&quot;&gt;链接&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://yq.aliyun.com/articles/514488&quot; target=&quot;_blank&quot;&gt;开放分布式追踪（OpenTracing）入门与 Jaeger 实现&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.jianshu.com/p/a963ad0bbe3e&quot; target=&quot;_blank&quot;&gt;OpenTracing语义标准规范及实现&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://medium.com/jaegertracing/the-life-of-a-span-ee508410200b&quot; target=&quot;_blank&quot;&gt;The life of a span&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/1255&quot; target=&quot;_blank&quot;&gt;What happens when the jaeger-agent is down on a machine? #1255&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/1430&quot; target=&quot;_blank&quot;&gt;Jaeger Agent does not buffer spans when the Collector is unavailable #1430&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/365&quot; target=&quot;_blank&quot;&gt;Adaptive Sampling #365&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/832&quot; target=&quot;_blank&quot;&gt;How sampler.type=remote works #832&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/jaegertracing/jaeger/issues/649&quot; target=&quot;_blank&quot;&gt;Integration with external logs storage when displaying traces #649&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://cassandra.apache.org/doc/latest/cql/&quot; target=&quot;_blank&quot;&gt;The Cassandra Query Language (CQL)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.datastax.com/en/archived/cql/3.3/cql/cql_reference/cqlsh.html&quot; target=&quot;_blank&quot;&gt;Starting cqlsh&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.datastax.com/en/archived/cassandra/3.0/cassandra/configuration/secureFireWall.html&quot; target=&quot;_blank&quot;&gt;Configuring firewall port access&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://hub.docker.com/r/jaegertracing/jaeger-cassandra-schema&quot; target=&quot;_blank&quot;&gt;jaegertracing/jaeger-cassandra-schema&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://medium.com/jaegertracing/jaeger-and-multitenancy-99dfa1d49dc0&quot; target=&quot;_blank&quot;&gt;Jaeger and multitenancy&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/yurishkuro/opentracing-tutorial/tree/master/go&quot; target=&quot;_blank&quot;&gt;OpenTracing Tutorial - Go&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grpc-ecosystem/grpc-opentracing/tree/master/go/otgrpc&quot; target=&quot;_blank&quot;&gt;grpc-opentracing/go/otgrpc/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;help&quot;&gt;Help&lt;/h2&gt;
&lt;h3 id=&quot;ID_APP_AGENT_HELP&quot;&gt;jaeger-agent –help&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;$ docker run --rm jaegertracing/jaeger-agent:1.11.0 --help

Jaeger agent is a daemon program that runs on every host and receives tracing data submitted by Jaeger client libraries.

Usage:
  jaeger-agent [flags]
  jaeger-agent [command]

Available Commands:
  help        Help about any command
  version     Print the version

Flags:
      --collector.host-port string                                Deprecated; comma-separated string representing host:ports of a static list of collectors to connect to directly (e.g. when not using service discovery)
      --config-file string                                        Configuration file in JSON, TOML, YAML, HCL, or Java properties formats (default none). See spf13/viper for precedence.
      --discovery.conn-check-timeout duration                     Deprecated; sets the timeout used when establishing new connections (default 250ms)
      --discovery.min-peers int                                   Deprecated; if using service discovery, the min number of connections to maintain to the backend (default 3)
  -h, --help                                                      help for jaeger-agent
      --http-server.host-port string                              host:port of the http server (e.g. for /sampling point and /baggageRestrictions endpoint) (default &quot;:5778&quot;)
      --log-level string                                          Minimal allowed log Level. For more levels see https://github.com/uber-go/zap (default &quot;info&quot;)
      --metrics-backend string                                    Defines which metrics backend to use for metrics reporting: expvar, prometheus, none (default &quot;prometheus&quot;)
      --metrics-http-route string                                 Defines the route of HTTP endpoint for metrics backends that support scraping (default &quot;/metrics&quot;)
      --processor.jaeger-binary.server-host-port string           host:port for the UDP server (default &quot;:6832&quot;)
      --processor.jaeger-binary.server-max-packet-size int        max packet size for the UDP server (default 65000)
      --processor.jaeger-binary.server-queue-size int             length of the queue for the UDP server (default 1000)
      --processor.jaeger-binary.workers int                       how many workers the processor should run (default 10)
      --processor.jaeger-compact.server-host-port string          host:port for the UDP server (default &quot;:6831&quot;)
      --processor.jaeger-compact.server-max-packet-size int       max packet size for the UDP server (default 65000)
      --processor.jaeger-compact.server-queue-size int            length of the queue for the UDP server (default 1000)
      --processor.jaeger-compact.workers int                      how many workers the processor should run (default 10)
      --processor.zipkin-compact.server-host-port string          host:port for the UDP server (default &quot;:5775&quot;)
      --processor.zipkin-compact.server-max-packet-size int       max packet size for the UDP server (default 65000)
      --processor.zipkin-compact.server-queue-size int            length of the queue for the UDP server (default 1000)
      --processor.zipkin-compact.workers int                      how many workers the processor should run (default 10)
      --reporter.grpc.host-port string                            Comma-separated string representing host:port of a static list of collectors to connect to directly.
      --reporter.grpc.retry.max uint                              Sets the maximum number of retries for a call. (default 3)
      --reporter.grpc.tls                                         Enable TLS.
      --reporter.grpc.tls.ca string                               Path to a TLS CA file. (default use the systems truststore)
      --reporter.grpc.tls.server-name string                      Override the TLS server name.
      --reporter.tchannel.discovery.conn-check-timeout duration   sets the timeout used when establishing new connections (default 250ms)
      --reporter.tchannel.discovery.min-peers int                 if using service discovery, the min number of connections to maintain to the backend (default 3)
      --reporter.tchannel.host-port string                        comma-separated string representing host:ports of a static list of collectors to connect to directly (e.g. when not using service discovery)
      --reporter.tchannel.report-timeout duration                 sets the timeout used when reporting spans (default 1s)
      --reporter.type string                                      Reporter type to use e.g. grpc, tchannel (default &quot;grpc&quot;)

Use &quot;jaeger-agent [command] --help&quot; for more information about a command.
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;ID_APP_COLLECTOR_HELP&quot;&gt;jaeger-collector memory –help&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;$ docker run --rm -e SPAN_STORAGE_TYPE=memory jaegertracing/jaeger-collector:1.11.0 --help

Jaeger collector receives traces from Jaeger agents and runs them through a processing pipeline.

Usage:
  jaeger-collector [flags]
  jaeger-collector [command]

Available Commands:
  env         Help about environment variables
  help        Help about any command
  version     Print the version

Flags:
      --collector.grpc-port int           The gRPC port for the collector service (default 14250)
      --collector.grpc.tls                Enable TLS
      --collector.grpc.tls.cert string    Path to TLS certificate file
      --collector.grpc.tls.key string     Path to TLS key file
      --collector.http-port int           The HTTP port for the collector service (default 14268)
      --collector.num-workers int         The number of workers pulling items from the queue (default 50)
      --collector.port int                The TChannel port for the collector service (default 14267)
      --collector.queue-size int          The queue size of the collector (default 2000)
      --collector.zipkin.http-port int    The HTTP port for the Zipkin collector service e.g. 9411
      --config-file string                Configuration file in JSON, TOML, YAML, HCL, or Java properties formats (default none). See spf13/viper for precedence.
      --health-check-http-port int        The http port for the health check service (default 14269)
  -h, --help                              help for jaeger-collector
      --log-level string                  Minimal allowed log Level. For more levels see https://github.com/uber-go/zap (default &quot;info&quot;)
      --memory.max-traces int             The maximum amount of traces to store in memory
      --metrics-backend string            Defines which metrics backend to use for metrics reporting: expvar, prometheus, none (default &quot;prometheus&quot;)
      --metrics-http-route string         Defines the route of HTTP endpoint for metrics backends that support scraping (default &quot;/metrics&quot;)
      --sampling.strategies-file string   The path for the sampling strategies file in JSON format. See sampling documentation to see format of the file
      --span-storage.type string          Deprecated; please use SPAN_STORAGE_TYPE environment variable. Run this binary with &quot;env&quot; command for help.

Use &quot;jaeger-collector [command] --help&quot; for more information about a command.
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;ID_APP_QUERY_HELP&quot;&gt;jaeger-query –help&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;$ docker run --rm jaegertracing/jaeger-query:1.11.0 --help

Jaeger query service provides a Web UI and an API for accessing trace data.

Usage:
  jaeger-query [flags]
  jaeger-query [command]

Available Commands:
  env         Help about environment variables
  help        Help about any command
  version     Print the version

Flags:
      --cassandra...
      --config-file string                              Configuration file in JSON, TOML, YAML, HCL, or Java properties formats (default none). See spf13/viper for precedence.
      --health-check-http-port int                      The http port for the health check service (default 16687)
  -h, --help                                            help for jaeger-query
      --log-level string                                Minimal allowed log Level. For more levels see https://github.com/uber-go/zap (default &quot;info&quot;)
      --metrics-backend string                          Defines which metrics backend to use for metrics reporting: expvar, prometheus, none (default &quot;prometheus&quot;)
      --metrics-http-route string                       Defines the route of HTTP endpoint for metrics backends that support scraping (default &quot;/metrics&quot;)
      --query.base-path string                          The base path for all HTTP routes, e.g. /jaeger; useful when running behind a reverse proxy (default &quot;/&quot;)
      --query.port int                                  The port for the query service (default 16686)
      --query.static-files string                       The directory path override for the static assets for the UI
      --query.ui-config string                          The path to the UI configuration file in JSON format
      --span-storage.type string                        Deprecated; please use SPAN_STORAGE_TYPE environment variable. Run this binary with &quot;env&quot; command for help.

Use &quot;jaeger-query [command] --help&quot; for more information about a command.
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;metrics&quot;&gt;Metrics&lt;/h2&gt;
&lt;h3 id=&quot;ID_APP_AGENT_METRICS&quot;&gt;jaeger-agent metrics&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# HELP go_gc_duration_seconds A summary of the GC invocation durations.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE go_gc_duration_seconds summary&lt;/span&gt;
...
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_collector_proxy_total collector-proxy&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_collector_proxy_total counter&lt;/span&gt;
jaeger_agent_collector_proxy_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;endpoint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;baggage&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_collector_proxy_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;endpoint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;baggage&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_collector_proxy_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;endpoint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;sampling&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_collector_proxy_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;endpoint&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;sampling&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_http_server_errors_total http-server.errors&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_http_server_errors_total counter&lt;/span&gt;
jaeger_agent_http_server_errors_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;all&amp;quot;&lt;/span&gt;,status&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;4xx&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_http_server_errors_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;collector-proxy&amp;quot;&lt;/span&gt;,status&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5xx&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_http_server_errors_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;thrift&amp;quot;&lt;/span&gt;,status&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5xx&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_http_server_errors_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;source&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;write&amp;quot;&lt;/span&gt;,status&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5xx&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_http_server_requests_total http-server.requests&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_http_server_requests_total counter&lt;/span&gt;
jaeger_agent_http_server_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;baggage&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_http_server_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;sampling&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_http_server_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;sampling-legacy&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_reporter_batch_size batch_size&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_reporter_batch_size gauge&lt;/span&gt;
jaeger_agent_reporter_batch_size&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_reporter_batch_size&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_reporter_batches_failures_total batches.failures&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_reporter_batches_failures_total counter&lt;/span&gt;
jaeger_agent_reporter_batches_failures_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_reporter_batches_failures_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_reporter_batches_submitted_total batches.submitted&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_reporter_batches_submitted_total counter&lt;/span&gt;
jaeger_agent_reporter_batches_submitted_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_reporter_batches_submitted_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_reporter_spans_failures_total spans.failures&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_reporter_spans_failures_total counter&lt;/span&gt;
jaeger_agent_reporter_spans_failures_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_reporter_spans_failures_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_reporter_spans_submitted_total spans.submitted&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_reporter_spans_submitted_total counter&lt;/span&gt;
jaeger_agent_reporter_spans_submitted_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_reporter_spans_submitted_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;grpc&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_thrift_udp_server_packet_size thrift.udp.server.packet_size&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_thrift_udp_server_packet_size gauge&lt;/span&gt;
jaeger_agent_thrift_udp_server_packet_size&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_server_packet_size&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_server_packet_size&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_thrift_udp_server_packets_dropped_total thrift.udp.server.packets.dropped&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_thrift_udp_server_packets_dropped_total counter&lt;/span&gt;
jaeger_agent_thrift_udp_server_packets_dropped_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_server_packets_dropped_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_server_packets_dropped_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_thrift_udp_server_packets_processed_total thrift.udp.server.packets.processed&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_thrift_udp_server_packets_processed_total counter&lt;/span&gt;
jaeger_agent_thrift_udp_server_packets_processed_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_server_packets_processed_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_server_packets_processed_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_thrift_udp_server_queue_size thrift.udp.server.queue_size&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_thrift_udp_server_queue_size gauge&lt;/span&gt;
jaeger_agent_thrift_udp_server_queue_size&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_server_queue_size&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_server_queue_size&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_thrift_udp_server_read_errors_total thrift.udp.server.read.errors&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_thrift_udp_server_read_errors_total counter&lt;/span&gt;
jaeger_agent_thrift_udp_server_read_errors_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_server_read_errors_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_server_read_errors_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_thrift_udp_t_processor_close_time thrift.udp.t-processor.close-time&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_thrift_udp_t_processor_close_time histogram&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_close_time_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_agent_thrift_udp_t_processor_handler_errors_total thrift.udp.t-processor.handler-errors&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_agent_thrift_udp_t_processor_handler_errors_total counter&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_handler_errors_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;binary&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_handler_errors_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_agent_thrift_udp_t_processor_handler_errors_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;model&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,protocol&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;compact&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP process_cpu_seconds_total Total user and system CPU time spent in seconds.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_cpu_seconds_total counter&lt;/span&gt;
process_cpu_seconds_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;.05
&lt;span class=&quot;c1&quot;&gt;# HELP process_max_fds Maximum number of open file descriptors.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_max_fds gauge&lt;/span&gt;
process_max_fds &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.048576e+06
&lt;span class=&quot;c1&quot;&gt;# HELP process_open_fds Number of open file descriptors.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_open_fds gauge&lt;/span&gt;
process_open_fds &lt;span class=&quot;m&quot;&gt;11&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP process_resident_memory_bytes Resident memory size in bytes.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_resident_memory_bytes gauge&lt;/span&gt;
process_resident_memory_bytes &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.3283328e+07
&lt;span class=&quot;c1&quot;&gt;# HELP process_start_time_seconds Start time of the process since unix epoch in seconds.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_start_time_seconds gauge&lt;/span&gt;
process_start_time_seconds &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.55540751234e+09
&lt;span class=&quot;c1&quot;&gt;# HELP process_virtual_memory_bytes Virtual memory size in bytes.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_virtual_memory_bytes gauge&lt;/span&gt;
process_virtual_memory_bytes &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.22187776e+08&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;ID_APP_COLLECTOR_METRICS&quot;&gt;jaeger-collector metrics&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# HELP go_gc_duration_seconds A summary of the GC invocation durations.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE go_gc_duration_seconds summary&lt;/span&gt;
...
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_batch_size batch-size&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_batch_size gauge&lt;/span&gt;
jaeger_collector_batch_size&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_in_queue_latency in-queue-latency&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_in_queue_latency histogram&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_in_queue_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_queue_length queue-length&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_queue_length gauge&lt;/span&gt;
jaeger_collector_queue_length&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_save_latency save-latency&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_save_latency histogram&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_save_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_spans_dropped_total spans.dropped&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_spans_dropped_total counter&lt;/span&gt;
jaeger_collector_spans_dropped_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_spans_received_total received&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_spans_received_total counter&lt;/span&gt;
jaeger_collector_spans_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;unknown&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;unknown&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_spans_rejected_total rejected&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_spans_rejected_total counter&lt;/span&gt;
jaeger_collector_spans_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;unknown&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;unknown&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_spans_saved_by_svc_total saved-by-svc&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_spans_saved_by_svc_total counter&lt;/span&gt;
jaeger_collector_spans_saved_by_svc_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_saved_by_svc_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_saved_by_svc_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_spans_saved_by_svc_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_spans_serviceNames spans.serviceNames&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_spans_serviceNames gauge&lt;/span&gt;
jaeger_collector_spans_serviceNames&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1bd33f303256&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_traces_received_total received&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_traces_received_total counter&lt;/span&gt;
jaeger_collector_traces_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;unknown&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;unknown&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_received_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_traces_rejected_total rejected&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_traces_rejected_total counter&lt;/span&gt;
jaeger_collector_traces_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;unknown&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;jaeger&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;unknown&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_rejected_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,format&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;zipkin&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_collector_traces_saved_by_svc_total saved-by-svc&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_collector_traces_saved_by_svc_total counter&lt;/span&gt;
jaeger_collector_traces_saved_by_svc_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_saved_by_svc_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;false&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_saved_by_svc_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_collector_traces_saved_by_svc_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;debug&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;true&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,svc&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;other-services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP process_cpu_seconds_total Total user and system CPU time spent in seconds.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_cpu_seconds_total counter&lt;/span&gt;
process_cpu_seconds_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;.71
&lt;span class=&quot;c1&quot;&gt;# HELP process_max_fds Maximum number of open file descriptors.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_max_fds gauge&lt;/span&gt;
process_max_fds &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.048576e+06
&lt;span class=&quot;c1&quot;&gt;# HELP process_open_fds Number of open file descriptors.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_open_fds gauge&lt;/span&gt;
process_open_fds &lt;span class=&quot;m&quot;&gt;11&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP process_resident_memory_bytes Resident memory size in bytes.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_resident_memory_bytes gauge&lt;/span&gt;
process_resident_memory_bytes &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.9329024e+07
&lt;span class=&quot;c1&quot;&gt;# HELP process_start_time_seconds Start time of the process since unix epoch in seconds.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_start_time_seconds gauge&lt;/span&gt;
process_start_time_seconds &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.55540675992e+09
&lt;span class=&quot;c1&quot;&gt;# HELP process_virtual_memory_bytes Virtual memory size in bytes.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_virtual_memory_bytes gauge&lt;/span&gt;
process_virtual_memory_bytes &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.3008896e+08&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h3 id=&quot;ID_APP_QUERY_METRICS&quot;&gt;jaeger-query metrics&lt;/h3&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# HELP go_gc_duration_seconds A summary of the GC invocation durations.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE go_gc_duration_seconds summary&lt;/span&gt;
...
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_query_latency latency&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_query_latency histogram&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_latency_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_query_requests_total requests&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_query_requests_total counter&lt;/span&gt;
jaeger_query_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_requests_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,result&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_query_responses responses&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_query_responses histogram&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_trace_ids&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;find_traces&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_operations&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_services&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.005&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.01&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.025&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.05&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.25&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;1&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;2.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;10&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_bucket&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;,le&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;+Inf&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_sum&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_query_responses_count&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;operation&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;get_trace&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_baggage_restrictions_updates_total Number of times baggage restrictions were successfully updated&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_baggage_restrictions_updates_total counter&lt;/span&gt;
jaeger_tracer_baggage_restrictions_updates_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_tracer_baggage_restrictions_updates_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_baggage_truncations_total Number of times baggage was truncated as per baggage restrictions&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_baggage_truncations_total counter&lt;/span&gt;
jaeger_tracer_baggage_truncations_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_baggage_updates_total Number of times baggage was successfully written or updated on spans&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_baggage_updates_total counter&lt;/span&gt;
jaeger_tracer_baggage_updates_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_tracer_baggage_updates_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_finished_spans_total Number of spans finished by this tracer&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_finished_spans_total counter&lt;/span&gt;
jaeger_tracer_finished_spans_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_reporter_queue_length Current number of spans in the reporter queue&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_reporter_queue_length gauge&lt;/span&gt;
jaeger_tracer_reporter_queue_length &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_reporter_spans_total Number of spans successfully reported&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_reporter_spans_total counter&lt;/span&gt;
jaeger_tracer_reporter_spans_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;dropped&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_tracer_reporter_spans_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_tracer_reporter_spans_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_sampler_queries_total Number of times the Sampler succeeded to retrieve sampling strategy&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_sampler_queries_total counter&lt;/span&gt;
jaeger_tracer_sampler_queries_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_tracer_sampler_queries_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_sampler_updates_total Number of times the Sampler succeeded to retrieve and update sampling strategy&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_sampler_updates_total counter&lt;/span&gt;
jaeger_tracer_sampler_updates_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_tracer_sampler_updates_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_span_context_decoding_errors_total Number of errors decoding tracing context&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_span_context_decoding_errors_total counter&lt;/span&gt;
jaeger_tracer_span_context_decoding_errors_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_started_spans_total Number of sampled spans started by this tracer&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_started_spans_total counter&lt;/span&gt;
jaeger_tracer_started_spans_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sampled&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;n&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_tracer_started_spans_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sampled&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;y&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_throttled_debug_spans_total Number of times debug spans were throttled&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_throttled_debug_spans_total counter&lt;/span&gt;
jaeger_tracer_throttled_debug_spans_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_throttler_updates_total Number of times throttler successfully updated&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_throttler_updates_total counter&lt;/span&gt;
jaeger_tracer_throttler_updates_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;err&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_tracer_throttler_updates_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;ok&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP jaeger_tracer_traces_total Number of traces started by this tracer as sampled&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE jaeger_tracer_traces_total counter&lt;/span&gt;
jaeger_tracer_traces_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sampled&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;n&amp;quot;&lt;/span&gt;,state&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;joined&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_tracer_traces_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sampled&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;n&amp;quot;&lt;/span&gt;,state&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;started&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_tracer_traces_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sampled&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;y&amp;quot;&lt;/span&gt;,state&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;joined&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
jaeger_tracer_traces_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;sampled&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;y&amp;quot;&lt;/span&gt;,state&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;started&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP process_cpu_seconds_total Total user and system CPU time spent in seconds.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_cpu_seconds_total counter&lt;/span&gt;
process_cpu_seconds_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;.09
&lt;span class=&quot;c1&quot;&gt;# HELP process_max_fds Maximum number of open file descriptors.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_max_fds gauge&lt;/span&gt;
process_max_fds &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.048576e+06
&lt;span class=&quot;c1&quot;&gt;# HELP process_open_fds Number of open file descriptors.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_open_fds gauge&lt;/span&gt;
process_open_fds &lt;span class=&quot;m&quot;&gt;9&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP process_resident_memory_bytes Resident memory size in bytes.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_resident_memory_bytes gauge&lt;/span&gt;
process_resident_memory_bytes &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.4475264e+07
&lt;span class=&quot;c1&quot;&gt;# HELP process_start_time_seconds Start time of the process since unix epoch in seconds.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_start_time_seconds gauge&lt;/span&gt;
process_start_time_seconds &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.55540951442e+09
&lt;span class=&quot;c1&quot;&gt;# HELP process_virtual_memory_bytes Virtual memory size in bytes.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE process_virtual_memory_bytes gauge&lt;/span&gt;
process_virtual_memory_bytes &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;.31395584e+08&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;EOF&lt;/p&gt;
&lt;/blockquote&gt;
</description>
				<pubDate>Wed, 17 Apr 2019 10:01:22 +0800</pubDate>
				<link>https://xenojoshua.com/2019/04/jaeger-note/</link>
				<guid isPermaLink="true">https://xenojoshua.com/2019/04/jaeger-note/</guid>
			</item>
		
			<item>
				<title>Compare: Monitoring | Tracing | Logging</title>
				<description>&lt;h4&gt;Table of Contents&lt;/h4&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#1-monitoring--tracing--logging&quot; id=&quot;markdown-toc-1-monitoring--tracing--logging&quot;&gt;1. Monitoring &amp;amp; Tracing &amp;amp; Logging&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2-monitoring&quot; id=&quot;markdown-toc-2-monitoring&quot;&gt;2. Monitoring&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#3-tracing&quot; id=&quot;markdown-toc-3-tracing&quot;&gt;3. Tracing&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#4-logging&quot; id=&quot;markdown-toc-4-logging&quot;&gt;4. Logging&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#5-总结&quot; id=&quot;markdown-toc-5-总结&quot;&gt;5. 总结&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;1-monitoring--tracing--logging&quot;&gt;1. Monitoring &amp;amp; Tracing &amp;amp; Logging&lt;/h1&gt;
&lt;p&gt;对于一个系统来说，标题中提到的这三者需求都是必然存在的，而有的时候我们会搞不清楚这三者相互之间是什么关系。我之前在做系统设计的时候也考虑过，是不是有必要引入那么多组件，毕竟如果这三者完全分开每一个一项的话，就有三个组件了（事实上就是：Prometheus+Grafana、Jaeger、ELK）。&lt;/p&gt;

&lt;p&gt;因此想做个笔记尝试举例来梳理下。&lt;/p&gt;

&lt;p&gt;外部链接：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://peter.bourgon.org/blog/2017/02/21/metrics-tracing-and-logging.html&quot; target=&quot;_blank&quot;&gt;Metrics, tracing, and logging&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;2-monitoring&quot;&gt;2. Monitoring&lt;/h1&gt;
&lt;p&gt;Monitoring（监控）举例来说就是：&lt;code&gt;定期体检&lt;/code&gt;。使用监控系统把需要关注的指标采集起来，形成报告，并对需要关注的异常数据进行分析形成告警。&lt;/p&gt;

&lt;p&gt;特点是：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;低频&lt;/li&gt;
  &lt;li&gt;定期&lt;/li&gt;
  &lt;li&gt;定量&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这也是Prometheus的架构做得非常简单的原因，Monitoring的需求并没有包含非常高的并发量和通讯量。反过来说：高并发、大数据量的需求并不适用于Monitoring这个点。&lt;/p&gt;

&lt;h1 id=&quot;3-tracing&quot;&gt;3. Tracing&lt;/h1&gt;
&lt;p&gt;Tracing（链路追踪）举例来说就是：&lt;code&gt;对某一项工作的定期汇报&lt;/code&gt;。某个工作开始做了A，制作A事件的报告，收集起来，然后这个工作还有B、C、D等条目，一个个处理，然后都汇总进报告，最终的结果就是一个Tracing。&lt;/p&gt;

&lt;p&gt;特点是：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;高频&lt;/li&gt;
  &lt;li&gt;巨量&lt;/li&gt;
  &lt;li&gt;有固定格式&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;因为Tracing是针对某一个事件（一般来说就是一个API），而这个API可能会和很多组件进行沟通，后续的所有的组件沟通无论是内部还是外部的IO，都算作这个API调用的Tracing的一部分。可以想见在一个业务繁忙的系统中，API调用的数量已经是天文数字，而其衍生出来的Tracing记录更是不得了的量。其特点就是高频、巨量，一个API会衍生出大量的子调用。&lt;/p&gt;

&lt;p&gt;也因此适合用来做Monitoring的系统就不一定适合做Tracing了，用Prometheus这样的系统来做Tracing肯定完蛋（Prometheus只有拉模式，全部都是HTTP请求，高并发直接挂掉）。一般来说Tracing系统都会在本地磁盘IO上做日志（最高效、也是最低的Cost），然后再通过本地Agent慢慢把文本日志数据发送到聚合服务器上，甚至可能在聚合服务器和本地的Agent之间还需要做消息队列，让聚合服务器慢慢消化巨量的消息。&lt;/p&gt;

&lt;p&gt;Tracing在现在的业界是有标准的：&lt;code&gt;OpenTracing&lt;/code&gt;，因此它不是很随意的日志/事件聚合，而是有格式要求的日志/事件聚合，这就是Tracing和Logging最大的不同。&lt;/p&gt;

&lt;h1 id=&quot;4-logging&quot;&gt;4. Logging&lt;/h1&gt;
&lt;p&gt;Logging（日志）举例来说就是：&lt;code&gt;废品回收站&lt;/code&gt;。各种各样的物品都会汇总进入到配品回收站里，然后经过分门别类归纳整理，成为各种可回收资源分别回收到商家那里。一般来说我们在大型系统中提到Logging说的都不是简单的&lt;code&gt;日志&lt;/code&gt;，而是&lt;code&gt;日志聚合系统&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;从本质上来说，Monitoring和Tracing都是Logging，Logging是这三者中覆盖面最大的超集，而前两者则是其一部分的子集。Logging最麻烦的是，开发者也不会完全知道最后记录进入到日志系统里的一共会有哪些东西，只有在使用（检索）的时候才可能需要汇总查询总量中的一部分。&lt;/p&gt;

&lt;p&gt;要在一般的Loggin系统中进行Monitoring也是可以的，直接把聚合进来的日志数据提取出来，定期形成数据报告，就是监控了。Tracing也是一样，只要聚合进了Logging系统，有了原始数据，后面要做都是可以做的。因此Logging系统最为通用，其特点和Tracing基本一致，也是需要处理高频并发和巨大的数据量。&lt;/p&gt;

&lt;h1 id=&quot;5-总结&quot;&gt;5. 总结&lt;/h1&gt;
&lt;p&gt;这样一看就很清楚了，每个组件都有其存在的必要性：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Monitoring系统（Prometheus）从根本的需求和基本设计上就不可能支持Tracing和Logging：低频 vs 高频、低量 vs 高量，其从设计到实现就只为了监控服务&lt;/li&gt;
  &lt;li&gt;Tracing系统（Jaeger）对提供的数据有格式要求，且处理方式和一般的Logging也不同，有更限定的应用范围&lt;/li&gt;
  &lt;li&gt;Logging系统（ELK）可以处理前两者的需求，但前两者的领域有更专业的工具就不推荐直接使用普通的日志聚合系统了；Logging系统一般用来处理大型系统的日志聚合以及检索查询&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;EOF&lt;/p&gt;
&lt;/blockquote&gt;
</description>
				<pubDate>Fri, 12 Apr 2019 10:01:22 +0800</pubDate>
				<link>https://xenojoshua.com/2019/04/monitoring-tracing-logging/</link>
				<guid isPermaLink="true">https://xenojoshua.com/2019/04/monitoring-tracing-logging/</guid>
			</item>
		
			<item>
				<title>Grafana Notes</title>
				<description>&lt;h4&gt;Table of Contents&lt;/h4&gt;
&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#1-前言&quot; id=&quot;markdown-toc-1-前言&quot;&gt;1. 前言&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#2-安装--文件位置--启动&quot; id=&quot;markdown-toc-2-安装--文件位置--启动&quot;&gt;2. 安装 &amp;amp; 文件位置 &amp;amp; 启动&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#21-安装&quot; id=&quot;markdown-toc-21-安装&quot;&gt;2.1 安装&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#22-文件位置&quot; id=&quot;markdown-toc-22-文件位置&quot;&gt;2.2 文件位置&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#23-配置文件&quot; id=&quot;markdown-toc-23-配置文件&quot;&gt;2.3 配置文件&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#24-启动&quot; id=&quot;markdown-toc-24-启动&quot;&gt;2.4 启动&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#25-cli&quot; id=&quot;markdown-toc-25-cli&quot;&gt;2.5 CLI&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#26-登录--访问&quot; id=&quot;markdown-toc-26-登录--访问&quot;&gt;2.6 登录 &amp;amp; 访问&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#3-概念&quot; id=&quot;markdown-toc-3-概念&quot;&gt;3. 概念&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#4-使用简介&quot; id=&quot;markdown-toc-4-使用简介&quot;&gt;4. 使用简介&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#41-日常使用&quot; id=&quot;markdown-toc-41-日常使用&quot;&gt;4.1 日常使用&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#42-数据保存--导出&quot; id=&quot;markdown-toc-42-数据保存--导出&quot;&gt;4.2 数据保存 &amp;amp; 导出&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#43-数据源&quot; id=&quot;markdown-toc-43-数据源&quot;&gt;4.3 数据源&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#5-监控指标&quot; id=&quot;markdown-toc-5-监控指标&quot;&gt;5. 监控指标&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#6-docker实践&quot; id=&quot;markdown-toc-6-docker实践&quot;&gt;6. Docker实践&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#61-docker安装&quot; id=&quot;markdown-toc-61-docker安装&quot;&gt;6.1 Docker安装&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#62-compose配置&quot; id=&quot;markdown-toc-62-compose配置&quot;&gt;6.2 Compose配置&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#63-provisioning&quot; id=&quot;markdown-toc-63-provisioning&quot;&gt;6.3 Provisioning&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#64-dashboard&quot; id=&quot;markdown-toc-64-dashboard&quot;&gt;6.4 Dashboard&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#641-variables&quot; id=&quot;markdown-toc-641-variables&quot;&gt;6.4.1 Variables&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#7-todo&quot; id=&quot;markdown-toc-7-todo&quot;&gt;7. TODO&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#8-写在最后&quot; id=&quot;markdown-toc-8-写在最后&quot;&gt;8. 写在最后&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#资料&quot; id=&quot;markdown-toc-资料&quot;&gt;资料&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#链接&quot; id=&quot;markdown-toc-链接&quot;&gt;链接&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ID_APP_GRAFANA_HELP&quot; id=&quot;markdown-toc-ID_APP_GRAFANA_HELP&quot;&gt;grafana -h&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ID_APP_SELF_METRICS&quot; id=&quot;markdown-toc-ID_APP_SELF_METRICS&quot;&gt;grafana/metrics&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;1-前言&quot;&gt;1. 前言&lt;/h1&gt;
&lt;p&gt;Grafana常被用作数据展示界面，虽然实际上它还有很多其他相关的功能，但一般都不会使用。在CNCF的项目中，一般Grafana都和Prometheus结合使用。Grafana的最大优势在于其灵活性，它作为数据界面可以利用相当多种类的后台数据源。在我构想中的系统里，ELK也是相当重要的一个组成部分，而Grafana也可以作为ElasticSearch的前台界面，这就相当好用。&lt;/p&gt;

&lt;p&gt;由于其相当于仅只是一个UI，所以本文中架构之类的内容基本上会很少，主要是概念介绍和使用细节方面的。&lt;/p&gt;

&lt;p&gt;下文所有内容都基于版本：&lt;code&gt;v6.1.2&lt;/code&gt;。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ ./bin/grafana-server -v
Version 6.1.2 (commit: de8f6ac, branch: HEAD)
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&quot;2-安装--文件位置--启动&quot;&gt;2. 安装 &amp;amp; 文件位置 &amp;amp; 启动&lt;/h1&gt;
&lt;h2 id=&quot;21-安装&quot;&gt;2.1 安装&lt;/h2&gt;
&lt;p&gt;官方文档：&lt;a href=&quot;https://grafana.com/grafana/download&quot; target=&quot;_blank&quot;&gt;Download Grafana&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;官方站点做得很好，直接按指示操作即可。MAC安装很方便，使用brew装是最佳选择，另外也可以wget下载tar包，解压即用。Go应用程序就这点，真的太赞了。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;brew update 
brew install grafana

or

wget https://dl.grafana.com/oss/release/grafana-6.1.2.darwin-amd64.tar.gz 
tar -zxvf grafana-6.1.2.darwin-amd64.tar.gz
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;22-文件位置&quot;&gt;2.2 文件位置&lt;/h2&gt;
&lt;p&gt;解压出来的Grafana文件夹可以简单看一下，基本上运行的文件位置就是按这个安排的：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;bin                 # grafana-server &amp;amp; grafana-cli
conf                # 配置文件夹
data \              # 运行时产生的文件，刚解压出来时还不存在
     | log          # 日志输出
     | plugins      # 安装的第三方插件等
     | png
     | grafana.db   # sqlite3数据库
public              # 展示相关的内容，HTML、CSS等
scripts             # bash脚本，忽略
tools               # 忽略
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;上面的&lt;code&gt;data&lt;/code&gt;文件夹及里面的内容等，都是默认的配置文件的设定，如果没有特殊需求，一般直接这样运行就可以了。&lt;/p&gt;

&lt;p&gt;如果将Grafana的运行文件夹指定在某个位置的话，一些文件夹是可能需要调整（配置文件中）：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ini&quot; data-lang=&quot;ini&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# Path to where grafana can store temp files, sessions, and the sqlite3 db (if that is used)&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;data/grafana&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Directory where grafana can store logs&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;logs&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;log&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Directory where grafana will automatically scan and look for plugins&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;plugins&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;data/grafana/plugins&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# folder that contains provisioning config files that grafana will apply on startup and while running.&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;provisioning&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;conf/provisioning&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# the path relative working path&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;static_root_path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;data/grafana/public&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;上面的所有文件夹实际上都是相对路径，相对于Grafana启动时候指定的工作路径：&lt;code&gt;--homepath&lt;/code&gt;。&lt;/p&gt;

&lt;h2 id=&quot;23-配置文件&quot;&gt;2.3 配置文件&lt;/h2&gt;
&lt;p&gt;官方文档：&lt;a href=&quot;https://grafana.com/docs/installation/configuration/&quot; target=&quot;_blank&quot;&gt;Configuration&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;配置文件中的选项基本上和运行时和监控关系不大，都是一些设置向的内容，配置过一次之后就不需要变动了。一些可能需要关心的选项：&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-ini&quot; data-lang=&quot;ini&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# Protocol (http, https, socket)&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;protocol&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;http&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# The ip address to bind to, empty will bind to all interfaces&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;http_addr&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;127.0.0.1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# The http port to use&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;http_port&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;3000&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# The public facing domain name used to access grafana from a browser&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;domain&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;localhost&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Either &amp;quot;mysql&amp;quot;, &amp;quot;postgres&amp;quot; or &amp;quot;sqlite3&amp;quot;, it&amp;#39;s your choice&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;sqlite3&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Server reporting, sends usage counters to stats.grafana.org every 24 hours.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# No ip addresses are being tracked, only simple counters to track&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# running instances, dashboard and error counts. It is very helpful to us.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Change this option to false to disable reporting.&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;reporting_enabled&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Set to false to disable all checks to https://grafana.com&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# for new versions (grafana itself and plugins), check is used&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# in some UI views to notify that grafana or plugin update exists&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# This option does not cause any auto updates, nor send any information&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# only a GET request to https://grafana.com to get latest versions&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;check_for_updates&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# disable user signup / registration&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;allow_sign_up&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;false&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# Allow non admin users to create organizations&lt;/span&gt;
&lt;span class=&quot;na&quot;&gt;allow_org_create&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;false&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h2 id=&quot;24-启动&quot;&gt;2.4 启动&lt;/h2&gt;
&lt;p&gt;启动这块就有个让人很头疼的事情，真的让我始料未及。&lt;/p&gt;

&lt;p&gt;让Grafana作为一个WEB应用启动，需要用到的是&lt;code&gt;bin/grafana-server&lt;/code&gt;这个命令，其帮助可以在&lt;a href=&quot;#ID_APP_GRAFANA_HELP&quot;&gt;资料&lt;/a&gt;查看。&lt;/p&gt;

&lt;p&gt;有用的参数只有两个：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;--config&lt;/code&gt;：指定配置文件位置&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;--homepath&lt;/code&gt;：指定Grafana工作的根目录&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如果是将下载下来的Grafana直接解包运行，不更改路径的话，那就不需要任何启动参数，直接运行即可。但如果需要更改运行根目录的话，就需要使用&lt;code&gt;--homepath&lt;/code&gt;这个选项：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ ./bin/grafana-server --homepath &quot;/Users/XXX/.../&quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;而我遇到的问题是&lt;code&gt;--config&lt;/code&gt;这个选项，无论我指定任何内容：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;相对于&lt;code&gt;--homepath&lt;/code&gt;的相对文件位置：&lt;code&gt;config/grafana/grafana.ini&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;相对于&lt;code&gt;--homepath&lt;/code&gt;的相对文件夹：&lt;code&gt;config/grafana/&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;绝对文件路径：&lt;code&gt;/Users/XXX/.../config/grafana/grafana.ini&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;绝对文件夹：&lt;code&gt;/Users/XXX/.../config/grafana/&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;它都不能正常工作，只会返回给我错误：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Grafana-server Init Failed: Could not find config defaults, make sure homepath command line parameter is set or working directory is homepath&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;真的让人相当恼火，官方文档里还有这块的解说，但说了根本就和没说一个样：&lt;a href=&quot;https://grafana.com/docs/installation/configuration/#config-file-locations&quot; target=&quot;_blank&quot;&gt;Config file locations&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;最后只能使用：&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;Default configuration from $WORKING_DIR/conf/defaults.ini&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;也就是在默认的配置文件位置上放上文件：&lt;code&gt;${--homepath}/conf/defaults.ini&lt;/code&gt;，才正常工作起来，哎。&lt;/p&gt;

&lt;h2 id=&quot;25-cli&quot;&gt;2.5 CLI&lt;/h2&gt;
&lt;p&gt;官方文档：&lt;a href=&quot;https://grafana.com/docs/administration/cli/&quot; target=&quot;_blank&quot;&gt;Grafana CLI&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;Grafana还提供了一个命令行工具来辅助admin平时的操作：&lt;code&gt;bin/grafana-cli&lt;/code&gt;，使用可以看：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ ./bin/grafana-cli -h
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;26-登录--访问&quot;&gt;2.6 登录 &amp;amp; 访问&lt;/h2&gt;
&lt;p&gt;默认第一次使用的用户名和密码是：&lt;code&gt;admin:admin&lt;/code&gt;，第一次登录进去之后系统就会要求更改admin密码。访问地址在配置文件里是可以更改的，默认为：&lt;code&gt;http://localhost:3000&lt;/code&gt;。&lt;/p&gt;

&lt;h1 id=&quot;3-概念&quot;&gt;3. 概念&lt;/h1&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code&gt;DataSource&lt;/code&gt;：数据源，Grafana仅只是一个UI，真正保存数据的是数据源，根据版本不同支持的数据源可能不尽相同，有需要可以查看官方文档：&lt;a href=&quot;https://grafana.com/docs/features/datasources/&quot; target=&quot;_blank&quot;&gt;Data Source Overview&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;用户 &amp;amp; 权限：
    &lt;ul&gt;
      &lt;li&gt;&lt;code&gt;Organization&lt;/code&gt;：组织，用在多个组织部门使用同一个Grafana的情况，可以根据组织的不同区分可访问的面板&lt;/li&gt;
      &lt;li&gt;&lt;code&gt;User&lt;/code&gt;：用户&lt;/li&gt;
      &lt;li&gt;&lt;code&gt;Role&lt;/code&gt;：角色，目前暂时只支持固定的角色：Admin、Editor、Read Only Editor、Viewer，相关：&lt;a href=&quot;https://github.com/grafana/grafana/issues/9877&quot; target=&quot;_blank&quot;&gt;How to create new user roles? #9877&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;code&gt;Panel&lt;/code&gt;：面板，Grafana的核心，实际上负责进行图形展示的单元，类型非常多，有需要可以查看官方文档：&lt;a href=&quot;https://grafana.com/docs/features/panels/graph/&quot; target=&quot;_blank&quot;&gt;Graph Panel&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;Row&lt;/code&gt;：行，Dashboard的下级逻辑分隔概念，一个Row里可以放入很多Panel，而且这里需要理解Row并不是物理上的&lt;code&gt;行&lt;/code&gt;（实际上一个Row可以容纳很多行Panel）&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;Dashboard&lt;/code&gt;：仪表盘，由大量Panel组成的集合，一般来说Dashboard是按某个目标进行设计的，比如说：机房的当前状况，某个应用的服务状况等&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;Plugins&lt;/code&gt;：插件，提供更多的额外功能集成，官方商店在：&lt;a href=&quot;https://grafana.com/plugins&quot; target=&quot;_blank&quot;&gt;Plugins&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;Playlist&lt;/code&gt;：举例来说就是某些大公司在门口做的数据滚动播放展示，类似那样的功能，官方文档：&lt;a href=&quot;https://grafana.com/docs/reference/playlist/&quot; target=&quot;_blank&quot;&gt;Playlist&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;Provisioning&lt;/code&gt;：通过配置文件的方式对DataSource及Dashboard进行设置，这是Grafana在使用API进行相关设置之外的另一种方法，且其不要求Grafana首先启动，使用上更为便利&lt;/li&gt;
  &lt;li&gt;&lt;code&gt;Templating&lt;/code&gt;：模板，对某些共性的Panel或Dashboard进行抽象，以便后续进行复用&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Provisioning官方文档：&lt;a href=&quot;https://grafana.com/docs/administration/provisioning/&quot; target=&quot;_blank&quot;&gt;Provisioning Grafana&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;在以前的Grafana版本中，你只能使用API来配置数据源和仪表盘，但是，这需要在开始创建仪表板之前运行服务，并且还需要为HTTP API设置证书。在v5.0中，我们决定通过添加使用配置文件的新的活动Provisioning系统来改善这种体验，这将使GitOps更加自然，因为可以通过可以进行版本控制的文件来定义数据源和仪表盘，我们希望扩展此系统以便稍后添加对用户，组织和警报的支持。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h1 id=&quot;4-使用简介&quot;&gt;4. 使用简介&lt;/h1&gt;
&lt;h1 id=&quot;41-日常使用&quot;&gt;4.1 日常使用&lt;/h1&gt;
&lt;p&gt;理解了上面的概念之后，日常功能无非就是以下几项：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;创建User&lt;/li&gt;
  &lt;li&gt;创建organization&lt;/li&gt;
  &lt;li&gt;管理User和Organization以及Roles&lt;/li&gt;
  &lt;li&gt;创建Dashboard，需要根据实际应用场景进行规划&lt;/li&gt;
  &lt;li&gt;创建Rows，如果有必要的话&lt;/li&gt;
  &lt;li&gt;在Dashboard上创建Panel&lt;/li&gt;
  &lt;li&gt;将Panel及Dashboard做成Templating复用，如果有必要的话&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;42-数据保存--导出&quot;&gt;4.2 数据保存 &amp;amp; 导出&lt;/h1&gt;
&lt;p&gt;Dashboard在面板上面的工具栏里有&lt;code&gt;Settings&lt;/code&gt;选项，进入之后有一项&lt;code&gt;JSON Model&lt;/code&gt;，这就是当前Dashboard的所有内容了，都做成了JSON文本进行描述。如果你查看过Grafana的数据库的话，你也可以看到Dashboard表只有一列，是用来存储这个数据的，其他任何地方都没有和Dashboard的内容相关的字段。只要复制了这个字段，也就完成了当前Dashboard的备份，当然也可以将这个JSON字符串做成*.json文件进行备份。&lt;/p&gt;

&lt;p&gt;Panel也有类似的功能，在Panel的Title进行点击，会有下拉菜单，然后&lt;code&gt;More &amp;gt; Panel Json&lt;/code&gt;就是了。&lt;/p&gt;

&lt;h1 id=&quot;43-数据源&quot;&gt;4.3 数据源&lt;/h1&gt;
&lt;p&gt;Grafana支持多种数据源，根据不同数据源有不同的一些细微的功能差别以及配置差别，可以查看官方文档：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://grafana.com/docs/features/datasources/prometheus/&quot; target=&quot;_blank&quot;&gt;Using Prometheus in Grafana&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://grafana.com/docs/features/datasources/elasticsearch/&quot; target=&quot;_blank&quot;&gt;Using Elasticsearch in Grafana&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这里面最有可能会用得到的就是&lt;code&gt;Templating&lt;/code&gt;相关内容，在制作数据模板的时候很有用。&lt;/p&gt;

&lt;p&gt;Grafana和ELK相整合的文章可以看这篇：&lt;a href=&quot;https://elkguide.elasticsearch.cn/elasticsearch/other/grafana.html&quot; target=&quot;_blank&quot;&gt;ELKstack 中文指南 &amp;gt; Grafana&lt;/a&gt;。&lt;/p&gt;

&lt;h1 id=&quot;5-监控指标&quot;&gt;5. 监控指标&lt;/h1&gt;
&lt;p&gt;Grafana做的好就好在其和其他监控系统的集成相当好，Grafana自身的相关监控指标也可以和Prometheus一样暴露出来，使用的格式也是Prometheus的格式，默认是在：&lt;code&gt;http://localhost:3000/metrics&lt;/code&gt;。&lt;/p&gt;

&lt;p&gt;我在本文中也留了一份，有必要可以研究下里面的内容：&lt;a href=&quot;#ID_APP_SELF_METRICS&quot;&gt;grafana/metrics&lt;/a&gt;。&lt;/p&gt;

&lt;h1 id=&quot;6-docker实践&quot;&gt;6. Docker实践&lt;/h1&gt;
&lt;p&gt;接下来的章节会从实践的角度来尝试在容器中安装和使用Grafana。数据源皆为Prometheus，此后不再备注。&lt;/p&gt;

&lt;h2 id=&quot;61-docker安装&quot;&gt;6.1 Docker安装&lt;/h2&gt;
&lt;p&gt;在容器内安装官方有指导文档：&lt;a href=&quot;https://grafana.com/docs/installation/docker/&quot; target=&quot;_blank&quot;&gt;Installing using Docker&lt;/a&gt;。主要了解几个重点：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;配置文件中的选项如何使用env参数来进行调整，如何进行配置名字映射：&lt;a href=&quot;https://grafana.com/docs/installation/docker/#configuration&quot; target=&quot;_blank&quot;&gt;Configuration&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;容器内的一些路径，以及如何调整这些默认路径：&lt;a href=&quot;https://grafana.com/docs/installation/docker/#default-paths&quot; target=&quot;_blank&quot;&gt;Default Paths&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;如何在启动时就自动安装插件（保证启动完成立即可用）：&lt;a href=&quot;https://grafana.com/docs/installation/docker/#installing-plugins-for-grafana&quot; target=&quot;_blank&quot;&gt;Installing Plugins for Grafana&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;映射volume，保证数据不会被清除：&lt;a href=&quot;https://grafana.com/docs/installation/docker/#grafana-container-with-persistent-storage-recommended&quot; target=&quot;_blank&quot;&gt;Grafana container with persistent storage &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;62-compose配置&quot;&gt;6.2 Compose配置&lt;/h2&gt;
&lt;p&gt;可运行的docker compose配置文件范例，参见：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/blob/master/golang/src/dist-system-practice/conf/dev/prometheus-cluster.yaml&quot; target=&quot;_blank&quot;&gt;dist-system-practice/conf/dev/prometheus-cluster.yaml&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;重点是&lt;code&gt;environment&lt;/code&gt;部分。&lt;/p&gt;

&lt;h2 id=&quot;63-provisioning&quot;&gt;6.3 Provisioning&lt;/h2&gt;
&lt;p&gt;既然已经要求Grafana在容器内使用，那么一般也就要做到启动即可用。Grafana在使用之前一般需要几步配置：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;用户、密码管理&lt;/li&gt;
  &lt;li&gt;数据源配置&lt;/li&gt;
  &lt;li&gt;Dashboard配置&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;用户和密码之类的设置，可用通过容器的env配置解决，而数据源和Dashboard就比较麻烦了。Grafana官方提供了一个解决方案，非常好用：&lt;a href=&quot;https://grafana.com/docs/administration/provisioning/&quot; target=&quot;_blank&quot;&gt;Provisioning Grafana&lt;/a&gt;。简单来说就是提供两个配置文件，一个用来告诉Grafana启动时需要输入的数据源有哪些，另一个告诉Grafana启动时候需要导入的Dashboard有哪些。&lt;/p&gt;

&lt;p&gt;存储provisioning配置文件的指定路径在之前6.1中提到的默认路径中有，一般使用bind mount的方式将本地的provisioning配置文件导入到容器中。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;GF_PATHS_PROVISIONING=/etc/grafana/provisioning
&lt;/code&gt;&lt;/pre&gt;

&lt;ul&gt;
  &lt;li&gt;数据源配置文件范例，参见：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/blob/master/golang/src/dist-system-practice/prometheus/grafana/provisioning/datasources/datasource.yaml&quot; target=&quot;_blank&quot;&gt;dist-system-practice/prometheus/grafana/provisioning/datasources/datasource.yaml&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Dashboard配置文件范例，参见：&lt;a href=&quot;https://github.com/agreatfool/dist-system-practice/blob/master/golang/src/dist-system-practice/prometheus/grafana/provisioning/dashboards/providers.yaml&quot; target=&quot;_blank&quot;&gt;dist-system-practice/prometheus/grafana/provisioning/dashboards/providers.yaml&lt;/a&gt;。实际上就是指定一个文件夹，一般也是用bind mount的方式mapping到容器内即可。&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;64-dashboard&quot;&gt;6.4 Dashboard&lt;/h2&gt;
&lt;p&gt;Grafana的灵活和强大在Dashboard上体现无疑，关键好用在于不仅仅界面美观、功能强大，而且还可以模板化，可导入导出，做到一次编写后续自动安装、更新。官方还有一个&lt;a href=&quot;https://grafana.com/dashboards&quot;&gt;Grafana Labs &amp;gt; Dashboards&lt;/a&gt;，类似于插件中心的地方，方便社区将做好的Dashboard进行分享。&lt;/p&gt;

&lt;p&gt;一般常用的组件，只要简单搜索下就可以找到可用的Dashboard，大大降低了监控的难度，加速了研发的进程。&lt;/p&gt;

&lt;h3 id=&quot;641-variables&quot;&gt;6.4.1 Variables&lt;/h3&gt;
&lt;p&gt;这里简单说下在进行Dashboard模板化的时候常见的variables设置问题。一般来说，在一个系统中，同角色的设备不会只有单个节点，大多数情况都会有多个节点，比如说web服务器、数据库服务器等。在进行监控的时候，只需要制作一份Grafana Dashboard，将里面的参数变量化，就可以将这个Dashboard模板化，方便后续使用。&lt;/p&gt;

&lt;p&gt;而模板化最关键就是要将节点做成可配置的变量，这里就需要进行Dashboard的variables设置。进入到Dashboard的Setting中，左边列表里就有variables设置的入口，设置方法可以参见下图：&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/resources/2019/04/grafana-note/grafana-dashboard-variables.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;h1 id=&quot;7-todo&quot;&gt;7. TODO&lt;/h1&gt;
&lt;p&gt;囿于当前使用的深度及项目调研的时间限制，有部分内容做的还不够深入，后续可以考虑补全：&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Grafana本身的性能，应该如何衡量&lt;/li&gt;
  &lt;li&gt;Grafana暴露出来的&lt;a href=&quot;#ID_APP_SELF_METRICS&quot;&gt;Metrics&lt;/a&gt;需要仔细研究下&lt;/li&gt;
  &lt;li&gt;所有的图表全部尝试一遍&lt;/li&gt;
  &lt;li&gt;热力图的应用范围及实际使用范例&lt;/li&gt;
  &lt;li&gt;常用 &amp;amp; 有用的插件列表整理&lt;/li&gt;
  &lt;li&gt;ELK整合使用必要性调研，Kibana是否够用，是否有必要使用Grafana作为ELK的前台UI&lt;/li&gt;
  &lt;li&gt;ELK结合使用范例&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&quot;8-写在最后&quot;&gt;8. 写在最后&lt;/h1&gt;
&lt;p&gt;了解Metrics的含义才是最关键的，就像我在写Prometheus Notes说的，很多exporter会吐出巨量的Metrics数据，你都了解这些Metrics代表的意义吗？如果不了解的话，那些数据即便采集进去了，你又会去用了？说到底Prometheus和Grafana不过就是个工具，关键还是在于工程师想要了解什么，对自己的系统的监控需求是什么。&lt;/p&gt;

&lt;p&gt;监控相关工作的第一步是梳理当前系统的组成组件，将每一个都列出来，将它们负责的职责明确清楚，然后将需要监控的Metrics都枚举出来，将这些Metrics需要做成的表类型都想清楚，最后才是使用Prometheus采集数据，使用Grafana制图。&lt;/p&gt;

&lt;p&gt;和写代码一样，优秀的工程师花的更多的时间是在思考和设计上，而不是实际的编写代码。如果不理解这点，那就永远只能是二流。&lt;/p&gt;

&lt;h1 id=&quot;资料&quot;&gt;资料&lt;/h1&gt;
&lt;h2 id=&quot;链接&quot;&gt;链接&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/grafana/grafana/issues/9877&quot; target=&quot;_blank&quot;&gt;How to create new user roles? #9877&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://elkguide.elasticsearch.cn/elasticsearch/other/grafana.html&quot; target=&quot;_blank&quot;&gt;ELKstack 中文指南 &amp;gt; Grafana&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://kiswo.com/article/1021&quot; target=&quot;_blank&quot;&gt;Grafana使用&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://yunlzheng.gitbook.io/prometheus-book/part-ii-prometheus-jin-jie/grafana/grafana-panels&quot; target=&quot;_blank&quot;&gt;Grafana与数据可视化&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ID_APP_GRAFANA_HELP&quot;&gt;grafana -h&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;$ ./bin/grafana-server -h
Usage of ./bin/grafana-server:
  -config string
    	path to config file
  -homepath string
    	path to grafana install/home path, defaults to working directory
  -packaging string
    	describes the way Grafana was installed (default &quot;unknown&quot;)
  -pidfile string
    	path to pid file
  -profile
    	Turn on pprof profiling
  -profile-port int
    	Define custom port for profiling (default 6060)
  -test.bench regexp
    	run only benchmarks matching regexp
  -test.benchmem
    	print memory allocations for benchmarks
  -test.benchtime d
    	run each benchmark for duration d (default 1s)
  -test.blockprofile file
    	write a goroutine blocking profile to file
  -test.blockprofilerate rate
    	set blocking profile rate (see runtime.SetBlockProfileRate) (default 1)
  -test.count n
    	run tests and benchmarks n times (default 1)
  -test.coverprofile file
    	write a coverage profile to file
  -test.cpu list
    	comma-separated list of cpu counts to run each test with
  -test.cpuprofile file
    	write a cpu profile to file
  -test.failfast
    	do not start new tests after the first test failure
  -test.list regexp
    	list tests, examples, and benchmarks matching regexp then exit
  -test.memprofile file
    	write an allocation profile to file
  -test.memprofilerate rate
    	set memory allocation profiling rate (see runtime.MemProfileRate)
  -test.mutexprofile string
    	write a mutex contention profile to the named file after execution
  -test.mutexprofilefraction int
    	if &amp;gt;= 0, calls runtime.SetMutexProfileFraction() (default 1)
  -test.outputdir dir
    	write profiles to dir
  -test.parallel n
    	run at most n tests in parallel (default 8)
  -test.run regexp
    	run only tests and examples matching regexp
  -test.short
    	run smaller test suite to save time
  -test.testlogfile file
    	write test action log to file (for use only by cmd/go)
  -test.timeout d
    	panic test binary after duration d (default 0, timeout disabled)
  -test.trace file
    	write an execution trace to file
  -test.v
    	verbose: print additional output
  -v	prints current version and exits
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&quot;ID_APP_SELF_METRICS&quot;&gt;grafana/metrics&lt;/h2&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-bash&quot; data-lang=&quot;bash&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;# HELP grafana_alerting_active_alerts amount of active alerts&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_alerting_active_alerts gauge&lt;/span&gt;
grafana_alerting_active_alerts &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_alerting_execution_time_milliseconds summary of alert exeuction duration&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_alerting_execution_time_milliseconds summary&lt;/span&gt;
grafana_alerting_execution_time_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_alerting_execution_time_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.9&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_alerting_execution_time_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.99&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_alerting_execution_time_milliseconds_sum &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_alerting_execution_time_milliseconds_count &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_admin_user_created_total api admin user created counter&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_admin_user_created_total counter&lt;/span&gt;
grafana_api_admin_user_created_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_dashboard_get_milliseconds summary for dashboard get duration&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_dashboard_get_milliseconds summary&lt;/span&gt;
grafana_api_dashboard_get_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dashboard_get_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.9&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dashboard_get_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.99&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dashboard_get_milliseconds_sum &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_api_dashboard_get_milliseconds_count &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_dashboard_save_milliseconds summary for dashboard save duration&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_dashboard_save_milliseconds summary&lt;/span&gt;
grafana_api_dashboard_save_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dashboard_save_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.9&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dashboard_save_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.99&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dashboard_save_milliseconds_sum &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_api_dashboard_save_milliseconds_count &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_dashboard_search_milliseconds summary for dashboard search duration&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_dashboard_search_milliseconds summary&lt;/span&gt;
grafana_api_dashboard_search_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dashboard_search_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.9&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dashboard_search_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.99&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dashboard_search_milliseconds_sum &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_api_dashboard_search_milliseconds_count &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_dashboard_snapshot_create_total dashboard snapshots created&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_dashboard_snapshot_create_total counter&lt;/span&gt;
grafana_api_dashboard_snapshot_create_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_dashboard_snapshot_external_total external dashboard snapshots created&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_dashboard_snapshot_external_total counter&lt;/span&gt;
grafana_api_dashboard_snapshot_external_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_dashboard_snapshot_get_total loaded dashboards&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_dashboard_snapshot_get_total counter&lt;/span&gt;
grafana_api_dashboard_snapshot_get_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_dataproxy_request_all_milliseconds summary for dataproxy request duration&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_dataproxy_request_all_milliseconds summary&lt;/span&gt;
grafana_api_dataproxy_request_all_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.5&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dataproxy_request_all_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.9&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dataproxy_request_all_milliseconds&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;quantile&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;0.99&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; NaN
grafana_api_dataproxy_request_all_milliseconds_sum &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_api_dataproxy_request_all_milliseconds_count &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_login_oauth_total api login oauth counter&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_login_oauth_total counter&lt;/span&gt;
grafana_api_login_oauth_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_login_post_total api login post counter&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_login_post_total counter&lt;/span&gt;
grafana_api_login_post_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_models_dashboard_insert_total dashboards inserted &lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_models_dashboard_insert_total counter&lt;/span&gt;
grafana_api_models_dashboard_insert_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_org_create_total api org created counter&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_org_create_total counter&lt;/span&gt;
grafana_api_org_create_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_response_status_total api http response status&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_response_status_total counter&lt;/span&gt;
grafana_api_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;200&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_api_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;404&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_api_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_api_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;unknown&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_user_signup_completed_total amount of users who completed the signup flow&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_user_signup_completed_total counter&lt;/span&gt;
grafana_api_user_signup_completed_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_user_signup_invite_total amount of users who have been invited&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_user_signup_invite_total counter&lt;/span&gt;
grafana_api_user_signup_invite_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_api_user_signup_started_total amount of users who started the signup flow&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_api_user_signup_started_total counter&lt;/span&gt;
grafana_api_user_signup_started_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_aws_cloudwatch_get_metric_data_total counter for getting metric data time series from aws&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_aws_cloudwatch_get_metric_data_total counter&lt;/span&gt;
grafana_aws_cloudwatch_get_metric_data_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_aws_cloudwatch_get_metric_statistics_total counter for getting metric statistics from aws&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_aws_cloudwatch_get_metric_statistics_total counter&lt;/span&gt;
grafana_aws_cloudwatch_get_metric_statistics_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_aws_cloudwatch_list_metrics_total counter for getting list of metrics from aws&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_aws_cloudwatch_list_metrics_total counter&lt;/span&gt;
grafana_aws_cloudwatch_list_metrics_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_build_info A metric with a constant &amp;#39;1&amp;#39; value labeled by version, revision, branch, and goversion from which Grafana was built.&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_build_info gauge&lt;/span&gt;
grafana_build_info&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;branch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;HEAD&amp;quot;&lt;/span&gt;,edition&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;oss&amp;quot;&lt;/span&gt;,goversion&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;go1.11.5&amp;quot;&lt;/span&gt;,revision&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;de8f6ac&amp;quot;&lt;/span&gt;,version&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;6.1.2&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_db_datasource_query_by_id_total counter for getting datasource by id&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_db_datasource_query_by_id_total counter&lt;/span&gt;
grafana_db_datasource_query_by_id_total &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_info Information about the Grafana. This metric is deprecated. please use `grafana_build_info`&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_info gauge&lt;/span&gt;
grafana_info&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;version&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;6.1.2&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_instance_start_total counter for started instances&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_instance_start_total counter&lt;/span&gt;
grafana_instance_start_total &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_page_response_status_total page http response status&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_page_response_status_total counter&lt;/span&gt;
grafana_page_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;200&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_page_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;404&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_page_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_page_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;unknown&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_proxy_response_status_total proxy http response status&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_proxy_response_status_total counter&lt;/span&gt;
grafana_proxy_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;200&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_proxy_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;404&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_proxy_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;500&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
grafana_proxy_response_status_total&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;code&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&amp;quot;unknown&amp;quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_stat_active_users number of active users&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_stat_active_users gauge&lt;/span&gt;
grafana_stat_active_users &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_stat_total_orgs total amount of orgs&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_stat_total_orgs gauge&lt;/span&gt;
grafana_stat_total_orgs &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_stat_total_playlists total amount of playlists&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_stat_total_playlists gauge&lt;/span&gt;
grafana_stat_total_playlists &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_stat_total_users total amount of users&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_stat_total_users gauge&lt;/span&gt;
grafana_stat_total_users &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# HELP grafana_stat_totals_dashboard total amount of dashboards&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;# TYPE grafana_stat_totals_dashboard gauge&lt;/span&gt;
grafana_stat_totals_dashboard &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;blockquote&gt;
  &lt;p&gt;EOF&lt;/p&gt;
&lt;/blockquote&gt;
</description>
				<pubDate>Thu, 11 Apr 2019 10:01:22 +0800</pubDate>
				<link>https://xenojoshua.com/2019/04/grafana-note/</link>
				<guid isPermaLink="true">https://xenojoshua.com/2019/04/grafana-note/</guid>
			</item>
		
	</channel>
</rss>
