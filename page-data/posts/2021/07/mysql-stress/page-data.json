{
    "componentChunkName": "component---src-templates-post-template-post-template-tsx",
    "path": "/posts/2021/07/mysql-stress",
    "result": {"data":{"markdownRemark":{"id":"2f03a372-b33d-58b6-a369-b53ff2e55a39","html":"<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#1-foreword\">1. Foreword</a>\n<ul>\n<li><a href=\"#scenario\">Scenario</a></li>\n</ul>\n</li>\n<li><a href=\"#2-db-metrics\">2. DB Metrics</a></li>\n<li><a href=\"#3-determine-stress\">3. Determine Stress</a></li>\n<li><a href=\"#4-prepare-sql-statements\">4. Prepare SQL Statements</a></li>\n<li><a href=\"#5-prepare-lua-script\">5. Prepare LUA script</a></li>\n<li><a href=\"#6-run-the-test\">6. Run the test</a></li>\n<li><a href=\"#others\">Others</a>\n<ul>\n<li><a href=\"#optimize-table\">Optimize table</a></li>\n<li><a href=\"#test-the-server-io-first\">Test the server io first</a></li>\n</ul>\n</li>\n<li><a href=\"#reference\">Reference</a></li>\n<li><a href=\"#appendix\">Appendix</a>\n<ul>\n<li><a href=\"#sysbench---help\">sysbench —help</a></li>\n<li><a href=\"#sysbench-fileio-help\">sysbench fileio help</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<h2 id=\"1-foreword\" style=\"position:relative;\"><a href=\"#1-foreword\" aria-label=\"1 foreword permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. Foreword</h2>\n<p>In this article we will go through how to do a RDBMS stress test using tool <code class=\"language-text\">sysbench</code>. In the article we are talking about <code class=\"language-text\">MySQL</code>, as sysbench also supports other DBs like <code class=\"language-text\">PostgreSQL</code>, you can replace MySQL with other DBs according to your requirement.</p>\n<h3 id=\"scenario\" style=\"position:relative;\"><a href=\"#scenario\" aria-label=\"scenario permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scenario</h3>\n<p>Say we have a BE application like this:</p>\n<p><img src=\"/media/posts/2021/07/mysql-stress/mysql-app.png\" alt=\"\"></p>\n<p>It contains several application containers and several DB instances, each app would establish one connection to each DB instance.</p>\n<p>Then we’d like to know under the target / high stress, what will happen to the DB instance, would they be able to handle the stress with ease or crash.</p>\n<p>To figure out this, we can’t simply use a client process to send batch of duplicated SQL queries to DB instance. We need to mock the business like our BE app would do.</p>\n<p>So several steps we need to do.</p>\n<h2 id=\"2-db-metrics\" style=\"position:relative;\"><a href=\"#2-db-metrics\" aria-label=\"2 db metrics permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. DB Metrics</h2>\n<p>First we need to figure out what’s the metrics we need to monitor in the stress test.</p>\n<p>Basically:</p>\n<ul>\n<li>MySQL instance CPU usage</li>\n<li>MySQL instance Memory usage</li>\n<li>MySQL connection amount</li>\n<li>MySQL query amount</li>\n<li>MySQL table lock wait: <code class=\"language-text\">show status;</code> -> <code class=\"language-text\">table_locks_waited</code></li>\n<li>MySQL innodb lock wait: <code class=\"language-text\">show status like 'innodb_row_lock%';</code> -> <code class=\"language-text\">innodb_row_lock_waits</code> <code class=\"language-text\">innodb_row_lock_time_avg</code></li>\n<li>MySQL slow sql log</li>\n<li>Host server CPU usage</li>\n<li>Host server Memory usage</li>\n<li>Host server io status: <code class=\"language-text\">iostat -d -x -k 1</code>, show device data show extend data show KB value refresh every 1 second\n<ul>\n<li>%util 1-100, 100 means all io occupied</li>\n<li>svctm closing to await means almost no wait</li>\n<li>await > svctm means long io queue</li>\n<li>avgqu-sz : average queue size</li>\n</ul>\n</li>\n</ul>\n<p>For more metrics you may want to learn:</p>\n<ul>\n<li>Run MySQL command: <code class=\"language-text\">show status;</code></li>\n<li>Download/View grafana dashboard: <a href=\"https://github.com/percona/grafana-dashboards\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">percona/grafana-dashboards</a></li>\n</ul>\n<p><img src=\"/media/posts/2021/07/mysql-stress/iostat-util.png\" alt=\"\"></p>\n<h2 id=\"3-determine-stress\" style=\"position:relative;\"><a href=\"#3-determine-stress\" aria-label=\"3 determine stress permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. Determine Stress</h2>\n<p>In this step we need to figure out the expected stress level.</p>\n<p>3 items to be determined:</p>\n<ul>\n<li>How many records shall be in db table</li>\n<li>How many connections</li>\n<li>How’s the expected TPS</li>\n</ul>\n<p>DB performance may fluctuate markedly according to the amount of records in table and amount of connections.</p>\n<p>How (for example):</p>\n<ul>\n<li>Records amount\n<ul>\n<li>App users 100K</li>\n<li>Records of each user 5</li>\n<li>Total records amount: 100K * 5 = 500K</li>\n</ul>\n</li>\n<li>Connections amount\n<ul>\n<li>BE pod amount -> connections amount</li>\n</ul>\n</li>\n<li>TPS\n<ul>\n<li>Best is to see the production monitoring data, most real data</li>\n<li>Secondary is deducing, for example like\n<ul>\n<li>1k online user</li>\n<li>each user 1 api/sec</li>\n<li>1 api -> 1 transaction</li>\n<li>1k * 1tps = 1k tps</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"4-prepare-sql-statements\" style=\"position:relative;\"><a href=\"#4-prepare-sql-statements\" aria-label=\"4 prepare sql statements permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. Prepare SQL Statements</h2>\n<p>In this step we need to figure out the SQL statements which would be used in the stress test.</p>\n<p>How:</p>\n<ul>\n<li>set up the staging backend server with monitoring, especially DB sql monitoring</li>\n<li>run app with user-like actions</li>\n<li>see the sql statements logged in binlog</li>\n<li>pick top X statements of <code class=\"language-text\">CRUD</code> each type, like:\n<ul>\n<li>SELECT: SQL1, SQL2, SQL3</li>\n<li>UPDATE: SQLa, SQLb, SQLc</li>\n</ul>\n</li>\n<li>also grab the CRUD ratio, like: 60% select 35% update 4% create 1% delete</li>\n</ul>\n<h2 id=\"5-prepare-lua-script\" style=\"position:relative;\"><a href=\"#5-prepare-lua-script\" aria-label=\"5 prepare lua script permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. Prepare LUA script</h2>\n<p>In this step we need to prepare the lua script which would be executed by the sysbench. There are multiple threads in sysbench, each thread will execute the LUA script rather than running SQL statement directly.</p>\n<p>The script will:</p>\n<ol>\n<li>determine every time execution which type of CRUD SQL should be executed, finally the CRUD ratio should be consistent with the percentage we got in step 4</li>\n<li>select one SQL statement from the CRUD type SQL pool</li>\n<li>execute the SQL</li>\n</ol>\n<p>Using this LUA script we can mock the SQL executions just like the CRUD ratio we got in step 4, and SQLs are also we prepared in step 4.</p>\n<p>LUA example:</p>\n<div class=\"gatsby-highlight\" data-language=\"lua\"><pre class=\"language-lua\"><code class=\"language-lua\"><span class=\"token keyword\">function</span> <span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"prepare of stress test\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">cleanup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"cleanup of stress test\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">help</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sysbench stress test; no special command line options available\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">thread_init</span><span class=\"token punctuation\">(</span>thread_id<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">thread_done</span><span class=\"token punctuation\">(</span>thread_id<span class=\"token punctuation\">)</span>\n    <span class=\"token function\">db_disconnect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">event</span><span class=\"token punctuation\">(</span>thread_id<span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">-----------------------------------------------------------------------------------------------------------------------</span>\n    <span class=\"token comment\">-- CONST</span>\n    <span class=\"token comment\">-----------------------------------------------------------------------------------------------------------------------</span>\n\n    <span class=\"token keyword\">local</span> SEARCH_KEY_PH <span class=\"token operator\">=</span> <span class=\"token string\">\"^SK\"</span>\n    <span class=\"token keyword\">local</span> RANDOM_INT_PH <span class=\"token operator\">=</span> <span class=\"token string\">\"^RI\"</span>\n\n    <span class=\"token comment\">-----------------------------------------------------------------------------------------------------------------------</span>\n    <span class=\"token comment\">-- PARAMS</span>\n    <span class=\"token comment\">-----------------------------------------------------------------------------------------------------------------------</span>\n\n    <span class=\"token keyword\">local</span> totalRowsOfRecordsInDb <span class=\"token operator\">=</span> <span class=\"token number\">10000</span>\n\n    <span class=\"token keyword\">local</span> cmdSeed <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n        select <span class=\"token operator\">=</span> <span class=\"token number\">3000</span><span class=\"token punctuation\">,</span>\n        insert <span class=\"token operator\">=</span> <span class=\"token number\">150</span><span class=\"token punctuation\">,</span>\n        delete <span class=\"token operator\">=</span> <span class=\"token number\">80</span><span class=\"token punctuation\">,</span>\n        update <span class=\"token operator\">=</span> <span class=\"token number\">6770</span>\n    <span class=\"token punctuation\">}</span>\n\n    selectQueries <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    selectQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"SELECT plantId, userId, seedId, status, growTime, harvestTime, blightTime, rarity, residue, leaf FROM fs2_plant_plants WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    selectQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"SELECT userId, finished FROM module_mission_finished WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    selectQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"SELECT userId, activityId, decorId, finished, acceptedRewards, expensePoint FROM fs2_activity_party WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    selectQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"SELECT userId, customerDefId, level, exp, rewards FROM fs2_customer_friendship WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    selectQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"SELECT userId, missionId, progress, acceptTime, expireTime FROM module_mission_in_progress WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    selectQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"SELECT userId, activityId, collect FROM fs2_activity_collect WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    selectQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"SELECT userId, gridId, layer1Type, layer1, layer2Type, layer2, layer3Type, layer3 FROM fs2_grounds WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    selectQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"SELECT decorId, decorDefId, userId, orient, cooldown, buildId, isUpgrade, effectCountLeft, resourceCountLeft, requestAccepted, output, withActivityOutput, freeMode FROM fs2_decoration WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    selectQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"SELECT requestId, receiverId, senderId, helpId, type, info, time, expire, platformRequestId FROM fs2_social_request WHERE receiverId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    selectQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"SELECT userId, customerDefIds FROM fs2_customer_event WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n\n\n    insertQueries <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    insertQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"insert into `fv_dev`.`fs2_pet` ( `status`, `userId`, `fodderId`, `feedUpCount`, `feedUpTime`, `petDefId`) values ( '0', '89', '780003', '1', '1438223373', '900001');\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    insertQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"insert into fs2_plant_plants (userId,seedId,status,growTime,harvestTime,blightTime,rarity,residue,leaf,soilId,soilType,soilCount,harvestCount,wood,requestAccepted,withActivityOutput) values ('57332', '110001', '1', '1428746759', '1428746819', '1429005959', '0', '0', '0', '0', '0', '0', '0', '0', null, null); \"</span><span class=\"token punctuation\">]</span><span class=\"token operator\">=</span><span class=\"token number\">100</span>\n\n\n    updateQueries <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE module_achievement_in_progress SET progress = '[3333333333,44444,5555555555555,7777777777777777777777,^RI,111111111111,22222222222222222222,999999999999999999999999,00000000]' WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">1000</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE module_profile_infos SET info = ^RI, time = ^RI WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">700</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE fs2_plant_plants SET seedId = ^RI, status = ^RI, growTime = ^RI, harvestTime = ^RI, blightTime = ^RI, rarity = ^RI, leaf = ^RI, residue = ^RI WHERE plantId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">700</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE module_profile SET  exp = exp + 1 WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">500</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE module_mission_in_progress SET progress = '[3333333333,44444,5555555555555,7777777777777777777777,^RI,111111111111,22222222222222222222,999999999999999999999999,00000000]', acceptTime = ^RI WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">300</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE module_item SET  updateTime = ^RI WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">700</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE fs2_plant_seeds SET exp = ^RI WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE fs2_social_feed SET helpId = ^RI, status = ^RI WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE fs2_pet SET feedUpCount = ^RI, feedUpTime = ^RI, status = ^RI WHERE petId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE fs2_customer SET exp = ^RI, status = ^RI WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">50</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE fs2_customer_town SET missionId = ^RI, leaveTime = ^RI WHERE customerId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">300</span>\n    updateQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"UPDATE fs2_activity SET count = ^RI, status = ^RI WHERE userId = ^SK;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">100</span>\n\n    deleteQueries <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n    deleteQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"delete from fs2_plant_plants where userId=57332 limit 1;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token number\">500</span>\n    deleteQueries<span class=\"token punctuation\">[</span><span class=\"token string\">\"delete from fs2_pet where userId=89 limit 1;\"</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span><span class=\"token number\">500</span>\n\n    <span class=\"token comment\">-----------------------------------------------------------------------------------------------------------------------</span>\n    <span class=\"token comment\">-- LIB</span>\n    <span class=\"token comment\">-----------------------------------------------------------------------------------------------------------------------</span>\n\n    <span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">randItem</span><span class=\"token punctuation\">(</span>seedTable<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">local</span> result <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n        <span class=\"token keyword\">local</span> seedSum <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n        <span class=\"token keyword\">for</span> key<span class=\"token punctuation\">,</span> value <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>seedTable<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n            seedSum <span class=\"token operator\">=</span> seedSum <span class=\"token operator\">+</span> value\n        <span class=\"token keyword\">end</span>\n\n        <span class=\"token keyword\">local</span> randSeed <span class=\"token operator\">=</span> <span class=\"token function\">sb_rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> seedSum<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">local</span> sum <span class=\"token operator\">=</span> <span class=\"token number\">0</span>\n\n        <span class=\"token keyword\">for</span> cmdType<span class=\"token punctuation\">,</span> prob <span class=\"token keyword\">in</span> <span class=\"token function\">pairs</span><span class=\"token punctuation\">(</span>seedTable<span class=\"token punctuation\">)</span> <span class=\"token keyword\">do</span>\n            sum <span class=\"token operator\">=</span> sum <span class=\"token operator\">+</span> prob\n            <span class=\"token keyword\">if</span> randSeed <span class=\"token operator\">&lt;=</span> sum <span class=\"token keyword\">then</span>\n                result <span class=\"token operator\">=</span> cmdType\n            <span class=\"token keyword\">break</span> <span class=\"token keyword\">end</span>\n        <span class=\"token keyword\">end</span>\n\n\n\n        <span class=\"token keyword\">return</span> result\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token keyword\">local</span> <span class=\"token keyword\">function</span> <span class=\"token function\">processSleep</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        os<span class=\"token punctuation\">.</span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"sleep 0.01\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">-- 10ms</span>\n    <span class=\"token keyword\">end</span>\n\n    <span class=\"token comment\">-----------------------------------------------------------------------------------------------------------------------</span>\n    <span class=\"token comment\">-- EXEC</span>\n    <span class=\"token comment\">-----------------------------------------------------------------------------------------------------------------------</span>\n\n    <span class=\"token keyword\">local</span> cmdType <span class=\"token operator\">=</span> <span class=\"token function\">randItem</span><span class=\"token punctuation\">(</span>cmdSeed<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">--print(cmdType)</span>\n\n    <span class=\"token comment\">--if cmdType == \"insert\" or cmdType == \"delete\" then</span>\n    <span class=\"token comment\">--    cmdType = \"update\"</span>\n    <span class=\"token comment\">--end</span>\n\n    <span class=\"token keyword\">local</span> querySeed <span class=\"token operator\">=</span> _G<span class=\"token punctuation\">[</span>cmdType <span class=\"token operator\">..</span> <span class=\"token string\">\"Queries\"</span><span class=\"token punctuation\">]</span>\n    \n    <span class=\"token keyword\">local</span> sql <span class=\"token operator\">=</span> <span class=\"token function\">randItem</span><span class=\"token punctuation\">(</span>querySeed<span class=\"token punctuation\">)</span>\n    <span class=\"token comment\">--print(sql)</span>\n\n    <span class=\"token keyword\">if</span> cmdType <span class=\"token operator\">==</span> <span class=\"token string\">\"update\"</span> <span class=\"token keyword\">then</span>\n        sql <span class=\"token operator\">=</span> sql<span class=\"token punctuation\">:</span><span class=\"token function\">gsub</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%^RI\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">sb_rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> totalRowsOfRecordsInDb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">end</span>\n    sql <span class=\"token operator\">=</span> sql<span class=\"token punctuation\">:</span><span class=\"token function\">gsub</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%^SK\"</span><span class=\"token punctuation\">,</span> <span class=\"token function\">sb_rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> totalRowsOfRecordsInDb<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token comment\">--processSleep() -- let the lua script sleep to make qps lower for testing, if necessary</span>\n\n    <span class=\"token function\">db_query</span><span class=\"token punctuation\">(</span>sql<span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>You may find a sleep function <code class=\"language-text\">processSleep</code>, in old sysbench version there is no way to control the TPS speed, so this function could help to slow down the execution. In latest versions, sysbench provided the option to control tps, so it’s no longer necessary.</p>\n<h2 id=\"6-run-the-test\" style=\"position:relative;\"><a href=\"#6-run-the-test\" aria-label=\"6 run the test permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. Run the test</h2>\n<p>In this step we will see how to run sysbench to execute the stress test.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ sysbench --version\nsysbench <span class=\"token number\">1.0</span>.18</code></pre></div>\n<p>Several useful options:</p>\n<ul>\n<li><code class=\"language-text\">--threads</code> : How many thread running inside the sysbench, each thread means a db connection</li>\n<li><code class=\"language-text\">--rate</code> : TPS, 0 means no limit, query as fast as possible</li>\n<li><code class=\"language-text\">--events</code> : Total requests to be made in the whole stress test, use this or <code class=\"language-text\">--time</code></li>\n<li><code class=\"language-text\">--time</code> : How long should the stress test last, in seconds, use this or <code class=\"language-text\">--events</code></li>\n</ul>\n<p>Steps to run the stress test:</p>\n<ul>\n<li>Start the MySQL instance along with all the monitoring facilities</li>\n<li>Create database and table with schema SQL</li>\n<li>Create the initial records in the db table</li>\n<li>Run sysbench with low threads and rate, to warm up the MySQL instance (cache, index, etc…)</li>\n<li>Run sysbench with target rate</li>\n<li>See monitoring, check the CPU Memory iostat and lock waiting</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ sysbench <span class=\"token punctuation\">\\</span>\n  --threads<span class=\"token operator\">=</span><span class=\"token number\">128</span> <span class=\"token punctuation\">\\</span>\n  --rate<span class=\"token operator\">=</span><span class=\"token number\">300</span> <span class=\"token punctuation\">\\</span>\n  --time<span class=\"token operator\">=</span><span class=\"token number\">3600</span> <span class=\"token punctuation\">\\</span>\n  --percentile<span class=\"token operator\">=</span><span class=\"token number\">99</span> <span class=\"token punctuation\">\\</span>\n  --report-interval<span class=\"token operator\">=</span><span class=\"token number\">5</span> <span class=\"token punctuation\">\\</span>\n  --db-driver<span class=\"token operator\">=</span>mysql <span class=\"token punctuation\">\\</span>\n  --mysql<span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">\\</span>\n  ./test_strategy.lua <span class=\"token punctuation\">\\</span>\n  run</code></pre></div>\n<p>After the test, see the monitoring system to grab the conclusion. Or may be need to analyse the cause of the performance issues.</p>\n<h2 id=\"others\" style=\"position:relative;\"><a href=\"#others\" aria-label=\"others permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Others</h2>\n<h3 id=\"optimize-table\" style=\"position:relative;\"><a href=\"#optimize-table\" aria-label=\"optimize table permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Optimize table</h3>\n<p>Use <code class=\"language-text\">OPTIMIZE TABLE</code> to resort index to restore the performance. After a lot of CRUD, the InnoDB index may be messed up, and the performance reduced. You can perform this command between several rounds of tests.</p>\n<blockquote>\n<p>You can use OPTIMIZE TABLE to reclaim the unused space and to defragment the data file. After extensive changes to a table, this statement may also improve performance of statements that use the table, sometimes significantly.</p>\n</blockquote>\n<blockquote>\n<p>OPTIMIZE TABLE works for InnoDB, MyISAM, and ARCHIVE tables.\nOPTIMIZE TABLE is also supported for dynamic columns of in-memory NDB tables. It does not work for fixed-width columns of in-memory tables, nor does it work for Disk Data tables.</p>\n</blockquote>\n<ul>\n<li>For InnoDB tables, optimize table will simply perform an alter table to reclaim the space.</li>\n<li>If you have indexes, it will also resort the index pages, and update the statistics.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">OPTIMIZE</span> <span class=\"token keyword\">TABLE</span> XXX<span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"test-the-server-io-first\" style=\"position:relative;\"><a href=\"#test-the-server-io-first\" aria-label=\"test the server io first permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test the server io first</h3>\n<p>You may need to test the server io before test db, since the io of some cloud servers is not the same as claimed. You can still use sysbench to do it.</p>\n<p>Create test file:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ sysbench <span class=\"token punctuation\">\\</span>\n  --file-num<span class=\"token operator\">=</span><span class=\"token number\">4</span> <span class=\"token punctuation\">\\</span>\n  --file-block-size<span class=\"token operator\">=</span>8k <span class=\"token punctuation\">\\</span>\n  --file-total-size<span class=\"token operator\">=</span>4G <span class=\"token punctuation\">\\</span>\n  --file-test-mode<span class=\"token operator\">=</span>rndrd <span class=\"token punctuation\">\\</span>\n  --file-extra-flags<span class=\"token operator\">=</span>direct <span class=\"token punctuation\">\\</span>\n  --max-requests<span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token punctuation\">\\</span>\n  --time<span class=\"token operator\">=</span><span class=\"token number\">1200</span> <span class=\"token punctuation\">\\</span>\n  --threads<span class=\"token operator\">=</span><span class=\"token number\">4</span> <span class=\"token punctuation\">\\</span>\n  fileio prepare</code></pre></div>\n<p>Test random read performance:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ sysbench <span class=\"token punctuation\">\\</span>\n  --file-num<span class=\"token operator\">=</span><span class=\"token number\">4</span> <span class=\"token punctuation\">\\</span>\n  --file-block-size<span class=\"token operator\">=</span>8k <span class=\"token punctuation\">\\</span>\n  --file-total-size<span class=\"token operator\">=</span>4G <span class=\"token punctuation\">\\</span>\n  --file-test-mode<span class=\"token operator\">=</span>rndrd <span class=\"token punctuation\">\\</span>\n  --file-extra-flags<span class=\"token operator\">=</span>direct <span class=\"token punctuation\">\\</span>\n  --max-requests<span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token punctuation\">\\</span>\n  --time<span class=\"token operator\">=</span><span class=\"token number\">30</span> <span class=\"token punctuation\">\\</span>\n  --threads<span class=\"token operator\">=</span><span class=\"token number\">4</span> <span class=\"token punctuation\">\\</span>\n  --report-interval<span class=\"token operator\">=</span><span class=\"token number\">3</span> <span class=\"token punctuation\">\\</span>\n  fileio run</code></pre></div>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li><a href=\"https://www.guru99.com/performance-vs-load-vs-stress-testing.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Load Testing vs Stress Testing vs Performance Testing: Difference Discussed</a></li>\n<li><a href=\"https://severalnines.com/database-blog/how-benchmark-performance-mysql-mariadb-using-sysbench\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">How to Benchmark Performance of MySQL &#x26; MariaDB Using SysBench</a></li>\n<li><a href=\"https://www.thegeekstuff.com/2016/04/mysql-optimize-table/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">How to Optimize MySQL Tables and Defragment to Recover Space</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/75595737\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">漫谈MySQL的锁机制</a></li>\n<li><a href=\"https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/iostat.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Docs » 工具参考篇 » 11. iostat 监视I/O子系统</a></li>\n<li><a href=\"https://www.programmersought.com/article/63521025630/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Ioss for sysbench, iostat test server</a></li>\n</ul>\n<h2 id=\"appendix\" style=\"position:relative;\"><a href=\"#appendix\" aria-label=\"appendix permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Appendix</h2>\n<h3 id=\"sysbench---help\" style=\"position:relative;\"><a href=\"#sysbench---help\" aria-label=\"sysbench   help permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sysbench —help</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ sysbench --help\nUsage:\n  sysbench <span class=\"token punctuation\">[</span>options<span class=\"token punctuation\">]</span><span class=\"token punctuation\">..</span>. <span class=\"token punctuation\">[</span>testname<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">[</span>command<span class=\"token punctuation\">]</span>\n\nCommands implemented by <span class=\"token function\">most</span> tests: prepare run cleanup <span class=\"token builtin class-name\">help</span>\n\nGeneral options:\n  --threads<span class=\"token operator\">=</span>N                     number of threads to use <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  --events<span class=\"token operator\">=</span>N                      limit <span class=\"token keyword\">for</span> total number of events <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  --time<span class=\"token operator\">=</span>N                        limit <span class=\"token keyword\">for</span> total execution <span class=\"token function\">time</span> <span class=\"token keyword\">in</span> seconds <span class=\"token punctuation\">[</span><span class=\"token number\">10</span><span class=\"token punctuation\">]</span>\n  --forced-shutdown<span class=\"token operator\">=</span>STRING        number of seconds to <span class=\"token function\">wait</span> after the --time limit before forcing shutdown, or <span class=\"token string\">'off'</span> to disable <span class=\"token punctuation\">[</span>off<span class=\"token punctuation\">]</span>\n  --thread-stack-size<span class=\"token operator\">=</span>SIZE        size of stack per thread <span class=\"token punctuation\">[</span>64K<span class=\"token punctuation\">]</span>\n  --rate<span class=\"token operator\">=</span>N                        average transactions rate. <span class=\"token number\">0</span> <span class=\"token keyword\">for</span> unlimited rate <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  --report-interval<span class=\"token operator\">=</span>N             periodically report intermediate statistics with a specified interval <span class=\"token keyword\">in</span> seconds. <span class=\"token number\">0</span> disables intermediate reports <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  --report-checkpoints<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>LIST,<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span> dump full statistics and reset all counters at specified points <span class=\"token keyword\">in</span> time. The argument is a list of comma-separated values representing the amount of <span class=\"token function\">time</span> <span class=\"token keyword\">in</span> seconds elapsed from start of <span class=\"token builtin class-name\">test</span> when report checkpoint<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span> must be performed. Report checkpoints are off by default. <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  --debug<span class=\"token punctuation\">[</span><span class=\"token operator\">=</span>on<span class=\"token operator\">|</span>off<span class=\"token punctuation\">]</span>                print <span class=\"token function\">more</span> debugging info <span class=\"token punctuation\">[</span>off<span class=\"token punctuation\">]</span>\n  --validate<span class=\"token punctuation\">[</span><span class=\"token operator\">=</span>on<span class=\"token operator\">|</span>off<span class=\"token punctuation\">]</span>             perform validation checks where possible <span class=\"token punctuation\">[</span>off<span class=\"token punctuation\">]</span>\n  --help<span class=\"token punctuation\">[</span><span class=\"token operator\">=</span>on<span class=\"token operator\">|</span>off<span class=\"token punctuation\">]</span>                 print <span class=\"token builtin class-name\">help</span> and <span class=\"token builtin class-name\">exit</span> <span class=\"token punctuation\">[</span>off<span class=\"token punctuation\">]</span>\n  --version<span class=\"token punctuation\">[</span><span class=\"token operator\">=</span>on<span class=\"token operator\">|</span>off<span class=\"token punctuation\">]</span>              print version and <span class=\"token builtin class-name\">exit</span> <span class=\"token punctuation\">[</span>off<span class=\"token punctuation\">]</span>\n  --config-file<span class=\"token operator\">=</span>FILENAME          File containing <span class=\"token builtin class-name\">command</span> line options\n  --tx-rate<span class=\"token operator\">=</span>N                     deprecated <span class=\"token builtin class-name\">alias</span> <span class=\"token keyword\">for</span> --rate <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  --max-requests<span class=\"token operator\">=</span>N                deprecated <span class=\"token builtin class-name\">alias</span> <span class=\"token keyword\">for</span> --events <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  --max-time<span class=\"token operator\">=</span>N                    deprecated <span class=\"token builtin class-name\">alias</span> <span class=\"token keyword\">for</span> --time <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  --num-threads<span class=\"token operator\">=</span>N                 deprecated <span class=\"token builtin class-name\">alias</span> <span class=\"token keyword\">for</span> --threads <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n\nPseudo-Random Numbers Generator options:\n  --rand-type<span class=\"token operator\">=</span>STRING random numbers distribution <span class=\"token punctuation\">{</span>uniform,gaussian,special,pareto<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">[</span>special<span class=\"token punctuation\">]</span>\n  --rand-spec-iter<span class=\"token operator\">=</span>N number of iterations used <span class=\"token keyword\">for</span> numbers generation <span class=\"token punctuation\">[</span><span class=\"token number\">12</span><span class=\"token punctuation\">]</span>\n  --rand-spec-pct<span class=\"token operator\">=</span>N  percentage of values to be treated as <span class=\"token string\">'special'</span> <span class=\"token punctuation\">(</span>for special distribution<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>\n  --rand-spec-res<span class=\"token operator\">=</span>N  percentage of <span class=\"token string\">'special'</span> values to use <span class=\"token punctuation\">(</span>for special distribution<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token number\">75</span><span class=\"token punctuation\">]</span>\n  --rand-seed<span class=\"token operator\">=</span>N      seed <span class=\"token keyword\">for</span> random number generator. When <span class=\"token number\">0</span>, the current <span class=\"token function\">time</span> is used as a RNG seed. <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  --rand-pareto-h<span class=\"token operator\">=</span>N  parameter h <span class=\"token keyword\">for</span> pareto distribution <span class=\"token punctuation\">[</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">]</span>\n\nLog options:\n  --verbosity<span class=\"token operator\">=</span>N verbosity level <span class=\"token punctuation\">{</span><span class=\"token number\">5</span> - debug, <span class=\"token number\">0</span> - only critical messages<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">[</span><span class=\"token number\">3</span><span class=\"token punctuation\">]</span>\n\n  --percentile<span class=\"token operator\">=</span>N       percentile to calculate <span class=\"token keyword\">in</span> latency statistics <span class=\"token punctuation\">(</span><span class=\"token number\">1</span>-100<span class=\"token punctuation\">)</span>. Use the special value of <span class=\"token number\">0</span> to disable percentile calculations <span class=\"token punctuation\">[</span><span class=\"token number\">95</span><span class=\"token punctuation\">]</span>\n  --histogram<span class=\"token punctuation\">[</span><span class=\"token operator\">=</span>on<span class=\"token operator\">|</span>off<span class=\"token punctuation\">]</span> print latency histogram <span class=\"token keyword\">in</span> report <span class=\"token punctuation\">[</span>off<span class=\"token punctuation\">]</span>\n\nGeneral database options:\n\n  --db-driver<span class=\"token operator\">=</span>STRING  specifies database driver to use <span class=\"token punctuation\">(</span><span class=\"token string\">'help'</span> to get list of available drivers<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>mysql<span class=\"token punctuation\">]</span>\n  --db-ps-mode<span class=\"token operator\">=</span>STRING prepared statements usage mode <span class=\"token punctuation\">{</span>auto, disable<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">[</span>auto<span class=\"token punctuation\">]</span>\n  --db-debug<span class=\"token punctuation\">[</span><span class=\"token operator\">=</span>on<span class=\"token operator\">|</span>off<span class=\"token punctuation\">]</span> print database-specific debug information <span class=\"token punctuation\">[</span>off<span class=\"token punctuation\">]</span>\n\n\nCompiled-in database drivers:\n  mysql - MySQL driver\n\nmysql options:\n  --mysql-host<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>LIST,<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>          MySQL server <span class=\"token function\">host</span> <span class=\"token punctuation\">[</span>localhost<span class=\"token punctuation\">]</span>\n  --mysql-port<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>LIST,<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>          MySQL server port <span class=\"token punctuation\">[</span><span class=\"token number\">3306</span><span class=\"token punctuation\">]</span>\n  --mysql-socket<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>LIST,<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span>        MySQL socket\n  --mysql-user<span class=\"token operator\">=</span>STRING              MySQL user <span class=\"token punctuation\">[</span>sbtest<span class=\"token punctuation\">]</span>\n  --mysql-password<span class=\"token operator\">=</span>STRING          MySQL password <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  --mysql-db<span class=\"token operator\">=</span>STRING                MySQL database name <span class=\"token punctuation\">[</span>sbtest<span class=\"token punctuation\">]</span>\n  --mysql-ssl<span class=\"token punctuation\">[</span><span class=\"token operator\">=</span>on<span class=\"token operator\">|</span>off<span class=\"token punctuation\">]</span>             use SSL connections, <span class=\"token keyword\">if</span> available <span class=\"token keyword\">in</span> the client library <span class=\"token punctuation\">[</span>off<span class=\"token punctuation\">]</span>\n  --mysql-ssl-cipher<span class=\"token operator\">=</span>STRING        use specific cipher <span class=\"token keyword\">for</span> SSL connections <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  --mysql-compression<span class=\"token punctuation\">[</span><span class=\"token operator\">=</span>on<span class=\"token operator\">|</span>off<span class=\"token punctuation\">]</span>     use compression, <span class=\"token keyword\">if</span> available <span class=\"token keyword\">in</span> the client library <span class=\"token punctuation\">[</span>off<span class=\"token punctuation\">]</span>\n  --mysql-debug<span class=\"token punctuation\">[</span><span class=\"token operator\">=</span>on<span class=\"token operator\">|</span>off<span class=\"token punctuation\">]</span>           trace all client library calls <span class=\"token punctuation\">[</span>off<span class=\"token punctuation\">]</span>\n  --mysql-ignore-errors<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>LIST,<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span> list of errors to ignore, or <span class=\"token string\">\"all\"</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1213,1020</span>,1205<span class=\"token punctuation\">]</span>\n  --mysql-dry-run<span class=\"token punctuation\">[</span><span class=\"token operator\">=</span>on<span class=\"token operator\">|</span>off<span class=\"token punctuation\">]</span>         Dry run, pretend that all MySQL client API calls are successful without executing them <span class=\"token punctuation\">[</span>off<span class=\"token punctuation\">]</span>\n\nCompiled-in tests:\n  fileio - File I/O <span class=\"token builtin class-name\">test</span>\n  cpu - CPU performance <span class=\"token builtin class-name\">test</span>\n  memory - Memory functions speed <span class=\"token builtin class-name\">test</span>\n  threads - Threads subsystem performance <span class=\"token builtin class-name\">test</span>\n  mutex - Mutex performance <span class=\"token builtin class-name\">test</span>\n\nSee <span class=\"token string\">'sysbench &lt;testname> help'</span> <span class=\"token keyword\">for</span> a list of options <span class=\"token keyword\">for</span> each test.</code></pre></div>\n<h3 id=\"sysbench-fileio-help\" style=\"position:relative;\"><a href=\"#sysbench-fileio-help\" aria-label=\"sysbench fileio help permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>sysbench fileio help</h3>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ sysbench fileio <span class=\"token builtin class-name\">help</span>\nsysbench <span class=\"token number\">1.0</span>.18 <span class=\"token punctuation\">(</span>using bundled LuaJIT <span class=\"token number\">2.1</span>.0-beta2<span class=\"token punctuation\">)</span>\n\nfileio options:\n  --file-num<span class=\"token operator\">=</span>N                  number of files to create <span class=\"token punctuation\">[</span><span class=\"token number\">128</span><span class=\"token punctuation\">]</span>\n  --file-block-size<span class=\"token operator\">=</span>N           block size to use <span class=\"token keyword\">in</span> all IO operations <span class=\"token punctuation\">[</span><span class=\"token number\">16384</span><span class=\"token punctuation\">]</span>\n  --file-total-size<span class=\"token operator\">=</span>SIZE        total size of files to create <span class=\"token punctuation\">[</span>2G<span class=\"token punctuation\">]</span>\n  --file-test-mode<span class=\"token operator\">=</span>STRING       <span class=\"token builtin class-name\">test</span> mode <span class=\"token punctuation\">{</span>seqwr, seqrewr, seqrd, rndrd, rndwr, rndrw<span class=\"token punctuation\">}</span>\n  --file-io-mode<span class=\"token operator\">=</span>STRING         <span class=\"token function\">file</span> operations mode <span class=\"token punctuation\">{</span>sync,async,mmap<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">[</span>sync<span class=\"token punctuation\">]</span>\n  --file-extra-flags<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span>LIST,<span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span> list of additional flags to use to <span class=\"token function\">open</span> files <span class=\"token punctuation\">{</span>sync,dsync,direct<span class=\"token punctuation\">}</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  --file-fsync-freq<span class=\"token operator\">=</span>N           <span class=\"token keyword\">do</span> fsync<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> after this number of requests <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> - don<span class=\"token string\">'t use fsync()) [100]\n  --file-fsync-all[=on|off]     do fsync() after each write operation [off]\n  --file-fsync-end[=on|off]     do fsync() at the end of test [on]\n  --file-fsync-mode=STRING      which method to use for synchronization {fsync, fdatasync} [fsync]\n  --file-merged-requests=N      merge at most this number of IO requests if possible (0 - don'</span>t merge<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span>\n  --file-rw-ratio<span class=\"token operator\">=</span>N             reads/writes ratio <span class=\"token keyword\">for</span> combined <span class=\"token builtin class-name\">test</span> <span class=\"token punctuation\">[</span><span class=\"token number\">1.5</span><span class=\"token punctuation\">]</span></code></pre></div>\n<blockquote>\n<p>EOF</p>\n</blockquote>","fields":{"slug":"/posts/2021/07/mysql-stress","tagSlugs":["/tag/mysql/","/tag/database/","/tag/stresstest/"]},"frontmatter":{"date":"2021-07-20T02:02:22.000Z","description":"How to prepare and run a MySQL stress test and get the expected result","tags":["MySQL","Database","StressTest"],"title":"How to do MySQL stress test","socialImage":"/media/default-social-image.jpg"}},"allFile":{"totalCount":0,"nodes":[]}},"pageContext":{"slug":"/posts/2021/07/mysql-stress","gallery":"media/posts/2021/07/mysql-stress/gallery"}},
    "staticQueryHashes": ["251939775","357378587","401334301"]}