{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/2021/09/gallery-example","result":{"data":{"markdownRemark":{"id":"7395989f-7bb7-5185-8580-41f892e1ddf3","html":"<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#1-%E9%9C%80%E6%B1%82\">1. 需求</a></li>\n<li><a href=\"#2-%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84\">2. 文件结构</a></li>\n<li>\n<p><a href=\"#3-%E4%BB%A3%E7%A0%81%E6%94%B9%E5%8A%A8\">3. 代码改动</a></p>\n<ul>\n<li><a href=\"#31-create-pagejs\">3.1 create-page.js</a></li>\n<li><a href=\"#32-post-templatejs\">3.2 post-template.js</a></li>\n<li><a href=\"#33-galleryjs\">3.3 Gallery.js</a></li>\n<li><a href=\"#34-postjs\">3.4 Post.js</a></li>\n</ul>\n</li>\n</ul>\n</div>\n<h1 id=\"1-需求\" style=\"position:relative;\"><a href=\"#1-%E9%9C%80%E6%B1%82\" aria-label=\"1 需求 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 需求</h1>\n<p>Gallery算是一个blog中非常基础的需求，看了下gatsby的插件库，貌似是有一个<code class=\"language-text\">gatsby-theme-gallery</code>。但是这个插件引入了theme概念，对我来说无用，而且我需求的并不是要一个site级别的gallery，而是一个post级别的gallery，所以不合用。还是自己做一个得了。</p>\n<p>主要参考了：<a href=\"https://engineering.belchior.me/creating-a-custom-photo-gallery-using-gatsbyjs-and-css-grid-ck8ghm0vn01vkz3s1ulux9v17\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Creating a Custom Photo Gallery using Gatsby.js and CSS Grid</a>。此外，我的gatsby使用的是<a href=\"https://github.com/alxshelepenok/gatsby-starter-lumen\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">alxshelepenok/gatsby-starter-lumen</a>这个starter，技术上倒是无所谓用的是哪个starter，但文件夹结构是因应着这个starter的结构，所以姑且这里提下。</p>\n<p>另外还有一个插件：<a href=\"https://github.com/browniebroke/gatsby-image-gallery\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">browniebroke/gatsby-image-gallery</a>，不过看了下用起来也蛮麻烦的，再说了。</p>\n<p>关于gatsby的一些技术点，及如何制作自制插件之类的，会在另一篇博文里展开，这里就不提了。</p>\n<h1 id=\"2-文件结构\" style=\"position:relative;\"><a href=\"#2-%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84\" aria-label=\"2 文件结构 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 文件结构</h1>\n<p>这里按当前这篇post进行举例，来说明下大致上的post相关文件及gallery相关图片文件的存放位置。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">root /\n     | content /\n               | posts /\n                       | 2021 /\n                              | 09 /\n                                   | gallery-example.md  # 这是博文本身\n     | static /\n              | media /\n                      | posts /\n                              | 2021 /\n                                     | 09 /\n                                          | gallery-example /\n                                                            | gallery / *.jpeg  # 将会展示在gallery内的图片\n                                                            | *.jpeg            # 其他会在post内使用的图片</code></pre></div>\n<ul>\n<li>这篇blog的slug：<code class=\"language-text\">gallery-example</code></li>\n<li>post本身的md文件还是按slug存放在：<code class=\"language-text\">/content/posts/YYYY/MM/${slug}.md</code></li>\n<li>post对应的图片是按slug存放在：<code class=\"language-text\">/static/media/posts/YYYY/MM/${slug}/*.jpeg</code></li>\n<li>这里新添加一层<code class=\"language-text\">gallery</code>文件夹，里面的图片会被gallery插件使用，展示在post的<code class=\"language-text\">EOF</code>之后：<code class=\"language-text\">/static/media/posts/YYYY/MM/${slug}/gallery/*.jpeg</code></li>\n</ul>\n<p>大致上就这样，主要就是在media的post专属文件夹里新添加了一个gallery文件夹，里面的图片都会作为post的专属gallery展示在EOF之后。</p>\n<p>这里展示一张不会在gallery里展出的图片，因为它是存放在post的media文件夹内，但在gallery文件夹之外的图片：<code class=\"language-text\">/static/media/posts/2021/09/gallery-example/non-gallery.jpeg</code>。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 934px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c1fe13cf975914cc897a82ed30cc92e1/b701e/non-gallery.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 150%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAQX/xAAXAQEBAQEAAAAAAAAAAAAAAAADAQAC/9oADAMBAAIQAxAAAAGaW3Jliy82UIqJeeKEP//EABwQAAIDAQADAAAAAAAAAAAAAAEDAhESAAQiI//aAAgBAQABBQLJQ7PsJQX3kQOlwPSUdPFNgKEz9NXO+aaZ/8QAFhEBAQEAAAAAAAAAAAAAAAAAABES/9oACAEDAQE/AVZR/8QAGBEAAgMAAAAAAAAAAAAAAAAAABAREiH/2gAIAQIBAT8BV9JP/8QAHhAAAgIBBQEAAAAAAAAAAAAAAAECETEQEiFBUcH/2gAIAQEABj8CcJYeB0U1b7I5NzVWMhzYq9+EhaM//8QAHRAAAwACAwEBAAAAAAAAAAAAAAERMVEhQWGxwf/aAAgBAQABPyFbgDbOzrvKgmuzwSeTby6XUNSz4YH2No5H0KRqU3X6MRv8OcarRobvZ8P/2gAMAwEAAgADAAAAEFgzj//EABgRAAMBAQAAAAAAAAAAAAAAAAABERAh/9oACAEDAQE/ELhcjln/xAAWEQEBAQAAAAAAAAAAAAAAAAARAAH/2gAIAQIBAT8QItAsWN//xAAhEAEAAgEDBAMAAAAAAAAAAAABABEhMUFRcZGxwaHR8P/aAAgBAQABPxAImzgdH7aWLwUbDjMB6yAKF2ixaasoheO0EMOrYXb+Is8k8wfcBbjZNc/cvGnKTBzbV8IXzS0rm2Fado34lITUHSh6n//Z'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/c1fe13cf975914cc897a82ed30cc92e1/8ac56/non-gallery.webp 240w,\n/static/c1fe13cf975914cc897a82ed30cc92e1/d3be9/non-gallery.webp 480w,\n/static/c1fe13cf975914cc897a82ed30cc92e1/7d4d8/non-gallery.webp 934w\"\n              sizes=\"(max-width: 934px) 100vw, 934px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/c1fe13cf975914cc897a82ed30cc92e1/09b79/non-gallery.jpg 240w,\n/static/c1fe13cf975914cc897a82ed30cc92e1/7cc5e/non-gallery.jpg 480w,\n/static/c1fe13cf975914cc897a82ed30cc92e1/b701e/non-gallery.jpg 934w\"\n            sizes=\"(max-width: 934px) 100vw, 934px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/c1fe13cf975914cc897a82ed30cc92e1/b701e/non-gallery.jpg\"\n            alt=\"non gallery\"\n            title=\"non gallery\"\n            loading=\"lazy\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<h1 id=\"3-代码改动\" style=\"position:relative;\"><a href=\"#3-%E4%BB%A3%E7%A0%81%E6%94%B9%E5%8A%A8\" aria-label=\"3 代码改动 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 代码改动</h1>\n<p>代码改动主要是下面几个：</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">gatsby-config.js                                 # 添加gatsby-plugin-image插件，该图片展示插件在lumen这个starter中不存在\ngatsby/create-page.js                            # 在post-template.js使用的context中添加gallery参数，该值为static的media文件夹下post对应的gallery文件夹\nsrc/types/gallery.js                             # 描述从graphql内查询出来的allFile数据结构，这会作为gallery参数传给Post\nsrc/templates/post-template.js                   # 在该template的page query中根据create-page.js给的gallery参数，查询对应路径的图片文件信息allFile；PostTemplate的传入参数data里会有一个新的节点allFile，把它作为gallery参数传给Post\nsrc/components/Post/Gallery/Gallery.js           # 组件实现js\nsrc/components/Post/Gallery/Gallery.module.scss  # 组件style\nsrc/components/Post/Gallery/index.js             # 组件index，直接引入Gallery.js\nsrc/components/Post/Post.js                      # 判断Post新的传入参数gallery，如果里面有图片，则在Content后面追加Gallery组件</code></pre></div>\n<h2 id=\"31-create-pagejs\" style=\"position:relative;\"><a href=\"#31-create-pagejs\" aria-label=\"31 create pagejs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.1 create-page.js</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">  <span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    path<span class=\"token operator\">:</span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">,</span>\n    component<span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./src/templates/post-template.js'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    context<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> slug<span class=\"token operator\">:</span> edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token punctuation\">,</span> gallery<span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">media</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>edge<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">.</span>slug<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/gallery</span><span class=\"token template-punctuation string\">`</span></span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"32-post-templatejs\" style=\"position:relative;\"><a href=\"#32-post-templatejs\" aria-label=\"32 post templatejs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2 post-template.js</h2>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\">  <span class=\"token keyword\">query</span> <span class=\"token definition-query function\">PostBySlug</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$slug</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span><span class=\"token operator\">!</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$gallery</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property-query\">markdownRemark</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">slug</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$slug</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">### </span>\n      <span class=\"token property\">others</span>\n      <span class=\"token comment\">###</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token property-query\">allFile</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">relativeDirectory</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$gallery</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">totalCount</span>\n      <span class=\"token object\">nodes</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token object\">childrenImageSharp</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">gatsbyImageData</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>Layout title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>postTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\"> - </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>siteTitle<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">}</span> description<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>metaDescription<span class=\"token punctuation\">}</span> socialImage<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>socialImageUrl<span class=\"token punctuation\">}</span> <span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>Post post<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>markdownRemark<span class=\"token punctuation\">}</span> gallery<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>data<span class=\"token punctuation\">.</span>allFile<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>Layout<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"33-galleryjs\" style=\"position:relative;\"><a href=\"#33-galleryjs\" aria-label=\"33 galleryjs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.3 Gallery.js</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// @flow strict</span>\n<span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> GatsbyImage <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'gatsby-plugin-image'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> styles <span class=\"token keyword\">from</span> <span class=\"token string\">'./Gallery.module.scss'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">import</span> type <span class=\"token punctuation\">{</span> GalleryData <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'../../../types/gallery'</span><span class=\"token punctuation\">;</span>\n\ntype Props <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  gallery<span class=\"token operator\">:</span> GalleryData\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">Gallery</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> gallery <span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> Props</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> images <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// eslint-disable-next-line no-restricted-syntax</span>\n  <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>index<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">]</span> <span class=\"token keyword\">of</span> gallery<span class=\"token punctuation\">.</span>nodes<span class=\"token punctuation\">.</span><span class=\"token function\">entries</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> imgKey <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gallery-img-</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>index<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> sharp <span class=\"token operator\">=</span> node<span class=\"token punctuation\">.</span>childrenImageSharp<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>sharp<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token keyword\">const</span> image <span class=\"token operator\">=</span> sharp<span class=\"token operator\">?.</span>gatsbyImageData<span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>image<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        images<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span>\n          <span class=\"token operator\">&lt;</span>GatsbyImage key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>imgKey<span class=\"token punctuation\">}</span> alt<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>imgKey<span class=\"token punctuation\">}</span> image<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>image<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>images<span class=\"token punctuation\">.</span>length <span class=\"token operator\">></span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n      <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">[</span><span class=\"token string\">'gallery'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span>images<span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> Gallery<span class=\"token punctuation\">;</span></code></pre></div>\n<h2 id=\"34-postjs\" style=\"position:relative;\"><a href=\"#34-postjs\" aria-label=\"34 postjs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.4 Post.js</h2>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">  <span class=\"token operator\">&lt;</span>div className<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>styles<span class=\"token punctuation\">[</span><span class=\"token string\">'post__content'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span>Content body<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>html<span class=\"token punctuation\">}</span> title<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>title<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span>\n    <span class=\"token punctuation\">{</span>galleryNode<span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span></code></pre></div>\n<blockquote>\n<p>EOF</p>\n</blockquote>","fields":{"slug":"/posts/2021/09/gallery-example","tagSlugs":["/tag/blog/","/tag/gatsby/","/tag/gallery/"]},"frontmatter":{"date":"2021-09-05T02:02:22.000Z","description":"在gatsby站点中制作gallery展示组件","tags":["Blog","Gatsby","Gallery"],"title":"Gatsby Gallery组件","socialImage":{"publicURL":"/static/7e722e026a41a08a8f9a1cc76782dd27/default-social-image.jpg"}}},"allFile":{"totalCount":15,"nodes":[{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#78b8f8","images":{"fallback":{"src":"/static/adaef2bb04f5ea781940e58c16606b75/fc2d4/gallery00006.jpg","srcSet":"/static/adaef2bb04f5ea781940e58c16606b75/b834a/gallery00006.jpg 225w,\n/static/adaef2bb04f5ea781940e58c16606b75/21c52/gallery00006.jpg 450w,\n/static/adaef2bb04f5ea781940e58c16606b75/fc2d4/gallery00006.jpg 900w","sizes":"(min-width: 900px) 900px, 100vw"},"sources":[{"srcSet":"/static/adaef2bb04f5ea781940e58c16606b75/71a10/gallery00006.webp 225w,\n/static/adaef2bb04f5ea781940e58c16606b75/901f1/gallery00006.webp 450w,\n/static/adaef2bb04f5ea781940e58c16606b75/4ffff/gallery00006.webp 900w","type":"image/webp","sizes":"(min-width: 900px) 900px, 100vw"}]},"width":900,"height":600}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/4c6b8f497b9926dd6dc8cf4c2c154c07/d097c/gallery00011.jpg","srcSet":"/static/4c6b8f497b9926dd6dc8cf4c2c154c07/8d2ca/gallery00011.jpg 213w,\n/static/4c6b8f497b9926dd6dc8cf4c2c154c07/658e5/gallery00011.jpg 425w,\n/static/4c6b8f497b9926dd6dc8cf4c2c154c07/d097c/gallery00011.jpg 850w","sizes":"(min-width: 850px) 850px, 100vw"},"sources":[{"srcSet":"/static/4c6b8f497b9926dd6dc8cf4c2c154c07/15d99/gallery00011.webp 213w,\n/static/4c6b8f497b9926dd6dc8cf4c2c154c07/6f790/gallery00011.webp 425w,\n/static/4c6b8f497b9926dd6dc8cf4c2c154c07/873af/gallery00011.webp 850w","type":"image/webp","sizes":"(min-width: 850px) 850px, 100vw"}]},"width":850,"height":478}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#d8d8d8","images":{"fallback":{"src":"/static/c819e72427cd616f099614a058702b57/e72d5/gallery00015.jpg","srcSet":"/static/c819e72427cd616f099614a058702b57/a270c/gallery00015.jpg 300w,\n/static/c819e72427cd616f099614a058702b57/4a91b/gallery00015.jpg 600w,\n/static/c819e72427cd616f099614a058702b57/e72d5/gallery00015.jpg 1200w","sizes":"(min-width: 1200px) 1200px, 100vw"},"sources":[{"srcSet":"/static/c819e72427cd616f099614a058702b57/861a1/gallery00015.webp 300w,\n/static/c819e72427cd616f099614a058702b57/25b28/gallery00015.webp 600w,\n/static/c819e72427cd616f099614a058702b57/8ccf0/gallery00015.webp 1200w","type":"image/webp","sizes":"(min-width: 1200px) 1200px, 100vw"}]},"width":1200,"height":729}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/e734335409dd96bbea3ee76bdc99688c/ad8e7/gallery00005.jpg","srcSet":"/static/e734335409dd96bbea3ee76bdc99688c/7fe0e/gallery00005.jpg 342w,\n/static/e734335409dd96bbea3ee76bdc99688c/6f2d6/gallery00005.jpg 683w,\n/static/e734335409dd96bbea3ee76bdc99688c/ad8e7/gallery00005.jpg 1366w","sizes":"(min-width: 1366px) 1366px, 100vw"},"sources":[{"srcSet":"/static/e734335409dd96bbea3ee76bdc99688c/5d104/gallery00005.webp 342w,\n/static/e734335409dd96bbea3ee76bdc99688c/d8e20/gallery00005.webp 683w,\n/static/e734335409dd96bbea3ee76bdc99688c/ea7e9/gallery00005.webp 1366w","type":"image/webp","sizes":"(min-width: 1366px) 1366px, 100vw"}]},"width":1366,"height":520}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/f847ba2e8472cd69bcf1e3a81728a63c/fc2d4/gallery00004.jpg","srcSet":"/static/f847ba2e8472cd69bcf1e3a81728a63c/b834a/gallery00004.jpg 225w,\n/static/f847ba2e8472cd69bcf1e3a81728a63c/21c52/gallery00004.jpg 450w,\n/static/f847ba2e8472cd69bcf1e3a81728a63c/fc2d4/gallery00004.jpg 900w","sizes":"(min-width: 900px) 900px, 100vw"},"sources":[{"srcSet":"/static/f847ba2e8472cd69bcf1e3a81728a63c/71a10/gallery00004.webp 225w,\n/static/f847ba2e8472cd69bcf1e3a81728a63c/901f1/gallery00004.webp 450w,\n/static/f847ba2e8472cd69bcf1e3a81728a63c/4ffff/gallery00004.webp 900w","type":"image/webp","sizes":"(min-width: 900px) 900px, 100vw"}]},"width":900,"height":600}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/4839c4903b6690471b688effdb9ae077/75eb4/gallery00007.jpg","srcSet":"/static/4839c4903b6690471b688effdb9ae077/5249a/gallery00007.jpg 500w,\n/static/4839c4903b6690471b688effdb9ae077/cd24f/gallery00007.jpg 1000w,\n/static/4839c4903b6690471b688effdb9ae077/75eb4/gallery00007.jpg 2000w","sizes":"(min-width: 2000px) 2000px, 100vw"},"sources":[{"srcSet":"/static/4839c4903b6690471b688effdb9ae077/593aa/gallery00007.webp 500w,\n/static/4839c4903b6690471b688effdb9ae077/a98c1/gallery00007.webp 1000w,\n/static/4839c4903b6690471b688effdb9ae077/91076/gallery00007.webp 2000w","type":"image/webp","sizes":"(min-width: 2000px) 2000px, 100vw"}]},"width":2000,"height":1301}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#78b8f8","images":{"fallback":{"src":"/static/fd9e897df49f95a24daee86cee76d6c7/f19bc/gallery00008.jpg","srcSet":"/static/fd9e897df49f95a24daee86cee76d6c7/26cfb/gallery00008.jpg 500w,\n/static/fd9e897df49f95a24daee86cee76d6c7/1b035/gallery00008.jpg 1000w,\n/static/fd9e897df49f95a24daee86cee76d6c7/f19bc/gallery00008.jpg 2000w","sizes":"(min-width: 2000px) 2000px, 100vw"},"sources":[{"srcSet":"/static/fd9e897df49f95a24daee86cee76d6c7/921bf/gallery00008.webp 500w,\n/static/fd9e897df49f95a24daee86cee76d6c7/b7ef5/gallery00008.webp 1000w,\n/static/fd9e897df49f95a24daee86cee76d6c7/c9c6a/gallery00008.webp 2000w","type":"image/webp","sizes":"(min-width: 2000px) 2000px, 100vw"}]},"width":2000,"height":1333}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#3888d8","images":{"fallback":{"src":"/static/ac58419bebb2029149e54e30ec4b4e06/1e618/gallery00013.jpg","srcSet":"/static/ac58419bebb2029149e54e30ec4b4e06/0132d/gallery00013.jpg 400w,\n/static/ac58419bebb2029149e54e30ec4b4e06/20b93/gallery00013.jpg 800w,\n/static/ac58419bebb2029149e54e30ec4b4e06/1e618/gallery00013.jpg 1600w","sizes":"(min-width: 1600px) 1600px, 100vw"},"sources":[{"srcSet":"/static/ac58419bebb2029149e54e30ec4b4e06/47294/gallery00013.webp 400w,\n/static/ac58419bebb2029149e54e30ec4b4e06/56f2e/gallery00013.webp 800w,\n/static/ac58419bebb2029149e54e30ec4b4e06/94e9c/gallery00013.webp 1600w","type":"image/webp","sizes":"(min-width: 1600px) 1600px, 100vw"}]},"width":1600,"height":1067}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/0b96bb9f5ffeecc55d96e9a5c3370f1c/488c2/gallery00012.jpg","srcSet":"/static/0b96bb9f5ffeecc55d96e9a5c3370f1c/3dce1/gallery00012.jpg 360w,\n/static/0b96bb9f5ffeecc55d96e9a5c3370f1c/cf188/gallery00012.jpg 720w,\n/static/0b96bb9f5ffeecc55d96e9a5c3370f1c/488c2/gallery00012.jpg 1440w","sizes":"(min-width: 1440px) 1440px, 100vw"},"sources":[{"srcSet":"/static/0b96bb9f5ffeecc55d96e9a5c3370f1c/7268c/gallery00012.webp 360w,\n/static/0b96bb9f5ffeecc55d96e9a5c3370f1c/a5fbe/gallery00012.webp 720w,\n/static/0b96bb9f5ffeecc55d96e9a5c3370f1c/1790f/gallery00012.webp 1440w","type":"image/webp","sizes":"(min-width: 1440px) 1440px, 100vw"}]},"width":1440,"height":1068}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#f8f8f8","images":{"fallback":{"src":"/static/0b35a848aa0549512b23be08c1615f41/dbd40/gallery00003.jpg","srcSet":"/static/0b35a848aa0549512b23be08c1615f41/d3119/gallery00003.jpg 500w,\n/static/0b35a848aa0549512b23be08c1615f41/26b49/gallery00003.jpg 1000w,\n/static/0b35a848aa0549512b23be08c1615f41/dbd40/gallery00003.jpg 2000w","sizes":"(min-width: 2000px) 2000px, 100vw"},"sources":[{"srcSet":"/static/0b35a848aa0549512b23be08c1615f41/cd07d/gallery00003.webp 500w,\n/static/0b35a848aa0549512b23be08c1615f41/bf95e/gallery00003.webp 1000w,\n/static/0b35a848aa0549512b23be08c1615f41/d36eb/gallery00003.webp 2000w","type":"image/webp","sizes":"(min-width: 2000px) 2000px, 100vw"}]},"width":2000,"height":1125}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/345ee95f9bfeef83c7a3e919abdae2ff/f6810/gallery00001.jpg","srcSet":"/static/345ee95f9bfeef83c7a3e919abdae2ff/eee8e/gallery00001.jpg 400w,\n/static/345ee95f9bfeef83c7a3e919abdae2ff/1e21a/gallery00001.jpg 800w,\n/static/345ee95f9bfeef83c7a3e919abdae2ff/f6810/gallery00001.jpg 1600w","sizes":"(min-width: 1600px) 1600px, 100vw"},"sources":[{"srcSet":"/static/345ee95f9bfeef83c7a3e919abdae2ff/dff21/gallery00001.webp 400w,\n/static/345ee95f9bfeef83c7a3e919abdae2ff/b2a35/gallery00001.webp 800w,\n/static/345ee95f9bfeef83c7a3e919abdae2ff/e9d78/gallery00001.webp 1600w","type":"image/webp","sizes":"(min-width: 1600px) 1600px, 100vw"}]},"width":1600,"height":900}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#6888c8","images":{"fallback":{"src":"/static/dc692c93b9d645568f7b2585b03ec837/7123a/gallery00002.jpg","srcSet":"/static/dc692c93b9d645568f7b2585b03ec837/e18a8/gallery00002.jpg 960w,\n/static/dc692c93b9d645568f7b2585b03ec837/cfc96/gallery00002.jpg 1920w,\n/static/dc692c93b9d645568f7b2585b03ec837/7123a/gallery00002.jpg 3840w","sizes":"(min-width: 3840px) 3840px, 100vw"},"sources":[{"srcSet":"/static/dc692c93b9d645568f7b2585b03ec837/b9ace/gallery00002.webp 960w,\n/static/dc692c93b9d645568f7b2585b03ec837/a66c1/gallery00002.webp 1920w,\n/static/dc692c93b9d645568f7b2585b03ec837/88bd9/gallery00002.webp 3840w","type":"image/webp","sizes":"(min-width: 3840px) 3840px, 100vw"}]},"width":3840,"height":1600}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#a8a8b8","images":{"fallback":{"src":"/static/db1420c413d3f7b3a4e1762ab91191ee/e72f4/gallery00014.jpg","srcSet":"/static/db1420c413d3f7b3a4e1762ab91191ee/2174d/gallery00014.jpg 439w,\n/static/db1420c413d3f7b3a4e1762ab91191ee/23de3/gallery00014.jpg 879w,\n/static/db1420c413d3f7b3a4e1762ab91191ee/e72f4/gallery00014.jpg 1757w","sizes":"(min-width: 1757px) 1757px, 100vw"},"sources":[{"srcSet":"/static/db1420c413d3f7b3a4e1762ab91191ee/15064/gallery00014.webp 439w,\n/static/db1420c413d3f7b3a4e1762ab91191ee/8b858/gallery00014.webp 879w,\n/static/db1420c413d3f7b3a4e1762ab91191ee/e98b4/gallery00014.webp 1757w","type":"image/webp","sizes":"(min-width: 1757px) 1757px, 100vw"}]},"width":1757,"height":1040}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#080808","images":{"fallback":{"src":"/static/0d03d4eb48a12a8fea3802e8946ffa7b/3817a/gallery00009.jpg","srcSet":"/static/0d03d4eb48a12a8fea3802e8946ffa7b/0ddcd/gallery00009.jpg 869w,\n/static/0d03d4eb48a12a8fea3802e8946ffa7b/7fd6c/gallery00009.jpg 1739w,\n/static/0d03d4eb48a12a8fea3802e8946ffa7b/3817a/gallery00009.jpg 3477w","sizes":"(min-width: 3477px) 3477px, 100vw"},"sources":[{"srcSet":"/static/0d03d4eb48a12a8fea3802e8946ffa7b/88b21/gallery00009.webp 869w,\n/static/0d03d4eb48a12a8fea3802e8946ffa7b/f3e80/gallery00009.webp 1739w,\n/static/0d03d4eb48a12a8fea3802e8946ffa7b/951ed/gallery00009.webp 3477w","type":"image/webp","sizes":"(min-width: 3477px) 3477px, 100vw"}]},"width":3477,"height":2318}}]},{"childrenImageSharp":[{"gatsbyImageData":{"layout":"constrained","backgroundColor":"#0878b8","images":{"fallback":{"src":"/static/c1627e3d9b9571286171817f8c6a485b/ace28/gallery00010.jpg","srcSet":"/static/c1627e3d9b9571286171817f8c6a485b/c2ada/gallery00010.jpg 480w,\n/static/c1627e3d9b9571286171817f8c6a485b/190cc/gallery00010.jpg 960w,\n/static/c1627e3d9b9571286171817f8c6a485b/ace28/gallery00010.jpg 1920w","sizes":"(min-width: 1920px) 1920px, 100vw"},"sources":[{"srcSet":"/static/c1627e3d9b9571286171817f8c6a485b/c5d35/gallery00010.webp 480w,\n/static/c1627e3d9b9571286171817f8c6a485b/f5c10/gallery00010.webp 960w,\n/static/c1627e3d9b9571286171817f8c6a485b/2de93/gallery00010.webp 1920w","type":"image/webp","sizes":"(min-width: 1920px) 1920px, 100vw"}]},"width":1920,"height":1200}}]}]}},"pageContext":{"slug":"/posts/2021/09/gallery-example","gallery":"media/posts/2021/09/gallery-example/gallery"}},"staticQueryHashes":["251939775","401334301","825871152"]}