<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.93a3ceeadb7c87daaf55.css" id="gatsby-global-css">html{font-size:100}body{margin:0 0 0 calc(100vw - 100%);color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:600}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:1.625rem;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:600}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.anchor{margin-left:-1.875rem!important;padding-right:.875rem!important}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}}blockquote{border-left:5px solid #424242!important;padding-left:1rem!important;color:#424242!important;display:block!important;text-align:left!important;font-style:normal!important}table{border-collapse:collapse;box-shadow:0 0 20px rgba(0,0,0,.15)}thead tr{background-color:#009879;color:#fff;text-align:left}td,th{padding:.75rem .9375rem}tbody tr{border-bottom:1px solid #ddd}tbody tr:nth-of-type(2n){background-color:#f3f3f3}tbody tr:last-of-type{border-bottom:2px solid #009879}code[class*=language-],pre[class*=language-]{color:#657b83;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#073642}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background-color:#fdf6e3}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#93a1a1}.token.punctuation{color:#586e75}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#268bd2}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string,.token.url{color:#2aa198}.token.entity{color:#657b83;background:#eee8d5}.token.atrule,.token.attr-value,.token.keyword{color:#859900}.token.class-name,.token.function{color:#b58900}.token.important,.token.regex,.token.variable{color:#cb4b16}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.Author-module--author__photo--36xCH{display:inline-block;margin-bottom:0;border-radius:50%;background-clip:padding-box}.Author-module--author__title--2CaTb{font-size:1.125rem;font-weight:600;line-height:1.82813rem;margin:.8125rem 0}.Author-module--author__title-link--Yrism,.Author-module--author__title-link--Yrism:focus,.Author-module--author__title-link--Yrism:hover{color:#222}.Author-module--author__subtitle--cAaEB{color:#888;line-height:1.625rem;margin-bottom:1.625rem}.Icon-module--icon--Gpyvw{display:inline-block;width:1em;height:1em;stroke-width:0;stroke:currentColor;fill:currentColor;font-style:normal;font-weight:400;speak:none;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.Contacts-module--contacts--1rGd1{margin-bottom:1.625rem}.Contacts-module--contacts__list--3OgdW{display:flex;flex-flow:row wrap;flex-grow:0;flex-shrink:0;list-style:none;padding:0;margin:.625rem -.1875rem;width:8.75rem}.Contacts-module--contacts__list-item--16p9q{padding:0;margin:.25rem;display:flex;align-content:center;align-items:center;justify-content:center;height:2.1875rem;width:2.1875rem;line-height:2.1875rem;border-radius:50%;text-align:center;border:1px solid #ebebeb}.Contacts-module--contacts__list-item-link--2MIDn{border:0;display:flex;color:#222}.Contacts-module--contacts__list-item-link--2MIDn:focus,.Contacts-module--contacts__list-item-link--2MIDn:hover{color:#5d93ff}.Copyright-module--copyright--1ariN{color:#b6b6b6;font-size:.875rem}.Menu-module--menu--Efbin{margin-bottom:1.625rem}.Menu-module--menu__list--31Zeo{list-style:none;padding:0;margin:0}.Menu-module--menu__list-item--1lJ6B{padding:0;margin:.625rem 0}.Menu-module--menu__list-item-link--10Ush{font-size:1rem;color:#222;font-weight:400;border:0}.Menu-module--menu__list-item-link--10Ush:focus,.Menu-module--menu__list-item-link--10Ush:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Menu-module--menu__list-item-link--active--2CbUO{color:#222;border-bottom:1px solid #222}.Sidebar-module--sidebar--X4z2p{width:100%}.Sidebar-module--sidebar__inner--Jdc5s{position:relative;padding:1.5625rem 1.25rem 0}@media screen and (min-width:685px){.Sidebar-module--sidebar--X4z2p{width:calc(41.625% - 1.09375rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(12n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(12n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:1.875rem 1.25rem 0}.Sidebar-module--sidebar__inner--Jdc5s:after{background:#e6e6e6;background:linear-gradient(180deg,#e6e6e6 0,#e6e6e6 48%,#fff);position:absolute;content:"";width:.0625rem;height:33.75rem;top:30px;right:-10px;bottom:0}}@media screen and (min-width:960px){.Sidebar-module--sidebar--X4z2p{width:calc(33.3% - 1.25rem)}.Sidebar-module--sidebar--X4z2p:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Sidebar-module--sidebar--X4z2p:last-child{margin-right:0}.Sidebar-module--sidebar--X4z2p:nth-child(3n){margin-right:0;float:right}.Sidebar-module--sidebar--X4z2p:nth-child(3n+1){clear:both}.Sidebar-module--sidebar__inner--Jdc5s{padding:2.5rem}}.Layout-module--layout--3Pyz6{max-width:66.875rem;margin-left:auto;margin-right:auto}.Layout-module--layout--3Pyz6:before{content:"";display:table}.Layout-module--layout--3Pyz6:after{content:"";display:table;clear:both}.Feed-module--feed__item--2D5rE{margin-bottom:2.03125rem}.Feed-module--feed__item--2D5rE:last-child{margin-bottom:.8125rem}.Feed-module--feed__item-title--3nigr{font-size:1.6875rem;line-height:2.4375rem;margin-top:0;margin-bottom:.8125rem}.Feed-module--feed__item-title-link--iFMRs{color:#222}.Feed-module--feed__item-title-link--iFMRs:focus,.Feed-module--feed__item-title-link--iFMRs:hover{color:#222;border-bottom:1px solid #222}.Feed-module--feed__item-description--1uO8e{font-size:1rem;line-height:1.625rem;margin-bottom:1.21875rem}.Feed-module--feed__item-meta-time--3t1fg{font-size:.875rem;color:#222;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-divider--N-Q0A{margin:0 .3125rem}.Feed-module--feed__item-meta-category-link--23f8F{font-size:.875rem;color:#f7a046;font-weight:600;text-transform:uppercase}.Feed-module--feed__item-meta-category-link--23f8F:focus,.Feed-module--feed__item-meta-category-link--23f8F:hover{color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI{font-size:1rem;color:#5d93ff}.Feed-module--feed__item-readmore--1u6bI:focus,.Feed-module--feed__item-readmore--1u6bI:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.Page-module--page--2nMky{margin-bottom:3.25rem}.Page-module--page__inner--2M_vz{padding:1.5625rem 1.25rem}.Page-module--page__title--GPD8L{font-size:2.5rem;font-weight:600;line-height:3.25rem;margin-top:0;margin-bottom:2.35625rem}.Page-module--page__body--Ic6i6{font-size:1rem;line-height:1.625rem;margin:0 0 1.625rem}@media screen and (min-width:685px){.Page-module--page--2nMky{width:calc(58.275% - .78125rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(12n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(12n+1){clear:both}.Page-module--page__inner--2M_vz{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.Page-module--page--2nMky{width:calc(66.6% - .625rem)}.Page-module--page--2nMky:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.Page-module--page--2nMky:last-child{margin-right:0}.Page-module--page--2nMky:nth-child(3n){margin-right:0;float:right}.Page-module--page--2nMky:nth-child(3n+1){clear:both}.Page-module--page__inner--2M_vz{padding:2.5rem 2.1875rem}}.Pagination-module--pagination--2H3nO{margin-top:3.25rem;display:flex}.Pagination-module--pagination__prev--bet5s{width:50%;text-align:left}.Pagination-module--pagination__prev-link--1Nzs6{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__prev-link--1Nzs6:focus,.Pagination-module--pagination__prev-link--1Nzs6:hover{color:#5d93ff}.Pagination-module--pagination__prev-link--disable--Yklx9{pointer-events:none;color:#bbb}.Pagination-module--pagination__next--3hFiN{width:50%;text-align:right}.Pagination-module--pagination__next-link--3FUtA{color:#f7a046;font-size:1.625rem;font-weight:700}.Pagination-module--pagination__next-link--3FUtA:focus,.Pagination-module--pagination__next-link--3FUtA:hover{color:#5d93ff}.Pagination-module--pagination__next-link--disable--30UwZ{pointer-events:none;color:#bbb}.Author-module--author--2Yefr{border-top:1px solid #e6e6e6;max-width:40rem;padding-top:1.25rem;line-height:1.625rem;margin-top:1.625rem;margin-bottom:3.25rem}.Author-module--author__bio-twitter--n-O9n{display:block;text-decoration:underline}@media screen and (min-width:685px){.Author-module--author--2Yefr{margin-left:auto;margin-right:auto}}.Content-module--content--3p512{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.Content-module--content__title--2BDW9{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.Content-module--content__body--2TrQ- figure{margin-bottom:1.625rem}.Content-module--content__body--2TrQ- figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.Content-module--content__body--2TrQ- figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.Content-module--content__body--2TrQ- a{text-decoration:underline}.Content-module--content__body--2TrQ- *{max-width:40rem;margin-left:auto;margin-right:auto}.Content-module--content__body--2TrQ- img{max-width:100%}@media screen and (min-width:960px){.Content-module--content--3p512{padding:0}.Content-module--content__title--2BDW9{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.Content-module--content__body--2TrQ-,.Content-module--content__body--2TrQ- p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}}.Meta-module--meta__date--29eD7{font-style:italic}.Tags-module--tags--1L_ct{margin-bottom:.8125rem}.Tags-module--tags__list--91FqN{list-style:none;margin:0 -.625rem;padding:0}.Tags-module--tags__list-item--1M30P{display:inline-block;margin:.625rem .3125rem}.Tags-module--tags__list-item-link--3SL_8{display:inline-block;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;border:1px solid #e6e6e6;text-decoration:none;border-radius:1.25rem;color:#222}.Tags-module--tags__list-item-link--3SL_8:focus,.Tags-module--tags__list-item-link--3SL_8:hover{color:#5d93ff}.Gallery-module--gallery--1Epkj{display:grid;grid-template-columns:repeat(4,1fr);grid-auto-rows:16vw;grid-gap:.5em}.Gallery-module--gallery--1Epkj>*{box-shadow:0 2px 8px 0 rgba(0,0,0,.2),0 3px 20px 0 rgba(0,0,0,.19)}.Gallery-module--gallery--1Epkj>:hover{filter:blur(4px);transition:all .5s ease;cursor:pointer}.Gallery-module--gallery--1Epkj>:nth-child(6n+3){grid-column:span 1;grid-row:span 2}.Gallery-module--gallery--1Epkj>:nth-child(6n+2),.Gallery-module--gallery--1Epkj>:nth-child(6n+5),.Gallery-module--gallery--1Epkj>:nth-child(6n+6){grid-column:span 2;grid-row:span 2}.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{max-width:40rem;margin:0 auto;padding:0 .9375rem}.Post-module--post__home-button--16Kl0{display:block;max-width:5.625rem;height:2.1875rem;padding:0 1.5rem;line-height:2.1875rem;text-align:center;color:#222;border:1px solid #e6e6e6;border-radius:1.25rem;font-size:1rem;font-weight:400;margin-left:auto;margin-right:auto;margin-top:1.625rem}.Post-module--post__home-button--16Kl0:focus,.Post-module--post__home-button--16Kl0:hover{color:#5d93ff}@media screen and (min-width:960px){.Post-module--post__comments--25y6I,.Post-module--post__footer--3WzWU{padding:0}.Post-module--post__home-button--16Kl0{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.32.13"/><link rel="alternate" type="application/rss+xml" title="Blog by Jonathan Dai" href="/rss.xml"/><style type="text/css">
    .anchor.before {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-100%);
      padding-right: 4px;
    }
    .anchor.after {
      display: inline-block;
      padding-left: 4px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop
          var clientTop = document.documentElement.clientTop || document.body.clientTop || 0
          var offset = element.getBoundingClientRect().top + scrollTop - clientTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-11349149-4"></script><script>
      
      
      if(true) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){window.dataLayer && window.dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-11349149-4', {"send_page_view":false});
      }
      </script><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link rel="icon" href="/favicon-32x32.png?v=bc5f0053fc3ffc2dfb62b5abaa975347" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#F7A046"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=bc5f0053fc3ffc2dfb62b5abaa975347"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=bc5f0053fc3ffc2dfb62b5abaa975347"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=bc5f0053fc3ffc2dfb62b5abaa975347"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=bc5f0053fc3ffc2dfb62b5abaa975347"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=bc5f0053fc3ffc2dfb62b5abaa975347"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=bc5f0053fc3ffc2dfb62b5abaa975347"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=bc5f0053fc3ffc2dfb62b5abaa975347"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=bc5f0053fc3ffc2dfb62b5abaa975347"/><title data-react-helmet="true">Prometheus Notes - Blog by Jonathan Dai</title><meta data-react-helmet="true" name="description" content=""/><meta data-react-helmet="true" property="og:site_name" content="Prometheus Notes - Blog by Jonathan Dai"/><meta data-react-helmet="true" property="og:image" content="https://xenojoshua.com/static/7e722e026a41a08a8f9a1cc76782dd27/default-social-image.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:title" content="Prometheus Notes - Blog by Jonathan Dai"/><meta data-react-helmet="true" name="twitter:description" content=""/><meta data-react-helmet="true" name="twitter:image" content="https://xenojoshua.com/static/7e722e026a41a08a8f9a1cc76782dd27/default-social-image.jpg"/><link as="script" rel="preload" href="/webpack-runtime-09dc584798815dcead78.js"/><link as="script" rel="preload" href="/framework-0c07c9218e9798907e47.js"/><link as="script" rel="preload" href="/532a2f07-7be199ac103747a90c37.js"/><link as="script" rel="preload" href="/dc6a8720040df98778fe970bf6c000a41750d3ae-ae9f57b3df6a2a1f7657.js"/><link as="script" rel="preload" href="/app-b6f74eeafda9215d2765.js"/><link as="script" rel="preload" href="/styles-407fe62976dc5310c43e.js"/><link as="script" rel="preload" href="/cd95ea5cbd2c605f26db819f07999610c9ff4310-69626fa07c736046dbe7.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-5ab2f930c9fb4b9f1d39.js"/><link as="fetch" rel="preload" href="/page-data/posts/2019/04/prometheus-note/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/251939775.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/401334301.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/825871152.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="Layout-module--layout--3Pyz6"><div><a class="Post-module--post__home-button--16Kl0" href="/">All Articles</a><div><div class="Content-module--content--3p512"><h1 class="Content-module--content__title--2BDW9">Prometheus Notes</h1><div class="Content-module--content__body--2TrQ-"><div class="table-of-contents">
<ul>
<li><a href="#1-%E5%89%8D%E8%A8%80">1. 前言</a></li>
<li>
<p><a href="#2-%E7%AB%9E%E5%93%81%E6%AF%94%E8%BE%83">2. 竞品比较</a></p>
<ul>
<li><a href="#21-comparison-to-alternatives-%E5%B0%8F%E7%BB%93">2.1 COMPARISON TO ALTERNATIVES 小结</a></li>
<li><a href="#22-%E4%BC%98%E5%8A%BF">2.2 优势</a></li>
</ul>
</li>
<li>
<p><a href="#3-%E5%9F%BA%E7%A1%80--%E6%97%A5%E5%B8%B8%E4%BD%BF%E7%94%A8">3. 基础 &#x26; 日常使用</a></p>
<ul>
<li><a href="#31-%E8%B5%84%E6%BA%90--%E5%AE%89%E8%A3%85">3.1 资源 &#x26; 安装</a></li>
<li><a href="#32-%E6%A6%82%E5%BF%B5">3.2 概念</a></li>
<li><a href="#33-metrics-type">3.3 Metrics Type</a></li>
<li>
<p><a href="#34-exporter">3.4 Exporter</a></p>
<ul>
<li><a href="#341-exporter-%E8%BF%87%E6%BB%A4">3.4.1 Exporter 过滤</a></li>
<li><a href="#342-metric_relabel_configs-%E8%BF%87%E6%BB%A4">3.4.2 metric_relabel_configs 过滤</a></li>
</ul>
</li>
<li><a href="#35-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">3.5 配置文件</a></li>
<li><a href="#36-promql">3.6 PromQL</a></li>
<li><a href="#37-%E5%91%8A%E8%AD%A6">3.7 告警</a></li>
<li>
<p><a href="#38-graph">3.8 Graph</a></p>
<ul>
<li><a href="#381-console-template">3.8.1 Console Template</a></li>
<li><a href="#382-grafana">3.8.2 Grafana</a></li>
</ul>
</li>
<li>
<p><a href="#39-%E5%AD%98%E5%82%A8">3.9 存储</a></p>
<ul>
<li><a href="#391-%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8">3.9.1 本地存储</a></li>
<li><a href="#392-%E8%BF%9C%E7%A8%8B%E5%AD%98%E5%82%A8">3.9.2 远程存储</a></li>
</ul>
</li>
<li><a href="#310-%E9%87%8D%E5%A4%8D%E7%9A%84metrics-name">3.10 重复的Metrics name</a></li>
</ul>
</li>
<li>
<p><a href="#4-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">4. 架构设计</a></p>
<ul>
<li><a href="#41-%E6%9E%B6%E6%9E%84%E5%9B%BE">4.1 架构图</a></li>
<li><a href="#42-%E9%9B%86%E7%BE%A4%E5%8C%96">4.2 集群化</a></li>
<li><a href="#43-%E8%81%94%E9%82%A6%E9%9B%86%E7%BE%A4-federation">4.3 联邦集群 federation</a></li>
<li><a href="#44-%E9%AB%98%E5%8F%AF%E7%94%A8">4.4 高可用</a></li>
</ul>
</li>
<li><a href="#5-prometheus%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87">5. Prometheus监控指标</a></li>
<li><a href="#6-%E8%8C%83%E4%BE%8B">6. 范例</a></li>
<li><a href="#7-docker%E5%AE%9E%E8%B7%B5">7. Docker实践</a></li>
<li>
<p><a href="#8-%E5%B8%B8%E7%94%A8%E7%9B%91%E6%8E%A7">8. 常用监控</a></p>
<ul>
<li><a href="#81-prometheus">8.1 Prometheus</a></li>
<li><a href="#82-host-machine">8.2 Host Machine</a></li>
<li><a href="#83-memcached">8.3 Memcached</a></li>
<li><a href="#84-jmx-exporter">8.4 JMX Exporter</a></li>
</ul>
</li>
<li><a href="#9-todo">9. TODO</a></li>
<li>
<p><a href="#%E8%B5%84%E6%96%99">资料</a></p>
<ul>
<li><a href="#%E9%93%BE%E6%8E%A5">链接</a></li>
<li><a href="#prometheusmetrics-id_app_self_metrics">prometheus/metrics {#ID_APP_SELF_METRICS}</a></li>
<li><a href="#prometheus--h-id_app_prometheus_help">prometheus -h {#ID_APP_PROMETHEUS_HELP}</a></li>
<li>
<p><a href="#comparison-to-alternatives-id_app_cta">COMPARISON TO ALTERNATIVES {#ID_APP_CTA}</a></p>
<ul>
<li>
<p><a href="#prometheus-vs-graphite">Prometheus vs. Graphite</a></p>
<ul>
<li><a href="#scope">Scope</a></li>
<li><a href="#data-model">Data model</a></li>
<li><a href="#storage">Storage</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
</li>
<li>
<p><a href="#prometheus-vs-influxdb">Prometheus vs. InfluxDB</a></p>
<ul>
<li><a href="#scope-1">Scope</a></li>
<li><a href="#data-model--storage">Data model / storage</a></li>
<li><a href="#architecture">Architecture</a></li>
<li><a href="#summary-1">Summary</a></li>
</ul>
</li>
<li>
<p><a href="#prometheus-vs-opentsdb">Prometheus vs. OpenTSDB</a></p>
<ul>
<li><a href="#scope-2">Scope</a></li>
<li><a href="#data-model-1">Data model</a></li>
<li><a href="#storage-1">Storage</a></li>
<li><a href="#summary-2">Summary</a></li>
</ul>
</li>
<li>
<p><a href="#prometheus-vs-nagios">Prometheus vs. Nagios</a></p>
<ul>
<li><a href="#scope-3">Scope</a></li>
<li><a href="#data-model-2">Data model</a></li>
<li><a href="#storage-2">Storage</a></li>
<li><a href="#architecture-1">Architecture</a></li>
<li><a href="#summary-3">Summary</a></li>
</ul>
</li>
<li>
<p><a href="#prometheus-vs-sensu">Prometheus vs. Sensu</a></p>
<ul>
<li><a href="#scope-4">Scope</a></li>
<li><a href="#data-model-3">Data model</a></li>
<li><a href="#storage-3">Storage</a></li>
<li><a href="#architecture-2">Architecture</a></li>
<li><a href="#summary-4">Summary</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h1 id="1-前言" style="position:relative;"><a href="#1-%E5%89%8D%E8%A8%80" aria-label="1 前言 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>1. 前言</h1>
<p>对于分布式系统来说，监控是非常重要的，少了精密的监控应用程序的状况就无法得知了，也很难查找问题。而在云原生的年代，监控系统（或者说分布式系统的所有组件）最好是使用Go语言编写的，这样才能做到最小的镜像、最高的性能、最佳的CPU利用。所以监控系统的选择其实也不是那么的难，直接用CNCF的Prometheus就可以了。虽然说是这么说，实际使用之前对于工具的理解还是有必要的，因此有了此文。</p>
<p>此外，这里简单讲下，官方的文档，怎么说呢，只能说是一个”手册”。假设，Prometheus的作者（这里假设是一个自然人）花了100个小时编完了Prometheus的代码，那么这个官方文档估计也就只花了30分钟，内容完全就是一堆细节的堆砌，完全没动脑子。所以，如果你是一名初学者，建议直接忽略官方的文档，去找第三方的书来看。这份文档只对需要跟着最新版本走的工程师，或者需要查找下一些Prometheus知识点或使用方法的工程师有点用。</p>
<p>这里推荐一本中文的gitbook：<a href="https://yunlzheng.gitbook.io/prometheus-book/" target="_blank" rel="nofollow noopener noreferrer">prometheus-book</a>。从起始的安装和使用例子，到后面的集群管理以及exporter等等，都做了非常详实的解说，最可贵的是，作者写的内容是基于思考、组织之后的，明确地是为了读者服务的，而不像官方文档，仅仅只是一堆细节的罗列。</p>
<p>版本申明，后续的所有行文内容都基于Prometheus<code class="language-text">v2.8.1</code>：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ prometheus --version
prometheus, version 2.8.1 (branch: HEAD, revision: 4d60eb36dcbed725fcac5b27018574118f12fffb)
  build user:       root@bfdd6a22a683
  build date:       20190328-18:09:49
  go version:       go1.11.6</code></pre></div>
<h1 id="2-竞品比较" style="position:relative;"><a href="#2-%E7%AB%9E%E5%93%81%E6%AF%94%E8%BE%83" aria-label="2 竞品比较 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2. 竞品比较</h1>
<p>作为一个领域的后来者，最聪明的做法就是在自己的手册里与各位竞品前辈大佬进行一下横向比较，甚至附上性能的benchmark，这样才能取得新使用者的信任。而Prometheus在官方文档的最开始，就有一篇：<a href="https://prometheus.io/docs/introduction/comparison/" target="_blank" rel="nofollow noopener noreferrer">COMPARISON TO ALTERNATIVES</a>（这其实也是了解监控相关软件功能的很好的普及文）。</p>
<p>文中主要提到了5个工具进行横向比较：<code class="language-text">Graphite</code>、<code class="language-text">InfluxDB</code>、<code class="language-text">OpenTSDB</code>、<code class="language-text">Nagios</code>、<code class="language-text">Sensu</code>。</p>
<p>翻译放在最后的<a href="#ID_APP_CTA">资料</a>部分（继续喷下官方文档，这篇比较也写得不怎么样，看完没get到优势或者劣势的点）。</p>
<h2 id="21-comparison-to-alternatives-小结" style="position:relative;"><a href="#21-comparison-to-alternatives-%E5%B0%8F%E7%BB%93" aria-label="21 comparison to alternatives 小结 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.1 COMPARISON TO ALTERNATIVES 小结</h2>
<p>简单过一下的话：</p>
<ul>
<li>Nagios和Sensu基本上可以直接忽略</li>
<li>OpenTSDB是基于Hadoop/HBase的，扩展性应该说不错，但过重，且对于Ops的要求比较高</li>
<li>InfluxDB相当不错，但其杀手锏功能类似于集群化之类的，都是付费版本才有的，且其维护基于单一的商业公司（言下之意，如果你不用商业版，其实InfluxDB也没什么特别大的优势，而且还是单一公司维护有风险）</li>
<li>Graphite和Prometheus比起来，Prometheus的功能更丰富更强大</li>
</ul>
<h2 id="22-优势" style="position:relative;"><a href="#22-%E4%BC%98%E5%8A%BF" aria-label="22 优势 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>2.2 优势</h2>
<p>在docker hub的<a href="https://hub.docker.com/r/prom/prometheus/" target="_blank" rel="nofollow noopener noreferrer">介绍页面</a>上，有一段优势描述：</p>
<ul>
<li><code class="language-text">多维度</code>的数据模型（由metric名字定义的时序，以及一系列键值对的维度）</li>
<li><code class="language-text">灵活的查询语言</code>来利用这些维度</li>
<li>无依赖的分布式存储；<code class="language-text">自治的单个服务器节点</code></li>
<li>时序数据采集使用基于HTTP的<code class="language-text">拉模式</code></li>
<li>利用中间网关来支持<code class="language-text">推送</code>时序数据</li>
<li>监控目标的发现是通过<code class="language-text">服务发现</code>或<code class="language-text">静态配置</code></li>
<li>多种模式的<code class="language-text">图像及报表支持</code></li>
<li>支持分层和水平的<code class="language-text">联邦集群（federation）</code></li>
</ul>
<h1 id="3-基础--日常使用" style="position:relative;"><a href="#3-%E5%9F%BA%E7%A1%80--%E6%97%A5%E5%B8%B8%E4%BD%BF%E7%94%A8" aria-label="3 基础  日常使用 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3. 基础 &#x26; 日常使用</h1>
<h2 id="31-资源--安装" style="position:relative;"><a href="#31-%E8%B5%84%E6%BA%90--%E5%AE%89%E8%A3%85" aria-label="31 资源  安装 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.1 资源 &#x26; 安装</h2>
<p>Prometheus的官方网站：<a href="https://prometheus.io/" target="_blank" rel="nofollow noopener noreferrer">https://prometheus.io/</a>。</p>
<p>安装一般可以直接根据平台下载，Go应用程序的好处就显示出来了，只要一个可执行文件就能运行：<a href="https://prometheus.io/download/" target="_blank" rel="nofollow noopener noreferrer">https://prometheus.io/download/</a>。</p>
<p>一般来说入门只需要：</p>
<ul>
<li>prometheus：本体</li>
<li>node_exporter：最基本的exporter</li>
</ul>
<p>使用help放在附录：<a href="#ID_APP_PROMETHEUS_HELP">prometheus -h</a>。</p>
<h2 id="32-概念" style="position:relative;"><a href="#32-%E6%A6%82%E5%BF%B5" aria-label="32 概念 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.2 概念</h2>
<p>Prometheus的基本概念不算多，但如果不了解的话，看后面的东西会有障碍，因此建议先把概念了解清楚。</p>
<p>这里先给出一个简单的exporter吐出来的数据范例：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># HELP node_cpu Seconds the cpus spent in each mode.
# TYPE node_cpu counter
node_cpu{cpu="cpu0",mode="idle"} 362812.7890625
# HELP node_load1 1m load average.
# TYPE node_load1 gauge
node_load1 3.0703125</code></pre></div>
<p>Prometheus是一个<code class="language-text">时序数据库</code>，何谓时序数据库，所有保存在Prometheus里的数据都是按时间戳和值的序列顺序存放的，这被称为<code class="language-text">Vector（向量）</code>。</p>
<p>Prometheus的数据采集，每一个<code class="language-text">Metrics（指标）</code>都会有两行以<code class="language-text">#</code>字符起始的文本作为开头：</p>
<ul>
<li>其中第一行是<code class="language-text">注释</code>：<code class="language-text"># HELP ...</code>，主要用来说明该指标是什么</li>
<li>第二行是<code class="language-text">定义</code>：<code class="language-text"># TYPE ...</code>，对当前的指标进行<code class="language-text">命名</code>：<code class="language-text">node_load1</code>，及<code class="language-text">类型</code>的定义：<code class="language-text">gauge</code></li>
</ul>
<p>除了名字之外，每一个指标都可以有一系列的<code class="language-text">Labels（标签）</code>来描述更细致的维度：<code class="language-text">{cpu="cpu0",mode="idle"}</code>。</p>
<p>每一次数据采集获得到的即一个<code class="language-text">Sample（样本）</code>，其由三部分组成：</p>
<ul>
<li>Metrics（指标）：包含了Metrics name以及Labels</li>
<li>Timestamp（时间戳）：当前采样的时间，精度到毫秒</li>
<li>Value（采样值）：其类型为float64浮点数</li>
</ul>
<p>e.g</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">&lt;--------------- metric --------------------->&lt;-timestamp ->&lt;-value->
http_request_total{status="200", method="GET"}@1434417560938 => 94355
http_request_total{status="200", method="GET"}@1434417561287 => 94334

http_request_total{status="404", method="GET"}@1434417560938 => 38473
http_request_total{status="404", method="GET"}@1434417561287 => 38544

http_request_total{status="200", method="POST"}@1434417560938 => 4748
http_request_total{status="200", method="POST"}@1434417561287 => 4785</code></pre></div>
<p>在Prometheus内部有一个预定义的变量<code class="language-text">__name__</code>用来表达<code class="language-text">Metrics name</code>（这里注意，该值只是名字，不含Label），在后续编程及配置文件处理的时候会用得到：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">api_http_requests_total{method="POST", handler="/messages"}
=
{__name__="api_http_requests_total"，method="POST", handler="/messages"}</code></pre></div>
<p>Prometheus服务器启动的时候，可以设置从很多端点（endpoint）进行数据采集。比如说：我们有一个主机，主机上运行了3个Go程序，一个Java程序，以及一个数据库。那么我们采集的时候就需要运行6个工作：主机采集、Go采集*3、Java采集、数据库采集。这6个工作，每一个我们都称之为：<code class="language-text">Job</code>。Job可以自由设置采集的IP、端口以及endpoint，因此其自由度相当高，可以采集同服务器的不同服务，也可以采集不同的服务器上的数据，最终都汇总到一台Prometheus服务器上。</p>
<p>资料：</p>
<ul>
<li><a href="https://prometheus.io/docs/prometheus/latest/querying/basics/#instant-vector-selectors" target="_blank" rel="nofollow noopener noreferrer">Instant vector selectors</a></li>
<li><a href="https://www.robustperception.io/whats-in-a-__name__" target="_blank" rel="nofollow noopener noreferrer">What’s in a __name__?</a></li>
</ul>
<h2 id="33-metrics-type" style="position:relative;"><a href="#33-metrics-type" aria-label="33 metrics type permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.3 Metrics Type</h2>
<p>Prometheus定义了4中不同的Metrics Type（指标类型）：</p>
<ul>
<li><a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-metrics-types#counter-zhi-zeng-bu-jian-de-ji-shu-qi" target="_blank" rel="nofollow noopener noreferrer">Counter（计数器）</a>：只增不减的计数器</li>
<li><a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-metrics-types#gauge-ke-zeng-ke-jian-de-yi-biao-pan" target="_blank" rel="nofollow noopener noreferrer">Gauge（仪表盘）</a>：可增可减的仪表盘</li>
<li><a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-metrics-types#shi-yong-histogram-he-summary-fen-xi-shu-ju-fen-bu-qing-kuang" target="_blank" rel="nofollow noopener noreferrer">Histogram（直方图）</a>：数据分布情况</li>
<li><a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-metrics-types#shi-yong-histogram-he-summary-fen-xi-shu-ju-fen-bu-qing-kuang" target="_blank" rel="nofollow noopener noreferrer">Summary（摘要）</a>：数据分布情况</li>
</ul>
<p>最后的两个有点类似，区别在于Histogram描述的是绝对值，而Summary描述的是百分比。</p>
<p>e.g</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># HELP prometheus_tsdb_compaction_chunk_range Final time range of chunks on their first compaction
# TYPE prometheus_tsdb_compaction_chunk_range histogram
prometheus_tsdb_compaction_chunk_range_bucket{le="100"} 0
prometheus_tsdb_compaction_chunk_range_bucket{le="400"} 0
prometheus_tsdb_compaction_chunk_range_bucket{le="1600"} 0
prometheus_tsdb_compaction_chunk_range_bucket{le="6400"} 0
prometheus_tsdb_compaction_chunk_range_bucket{le="25600"} 0
prometheus_tsdb_compaction_chunk_range_bucket{le="102400"} 0
prometheus_tsdb_compaction_chunk_range_bucket{le="409600"} 0
prometheus_tsdb_compaction_chunk_range_bucket{le="1.6384e+06"} 260
prometheus_tsdb_compaction_chunk_range_bucket{le="6.5536e+06"} 780
prometheus_tsdb_compaction_chunk_range_bucket{le="2.62144e+07"} 780
prometheus_tsdb_compaction_chunk_range_bucket{le="+Inf"} 780
prometheus_tsdb_compaction_chunk_range_sum 1.1540798e+09
prometheus_tsdb_compaction_chunk_range_count 780</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text"># HELP prometheus_tsdb_wal_fsync_duration_seconds Duration of WAL fsync.
# TYPE prometheus_tsdb_wal_fsync_duration_seconds summary
prometheus_tsdb_wal_fsync_duration_seconds{quantile="0.5"} 0.012352463
prometheus_tsdb_wal_fsync_duration_seconds{quantile="0.9"} 0.014458005
prometheus_tsdb_wal_fsync_duration_seconds{quantile="0.99"} 0.017316173
prometheus_tsdb_wal_fsync_duration_seconds_sum 2.888716127000002
prometheus_tsdb_wal_fsync_duration_seconds_count 216</code></pre></div>
<h2 id="34-exporter" style="position:relative;"><a href="#34-exporter" aria-label="34 exporter permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.4 Exporter</h2>
<p>官方文档：<a href="https://prometheus.io/docs/instrumenting/exporters/" target="_blank" rel="nofollow noopener noreferrer">EXPORTERS AND INTEGRATIONS</a>。以及中文：<a href="https://yunlzheng.gitbook.io/prometheus-book/part-ii-prometheus-jin-jie/exporter" target="_blank" rel="nofollow noopener noreferrer">第4章 Exporter详解</a>。</p>
<p>Prometheus的设计是Prometheus服务器进行<code class="language-text">拉</code>操作，而受监控对象则将时序数据吐出来给服务器。为了不影响受监控的应用程序本身，一般是用Sidecar设计，在应用程序之外进行数据的吐出，也就是<code class="language-text">Exporter</code>这个角色（应用程序）。当然，如果需要直接在当前应用程序中进行数据暴露也是可以的，直接使用一些类库引入到应用程序中即可。</p>
<p>Prometheus流行起来之后，主流的应用程序一般都有对应的Exporter，直接下载使用即可。这里要提一下node_exporter，因为它是针对主机进行监控，因此不建议运行在容器里。容器本身就是和主机进行隔离的，运行在容器之中的话node_exporter无法很好工作。</p>
<p>这里需要注意的点是：<code class="language-text">信息的过滤</code>。</p>
<p>Prometheus的特性是，只要你在配置文件中将某个Exporter设定为Prometheus定时抓取的对象，Prometheus就会将这个Exporter吐出的<code class="language-text">所有数据</code>都定期采集起来，保存到时序数据库中。而实际情况则是，某个Exporter吐出来的数据中有很大一部分其实是我们并不关心的。</p>
<p>举个例子，Go语言的Exporter会吐出GC、内存、CPU、Goroutine等等一系列数据，而我们可能只关心GC、内存，其他都不关心。这个时候如果还是按默认的行为来进行采集的话，时序数据库里就会有很多无意义（我们不关心）的数据。为了防止这样的情况发生，有两种做法：</p>
<ul>
<li>在启动Exporter的时候将部分指标过滤掉，直接不吐出来</li>
<li>在Prometheus配置文件中针对采集的Job进行</li>
</ul>
<h3 id="341-exporter-过滤" style="position:relative;"><a href="#341-exporter-%E8%BF%87%E6%BB%A4" aria-label="341 exporter 过滤 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.4.1 Exporter 过滤</h3>
<p>举个例子，node_exporter在MAC上启动，默认会吐出如下数据：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">INFO[0000] Enabled collectors:                           source="node_exporter.go:90"
INFO[0000]  - boottime                                   source="node_exporter.go:97"
INFO[0000]  - cpu                                        source="node_exporter.go:97"
INFO[0000]  - diskstats                                  source="node_exporter.go:97"
INFO[0000]  - filesystem                                 source="node_exporter.go:97"
INFO[0000]  - loadavg                                    source="node_exporter.go:97"
INFO[0000]  - meminfo                                    source="node_exporter.go:97"
INFO[0000]  - netdev                                     source="node_exporter.go:97"
INFO[0000]  - textfile                                   source="node_exporter.go:97"
INFO[0000]  - time                                       source="node_exporter.go:97"</code></pre></div>
<p>我们就可以在启动的时候附加：<code class="language-text">--no-collector.time</code>option（time可置换成其他的），让其不再吐出，当然也可以添加option（—collector.xxx）吐出某些我们需要但默认不开启的数据。不同的Exporter设置可能会有些微不同，建议使用的时候仔细查看其手册。</p>
<p>这样的设计模式其实是有问题的，在使用的时候需要大量设置，用起来过于复杂：<a href="https://github.com/prometheus/node_exporter/issues/735" target="_blank" rel="nofollow noopener noreferrer">Question: Disable all collectors?</a>。</p>
<h3 id="342-metric_relabel_configs-过滤" style="position:relative;"><a href="#342-metric_relabel_configs-%E8%BF%87%E6%BB%A4" aria-label="342 metric_relabel_configs 过滤 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.4.2 metric_relabel_configs 过滤</h3>
<p>官方文档在：<a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#metric_relabel_configs" target="_blank" rel="nofollow noopener noreferrer">&#x3C;metric_relabel_configs></a>。讲解可以看一篇英语的：<a href="https://medium.com/quiq-blog/prometheus-relabeling-tricks-6ae62c56cbda" target="_blank" rel="nofollow noopener noreferrer">Prometheus relabeling tricks</a>。</p>
<p>这个配置项的作用主要有几点：</p>
<ul>
<li>在入库之前去掉不需要的指标</li>
<li>将入库的某些指标重新命名（这点很有用，后面会说到）</li>
</ul>
<p>该配置项的效果会在数据入库之前生效，因此非常有用，可以显著减少入库的数据量，减少磁盘的容量占用，加快数据查询。</p>
<p>e.g</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token key atrule">metric_relabel_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">source_labels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>__name__<span class="token punctuation">]</span>
    <span class="token key atrule">regex</span><span class="token punctuation">:</span> "(\
      go_gc_duration_seconds<span class="token punctuation">|</span>\
      <span class="token punctuation">...</span><span class="token punctuation">|</span>\
      node_memory_wired_bytes\
    )"
    <span class="token key atrule">action</span><span class="token punctuation">:</span> drop</code></pre></div>
<p>上面的例子里使用了字符串换行，这里需要注意的是需要换行的字符串一定要使用双引号<code class="language-text">"</code>，双引号里的字符是不会被转译的，换行符<code class="language-text">\</code>也就不会失效了。不换行的话，写法是：</p>
<p><code class="language-text">regex: "(filtered1|filtered2|filtered3)"</code></p>
<p>总而言之，在数据过滤方面，Prometheus做的真的不好，无论是在Exporter端做过滤还是在配置文件里做过滤，都需要写不少过滤条目，蛮麻烦的。</p>
<h2 id="35-配置文件" style="position:relative;"><a href="#35-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" aria-label="35 配置文件 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.5 配置文件</h2>
<p>官方文档：<a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/" target="_blank" rel="nofollow noopener noreferrer">CONFIGURATION</a>。有一篇中文的译文不错，但不是太全：<a href="https://www.jianshu.com/p/bedd169676b6" target="_blank" rel="nofollow noopener noreferrer">Prometheus的安装和配置</a>。</p>
<p>配置文件这块，官方的文档细节肯定是最全的，有很多不常用的选项之类的，估计一般也只有官方文档里才找得到。不过官方文档就像我一开始说的，讲解得实在是，光有细节没有脑子。因此建议看一些范例，对配置文件有一个大概的了解之后再去官方文档里查细节会比较好。</p>
<p>主要的配置大项有：</p>
<ul>
<li>抓取配置 <a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#scrape_config" target="_blank" rel="nofollow noopener noreferrer">scrape_configs</a></li>
<li>规则配置 <a href="https://prometheus.io/docs/prometheus/latest/configuration/recording_rules/" target="_blank" rel="nofollow noopener noreferrer">recording_rules</a> <a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/alert/prometheus-recoding-rules#ding-yi-recoding-rules" target="_blank" rel="nofollow noopener noreferrer">中文</a></li>
<li>告警配置 <a href="https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/" target="_blank" rel="nofollow noopener noreferrer">alerting_rules</a></li>
</ul>
<h2 id="36-promql" style="position:relative;"><a href="#36-promql" aria-label="36 promql permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.6 PromQL</h2>
<p>Prometheus这块的设计应该说还算是比较可读的，可以看下中文book里的内容：</p>
<ul>
<li><a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-query-language" target="_blank" rel="nofollow noopener noreferrer">初识PromQL</a></li>
<li><a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-promql-operators-v2" target="_blank" rel="nofollow noopener noreferrer">PromQL操作符</a></li>
<li><a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-aggr-ops" target="_blank" rel="nofollow noopener noreferrer">PromQL聚合操作</a></li>
<li><a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-promql-functions" target="_blank" rel="nofollow noopener noreferrer">PromQL内置函数</a></li>
</ul>
<h2 id="37-告警" style="position:relative;"><a href="#37-%E5%91%8A%E8%AD%A6" aria-label="37 告警 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.7 告警</h2>
<p>Prometheus里的告警功能做得非常强大，按规则的组合可以轻松对告警进行规则定义、分组，并可以使用Altermanager进行对应的告警行为。当然使用上就有点复杂，需要花点时间梳理下。具体的细节可以查看：<a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/alert" target="_blank" rel="nofollow noopener noreferrer">第3章 Prometheus告警处理</a>。</p>
<h2 id="38-graph" style="position:relative;"><a href="#38-graph" aria-label="38 graph permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.8 Graph</h2>
<h3 id="381-console-template" style="position:relative;"><a href="#381-console-template" aria-label="381 console template permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.8.1 Console Template</h3>
<p>Prometheus的服务器有提供集成的图像化解决方案，这被称为：<code class="language-text">Console Template</code>，其实无非就是一个模板引擎然后向其中填充数据。上手还是需要花点时间稍微摸索下，具体的细节可以查看：<a href="https://yunlzheng.gitbook.io/prometheus-book/part-ii-prometheus-jin-jie/grafana/use-console-template" target="_blank" rel="nofollow noopener noreferrer">使用Console Template</a>。</p>
<h3 id="382-grafana" style="position:relative;"><a href="#382-grafana" aria-label="382 grafana permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.8.2 Grafana</h3>
<p>现在比较主流的图像化做法是数据采集和存储由Prometheus来，然后图像化输出则由Grafana来处理。这块后面会在Grafana的专题里进行讲解。</p>
<h2 id="39-存储" style="position:relative;"><a href="#39-%E5%AD%98%E5%82%A8" aria-label="39 存储 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.9 存储</h2>
<h3 id="391-本地存储" style="position:relative;"><a href="#391-%E6%9C%AC%E5%9C%B0%E5%AD%98%E5%82%A8" aria-label="391 本地存储 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.9.1 本地存储</h3>
<p>Prometheus的时序数据库默认是存储在本地磁盘的，以2小时时间长度为分段，将数据存储到一个Block（块）中。具体的细节可以查看：<a href="https://yunlzheng.gitbook.io/prometheus-book/part-ii-prometheus-jin-jie/readmd/prometheus-local-storage" target="_blank" rel="nofollow noopener noreferrer">本地存储</a>。</p>
<h3 id="392-远程存储" style="position:relative;"><a href="#392-%E8%BF%9C%E7%A8%8B%E5%AD%98%E5%82%A8" aria-label="392 远程存储 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.9.2 远程存储</h3>
<p>本地存储在可用性及高效性上有先天优势，但也有很多问题，最主要的就是本地磁盘的容量问题，本地磁盘容量不足就不能够保存长期数据。因此Prometheus也提供了远程写和远程读的设置，允许开发者将时序数据库的数据存储在远程介质中。具体的细节可以查看：<a href="https://yunlzheng.gitbook.io/prometheus-book/part-ii-prometheus-jin-jie/readmd/prometheus-remote-storage" target="_blank" rel="nofollow noopener noreferrer">远程存储</a>。</p>
<h2 id="310-重复的metrics-name" style="position:relative;"><a href="#310-%E9%87%8D%E5%A4%8D%E7%9A%84metrics-name" aria-label="310 重复的metrics name permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>3.10 重复的Metrics name</h2>
<p>有一个比较常见的麻烦问题是：在同一个Prometheus服务器节点上，可能会采集到大量重名的指标。</p>
<p>这里举个例子来说：同一台Linux服务器节点上，有3个Go应用程序在运行，而我们需要把这三个应用程序的Go相关指标都监控起来。这时候你会发现采集上来的3份Go指标数据，其指标名都是重复的。这很正常，因为采集的指标都是同样的东西，只不过吐出数据的应用程序不同而已。</p>
<p>这时候我们就需要用到之前提到过的：<code class="language-text">metric_relabel_configs</code>。每个Go应用程序肯定是在Prometheus服务器上设置成单独的<code class="language-text">Jobs</code>，而这些不同的Jobs就需要设置各自的metric_relabel_configs，将获取到的同名指标重命名成和应用程序相关的指标，当然指标名的意义需要保持不变。</p>
<p>e.g</p>
<div class="gatsby-highlight" data-language="yaml"><pre class="language-yaml"><code class="language-yaml"><span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> cadvisor
  <span class="token punctuation">...</span>
  <span class="token key atrule">metric_relabel_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">source_labels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>image<span class="token punctuation">]</span>
    <span class="token key atrule">regex</span><span class="token punctuation">:</span> <span class="token string">'.*/(.*)'</span>
    <span class="token key atrule">replacement</span><span class="token punctuation">:</span> <span class="token string">'$1'</span>
    <span class="token key atrule">target_label</span><span class="token punctuation">:</span> id
  <span class="token punctuation">-</span> <span class="token key atrule">source_labels</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>service<span class="token punctuation">]</span>
    <span class="token key atrule">regex</span><span class="token punctuation">:</span> <span class="token string">'ecs-.*:ecs-([a-z]+-*[a-z]*).*:[0-9]+'</span>
    <span class="token key atrule">replacement</span><span class="token punctuation">:</span> <span class="token string">'$1'</span>
    <span class="token key atrule">target_label</span><span class="token punctuation">:</span> service</code></pre></div>
<h1 id="4-架构设计" style="position:relative;"><a href="#4-%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1" aria-label="4 架构设计 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4. 架构设计</h1>
<h2 id="41-架构图" style="position:relative;"><a href="#41-%E6%9E%B6%E6%9E%84%E5%9B%BE" aria-label="41 架构图 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.1 架构图</h2>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 960px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/2ada1ece66fcc81d704c2ba46f9dd7d3/6edca/architecture.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 60%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADaElEQVQozz2SS2wbVRiFLzh1EtpFkWjJhgU7aHdRQAhCSpEQj6oLloQNQoiwIRVKpQgh2V2kUV8gyoIdLYkIIg2icpKaOICJmzpuHKexa7t+zTPz8oztuZ6XZ8bj0WXsphzpW9xfV0fn3P8CURRzLMtCUayyvCifhKoV1gwTcULVphnWIUja0XTD1s02qmvuMEIIeHrOw4+Xs6BAl1/N1Eu/FyEZxiX6IyBDOM1xfLzRkBcU3XiRlYzEPldDNE0hCJtIliFiGAY1oIokXnrbFujZGlaMQApbc4jCcIkhh8kak2PqHC5AcRJ8DYAvl81ezKeSJ+qqAkq0NJbOFX8uV5X3WR2N7ivOqTIHT5VYOEbupIachph0GpLm1Ku6TJQ+oxluTJGbe7AhVwzdOAfa9WrFI99uSKxJVz5wZPFLyFBpC89ft7HsFZt4dK3DU1eQof7QKuy+1K38hDvzPx310n+oqMquoiiEoqrngM3TYYOuRFyR/cMlH73escyca1uoLdeQ3ZBQG9aRo6vIdV1kMsRZniTA5ubmN4lkaiQe2+gZT50/f2h8fLwvGAw+DZwaDxCZB/e2k1/sbMZOt5ryXUXTkG5attYyHcO0nLosW4rSRMY+/i5FUuDv9fWR9bXIUNeMrxR9geAFMDExAaampgAoZfb88fDyQGp3d/xh4t4rLQUmFEVFhqG7TQiRpqlI142OaduIz+2d8bb7jEffdtRLV0wDi6JAvpQBwcAFEFpdBcAwjF7sXPoBGOm+jW3tocdqe3S6uBJnm7FVpHPUewffps9mqYttlixaLH3tYAYWv70EAI7jHxME8ck+w5xduH71cCWb+UegKbWQSQs/fv+d+Ff4jihgJZ5ObemZrbtvEYV8L0CLL8838AJqCditaB2Bk6+909dzhV4tSZK8ahrCMPzEvxsbf2IYpsdisero6JvSzMyMxHK8UCEpYy0SOf3/ljvSL6aQRcit3fJsjvh8/uH+/kNHQSgUejkQCJyZm5t7w7voD92+/aw3G0qldo575x6Lvy4cDy3+9vz8zRv+ycmvnuoa1oTizSZ3HzVrlQXPcHBw8PALAwP9R8BB/2MevunpaRCNRsHKygqIx+OPq7VaYGlpCSwvL4PZ2Vlw+fKlnmF86/6n26mHN7YSyc/T6R3wRP8Bv6Khni6cOA0AAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <picture>
          <source
              srcset="/static/2ada1ece66fcc81d704c2ba46f9dd7d3/8ac56/architecture.webp 240w,
/static/2ada1ece66fcc81d704c2ba46f9dd7d3/d3be9/architecture.webp 480w,
/static/2ada1ece66fcc81d704c2ba46f9dd7d3/e46b2/architecture.webp 960w,
/static/2ada1ece66fcc81d704c2ba46f9dd7d3/2d20a/architecture.webp 1351w"
              sizes="(max-width: 960px) 100vw, 960px"
              type="image/webp"
            />
          <source
            srcset="/static/2ada1ece66fcc81d704c2ba46f9dd7d3/8ff5a/architecture.png 240w,
/static/2ada1ece66fcc81d704c2ba46f9dd7d3/e85cb/architecture.png 480w,
/static/2ada1ece66fcc81d704c2ba46f9dd7d3/d9199/architecture.png 960w,
/static/2ada1ece66fcc81d704c2ba46f9dd7d3/6edca/architecture.png 1351w"
            sizes="(max-width: 960px) 100vw, 960px"
            type="image/png"
          />
          <img
            class="gatsby-resp-image-image"
            src="/static/2ada1ece66fcc81d704c2ba46f9dd7d3/d9199/architecture.png"
            alt="Architecture"
            title="Architecture"
            loading="lazy"
            style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
          />
        </picture>
  </a>
    </span></p>
<p>Prometheus的设计理念就是保证单节点的性能、功能完整性以及单节点的使用便利性。在这个理念下，Prometheus的使用是一件很简单的事情，稍微做点配置调整就可以使用了，而且这个节点上的所有数据都是存储在其本身的物理磁盘上的（有选项可以远程存储，这里按下不表），保证了不会有跨物理节点的各种问题。</p>
<h2 id="42-集群化" style="position:relative;"><a href="#42-%E9%9B%86%E7%BE%A4%E5%8C%96" aria-label="42 集群化 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.2 集群化</h2>
<p>Prometheus将单个节点做到极致的设计理念无疑是非常出色的，但万事都没有银弹。</p>
<ul>
<li>整体的集群庞大到一定程度之后（全局的监控需求）</li>
<li>单个服务的集群扩展到一定程度（单服务的监控需求）</li>
<li>跨机房监控需求（单个机房单个Prometheus服务器，但需要有一个跳脱实例机房的节点进行overview）</li>
</ul>
<p>在这些情况下，单个节点的Prometheus可能就无法胜任了。这时候必然就需要进行水平扩展或引入分布式集群的概念。</p>
<h2 id="43-联邦集群-federation" style="position:relative;"><a href="#43-%E8%81%94%E9%82%A6%E9%9B%86%E7%BE%A4-federation" aria-label="43 联邦集群 federation permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.3 联邦集群 federation</h2>
<p>联邦集群是官方提供的Prometheus唯一的集群解决方案。这个名词听上去有点玄乎，其实简单来说：</p>
<ul>
<li>联邦集群中的Prometheus节点是分层级的</li>
<li>下级的Prometheus节点采集应用数据</li>
<li>上级的Prometheus节点从下级的Prometheus节点上采集数据</li>
</ul>
<p>有几点需要注意：</p>
<ul>
<li>下级Prometheus默认在<code class="language-text">/federate</code>endpoint暴露联邦集群的数据采集点，不需要配置</li>
<li>上级Prometheus必须在配置文件里指定<code class="language-text">params:'match[]':- '{__name__=~"node_.*"}'</code>这样的采集规则才能真正采集到数据，这方面的行为模式和Prometheus的默认模式是不一样的；默认情况下Prometheus会将暴露出来的所有数据都采集起来，但联邦集群的时候如果上级节点不指定采集的过滤参数的话，默认是什么都不采集（可能考虑到量级会有问题），因此必须手动在配置文件里进行指标名（可以组合标签）的过滤</li>
</ul>
<p>说穿了其实所谓的联邦集群也没什么内容，无非就是在启动的Prometheus节点上默认开了个<code class="language-text">/federate</code>endpoint，允许其他Prometheus从它这里拉取数据。至于联邦集群怎么组建，能玩出什么花来，Prometheus就不管了，让搭建者自己发挥。</p>
<h2 id="44-高可用" style="position:relative;"><a href="#44-%E9%AB%98%E5%8F%AF%E7%94%A8" aria-label="44 高可用 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>4.4 高可用</h2>
<p>简单的结论是：Prometheus<code class="language-text">并不存在高可用</code>的解决方案。</p>
<p>官方现在的设计是将单节点的Prometheus做好，并提供联邦集群这个解决方案让用户自己去组建自己的监控拓扑网络。这在规模比较小的时候还算能对付，但在真正规模大起来之后就很容易出错了，维护者必须很清楚联邦集群里每一个节点负责的业务内容是什么，然后各层级节点如何对应汇集数据，这非常考验整个拓扑结构的搭建者的功力，以及维护的流程和工具。</p>
<p>Prometheus当前的集群设计给我的感觉有点类似于：3.0版本之前的redis的第三方集群解决方案 与 3.0版本之后redis官方提供的集群解决方案 之间的关系。你不能说第三方做的集群解决方案不能用，但和3.0之后官方集群方案提供的高可用相比之下，不得不说就不是一个档次上的了。</p>
<p>希望今后的Prometheus能在这方面发力。当然可能在组合了K8S之后，联邦集群也够用了，这方面我还没尝试过，就不做判断了。</p>
<p>这篇可以好好看下：<a href="https://yunlzheng.gitbook.io/prometheus-book/part-ii-prometheus-jin-jie/readmd/prometheus-and-high-availability" target="_blank" rel="nofollow noopener noreferrer">Prometheus高可用</a>。</p>
<h1 id="5-prometheus监控指标" style="position:relative;"><a href="#5-prometheus%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87" aria-label="5 prometheus监控指标 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>5. Prometheus监控指标</h1>
<p>Prometheus对自身的指标也有直接暴露，默认是放在：<a href="http://url_of_prometheus_server/metrics%E3%80%82" target="_blank" rel="nofollow noopener noreferrer">http://url_of_prometheus_server/metrics。</a></p>
<p>附录里我放了一份指标，可以研究下：<a href="#ID_APP_SELF_METRICS">prometheus/metrics</a>。对于Prometheus自身的监控也是必要的。</p>
<h1 id="6-范例" style="position:relative;"><a href="#6-%E8%8C%83%E4%BE%8B" aria-label="6 范例 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>6. 范例</h1>
<p>实际的可运行范例可以查看：<a href="https://github.com/agreatfool/dist-system-practice/tree/master/experiment/prometheus/federation" target="_blank" rel="nofollow noopener noreferrer">dist-system-practice/experiment/prometheus/federation/</a>。</p>
<h1 id="7-docker实践" style="position:relative;"><a href="#7-docker%E5%AE%9E%E8%B7%B5" aria-label="7 docker实践 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>7. Docker实践</h1>
<p>Prometheus在容器内运行有些难点，主要是配置上的，官方不支持在env中覆写配置文件中的内容，只允许使用bind mount的方式将配置文件加载进容器：<a href="https://github.com/prometheus/prometheus/issues/2357" target="_blank" rel="nofollow noopener noreferrer">Support for environment variable substitution in configuration file #2357</a>。</p>
<p>这样一来所有的配置就必须使用配置文件的方式来生效，对于需要动态运行以及容器内集群支持的部署者来说就非常不友好，但官方维护者比较独裁，也没什么办法。</p>
<p>可运行范例参见：<a href="https://github.com/agreatfool/dist-system-practice/blob/master/golang/src/dist-system-practice/conf/dev/prometheus-cluster.yaml" target="_blank" rel="nofollow noopener noreferrer">dist-system-practice/conf/dev/prometheus-cluster.yaml</a>。</p>
<h1 id="8-常用监控" style="position:relative;"><a href="#8-%E5%B8%B8%E7%94%A8%E7%9B%91%E6%8E%A7" aria-label="8 常用监控 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>8. 常用监控</h1>
<h2 id="81-prometheus" style="position:relative;"><a href="#81-prometheus" aria-label="81 prometheus permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>8.1 Prometheus</h2>
<p>Prometheus自带metrics输出，自己采集自己即可，当然也可以用一个节点的prometheus将整个集群的metrics都采集起来。Grafana这边有一个2.0的Dashboard可以开箱即用，非常方便：<a href="https://grafana.com/dashboards/3662" target="_blank" rel="nofollow noopener noreferrer">Prometheus 2.0 Overview</a>。</p>
<h2 id="82-host-machine" style="position:relative;"><a href="#82-host-machine" aria-label="82 host machine permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>8.2 Host Machine</h2>
<p>主机监控需要使用node_exporter：</p>
<ul>
<li>代码：<a href="https://github.com/prometheus/node_exporter" target="_blank" rel="nofollow noopener noreferrer">prometheus/node_exporter</a></li>
<li>
<p>镜像：<a href="https://hub.docker.com/r/prom/node-exporter/" target="_blank" rel="nofollow noopener noreferrer">prom/node-exporter</a></p>
<ul>
<li>prom/node-exporter:v0.17.0</li>
</ul>
</li>
</ul>
<p>问题：</p>
<ul>
<li>之前提到过，指标默认基本上全部都开启并输出，如果需要过滤部分非常麻烦：<a href="https://github.com/prometheus/node_exporter/issues/735" target="_blank" rel="nofollow noopener noreferrer">Question: Disable all collectors?</a></li>
<li>不同的操作系统指标名不同，exporter直接将系统的指标名输出出来，因此不同系统还不同，且官方目前来看没有意愿进行抽象统一：<a href="https://github.com/prometheus/node_exporter/issues/855" target="_blank" rel="nofollow noopener noreferrer">Weird Memory Readings on macOS #855</a></li>
</ul>
<p>Grafana Dashboard：<a href="https://grafana.com/dashboards/8919" target="_blank" rel="nofollow noopener noreferrer">1 Node Exporter 0.16—0.18 for Prometheus 监控展示看板</a></p>
<blockquote>
<p>depends: grafana-cli plugins install grafana-piechart-panel</p>
</blockquote>
<h2 id="83-memcached" style="position:relative;"><a href="#83-memcached" aria-label="83 memcached permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>8.3 Memcached</h2>
<ul>
<li>Exporter代码：<a href="https://github.com/prometheus/memcached_exporter" target="_blank" rel="nofollow noopener noreferrer">prometheus/memcached_exporter</a></li>
<li>
<p>Exporter镜像：<a href="https://hub.docker.com/r/prom/memcached-exporter/" target="_blank" rel="nofollow noopener noreferrer">prom/memcached-exporter</a></p>
<ul>
<li>prom/memcached-exporter:v0.5.0</li>
</ul>
</li>
<li>Dashboard：<a href="https://grafana.com/dashboards/37" target="_blank" rel="nofollow noopener noreferrer">Prometheus memcached</a></li>
</ul>
<h2 id="84-jmx-exporter" style="position:relative;"><a href="#84-jmx-exporter" aria-label="84 jmx exporter permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>8.4 JMX Exporter</h2>
<p>官方介绍：</p>
<blockquote>
<p>JMX to Prometheus exporter: a collector that can configurably scrape and expose mBeans of a JMX target.</p>
<p>This exporter is intended to be run as a Java Agent, exposing a HTTP server and serving metrics of the local JVM. It can be also run as an independent HTTP server and scrape remote JMX targets, but this has various disadvantages, such as being harder to configure and being unable to expose process metrics (e.g., memory and CPU usage). Running the exporter as a Java Agent is thus strongly encouraged.</p>
</blockquote>
<p>大部分以JAVA为runtime的应用程序在进行监控的时候都需要使用到这个组件，因此使用频度还是相当高的。</p>
<ul>
<li>Exporter代码：<a href="https://github.com/prometheus/jmx_exporter" target="_blank" rel="nofollow noopener noreferrer">prometheus/jmx_exporter</a></li>
<li>
<p>Exporter镜像：<a href="https://hub.docker.com/r/sscaling/jmx-prometheus-exporter" target="_blank" rel="nofollow noopener noreferrer">sscaling/jmx-prometheus-exporter</a></p>
<ul>
<li>sscaling/jmx-prometheus-exporter:0.11.0</li>
</ul>
</li>
<li>Dashboard：通用的dashboard在这里比较没意义，因为使用java作为runtime的应用程序可能是web、可能是存储，多种多样，使用时需要根据应用程序进行适配的dashboard查找</li>
</ul>
<h1 id="9-todo" style="position:relative;"><a href="#9-todo" aria-label="9 todo permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>9. TODO</h1>
<p>囿于当前使用的深度及项目调研的时间限制，有部分内容做的还不够深入，后续可以考虑补全：</p>
<ul>
<li>Prometheus自身的Metrics深入研究，以便将Prometheus自身也纳入监控</li>
<li>Prometheus的Benchmark</li>
<li>PromQL深入理解</li>
<li>聚合操作：<a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-aggr-ops" target="_blank" rel="nofollow noopener noreferrer">PromQL聚合操作</a> &#x26; <a href="https://prometheus.io/docs/prometheus/latest/querying/operators/" target="_blank" rel="nofollow noopener noreferrer">OPERATORS</a></li>
<li>内置函数：<a href="https://yunlzheng.gitbook.io/prometheus-book/parti-prometheus-ji-chu/promql/prometheus-promql-functions" target="_blank" rel="nofollow noopener noreferrer">PromQL内置函数</a> &#x26; <a href="https://prometheus.io/docs/prometheus/latest/querying/functions/" target="_blank" rel="nofollow noopener noreferrer">FUNCTIONS</a></li>
<li>常用Exporter及其指标含义 及 实际可用的指标公式换算</li>
</ul>
<h1 id="资料" style="position:relative;"><a href="#%E8%B5%84%E6%96%99" aria-label="资料 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>资料</h1>
<h2 id="链接" style="position:relative;"><a href="#%E9%93%BE%E6%8E%A5" aria-label="链接 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>链接</h2>
<ul>
<li><a href="https://yunlzheng.gitbook.io/prometheus-book/" target="_blank" rel="nofollow noopener noreferrer">prometheus-book</a></li>
<li><a href="https://prometheus.io/docs/prometheus/latest/querying/basics/#instant-vector-selectors" target="_blank" rel="nofollow noopener noreferrer">Instant vector selectors</a></li>
<li><a href="https://www.robustperception.io/whats-in-a-__name__" target="_blank" rel="nofollow noopener noreferrer">What’s in a __name__?</a></li>
<li><a href="https://github.com/prometheus/node_exporter/issues/735" target="_blank" rel="nofollow noopener noreferrer">Question: Disable all collectors?</a></li>
<li><a href="https://medium.com/quiq-blog/prometheus-relabeling-tricks-6ae62c56cbda" target="_blank" rel="nofollow noopener noreferrer">Prometheus relabeling tricks</a></li>
<li><a href="https://www.jianshu.com/p/bedd169676b6" target="_blank" rel="nofollow noopener noreferrer">Prometheus的安装和配置</a></li>
<li><a href="http://www.servicemesher.com/blog/prometheus-monitor-k8s-1/" target="_blank" rel="nofollow noopener noreferrer">Prometheus监控Kubernetes系列1——监控框架</a></li>
<li><a href="http://www.servicemesher.com/blog/prometheus-monitor-k8s-2/" target="_blank" rel="nofollow noopener noreferrer">Prometheus监控Kubernetes系列2——监控部署</a></li>
<li><a href="http://www.servicemesher.com/blog/prometheus-monitor-k8s-3/" target="_blank" rel="nofollow noopener noreferrer">Prometheus监控Kubernetes系列3——业务指标采集</a></li>
</ul>
<h2 id="prometheusmetrics-id_app_self_metrics" style="position:relative;"><a href="#prometheusmetrics-id_app_self_metrics" aria-label="prometheusmetrics id_app_self_metrics permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>prometheus/metrics {#ID_APP_SELF_METRICS}</h2>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment"># HELP net_conntrack_dialer_conn_attempted_total Total number of connections attempted by the given dialer a given name.</span>
<span class="token comment"># TYPE net_conntrack_dialer_conn_attempted_total counter</span>
net_conntrack_dialer_conn_attempted_total<span class="token punctuation">{</span>dialer_name<span class="token operator">=</span><span class="token string">"federate"</span><span class="token punctuation">}</span> <span class="token number">3</span> <span class="token comment"># 这里的dialer_name其实就是job名字</span>
<span class="token comment"># HELP net_conntrack_dialer_conn_closed_total Total number of connections closed which originated from the dialer of a given name.</span>
<span class="token comment"># TYPE net_conntrack_dialer_conn_closed_total counter</span>
<span class="token punctuation">..</span>.
<span class="token comment"># HELP net_conntrack_dialer_conn_established_total Total number of connections successfully established by the given dialer a given name.</span>
<span class="token comment"># TYPE net_conntrack_dialer_conn_established_total counter</span>
<span class="token punctuation">..</span>.
<span class="token comment"># HELP net_conntrack_dialer_conn_failed_total Total number of connections failed to dial by the dialer a given name.</span>
<span class="token comment"># TYPE net_conntrack_dialer_conn_failed_total counter</span>
<span class="token punctuation">..</span>. <span class="token comment"># 这里的label：{dialer_name="federate",reason="refused|resolution|timeout|unknown"}</span>
<span class="token comment"># HELP net_conntrack_listener_conn_accepted_total Total number of connections opened to the listener of a given name.</span>
<span class="token comment"># TYPE net_conntrack_listener_conn_accepted_total counter</span>
net_conntrack_listener_conn_accepted_total<span class="token punctuation">{</span>listener_name<span class="token operator">=</span><span class="token string">"http"</span><span class="token punctuation">}</span> <span class="token number">124</span>
<span class="token comment"># HELP net_conntrack_listener_conn_closed_total Total number of connections closed that were made to the listener of a given name.</span>
<span class="token comment"># TYPE net_conntrack_listener_conn_closed_total counter</span>
net_conntrack_listener_conn_closed_total<span class="token punctuation">{</span>listener_name<span class="token operator">=</span><span class="token string">"http"</span><span class="token punctuation">}</span> <span class="token number">122</span>
<span class="token comment"># HELP prometheus_api_remote_read_queries The current number of remote read queries being executed or waiting.</span>
<span class="token comment"># TYPE prometheus_api_remote_read_queries gauge</span>
prometheus_api_remote_read_queries <span class="token number">0</span>
<span class="token comment"># HELP prometheus_build_info A metric with a constant '1' value labeled by version, revision, branch, and goversion from which prometheus was built.</span>
<span class="token comment"># TYPE prometheus_build_info gauge</span>
prometheus_build_info<span class="token punctuation">{</span>branch<span class="token operator">=</span><span class="token string">"HEAD"</span>,goversion<span class="token operator">=</span><span class="token string">"go1.11.6"</span>,revision<span class="token operator">=</span><span class="token string">"4d60eb36dcbed725fcac5b27018574118f12fffb"</span>,version<span class="token operator">=</span><span class="token string">"2.8.1"</span><span class="token punctuation">}</span> <span class="token number">1</span>
<span class="token comment"># HELP prometheus_config_last_reload_success_timestamp_seconds Timestamp of the last successful configuration reload.</span>
<span class="token comment"># TYPE prometheus_config_last_reload_success_timestamp_seconds gauge</span>
prometheus_config_last_reload_success_timestamp_seconds <span class="token number">1</span>.5547790627954009e+09
<span class="token comment"># HELP prometheus_config_last_reload_successful Whether the last configuration reload attempt was successful.</span>
<span class="token comment"># TYPE prometheus_config_last_reload_successful gauge</span>
prometheus_config_last_reload_successful <span class="token number">1</span>
<span class="token comment"># HELP prometheus_engine_queries The current number of queries being executed or waiting.</span>
<span class="token comment"># TYPE prometheus_engine_queries gauge</span>
prometheus_engine_queries <span class="token number">0</span>
<span class="token comment"># HELP prometheus_engine_queries_concurrent_max The max number of concurrent queries.</span>
<span class="token comment"># TYPE prometheus_engine_queries_concurrent_max gauge</span>
prometheus_engine_queries_concurrent_max <span class="token number">20</span>
<span class="token comment"># HELP prometheus_engine_query_duration_seconds Query timings</span>
<span class="token comment"># TYPE prometheus_engine_query_duration_seconds summary</span>
prometheus_engine_query_duration_seconds<span class="token punctuation">{</span>slice<span class="token operator">=</span><span class="token string">"inner_eval"</span>,quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_engine_query_duration_seconds<span class="token punctuation">{</span>slice<span class="token operator">=</span><span class="token string">"inner_eval"</span>,quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_engine_query_duration_seconds<span class="token punctuation">{</span>slice<span class="token operator">=</span><span class="token string">"inner_eval"</span>,quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_engine_query_duration_seconds_sum<span class="token punctuation">{</span>slice<span class="token operator">=</span><span class="token string">"inner_eval"</span><span class="token punctuation">}</span> <span class="token number">2</span>.2003e-05
<span class="token punctuation">..</span>. prepare_time <span class="token operator">|</span> queue_time <span class="token operator">|</span> result_sort
<span class="token comment"># HELP prometheus_http_request_duration_seconds Histogram of latencies for HTTP requests.</span>
<span class="token comment"># TYPE prometheus_http_request_duration_seconds histogram</span>
prometheus_http_request_duration_seconds_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"0.1"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_request_duration_seconds_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"0.2"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_request_duration_seconds_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"0.4"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_request_duration_seconds_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_request_duration_seconds_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"3"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_request_duration_seconds_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"8"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_request_duration_seconds_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"20"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_request_duration_seconds_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"60"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_request_duration_seconds_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"120"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_request_duration_seconds_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"+Inf"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_request_duration_seconds_sum<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span><span class="token punctuation">}</span> <span class="token number">0.000778872</span>
prometheus_http_request_duration_seconds_count<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span><span class="token punctuation">}</span> <span class="token number">1</span>
<span class="token punctuation">..</span>. /api/v1/query <span class="token operator">|</span> /graph <span class="token operator">|</span> /static/*filepath <span class="token operator">|</span> /targets
<span class="token comment"># HELP prometheus_http_response_size_bytes Histogram of response size for HTTP requests.</span>
<span class="token comment"># TYPE prometheus_http_response_size_bytes histogram</span>
prometheus_http_response_size_bytes_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"100"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_http_response_size_bytes_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"1000"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_response_size_bytes_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"10000"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_response_size_bytes_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"100000"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_response_size_bytes_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"1e+06"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_response_size_bytes_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"1e+07"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_response_size_bytes_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"1e+08"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_response_size_bytes_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"1e+09"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_response_size_bytes_bucket<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span>,le<span class="token operator">=</span><span class="token string">"+Inf"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_http_response_size_bytes_sum<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span><span class="token punctuation">}</span> <span class="token number">293</span>
prometheus_http_response_size_bytes_count<span class="token punctuation">{</span>handler<span class="token operator">=</span><span class="token string">"/api/v1/label/:name/values"</span><span class="token punctuation">}</span> <span class="token number">1</span>
<span class="token punctuation">..</span>. /api/v1/query <span class="token operator">|</span> /graph <span class="token operator">|</span> /static/*filepath <span class="token operator">|</span> /targets
<span class="token comment"># HELP prometheus_notifications_alertmanagers_discovered The number of alertmanagers discovered and active.</span>
<span class="token comment"># TYPE prometheus_notifications_alertmanagers_discovered gauge</span>
prometheus_notifications_alertmanagers_discovered <span class="token number">0</span>
<span class="token comment"># HELP prometheus_notifications_dropped_total Total number of alerts dropped due to errors when sending to Alertmanager.</span>
<span class="token comment"># TYPE prometheus_notifications_dropped_total counter</span>
prometheus_notifications_dropped_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_notifications_queue_capacity The capacity of the alert notifications queue.</span>
<span class="token comment"># TYPE prometheus_notifications_queue_capacity gauge</span>
prometheus_notifications_queue_capacity <span class="token number">10000</span>
<span class="token comment"># HELP prometheus_notifications_queue_length The number of alert notifications in the queue.</span>
<span class="token comment"># TYPE prometheus_notifications_queue_length gauge</span>
prometheus_notifications_queue_length <span class="token number">0</span>
<span class="token comment"># HELP prometheus_remote_storage_highest_timestamp_in_seconds Highest timestamp that has come into the remote storage via the Appender interface, in seconds since epoch.</span>
<span class="token comment"># TYPE prometheus_remote_storage_highest_timestamp_in_seconds gauge</span>
prometheus_remote_storage_highest_timestamp_in_seconds <span class="token number">1</span>.554792751e+09
<span class="token comment"># HELP prometheus_remote_storage_samples_in_total Samples in to remote storage, compare to samples out for queue managers.</span>
<span class="token comment"># TYPE prometheus_remote_storage_samples_in_total counter</span>
prometheus_remote_storage_samples_in_total <span class="token number">123185</span>
<span class="token comment"># HELP prometheus_rule_evaluation_duration_seconds The duration for a rule to execute.</span>
<span class="token comment"># TYPE prometheus_rule_evaluation_duration_seconds summary</span>
prometheus_rule_evaluation_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_rule_evaluation_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_rule_evaluation_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_rule_evaluation_duration_seconds_sum <span class="token number">0</span>
prometheus_rule_evaluation_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_rule_evaluation_failures_total The total number of rule evaluation failures.</span>
<span class="token comment"># TYPE prometheus_rule_evaluation_failures_total counter</span>
prometheus_rule_evaluation_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_rule_evaluations_total The total number of rule evaluations.</span>
<span class="token comment"># TYPE prometheus_rule_evaluations_total counter</span>
prometheus_rule_evaluations_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_rule_group_duration_seconds The duration of rule group evaluations.</span>
<span class="token comment"># TYPE prometheus_rule_group_duration_seconds summary</span>
prometheus_rule_group_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.01"</span><span class="token punctuation">}</span> NaN
prometheus_rule_group_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.05"</span><span class="token punctuation">}</span> NaN
prometheus_rule_group_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_rule_group_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_rule_group_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_rule_group_duration_seconds_sum <span class="token number">0</span>
prometheus_rule_group_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_rule_group_iterations_missed_total The total number of rule group evaluations missed due to slow rule group evaluation.</span>
<span class="token comment"># TYPE prometheus_rule_group_iterations_missed_total counter</span>
prometheus_rule_group_iterations_missed_total <span class="token number">1</span>
<span class="token comment"># HELP prometheus_rule_group_iterations_total The total number of scheduled rule group evaluations, whether executed or missed.</span>
<span class="token comment"># TYPE prometheus_rule_group_iterations_total counter</span>
prometheus_rule_group_iterations_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_azure_refresh_duration_seconds The duration of a Azure-SD refresh in seconds.</span>
<span class="token comment"># TYPE prometheus_sd_azure_refresh_duration_seconds summary</span>
prometheus_sd_azure_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_sd_azure_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_sd_azure_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_sd_azure_refresh_duration_seconds_sum <span class="token number">0</span>
prometheus_sd_azure_refresh_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_azure_refresh_failures_total Number of Azure-SD refresh failures.</span>
<span class="token comment"># TYPE prometheus_sd_azure_refresh_failures_total counter</span>
prometheus_sd_azure_refresh_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_consul_rpc_duration_seconds The duration of a Consul RPC call in seconds.</span>
<span class="token comment"># TYPE prometheus_sd_consul_rpc_duration_seconds summary</span>
prometheus_sd_consul_rpc_duration_seconds<span class="token punctuation">{</span>call<span class="token operator">=</span><span class="token string">"service"</span>,endpoint<span class="token operator">=</span><span class="token string">"catalog"</span>,quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_sd_consul_rpc_duration_seconds<span class="token punctuation">{</span>call<span class="token operator">=</span><span class="token string">"service"</span>,endpoint<span class="token operator">=</span><span class="token string">"catalog"</span>,quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_sd_consul_rpc_duration_seconds<span class="token punctuation">{</span>call<span class="token operator">=</span><span class="token string">"service"</span>,endpoint<span class="token operator">=</span><span class="token string">"catalog"</span>,quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_sd_consul_rpc_duration_seconds_sum<span class="token punctuation">{</span>call<span class="token operator">=</span><span class="token string">"service"</span>,endpoint<span class="token operator">=</span><span class="token string">"catalog"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_consul_rpc_duration_seconds_count<span class="token punctuation">{</span>call<span class="token operator">=</span><span class="token string">"service"</span>,endpoint<span class="token operator">=</span><span class="token string">"catalog"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_consul_rpc_duration_seconds<span class="token punctuation">{</span>call<span class="token operator">=</span><span class="token string">"services"</span>,endpoint<span class="token operator">=</span><span class="token string">"catalog"</span>,quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_sd_consul_rpc_duration_seconds<span class="token punctuation">{</span>call<span class="token operator">=</span><span class="token string">"services"</span>,endpoint<span class="token operator">=</span><span class="token string">"catalog"</span>,quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_sd_consul_rpc_duration_seconds<span class="token punctuation">{</span>call<span class="token operator">=</span><span class="token string">"services"</span>,endpoint<span class="token operator">=</span><span class="token string">"catalog"</span>,quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_sd_consul_rpc_duration_seconds_sum<span class="token punctuation">{</span>call<span class="token operator">=</span><span class="token string">"services"</span>,endpoint<span class="token operator">=</span><span class="token string">"catalog"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_consul_rpc_duration_seconds_count<span class="token punctuation">{</span>call<span class="token operator">=</span><span class="token string">"services"</span>,endpoint<span class="token operator">=</span><span class="token string">"catalog"</span><span class="token punctuation">}</span> <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_consul_rpc_failures_total The number of Consul RPC call failures.</span>
<span class="token comment"># TYPE prometheus_sd_consul_rpc_failures_total counter</span>
prometheus_sd_consul_rpc_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_discovered_targets Current number of discovered targets.</span>
<span class="token comment"># TYPE prometheus_sd_discovered_targets gauge</span>
prometheus_sd_discovered_targets<span class="token punctuation">{</span>config<span class="token operator">=</span><span class="token string">"federate"</span>,name<span class="token operator">=</span><span class="token string">"scrape"</span><span class="token punctuation">}</span> <span class="token number">3</span>
<span class="token comment"># HELP prometheus_sd_dns_lookup_failures_total The number of DNS-SD lookup failures.</span>
<span class="token comment"># TYPE prometheus_sd_dns_lookup_failures_total counter</span>
prometheus_sd_dns_lookup_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_dns_lookups_total The number of DNS-SD lookups.</span>
<span class="token comment"># TYPE prometheus_sd_dns_lookups_total counter</span>
prometheus_sd_dns_lookups_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_ec2_refresh_duration_seconds The duration of a EC2-SD refresh in seconds.</span>
<span class="token comment"># TYPE prometheus_sd_ec2_refresh_duration_seconds summary</span>
prometheus_sd_ec2_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_sd_ec2_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_sd_ec2_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_sd_ec2_refresh_duration_seconds_sum <span class="token number">0</span>
prometheus_sd_ec2_refresh_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_ec2_refresh_failures_total The number of EC2-SD scrape failures.</span>
<span class="token comment"># TYPE prometheus_sd_ec2_refresh_failures_total counter</span>
prometheus_sd_ec2_refresh_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_file_read_errors_total The number of File-SD read errors.</span>
<span class="token comment"># TYPE prometheus_sd_file_read_errors_total counter</span>
prometheus_sd_file_read_errors_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_file_scan_duration_seconds The duration of the File-SD scan in seconds.</span>
<span class="token comment"># TYPE prometheus_sd_file_scan_duration_seconds summary</span>
prometheus_sd_file_scan_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_sd_file_scan_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_sd_file_scan_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_sd_file_scan_duration_seconds_sum <span class="token number">0</span>
prometheus_sd_file_scan_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_gce_refresh_duration The duration of a GCE-SD refresh in seconds.</span>
<span class="token comment"># TYPE prometheus_sd_gce_refresh_duration summary</span>
prometheus_sd_gce_refresh_duration<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_sd_gce_refresh_duration<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_sd_gce_refresh_duration<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_sd_gce_refresh_duration_sum <span class="token number">0</span>
prometheus_sd_gce_refresh_duration_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_gce_refresh_failures_total The number of GCE-SD refresh failures.</span>
<span class="token comment"># TYPE prometheus_sd_gce_refresh_failures_total counter</span>
prometheus_sd_gce_refresh_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_kubernetes_cache_last_resource_version Last resource version from the Kubernetes API.</span>
<span class="token comment"># TYPE prometheus_sd_kubernetes_cache_last_resource_version gauge</span>
prometheus_sd_kubernetes_cache_last_resource_version <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_kubernetes_cache_list_duration_seconds Duration of a Kubernetes API call in seconds.</span>
<span class="token comment"># TYPE prometheus_sd_kubernetes_cache_list_duration_seconds summary</span>
prometheus_sd_kubernetes_cache_list_duration_seconds_sum <span class="token number">0</span>
prometheus_sd_kubernetes_cache_list_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_kubernetes_cache_list_items Count of items in a list from the Kubernetes API.</span>
<span class="token comment"># TYPE prometheus_sd_kubernetes_cache_list_items summary</span>
prometheus_sd_kubernetes_cache_list_items_sum <span class="token number">0</span>
prometheus_sd_kubernetes_cache_list_items_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_kubernetes_cache_list_total Total number of list operations.</span>
<span class="token comment"># TYPE prometheus_sd_kubernetes_cache_list_total counter</span>
prometheus_sd_kubernetes_cache_list_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_kubernetes_cache_short_watches_total Total number of short watch operations.</span>
<span class="token comment"># TYPE prometheus_sd_kubernetes_cache_short_watches_total counter</span>
prometheus_sd_kubernetes_cache_short_watches_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_kubernetes_cache_watch_duration_seconds Duration of watches on the Kubernetes API.</span>
<span class="token comment"># TYPE prometheus_sd_kubernetes_cache_watch_duration_seconds summary</span>
prometheus_sd_kubernetes_cache_watch_duration_seconds_sum <span class="token number">0</span>
prometheus_sd_kubernetes_cache_watch_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_kubernetes_cache_watch_events Number of items in watches on the Kubernetes API.</span>
<span class="token comment"># TYPE prometheus_sd_kubernetes_cache_watch_events summary</span>
prometheus_sd_kubernetes_cache_watch_events_sum <span class="token number">0</span>
prometheus_sd_kubernetes_cache_watch_events_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_kubernetes_cache_watches_total Total number of watch operations.</span>
<span class="token comment"># TYPE prometheus_sd_kubernetes_cache_watches_total counter</span>
prometheus_sd_kubernetes_cache_watches_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_kubernetes_events_total The number of Kubernetes events handled.</span>
<span class="token comment"># TYPE prometheus_sd_kubernetes_events_total counter</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"add"</span>,role<span class="token operator">=</span><span class="token string">"endpoints"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"add"</span>,role<span class="token operator">=</span><span class="token string">"ingress"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"add"</span>,role<span class="token operator">=</span><span class="token string">"node"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"add"</span>,role<span class="token operator">=</span><span class="token string">"pod"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"add"</span>,role<span class="token operator">=</span><span class="token string">"service"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"delete"</span>,role<span class="token operator">=</span><span class="token string">"endpoints"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"delete"</span>,role<span class="token operator">=</span><span class="token string">"ingress"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"delete"</span>,role<span class="token operator">=</span><span class="token string">"node"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"delete"</span>,role<span class="token operator">=</span><span class="token string">"pod"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"delete"</span>,role<span class="token operator">=</span><span class="token string">"service"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"update"</span>,role<span class="token operator">=</span><span class="token string">"endpoints"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"update"</span>,role<span class="token operator">=</span><span class="token string">"ingress"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"update"</span>,role<span class="token operator">=</span><span class="token string">"node"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"update"</span>,role<span class="token operator">=</span><span class="token string">"pod"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_sd_kubernetes_events_total<span class="token punctuation">{</span>event<span class="token operator">=</span><span class="token string">"update"</span>,role<span class="token operator">=</span><span class="token string">"service"</span><span class="token punctuation">}</span> <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_marathon_refresh_duration_seconds The duration of a Marathon-SD refresh in seconds.</span>
<span class="token comment"># TYPE prometheus_sd_marathon_refresh_duration_seconds summary</span>
prometheus_sd_marathon_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_sd_marathon_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_sd_marathon_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_sd_marathon_refresh_duration_seconds_sum <span class="token number">0</span>
prometheus_sd_marathon_refresh_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_marathon_refresh_failures_total The number of Marathon-SD refresh failures.</span>
<span class="token comment"># TYPE prometheus_sd_marathon_refresh_failures_total counter</span>
prometheus_sd_marathon_refresh_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_openstack_refresh_duration_seconds The duration of an OpenStack-SD refresh in seconds.</span>
<span class="token comment"># TYPE prometheus_sd_openstack_refresh_duration_seconds summary</span>
prometheus_sd_openstack_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_sd_openstack_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_sd_openstack_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_sd_openstack_refresh_duration_seconds_sum <span class="token number">0</span>
prometheus_sd_openstack_refresh_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_openstack_refresh_failures_total The number of OpenStack-SD scrape failures.</span>
<span class="token comment"># TYPE prometheus_sd_openstack_refresh_failures_total counter</span>
prometheus_sd_openstack_refresh_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_received_updates_total Total number of update events received from the SD providers.</span>
<span class="token comment"># TYPE prometheus_sd_received_updates_total counter</span>
prometheus_sd_received_updates_total<span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token string">"scrape"</span><span class="token punctuation">}</span> <span class="token number">2</span>
<span class="token comment"># HELP prometheus_sd_triton_refresh_duration_seconds The duration of a Triton-SD refresh in seconds.</span>
<span class="token comment"># TYPE prometheus_sd_triton_refresh_duration_seconds summary</span>
prometheus_sd_triton_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_sd_triton_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_sd_triton_refresh_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_sd_triton_refresh_duration_seconds_sum <span class="token number">0</span>
prometheus_sd_triton_refresh_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_triton_refresh_failures_total The number of Triton-SD scrape failures.</span>
<span class="token comment"># TYPE prometheus_sd_triton_refresh_failures_total counter</span>
prometheus_sd_triton_refresh_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_sd_updates_total Total number of update events sent to the SD consumers.</span>
<span class="token comment"># TYPE prometheus_sd_updates_total counter</span>
prometheus_sd_updates_total<span class="token punctuation">{</span>name<span class="token operator">=</span><span class="token string">"scrape"</span><span class="token punctuation">}</span> <span class="token number">1</span>
<span class="token comment"># HELP prometheus_target_interval_length_seconds Actual intervals between scrapes.</span>
<span class="token comment"># TYPE prometheus_target_interval_length_seconds summary</span>
prometheus_target_interval_length_seconds<span class="token punctuation">{</span>interval<span class="token operator">=</span><span class="token string">"15s"</span>,quantile<span class="token operator">=</span><span class="token string">"0.01"</span><span class="token punctuation">}</span> <span class="token number">14.995180776</span>
prometheus_target_interval_length_seconds<span class="token punctuation">{</span>interval<span class="token operator">=</span><span class="token string">"15s"</span>,quantile<span class="token operator">=</span><span class="token string">"0.05"</span><span class="token punctuation">}</span> <span class="token number">14.996111038</span>
prometheus_target_interval_length_seconds<span class="token punctuation">{</span>interval<span class="token operator">=</span><span class="token string">"15s"</span>,quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> <span class="token number">15.000072502</span>
prometheus_target_interval_length_seconds<span class="token punctuation">{</span>interval<span class="token operator">=</span><span class="token string">"15s"</span>,quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> <span class="token number">15.00274162</span>
prometheus_target_interval_length_seconds<span class="token punctuation">{</span>interval<span class="token operator">=</span><span class="token string">"15s"</span>,quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> <span class="token number">15.004418161</span>
prometheus_target_interval_length_seconds_sum<span class="token punctuation">{</span>interval<span class="token operator">=</span><span class="token string">"15s"</span><span class="token punctuation">}</span> <span class="token number">41010.099564205055</span>
prometheus_target_interval_length_seconds_count<span class="token punctuation">{</span>interval<span class="token operator">=</span><span class="token string">"15s"</span><span class="token punctuation">}</span> <span class="token number">2734</span>
<span class="token comment"># HELP prometheus_target_scrape_pool_reloads_failed_total Total number of failed scrape loop reloads.</span>
<span class="token comment"># TYPE prometheus_target_scrape_pool_reloads_failed_total counter</span>
prometheus_target_scrape_pool_reloads_failed_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_target_scrape_pool_reloads_total Total number of scrape loop reloads.</span>
<span class="token comment"># TYPE prometheus_target_scrape_pool_reloads_total counter</span>
prometheus_target_scrape_pool_reloads_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_target_scrape_pool_sync_total Total number of syncs that were executed on a scrape pool.</span>
<span class="token comment"># TYPE prometheus_target_scrape_pool_sync_total counter</span>
prometheus_target_scrape_pool_sync_total<span class="token punctuation">{</span>scrape_job<span class="token operator">=</span><span class="token string">"federate"</span><span class="token punctuation">}</span> <span class="token number">1</span>
<span class="token comment"># HELP prometheus_target_scrape_pools_failed_total Total number of scrape pool creations that failed.</span>
<span class="token comment"># TYPE prometheus_target_scrape_pools_failed_total counter</span>
prometheus_target_scrape_pools_failed_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_target_scrape_pools_total Total number of scrape pool creation atttempts.</span>
<span class="token comment"># TYPE prometheus_target_scrape_pools_total counter</span>
prometheus_target_scrape_pools_total <span class="token number">1</span>
<span class="token comment"># HELP prometheus_target_scrapes_exceeded_sample_limit_total Total number of scrapes that hit the sample limit and were rejected.</span>
<span class="token comment"># TYPE prometheus_target_scrapes_exceeded_sample_limit_total counter</span>
prometheus_target_scrapes_exceeded_sample_limit_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_target_scrapes_sample_duplicate_timestamp_total Total number of samples rejected due to duplicate timestamps but different values</span>
<span class="token comment"># TYPE prometheus_target_scrapes_sample_duplicate_timestamp_total counter</span>
prometheus_target_scrapes_sample_duplicate_timestamp_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_target_scrapes_sample_out_of_bounds_total Total number of samples rejected due to timestamp falling outside of the time bounds</span>
<span class="token comment"># TYPE prometheus_target_scrapes_sample_out_of_bounds_total counter</span>
prometheus_target_scrapes_sample_out_of_bounds_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_target_scrapes_sample_out_of_order_total Total number of samples rejected due to not being out of the expected order</span>
<span class="token comment"># TYPE prometheus_target_scrapes_sample_out_of_order_total counter</span>
prometheus_target_scrapes_sample_out_of_order_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_target_sync_length_seconds Actual interval to sync the scrape pool.</span>
<span class="token comment"># TYPE prometheus_target_sync_length_seconds summary</span>
prometheus_target_sync_length_seconds<span class="token punctuation">{</span>scrape_job<span class="token operator">=</span><span class="token string">"federate"</span>,quantile<span class="token operator">=</span><span class="token string">"0.01"</span><span class="token punctuation">}</span> NaN
prometheus_target_sync_length_seconds<span class="token punctuation">{</span>scrape_job<span class="token operator">=</span><span class="token string">"federate"</span>,quantile<span class="token operator">=</span><span class="token string">"0.05"</span><span class="token punctuation">}</span> NaN
prometheus_target_sync_length_seconds<span class="token punctuation">{</span>scrape_job<span class="token operator">=</span><span class="token string">"federate"</span>,quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_target_sync_length_seconds<span class="token punctuation">{</span>scrape_job<span class="token operator">=</span><span class="token string">"federate"</span>,quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_target_sync_length_seconds<span class="token punctuation">{</span>scrape_job<span class="token operator">=</span><span class="token string">"federate"</span>,quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_target_sync_length_seconds_sum<span class="token punctuation">{</span>scrape_job<span class="token operator">=</span><span class="token string">"federate"</span><span class="token punctuation">}</span> <span class="token number">0.000219783</span>
prometheus_target_sync_length_seconds_count<span class="token punctuation">{</span>scrape_job<span class="token operator">=</span><span class="token string">"federate"</span><span class="token punctuation">}</span> <span class="token number">1</span>
<span class="token comment"># HELP prometheus_template_text_expansion_failures_total The total number of template text expansion failures.</span>
<span class="token comment"># TYPE prometheus_template_text_expansion_failures_total counter</span>
prometheus_template_text_expansion_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_template_text_expansions_total The total number of template text expansions.</span>
<span class="token comment"># TYPE prometheus_template_text_expansions_total counter</span>
prometheus_template_text_expansions_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_treecache_watcher_goroutines The current number of watcher goroutines.</span>
<span class="token comment"># TYPE prometheus_treecache_watcher_goroutines gauge</span>
prometheus_treecache_watcher_goroutines <span class="token number">0</span>
<span class="token comment"># HELP prometheus_treecache_zookeeper_failures_total The total number of ZooKeeper failures.</span>
<span class="token comment"># TYPE prometheus_treecache_zookeeper_failures_total counter</span>
prometheus_treecache_zookeeper_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_blocks_loaded Number of currently loaded data blocks</span>
<span class="token comment"># TYPE prometheus_tsdb_blocks_loaded gauge</span>
prometheus_tsdb_blocks_loaded <span class="token number">1</span>
<span class="token comment"># HELP prometheus_tsdb_checkpoint_creations_failed_total Total number of checkpoint creations that failed.</span>
<span class="token comment"># TYPE prometheus_tsdb_checkpoint_creations_failed_total counter</span>
prometheus_tsdb_checkpoint_creations_failed_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_checkpoint_creations_total Total number of checkpoint creations attempted.</span>
<span class="token comment"># TYPE prometheus_tsdb_checkpoint_creations_total counter</span>
prometheus_tsdb_checkpoint_creations_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_checkpoint_deletions_failed_total Total number of checkpoint deletions that failed.</span>
<span class="token comment"># TYPE prometheus_tsdb_checkpoint_deletions_failed_total counter</span>
prometheus_tsdb_checkpoint_deletions_failed_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_checkpoint_deletions_total Total number of checkpoint deletions attempted.</span>
<span class="token comment"># TYPE prometheus_tsdb_checkpoint_deletions_total counter</span>
prometheus_tsdb_checkpoint_deletions_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_compaction_chunk_range_seconds Final time range of chunks on their first compaction</span>
<span class="token comment"># TYPE prometheus_tsdb_compaction_chunk_range_seconds histogram</span>
prometheus_tsdb_compaction_chunk_range_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"100"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_range_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"400"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_range_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"1600"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_range_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"6400"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_range_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"25600"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_range_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"102400"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_range_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"409600"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_range_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"1.6384e+06"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_range_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"6.5536e+06"</span><span class="token punctuation">}</span> <span class="token number">147</span>
prometheus_tsdb_compaction_chunk_range_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"2.62144e+07"</span><span class="token punctuation">}</span> <span class="token number">147</span>
prometheus_tsdb_compaction_chunk_range_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"+Inf"</span><span class="token punctuation">}</span> <span class="token number">147</span>
prometheus_tsdb_compaction_chunk_range_seconds_sum <span class="token number">4</span>.53475943e+08
prometheus_tsdb_compaction_chunk_range_seconds_count <span class="token number">147</span>
<span class="token comment"># HELP prometheus_tsdb_compaction_chunk_samples Final number of samples on their first compaction</span>
<span class="token comment"># TYPE prometheus_tsdb_compaction_chunk_samples histogram</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"4"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"6"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"9"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"13.5"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"20.25"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"30.375"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"45.5625"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"68.34375"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"102.515625"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"153.7734375"</span><span class="token punctuation">}</span> <span class="token number">24</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"230.66015625"</span><span class="token punctuation">}</span> <span class="token number">147</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"345.990234375"</span><span class="token punctuation">}</span> <span class="token number">147</span>
prometheus_tsdb_compaction_chunk_samples_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"+Inf"</span><span class="token punctuation">}</span> <span class="token number">147</span>
prometheus_tsdb_compaction_chunk_samples_sum <span class="token number">30343</span>
prometheus_tsdb_compaction_chunk_samples_count <span class="token number">147</span>
<span class="token comment"># HELP prometheus_tsdb_compaction_chunk_size_bytes Final size of chunks on their first compaction</span>
<span class="token comment"># TYPE prometheus_tsdb_compaction_chunk_size_bytes histogram</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"32"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"48"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"72"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"108"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"162"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"243"</span><span class="token punctuation">}</span> <span class="token number">3</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"364.5"</span><span class="token punctuation">}</span> <span class="token number">18</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"546.75"</span><span class="token punctuation">}</span> <span class="token number">18</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"820.125"</span><span class="token punctuation">}</span> <span class="token number">80</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"1230.1875"</span><span class="token punctuation">}</span> <span class="token number">103</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"1845.28125"</span><span class="token punctuation">}</span> <span class="token number">106</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"2767.921875"</span><span class="token punctuation">}</span> <span class="token number">147</span>
prometheus_tsdb_compaction_chunk_size_bytes_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"+Inf"</span><span class="token punctuation">}</span> <span class="token number">147</span>
prometheus_tsdb_compaction_chunk_size_bytes_sum <span class="token number">152382</span>
prometheus_tsdb_compaction_chunk_size_bytes_count <span class="token number">147</span>
<span class="token comment"># HELP prometheus_tsdb_compaction_duration_seconds Duration of compaction runs</span>
<span class="token comment"># TYPE prometheus_tsdb_compaction_duration_seconds histogram</span>
prometheus_tsdb_compaction_duration_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_compaction_duration_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"2"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_tsdb_compaction_duration_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"4"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_tsdb_compaction_duration_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"8"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_tsdb_compaction_duration_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"16"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_tsdb_compaction_duration_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"32"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_tsdb_compaction_duration_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"64"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_tsdb_compaction_duration_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"128"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_tsdb_compaction_duration_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"256"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_tsdb_compaction_duration_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"512"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_tsdb_compaction_duration_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"+Inf"</span><span class="token punctuation">}</span> <span class="token number">1</span>
prometheus_tsdb_compaction_duration_seconds_sum <span class="token number">1.250883887</span>
prometheus_tsdb_compaction_duration_seconds_count <span class="token number">1</span>
<span class="token comment"># HELP prometheus_tsdb_compaction_populating_block Set to 1 when a block is currently being written to the disk.</span>
<span class="token comment"># TYPE prometheus_tsdb_compaction_populating_block gauge</span>
prometheus_tsdb_compaction_populating_block <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_compactions_failed_total Total number of compactions that failed for the partition.</span>
<span class="token comment"># TYPE prometheus_tsdb_compactions_failed_total counter</span>
prometheus_tsdb_compactions_failed_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_compactions_total Total number of compactions that were executed for the partition.</span>
<span class="token comment"># TYPE prometheus_tsdb_compactions_total counter</span>
prometheus_tsdb_compactions_total <span class="token number">1</span>
<span class="token comment"># HELP prometheus_tsdb_compactions_triggered_total Total number of triggered compactions for the partition.</span>
<span class="token comment"># TYPE prometheus_tsdb_compactions_triggered_total counter</span>
prometheus_tsdb_compactions_triggered_total <span class="token number">228</span>
<span class="token comment"># HELP prometheus_tsdb_head_active_appenders Number of currently active appender transactions</span>
<span class="token comment"># TYPE prometheus_tsdb_head_active_appenders gauge</span>
prometheus_tsdb_head_active_appenders <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_head_chunks Total number of chunks in the head block.</span>
<span class="token comment"># TYPE prometheus_tsdb_head_chunks gauge</span>
prometheus_tsdb_head_chunks <span class="token number">810</span>
<span class="token comment"># HELP prometheus_tsdb_head_chunks_created_total Total number of chunks created in the head</span>
<span class="token comment"># TYPE prometheus_tsdb_head_chunks_created_total counter</span>
prometheus_tsdb_head_chunks_created_total <span class="token number">957</span>
<span class="token comment"># HELP prometheus_tsdb_head_chunks_removed_total Total number of chunks removed in the head</span>
<span class="token comment"># TYPE prometheus_tsdb_head_chunks_removed_total counter</span>
prometheus_tsdb_head_chunks_removed_total <span class="token number">147</span>
<span class="token comment"># HELP prometheus_tsdb_head_gc_duration_seconds Runtime of garbage collection in the head block.</span>
<span class="token comment"># TYPE prometheus_tsdb_head_gc_duration_seconds summary</span>
prometheus_tsdb_head_gc_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_tsdb_head_gc_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_tsdb_head_gc_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_tsdb_head_gc_duration_seconds_sum <span class="token number">0.001884575</span>
prometheus_tsdb_head_gc_duration_seconds_count <span class="token number">1</span>
<span class="token comment"># HELP prometheus_tsdb_head_max_time Maximum timestamp of the head block. The unit is decided by the library consumer.</span>
<span class="token comment"># TYPE prometheus_tsdb_head_max_time gauge</span>
prometheus_tsdb_head_max_time <span class="token number">1</span>.554792751194e+12
<span class="token comment"># HELP prometheus_tsdb_head_max_time_seconds Maximum timestamp of the head block.</span>
<span class="token comment"># TYPE prometheus_tsdb_head_max_time_seconds gauge</span>
prometheus_tsdb_head_max_time_seconds <span class="token number">1</span>.554792751194e+09
<span class="token comment"># HELP prometheus_tsdb_head_min_time Minimum time bound of the head block. The unit is decided by the library consumer.</span>
<span class="token comment"># TYPE prometheus_tsdb_head_min_time gauge</span>
prometheus_tsdb_head_min_time <span class="token number">1</span>.5547824e+12
<span class="token comment"># HELP prometheus_tsdb_head_min_time_seconds Minimum time bound of the head block.</span>
<span class="token comment"># TYPE prometheus_tsdb_head_min_time_seconds gauge</span>
prometheus_tsdb_head_min_time_seconds <span class="token number">1</span>.5547824e+09
<span class="token comment"># HELP prometheus_tsdb_head_samples_appended_total Total number of appended samples.</span>
<span class="token comment"># TYPE prometheus_tsdb_head_samples_appended_total counter</span>
prometheus_tsdb_head_samples_appended_total <span class="token number">123185</span>
<span class="token comment"># HELP prometheus_tsdb_head_series Total number of series in the head block.</span>
<span class="token comment"># TYPE prometheus_tsdb_head_series gauge</span>
prometheus_tsdb_head_series <span class="token number">135</span>
<span class="token comment"># HELP prometheus_tsdb_head_series_created_total Total number of series created in the head</span>
<span class="token comment"># TYPE prometheus_tsdb_head_series_created_total counter</span>
prometheus_tsdb_head_series_created_total <span class="token number">135</span>
<span class="token comment"># HELP prometheus_tsdb_head_series_not_found_total Total number of requests for series that were not found.</span>
<span class="token comment"># TYPE prometheus_tsdb_head_series_not_found_total counter</span>
prometheus_tsdb_head_series_not_found_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_head_series_removed_total Total number of series removed in the head</span>
<span class="token comment"># TYPE prometheus_tsdb_head_series_removed_total counter</span>
prometheus_tsdb_head_series_removed_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_head_truncations_failed_total Total number of head truncations that failed.</span>
<span class="token comment"># TYPE prometheus_tsdb_head_truncations_failed_total counter</span>
prometheus_tsdb_head_truncations_failed_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_head_truncations_total Total number of head truncations attempted.</span>
<span class="token comment"># TYPE prometheus_tsdb_head_truncations_total counter</span>
prometheus_tsdb_head_truncations_total <span class="token number">1</span>
<span class="token comment"># HELP prometheus_tsdb_lowest_timestamp Lowest timestamp value stored in the database. The unit is decided by the library consumer.</span>
<span class="token comment"># TYPE prometheus_tsdb_lowest_timestamp gauge</span>
prometheus_tsdb_lowest_timestamp <span class="token number">1</span>.55477867699e+12
<span class="token comment"># HELP prometheus_tsdb_lowest_timestamp_seconds Lowest timestamp value stored in the database.</span>
<span class="token comment"># TYPE prometheus_tsdb_lowest_timestamp_seconds gauge</span>
prometheus_tsdb_lowest_timestamp_seconds <span class="token number">1</span>.55477867699e+09
<span class="token comment"># HELP prometheus_tsdb_reloads_failures_total Number of times the database failed to reload block data from disk.</span>
<span class="token comment"># TYPE prometheus_tsdb_reloads_failures_total counter</span>
prometheus_tsdb_reloads_failures_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_reloads_total Number of times the database reloaded block data from disk.</span>
<span class="token comment"># TYPE prometheus_tsdb_reloads_total counter</span>
prometheus_tsdb_reloads_total <span class="token number">2</span>
<span class="token comment"># HELP prometheus_tsdb_size_retentions_total The number of times that blocks were deleted because the maximum number of bytes was exceeded.</span>
<span class="token comment"># TYPE prometheus_tsdb_size_retentions_total counter</span>
prometheus_tsdb_size_retentions_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_storage_blocks_bytes The number of bytes that are currently used for local storage by all blocks.</span>
<span class="token comment"># TYPE prometheus_tsdb_storage_blocks_bytes gauge</span>
prometheus_tsdb_storage_blocks_bytes <span class="token number">165474</span>
<span class="token comment"># HELP prometheus_tsdb_symbol_table_size_bytes Size of symbol table on disk (in bytes)</span>
<span class="token comment"># TYPE prometheus_tsdb_symbol_table_size_bytes gauge</span>
prometheus_tsdb_symbol_table_size_bytes <span class="token number">1807</span>
<span class="token comment"># HELP prometheus_tsdb_time_retentions_total The number of times that blocks were deleted because the maximum time limit was exceeded.</span>
<span class="token comment"># TYPE prometheus_tsdb_time_retentions_total counter</span>
prometheus_tsdb_time_retentions_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_tombstone_cleanup_seconds The time taken to recompact blocks to remove tombstones.</span>
<span class="token comment"># TYPE prometheus_tsdb_tombstone_cleanup_seconds histogram</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"0.005"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"0.01"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"0.025"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"0.05"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"0.1"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"0.25"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"2.5"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"5"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"10"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_bucket<span class="token punctuation">{</span>le<span class="token operator">=</span><span class="token string">"+Inf"</span><span class="token punctuation">}</span> <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_sum <span class="token number">0</span>
prometheus_tsdb_tombstone_cleanup_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_vertical_compactions_total Total number of compactions done on overlapping blocks.</span>
<span class="token comment"># TYPE prometheus_tsdb_vertical_compactions_total counter</span>
prometheus_tsdb_vertical_compactions_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_wal_completed_pages_total Total number of completed pages.</span>
<span class="token comment"># TYPE prometheus_tsdb_wal_completed_pages_total counter</span>
prometheus_tsdb_wal_completed_pages_total <span class="token number">42</span>
<span class="token comment"># HELP prometheus_tsdb_wal_corruptions_total Total number of WAL corruptions.</span>
<span class="token comment"># TYPE prometheus_tsdb_wal_corruptions_total counter</span>
prometheus_tsdb_wal_corruptions_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_wal_fsync_duration_seconds Duration of WAL fsync.</span>
<span class="token comment"># TYPE prometheus_tsdb_wal_fsync_duration_seconds summary</span>
prometheus_tsdb_wal_fsync_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_tsdb_wal_fsync_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_tsdb_wal_fsync_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_tsdb_wal_fsync_duration_seconds_sum <span class="token number">0</span>
prometheus_tsdb_wal_fsync_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_wal_page_flushes_total Total number of page flushes.</span>
<span class="token comment"># TYPE prometheus_tsdb_wal_page_flushes_total counter</span>
prometheus_tsdb_wal_page_flushes_total <span class="token number">5519</span>
<span class="token comment"># HELP prometheus_tsdb_wal_truncate_duration_seconds Duration of WAL truncation.</span>
<span class="token comment"># TYPE prometheus_tsdb_wal_truncate_duration_seconds summary</span>
prometheus_tsdb_wal_truncate_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">}</span> NaN
prometheus_tsdb_wal_truncate_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.9"</span><span class="token punctuation">}</span> NaN
prometheus_tsdb_wal_truncate_duration_seconds<span class="token punctuation">{</span>quantile<span class="token operator">=</span><span class="token string">"0.99"</span><span class="token punctuation">}</span> NaN
prometheus_tsdb_wal_truncate_duration_seconds_sum <span class="token number">0</span>
prometheus_tsdb_wal_truncate_duration_seconds_count <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_wal_truncations_failed_total Total number of WAL truncations that failed.</span>
<span class="token comment"># TYPE prometheus_tsdb_wal_truncations_failed_total counter</span>
prometheus_tsdb_wal_truncations_failed_total <span class="token number">0</span>
<span class="token comment"># HELP prometheus_tsdb_wal_truncations_total Total number of WAL truncations attempted.</span>
<span class="token comment"># TYPE prometheus_tsdb_wal_truncations_total counter</span>
prometheus_tsdb_wal_truncations_total <span class="token number">0</span>
<span class="token comment"># HELP promhttp_metric_handler_requests_in_flight Current number of scrapes being served.</span>
<span class="token comment"># TYPE promhttp_metric_handler_requests_in_flight gauge</span>
promhttp_metric_handler_requests_in_flight <span class="token number">1</span>
<span class="token comment"># HELP promhttp_metric_handler_requests_total Total number of scrapes by HTTP status code.</span>
<span class="token comment"># TYPE promhttp_metric_handler_requests_total counter</span>
promhttp_metric_handler_requests_total<span class="token punctuation">{</span>code<span class="token operator">=</span><span class="token string">"200"</span><span class="token punctuation">}</span> <span class="token number">0</span>
promhttp_metric_handler_requests_total<span class="token punctuation">{</span>code<span class="token operator">=</span><span class="token string">"500"</span><span class="token punctuation">}</span> <span class="token number">0</span>
promhttp_metric_handler_requests_total<span class="token punctuation">{</span>code<span class="token operator">=</span><span class="token string">"503"</span><span class="token punctuation">}</span> <span class="token number">0</span></code></pre></div>
<h2 id="prometheus--h-id_app_prometheus_help" style="position:relative;"><a href="#prometheus--h-id_app_prometheus_help" aria-label="prometheus  h id_app_prometheus_help permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>prometheus -h {#ID_APP_PROMETHEUS_HELP}</h2>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">prometheus -h
usage: prometheus [&lt;flags>]

The Prometheus monitoring server

Flags:
  -h, --help                     Show context-sensitive help (also try --help-long and --help-man).
      --version                  Show application version.
      --config.file="prometheus.yml"
                                 Prometheus configuration file path.
      --web.listen-address="0.0.0.0:9090"
                                 Address to listen on for UI, API, and telemetry.
      --web.read-timeout=5m      Maximum duration before timing out read of the request, and closing idle connections.
      --web.max-connections=512  Maximum number of simultaneous connections.
      --web.external-url=&lt;URL>   The URL under which Prometheus is externally reachable (for example, if Prometheus is served via a reverse proxy). Used for generating
                                 relative and absolute links back to Prometheus itself. If the URL has a path portion, it will be used to prefix all HTTP endpoints
                                 served by Prometheus. If omitted, relevant URL components will be derived automatically.
      --web.route-prefix=&lt;path>  Prefix for the internal routes of web endpoints. Defaults to path of --web.external-url.
      --web.user-assets=&lt;path>   Path to static asset directory, available at /user.
      --web.enable-lifecycle     Enable shutdown and reload via HTTP request.
      --web.enable-admin-api     Enable API endpoints for admin control actions.
      --web.console.templates="consoles"
                                 Path to the console template directory, available at /consoles.
      --web.console.libraries="console_libraries"
                                 Path to the console library directory.
      --web.page-title="Prometheus Time Series Collection and Processing Server"
                                 Document title of Prometheus instance.
      --storage.tsdb.path="data/"
                                 Base path for metrics storage.
      --storage.tsdb.retention=STORAGE.TSDB.RETENTION
                                 [DEPRECATED] How long to retain samples in storage. This flag has been deprecated, use "storage.tsdb.retention.time" instead
      --storage.tsdb.retention.time=STORAGE.TSDB.RETENTION.TIME
                                 How long to retain samples in storage. When this flag is set it overrides "storage.tsdb.retention". If neither this flag nor
                                 "storage.tsdb.retention" nor "storage.tsdb.retention.size" is set, the retention time defaults to 15d.
      --storage.tsdb.retention.size=STORAGE.TSDB.RETENTION.SIZE
                                 [EXPERIMENTAL] Maximum number of bytes that can be stored for blocks. Units supported: KB, MB, GB, TB, PB. This flag is experimental and
                                 can be changed in future releases.
      --storage.tsdb.no-lockfile
                                 Do not create lockfile in data directory.
      --storage.tsdb.allow-overlapping-blocks
                                 [EXPERIMENTAL] Allow overlapping blocks which in-turn enables vertical compaction and vertical query merge.
      --storage.remote.flush-deadline=&lt;duration>
                                 How long to wait flushing sample on shutdown or config reload.
      --storage.remote.read-sample-limit=5e7
                                 Maximum overall number of samples to return via the remote read interface, in a single query. 0 means no limit.
      --storage.remote.read-concurrent-limit=10
                                 Maximum number of concurrent remote read calls. 0 means no limit.
      --rules.alert.for-outage-tolerance=1h
                                 Max time to tolerate prometheus outage for restoring 'for' state of alert.
      --rules.alert.for-grace-period=10m
                                 Minimum duration between alert and restored 'for' state. This is maintained only for alerts with configured 'for' time greater than
                                 grace period.
      --rules.alert.resend-delay=1m
                                 Minimum amount of time to wait before resending an alert to Alertmanager.
      --alertmanager.notification-queue-capacity=10000
                                 The capacity of the queue for pending Alertmanager notifications.
      --alertmanager.timeout=10s
                                 Timeout for sending alerts to Alertmanager.
      --query.lookback-delta=5m  The delta difference allowed for retrieving metrics during expression evaluations.
      --query.timeout=2m         Maximum time a query may take before being aborted.
      --query.max-concurrency=20
                                 Maximum number of queries executed concurrently.
      --query.max-samples=50000000
                                 Maximum number of samples a single query can load into memory. Note that queries will fail if they would load more samples than this
                                 into memory, so this also limits the number of samples a query can return.
      --web.cors.origin=".*"     Regex for CORS origin. It is fully anchored. Eg. 'https?://(domain1|domain2)\.com'
      --log.level=info           Only log messages with the given severity or above. One of: [debug, info, warn, error]
      --log.format=logfmt        Output format of log messages. One of: [logfmt, json]</code></pre></div>
<h2 id="comparison-to-alternatives-id_app_cta" style="position:relative;"><a href="#comparison-to-alternatives-id_app_cta" aria-label="comparison to alternatives id_app_cta permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>COMPARISON TO ALTERNATIVES {#ID_APP_CTA}</h2>
<h3 id="prometheus-vs-graphite" style="position:relative;"><a href="#prometheus-vs-graphite" aria-label="prometheus vs graphite permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prometheus vs. Graphite</h3>
<h4 id="scope" style="position:relative;"><a href="#scope" aria-label="scope permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scope</h4>
<p>Graphite专注于被动的时序数据库加上查询语言加上展示界面功能。任何其他的功能点都由外部组件提供。</p>
<p>Prometheus是一个全面的监控和趋势追踪系统，包含了基于时序数据库的内建的主动式获取、存储、查询、图像化以及报警功能。在Prometheus中定义了何谓正确的行为（哪些终端应该存在，哪些时序模式意味着错误，等等），并能够主动查找错误。</p>
<h4 id="data-model" style="position:relative;"><a href="#data-model" aria-label="data model permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Data model</h4>
<p>Graphite在命名的时序字段内存储数字化的采样值，这和Prometheus类似。然而，Prometheus的metadata模型更丰富：Graphite的metric由<code class="language-text">.</code>分隔的组件组成，并隐式编码维度，而Prometheus则显示地将维度编码为键值对，这被称为labels，并附加在metric上。这使得使用labels进行过滤、分组、匹配更为简单。</p>
<p>更进一步，特别当Graphite与StatsD结合使用的时候，通常会仅存储所有被监控实例的聚合数据，而不是将实例作为一个维度进行保存，并能够深入挖掘单独的有问题实例。</p>
<p>举例来说，存储响应码为<code class="language-text">500</code>、方法为<code class="language-text">POST</code>、发送到API服务器上<code class="language-text">/tracks</code>端点的HTTP请求数量，一般在Graphite/StatsD会存储为：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">stats.api-server.tracks.post.500 -> 93</code></pre></div>
<p>在Prometheus中，相同的数据则会被编码为（假设有三个API服务器实例）：</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">api_server_http_requests_total{method="POST",handler="/tracks",status="500",instance="&lt;sample1>"} -> 34
api_server_http_requests_total{method="POST",handler="/tracks",status="500",instance="&lt;sample2>"} -> 28
api_server_http_requests_total{method="POST",handler="/tracks",status="500",instance="&lt;sample3>"} -> 31</code></pre></div>
<h4 id="storage" style="position:relative;"><a href="#storage" aria-label="storage permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Storage</h4>
<p>Graphite将时序数据以Whisper格式存储在本地磁盘上，这是一个RDD-style的数据库，要求采样数据以固定间隔存储进入。每个时序数据被存储为单独的文件，而每隔一段固定时长，新的采样数据则会覆盖旧的数据。</p>
<p>Prometheus也会在本地磁盘按照每个时序数据创建一个本地文件，但允许采样数据按随机的时间间隔进行存储，只要采样行为和规则评估行为发生。由于新的数据会被简单附加在后面，旧的数据会被保存不定时长。Prometheus在处理短存活周期、频繁变动的时序数据时也能很好工作。</p>
<h4 id="summary" style="position:relative;"><a href="#summary" aria-label="summary permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h4>
<p>Prometheus提供了更丰富的数据模型和查询语言，此外还更容易运行并整合进你的环境。但如果你希望一个集群化的解决方案，并希望能长期保存历史数据，那么Graphite会是一个更好的选择。</p>
<h3 id="prometheus-vs-influxdb" style="position:relative;"><a href="#prometheus-vs-influxdb" aria-label="prometheus vs influxdb permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prometheus vs. InfluxDB</h3>
<p>InfluxDB是一个开源的时序数据库，并有一个可扩展和可集群化的商业选项。InfluxDB项目是在Prometheus的研发开始之后一年才被release出来的，因此我们之前无法将其作为一个竞品进行考虑。当然，Prometheus和InfluxDB之间还是有显著区别的，并且双方系统都是朝着不同的用例进行设计实施的。</p>
<h4 id="scope-1" style="position:relative;"><a href="#scope-1" aria-label="scope 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scope</h4>
<p>为了公平起见，我们还必须将Kapacitor和InfluxDB一起考虑，将这两者组合起来之后，他们解决的是和Prometheus以及Alertmanager相同的问题领域。</p>
<p>在scope方面，InfluxDB和Graphite对Prometheus的差异是类似的。除此之外，InfluxDB提供了连续查询（continuous queries），和Prometheus的记录规则（recording rules）是等价的。</p>
<p>Kapacitor的领域则是Prometheus记录规则（recording rules）、报警规则（alerting rules）以及Alertmanager的通知功能的综合。Prometheus提供了相对来说更强大的查询语言与图像化、报警功能。Prometheus Alertmanager额外提供了分组、去重以及静默功能。</p>
<h4 id="data-model--storage" style="position:relative;"><a href="#data-model--storage" aria-label="data model  storage permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Data model / storage</h4>
<p>和Prometheus类似，InfluxDB数据模型也使用键值对作为labels，在InfluxDB中这被称为tags。此外，InfluxDB拥有一个二级labels被称为fields，这个fields在使用上更受限。InfluxDB支持纳秒级别的timestamps，以及float64、int64、bool、字符串，这几种数据类型。Prometheus，根据约定，支持float64数据类型以及支持受限的字符串，以及毫秒级别的timestamps。</p>
<p>INfulxDB使用带有预写日志的多样的 log-structured merge tree 来进行存储。这比Prometheus的每种时间序列仅追加的文件方案更加适合进行事件日志。</p>
<p>日志和Metrics以及图，描述了事件日志和Metrics记录之间的区别。</p>
<h4 id="architecture" style="position:relative;"><a href="#architecture" aria-label="architecture permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Architecture</h4>
<p>Prometheus服务器每一个都是单独运行的，与其他服务器分离，并仅依赖它们的本地存储来进行核心功能服务：抓取数据、规则处理，以及警告。开源版本的InfluxDB也是类似的。</p>
<p>商业版的InfluxDB提供了，按设计所述，一个分布式存储集群，同时有许多集群节点处理存储和查询。</p>
<p>这意味着商业版的InfluxDB更容易水平扩展，但这也意味着必须一开始就处理一个复杂的分布式存储系统。Prometheus更容易使用，但在某个时间点将必须手动地根据扩展边界来拓展服务器，比如说根据产品、服务、数据中心，或类似的概念。单独的服务器（可以平行运作）也可以给你更好的可靠性以及错误隔离。</p>
<p>Kapacitor的开源release并没有内建的针对规则、警告、通知的分布式/冗余选项。开源版本可以通过用户手动分割的方式进行扩展，类似于Prometheus。Influx提供了企业版本的Kapacitor，支持高可用/冗余的告警系统。</p>
<p>Prometheus以及Alertmanager按约定提供了一个完全开源的冗余选项，通过运行冗余的Prometheus复制（replicas），以及使用Alertmanager的高可用模式。</p>
<h4 id="summary-1" style="position:relative;"><a href="#summary-1" aria-label="summary 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h4>
<p>Prometheus和InfluxDB系统有诸多相似之处。都具有labels（在InfluxDB里被称为tags）来支持高效的多维度metrics。都使用相同的数据压缩算法。都有扩展集成。都有钩子允许你拓展它们的功能，比如说在统计工具中分析数据或进行自动化处理等。</p>
<p>InfluxDB做的更好的地方：</p>
<ul>
<li>使用InfluxDB系统进行事件日志处理</li>
<li>商业版本提供了系统集群化，对长期的数据存储来说也是更好的选择</li>
<li>在多个复制之间保持数据的最终一致性</li>
</ul>
<p>Prometheus做的更好的地方：</p>
<ul>
<li>使用Prometheus系统来进行metrics监控</li>
<li>更强大的查询语言、报警以及通知功能</li>
<li>高可用以及图像化的运行时长以及报警</li>
</ul>
<p>InfluxDB是由单一商业公司维护的，其模式为：核心功能开源，提供会员功能比如说闭源的集群功能、托管功能以及支持。Prometheus是一个完全开源且独立的项目，由一系列公司及独立个体进行维护，部分其中的成员也提供商业服务及支持。</p>
<h3 id="prometheus-vs-opentsdb" style="position:relative;"><a href="#prometheus-vs-opentsdb" aria-label="prometheus vs opentsdb permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prometheus vs. OpenTSDB</h3>
<p>OpenTSDB是一个分布式的时序数据库，基于Hadoop以及HBase。</p>
<h4 id="scope-2" style="position:relative;"><a href="#scope-2" aria-label="scope 2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scope</h4>
<p>在scope方面，其与Prometheus的差别和Graphite一样。</p>
<h4 id="data-model-1" style="position:relative;"><a href="#data-model-1" aria-label="data model 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Data model</h4>
<p>OpenTSDB的数据模型基本上和Prometheus是一致的：时序由一系列任意的键值对进行识别（OpenTSDB中的tags就是Prometheus中的labels）。针对一个metrics的数据是存储在一起的，限制metrics的基数。也有些微的不同：Prometheus允许label值中存在任意的字符，而OpenTSDB则更具有限制性。OpenTSDB也缺乏一个查询语言，仅允许通过API进行简单的聚合以及数学查询。</p>
<h4 id="storage-1" style="position:relative;"><a href="#storage-1" aria-label="storage 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Storage</h4>
<p>OpenTSDB的存储是基于Hadoop以及HBase进行实现的。这意味着对OpenTSDB进行水平扩展是容易的，但你必须接受从一开始就运作一个Hadoop/HBase集群的复杂性。</p>
<p>Prometheus作为初始是非常容易直接开始运作的，但当单节点已经无法承载的时候则需要手动进行进行分片。</p>
<h4 id="summary-2" style="position:relative;"><a href="#summary-2" aria-label="summary 2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h4>
<p>Prometheus提供了更丰富的查询语言，能处理更高的metrics技术，并胜任一个完整的监控系统。如果你已经有运行中的Hadoop集群，且希望拥有一个长期的数据存储更胜于之前所述的优点，那OpenTSDB就是更好的选择。</p>
<h3 id="prometheus-vs-nagios" style="position:relative;"><a href="#prometheus-vs-nagios" aria-label="prometheus vs nagios permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prometheus vs. Nagios</h3>
<p>Nagios是由NetSaint公司自1990年代开始发起的一个监控系统。</p>
<h4 id="scope-3" style="position:relative;"><a href="#scope-3" aria-label="scope 3 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scope</h4>
<p>Nagios是一个主要基于已经存在的脚本代码进行告警的系统。这些被称为<code class="language-text">checks</code>。可以针对单独的告警进行静默处理，然而并没有分组、路由以及去重。</p>
<p>Nagios拥有大量的插件。举例来说，使用几K的perfData插件就能允许向一个时序数据库（例如Graphite）输出数据或者使用NRPE就可以在远程机器上运行checks。</p>
<h4 id="data-model-2" style="position:relative;"><a href="#data-model-2" aria-label="data model 2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Data model</h4>
<p>Nagios是基于主机的。每个主机可以有一个或多个服务，然后每个服务可以运行一个check。</p>
<p>并不存在labels的概念或一个查询语言。</p>
<h4 id="storage-2" style="position:relative;"><a href="#storage-2" aria-label="storage 2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Storage</h4>
<p>Nagios并没有存储，只有状态check。有插件可以存储数据来进行图形化。</p>
<h4 id="architecture-1" style="position:relative;"><a href="#architecture-1" aria-label="architecture 1 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Architecture</h4>
<p>Nagios服务器是独立运作的。所有的checks都是通过配置文件来进行管理的。</p>
<h4 id="summary-3" style="position:relative;"><a href="#summary-3" aria-label="summary 3 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h4>
<p>Nagios适合小型的静态的系统的基本监控（基本上是黑盒状态）。</p>
<p>如果你希望拥有可调整的白盒监控，或拥有一个动态的基于云的环境，那么Prometheus是更好的选择。</p>
<h3 id="prometheus-vs-sensu" style="position:relative;"><a href="#prometheus-vs-sensu" aria-label="prometheus vs sensu permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Prometheus vs. Sensu</h3>
<p>Sensu是一个可编组的监控管线，可以复用已经存在的Nagios checks。</p>
<h4 id="scope-4" style="position:relative;"><a href="#scope-4" aria-label="scope 4 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Scope</h4>
<p>在scope方面其和Nagios是一致的。</p>
<p>由客户端socket来支持将临时的check结果推送到Sensu。</p>
<h4 id="data-model-3" style="position:relative;"><a href="#data-model-3" aria-label="data model 3 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Data model</h4>
<p>Sensu的数据模型和Nagios一致。</p>
<h4 id="storage-3" style="position:relative;"><a href="#storage-3" aria-label="storage 3 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Storage</h4>
<p>Sensu使用Redis来持久化监控数据，包括了Sensu的客户端注册，check结果，check执行历史，以及当前的事件数据。</p>
<h4 id="architecture-2" style="position:relative;"><a href="#architecture-2" aria-label="architecture 2 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Architecture</h4>
<p>Sensu有一系列的组件。它使用RabbitMQ来传输数据，Redis来处理当前状态，以及一个单独的服务器来处理访问请求。</p>
<p>一个Sensu部署的所有组件（RabbitMQ、Redis以及Sensu 服务器/API）可以做成集群化来支持高可用、冗余配置。</p>
<h4 id="summary-4" style="position:relative;"><a href="#summary-4" aria-label="summary 4 permalink" class="anchor before"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Summary</h4>
<p>如果你手头有一个存在的Nagios，且你希望扩展它，或者希望利用Sensu的自动化注册功能，那么Sensu是一个好选择。</p>
<p>如果你希望进行白盒监控，或希望有动态的基于云的环境，那么Prometheus是一个好的选择。</p>
<blockquote>
<p>EOF</p>
</blockquote></div></div></div><div class="Post-module--post__footer--3WzWU"><div><p class="Meta-module--meta__date--29eD7">Published <!-- -->2019/4/9</p></div><div class="Tags-module--tags--1L_ct"><ul class="Tags-module--tags__list--91FqN"><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/prometheus/">Prometheus</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/monitor/">Monitor</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/metrics/">Metrics</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/dev-ops/">DevOps</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/time-series-db/">TimeSeriesDB</a></li><li class="Tags-module--tags__list-item--1M30P"><a class="Tags-module--tags__list-item-link--3SL_8" href="/tag/keynote/">Keynote</a></li></ul></div><div class="Author-module--author--2Yefr"><p>Some tech &amp; personal blog posts<a class="Author-module--author__bio-twitter--n-O9n" href="https://github.com/agreatfool" rel="noopener noreferrer" target="_blank"><strong>Jonathan Dai</strong> on Github</a></p></div></div><div class="Post-module--post__comments--25y6I"><div><div id="disqus_thread"></div></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/2019/04/prometheus-note";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-6c97a84da242e3df27de.js"],"app":["/app-b6f74eeafda9215d2765.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-a95b272f8c25b9a8a758.js"],"component---src-templates-categories-list-template-js":["/component---src-templates-categories-list-template-js-0b5ec6331b346faff87c.js"],"component---src-templates-category-template-js":["/component---src-templates-category-template-js-a615ce56a55260054f6f.js"],"component---src-templates-index-template-js":["/component---src-templates-index-template-js-43f4f445a747fad1c9ab.js"],"component---src-templates-not-found-template-js":["/component---src-templates-not-found-template-js-5a6b0b2cd3a2384575c3.js"],"component---src-templates-page-template-js":["/component---src-templates-page-template-js-a00ead819a9bad15ee62.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-5ab2f930c9fb4b9f1d39.js"],"component---src-templates-tag-template-js":["/component---src-templates-tag-template-js-6c6b9db9009c5b087140.js"],"component---src-templates-tags-list-template-js":["/component---src-templates-tags-list-template-js-ab1fa84c826a4bf3640a.js"]};/*]]>*/</script><script src="/polyfill-6c97a84da242e3df27de.js" nomodule=""></script><script src="/component---src-templates-post-template-js-5ab2f930c9fb4b9f1d39.js" async=""></script><script src="/cd95ea5cbd2c605f26db819f07999610c9ff4310-69626fa07c736046dbe7.js" async=""></script><script src="/styles-407fe62976dc5310c43e.js" async=""></script><script src="/app-b6f74eeafda9215d2765.js" async=""></script><script src="/dc6a8720040df98778fe970bf6c000a41750d3ae-ae9f57b3df6a2a1f7657.js" async=""></script><script src="/532a2f07-7be199ac103747a90c37.js" async=""></script><script src="/framework-0c07c9218e9798907e47.js" async=""></script><script src="/webpack-runtime-09dc584798815dcead78.js" async=""></script></body></html>